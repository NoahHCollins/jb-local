

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>ODE solvers (or time-stepping methods - numerical solution of IVPs) 2 &#8212; Modelling and Numerical Methods</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter10/Lecture 10.1 - ODE Solver';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="9. PDE Solvers: Finite Difference Methods 2" href="../Chapter11/intro.html" />
    <link rel="prev" title="10. ODE Solvers 2" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Modelling and Numerical Methods
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Analytical Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter1/intro.html">1. Intro to Vector/Tensor Calculus</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.1%20-%20Intro%20to%20Vectors.html">1.1 Continuum Mechanics and Vector Calculus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.2%20-%20Vector%20Transformations.html">1.2 Vector Transformations  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.3%20-%20Intro%20to%20Tensors.html">1.3 Intro to Tensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/exercises.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/solutions.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter2/intro.html">2. Stress Tensor</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/Lecture%202%20-%20Stress%20and%20Tensors.html">2.1 Stress and Tensors  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/exercises2.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/solutions2.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter3/intro.html">3. Kinematics and Strain</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/Lecture%203%20-%20Kinematics.html">3.1 Kinematics   <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/exercises3.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/solutions3.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter4/intro.html">4. Conservation Equations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Lecture%204.1%20-%20Conservation%20Equations.html">4.1 Conservation Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Lecture%204.2%20-%20Rheology.html">4.2 Rheology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/exercises4.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/solutions4.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter5/intro.html">5. Dimensional Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter5/Lecture%205%20-%20Dimensions%20and%20Dimensional%20Analysis.html">5.1 Dimensions and Dimensional Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter5/Worksheet.html">Worksheet  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter5/Solutions.html">Solutions  <a class="tocSkip"></a></a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Numerical Solutions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter6/intro.html">6. Potential Flow</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/Lecture%206%20-%20Potential%20Flow.html">6.1 Potential Flow  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/Worksheet.html">Worksheet  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/Solutions.html">Solutions  <a class="tocSkip"></a></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter7/intro.html">7. Navier-Stokes</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/Lecture%207.1%20-%20Navier-Stokes.html">7.1 Solving Navier-Stokes Numerically</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/SolversIntro.html">Solvers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter8/intro.html">8. Turbulence and Non-Newtonian Flows</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Lecture%208.1%20-%20Turbulent%20and%20Non-Newtonian%20Flows.html">8.1 Turbulent and Non-Newtonian Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Solutions.html">Solutions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Numerical Techniques</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter9/intro.html">9. Interpolation Quadrature 2</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter9/Lecture%209.1%20-%20interpolation%20quadrature.html">9.1 Interpolation &amp; Quadrature 2 <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter9/Homework.html">Homework <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter9/Solutions.html">Solutions <a class="tocSkip"></a></a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">10. ODE Solvers 2</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">ODE solvers (or time-stepping methods - numerical solution of IVPs) 2 <a class="tocSkip"></a></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter11/intro.html">9. PDE Solvers: Finite Difference Methods 2</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter11/Lecture%2011%20-%20PDE%20Solvers%20-%20Finite%20Difference%20Methods%202.html">PDE Solvers: Finite Difference Methods 2 <a class="tocSkip"></a></a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FChapter10/Lecture 10.1 - ODE Solver.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapter10/Lecture 10.1 - ODE Solver.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>ODE solvers (or time-stepping methods - numerical solution of IVPs) 2 <a class="tocSkip"></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># the following allows us to plot triangles indicating convergence order</span>
<span class="kn">from</span> <span class="nn">mpltools</span> <span class="kn">import</span> <span class="n">annotation</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="c1"># font sizes for plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sans-serif&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;Dejavu Sans&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="ode-solvers-or-time-stepping-methods-numerical-solution-of-ivps-2-a-class-tocskip">
<h1>ODE solvers (or time-stepping methods - numerical solution of IVPs) 2 <a class="tocSkip"><a class="headerlink" href="#ode-solvers-or-time-stepping-methods-numerical-solution-of-ivps-2-a-class-tocskip" title="Permalink to this heading">#</a></h1>
<p>Lecture 10.1<br />
Matt Piggott</p>
<h2>Table of Contents<span class="tocSkip"></span></h2>
<div class="toc"><ul class="toc-item"><li><span><a href="#Review" data-toc-modified-id="Review-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Review</a></span><ul class="toc-item"><li><span><a href="#Problem-definition" data-toc-modified-id="Problem-definition-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Problem definition</a></span></li><li><span><a href="#Notation" data-toc-modified-id="Notation-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Notation</a></span></li><li><span><a href="#Convergence" data-toc-modified-id="Convergence-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>Convergence</a></span></li><li><span><a href="#Model-Problem:-exponential-decay" data-toc-modified-id="Model-Problem:-exponential-decay-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>Model Problem: exponential decay</a></span></li></ul></li><li><span><a href="#Simple-numerical-approximations" data-toc-modified-id="Simple-numerical-approximations-2"><span class="toc-item-num">2&nbsp;&nbsp;</span>Simple numerical approximations</a></span><ul class="toc-item"><li><span><a href="#Forward-Euler" data-toc-modified-id="Forward-Euler-2.1"><span class="toc-item-num">2.1&nbsp;&nbsp;</span>Forward Euler</a></span></li><li><span><a href="#Taylor-series-approximation" data-toc-modified-id="Taylor-series-approximation-2.2"><span class="toc-item-num">2.2&nbsp;&nbsp;</span>Taylor series approximation</a></span></li><li><span><a href="#Using-numerical-differentiation" data-toc-modified-id="Using-numerical-differentiation-2.3"><span class="toc-item-num">2.3&nbsp;&nbsp;</span>Using numerical differentiation</a></span><ul class="toc-item"><li><span><a href="#Four-simple-schemes" data-toc-modified-id="Four-simple-schemes-2.3.1"><span class="toc-item-num">2.3.1&nbsp;&nbsp;</span>Four simple schemes</a></span></li></ul></li><li><span><a href="#An-example-application" data-toc-modified-id="An-example-application-2.4"><span class="toc-item-num">2.4&nbsp;&nbsp;</span>An example application</a></span><ul class="toc-item"><li><span><a href="#Convergence" data-toc-modified-id="Convergence-2.4.1"><span class="toc-item-num">2.4.1&nbsp;&nbsp;</span>Convergence</a></span></li></ul></li><li><span><a href="#Implementing-implicit-schemes" data-toc-modified-id="Implementing-implicit-schemes-2.5"><span class="toc-item-num">2.5&nbsp;&nbsp;</span>Implementing implicit schemes</a></span></li><li><span><a href="#Using-numerical-quadrature" data-toc-modified-id="Using-numerical-quadrature-2.6"><span class="toc-item-num">2.6&nbsp;&nbsp;</span>Using numerical quadrature</a></span></li></ul></li><li><span><a href="#Errors" data-toc-modified-id="Errors-3"><span class="toc-item-num">3&nbsp;&nbsp;</span>Errors</a></span><ul class="toc-item"><li><span><a href="#Definitions-(errors)" data-toc-modified-id="Definitions-(errors)-3.1"><span class="toc-item-num">3.1&nbsp;&nbsp;</span>Definitions (errors)</a></span><ul class="toc-item"><li><span><a href="#Local-truncation-error" data-toc-modified-id="Local-truncation-error-3.1.1"><span class="toc-item-num">3.1.1&nbsp;&nbsp;</span>Local truncation error</a></span></li><li><span><a href="#Order-of-convergence-&amp;-consistency" data-toc-modified-id="Order-of-convergence-&amp;-consistency-3.1.2"><span class="toc-item-num">3.1.2&nbsp;&nbsp;</span>Order of convergence &amp; consistency</a></span></li><li><span><a href="#Local-error" data-toc-modified-id="Local-error-3.1.3"><span class="toc-item-num">3.1.3&nbsp;&nbsp;</span>Local error</a></span></li><li><span><a href="#Global-error" data-toc-modified-id="Global-error-3.1.4"><span class="toc-item-num">3.1.4&nbsp;&nbsp;</span>Global error</a></span></li><li><span><a href="#Links-between-errors-and-stability" data-toc-modified-id="Links-between-errors-and-stability-3.1.5"><span class="toc-item-num">3.1.5&nbsp;&nbsp;</span>Links between errors and stability</a></span></li></ul></li></ul></li><li><span><a href="#Stability" data-toc-modified-id="Stability-4"><span class="toc-item-num">4&nbsp;&nbsp;</span>Stability</a></span><ul class="toc-item"><li><span><a href="#Continuous-case" data-toc-modified-id="Continuous-case-4.1"><span class="toc-item-num">4.1&nbsp;&nbsp;</span>Continuous case</a></span></li><li><span><a href="#Discrete-case" data-toc-modified-id="Discrete-case-4.2"><span class="toc-item-num">4.2&nbsp;&nbsp;</span>Discrete case</a></span><ul class="toc-item"><li><span><a href="#Backward-Euler-excess-stability-test" data-toc-modified-id="Backward-Euler-excess-stability-test-4.2.1"><span class="toc-item-num">4.2.1&nbsp;&nbsp;</span>Backward Euler excess stability test</a></span></li></ul></li><li><span><a href="#Absolute-stability" data-toc-modified-id="Absolute-stability-4.3"><span class="toc-item-num">4.3&nbsp;&nbsp;</span>Absolute stability</a></span><ul class="toc-item"><li><span><a href="#&quot;A&quot;-stability-/-A-stable-methods" data-toc-modified-id="&quot;A&quot;-stability-/-A-stable-methods-4.3.1"><span class="toc-item-num">4.3.1&nbsp;&nbsp;</span>"A" stability / A-stable methods</a></span></li><li><span><a href="#A($\alpha$)-stability-[$\star$]" data-toc-modified-id="A($\alpha$)-stability-[$\star$]-4.3.2"><span class="toc-item-num">4.3.2&nbsp;&nbsp;</span>A($\alpha$) stability [$\star$]</a></span></li></ul></li><li><span><a href="#L-stability-[$\star\star$]" data-toc-modified-id="L-stability-[$\star\star$]-4.4"><span class="toc-item-num">4.4&nbsp;&nbsp;</span>L-stability [$\star\star$]</a></span></li></ul></li><li><span><a href="#Time-stepping-errors" data-toc-modified-id="Time-stepping-errors-5"><span class="toc-item-num">5&nbsp;&nbsp;</span>Time-stepping errors</a></span><ul class="toc-item"><li><span><a href="#A-little-bit-of-maths-to-bound-the-global-error--[$\star\star$]" data-toc-modified-id="A-little-bit-of-maths-to-bound-the-global-error--[$\star\star$]-5.1"><span class="toc-item-num">5.1&nbsp;&nbsp;</span>A little bit of maths to bound the global error  [$\star\star$]</a></span></li><li><span><a href="#Zero-stability--[$\star\star$]" data-toc-modified-id="Zero-stability--[$\star\star$]-5.2"><span class="toc-item-num">5.2&nbsp;&nbsp;</span>Zero stability  [$\star\star$]</a></span></li><li><span><a href="#Practical-choice-of-step-size" data-toc-modified-id="Practical-choice-of-step-size-5.3"><span class="toc-item-num">5.3&nbsp;&nbsp;</span>Practical choice of step size</a></span></li></ul></li><li><span><a href="#Linear-multistep-(LMS)-methods" data-toc-modified-id="Linear-multistep-(LMS)-methods-6"><span class="toc-item-num">6&nbsp;&nbsp;</span>Linear multistep (LMS) methods</a></span><ul class="toc-item"><li><span><a href="#Popular-time-stepping-schemes" data-toc-modified-id="Popular-time-stepping-schemes-6.1"><span class="toc-item-num">6.1&nbsp;&nbsp;</span>Popular time-stepping schemes</a></span></li><li><span><a href="#Introduction---LMS" data-toc-modified-id="Introduction---LMS-6.2"><span class="toc-item-num">6.2&nbsp;&nbsp;</span>Introduction - LMS</a></span></li><li><span><a href="#Explicit-linear-multistep-methods---Adams-Bashforth-schemes" data-toc-modified-id="Explicit-linear-multistep-methods---Adams-Bashforth-schemes-6.3"><span class="toc-item-num">6.3&nbsp;&nbsp;</span>Explicit linear multistep methods - Adams-Bashforth schemes</a></span></li><li><span><a href="#Adams-Bashforth-scheme---sketch-of-derivation-[$\star$]" data-toc-modified-id="Adams-Bashforth-scheme---sketch-of-derivation-[$\star$]-6.4"><span class="toc-item-num">6.4&nbsp;&nbsp;</span>Adams-Bashforth scheme - sketch of derivation [$\star$]</a></span></li><li><span><a href="#Implicit-linear-multistep-methods---Adams-Moulton-schemes" data-toc-modified-id="Implicit-linear-multistep-methods---Adams-Moulton-schemes-6.5"><span class="toc-item-num">6.5&nbsp;&nbsp;</span>Implicit linear multistep methods - Adams-Moulton schemes</a></span></li><li><span><a href="#Linear-Multistep-Methods---error-analysis-and-consistency/order-conditions--[$\star\star$]" data-toc-modified-id="Linear-Multistep-Methods---error-analysis-and-consistency/order-conditions--[$\star\star$]-6.6"><span class="toc-item-num">6.6&nbsp;&nbsp;</span>Linear Multistep Methods - error analysis and consistency/order conditions  [$\star\star$]</a></span></li><li><span><a href="#Linear-Multistep-Methods---Predictor-Corrector-approach" data-toc-modified-id="Linear-Multistep-Methods---Predictor-Corrector-approach-6.7"><span class="toc-item-num">6.7&nbsp;&nbsp;</span>Linear Multistep Methods - Predictor-Corrector approach</a></span><ul class="toc-item"><li><span><a href="#Stability-of-predictor-corrector-methods" data-toc-modified-id="Stability-of-predictor-corrector-methods-6.7.1"><span class="toc-item-num">6.7.1&nbsp;&nbsp;</span>Stability of predictor-corrector methods</a></span></li></ul></li><li><span><a href="#Linear-Multistep-Methods---stability" data-toc-modified-id="Linear-Multistep-Methods---stability-6.8"><span class="toc-item-num">6.8&nbsp;&nbsp;</span>Linear Multistep Methods - stability</a></span></li></ul></li><li><span><a href="#Runge-Kutta-(RK)-methods" data-toc-modified-id="Runge-Kutta-(RK)-methods-7"><span class="toc-item-num">7&nbsp;&nbsp;</span>Runge-Kutta (RK) methods</a></span><ul class="toc-item"><li><span><a href="#LMS-vs-RK-methods" data-toc-modified-id="LMS-vs-RK-methods-7.1"><span class="toc-item-num">7.1&nbsp;&nbsp;</span>LMS vs RK methods</a></span></li><li><span><a href="#Two-stage-Runge-Kutta-example-(RK2)---aka-improved-Euler-/-explicit-trapezoidal-/-Euler-trapezoidal-/-Heun's-method-[from-Comp-Math]" data-toc-modified-id="Two-stage-Runge-Kutta-example-(RK2)---aka-improved-Euler-/-explicit-trapezoidal-/-Euler-trapezoidal-/-Heun's-method-[from-Comp-Math]-7.2"><span class="toc-item-num">7.2&nbsp;&nbsp;</span>Two stage Runge-Kutta example (RK2) - aka improved Euler / explicit trapezoidal / Euler-trapezoidal / Heun's method [from Comp Math]</a></span><ul class="toc-item"><li><span><a href="#RK2---schematic-visualisation-of-method" data-toc-modified-id="RK2---schematic-visualisation-of-method-7.2.1"><span class="toc-item-num">7.2.1&nbsp;&nbsp;</span>RK2 - schematic visualisation of method</a></span></li></ul></li><li><span><a href="#Another-RK2-example-(RK2-version-2)---aka-explicit-midpoint-/-modified-Euler-...-[from-Comp-Math]" data-toc-modified-id="Another-RK2-example-(RK2-version-2)---aka-explicit-midpoint-/-modified-Euler-...-[from-Comp-Math]-7.3"><span class="toc-item-num">7.3&nbsp;&nbsp;</span>Another RK2 example (RK2 version 2) - aka explicit midpoint / modified Euler ... [from Comp Math]</a></span></li><li><span><a href="#Runge-Kutta-scheme-derivation-(via-Taylor-series-methods)-[$\star$]" data-toc-modified-id="Runge-Kutta-scheme-derivation-(via-Taylor-series-methods)-[$\star$]-7.4"><span class="toc-item-num">7.4&nbsp;&nbsp;</span>Runge-Kutta scheme derivation (via Taylor series methods) [$\star$]</a></span><ul class="toc-item"><li><span><a href="#Taylor-series-methods-[from-Comp-Math]" data-toc-modified-id="Taylor-series-methods-[from-Comp-Math]-7.4.1"><span class="toc-item-num">7.4.1&nbsp;&nbsp;</span>Taylor series methods [from Comp Math]</a></span></li><li><span><a href="#Runge-Kutta-derivation--[$\star$]" data-toc-modified-id="Runge-Kutta-derivation--[$\star$]-7.4.2"><span class="toc-item-num">7.4.2&nbsp;&nbsp;</span>Runge-Kutta derivation  [$\star$]</a></span></li></ul></li><li><span><a href="#Butcher-tableau-[$\star$]" data-toc-modified-id="Butcher-tableau-[$\star$]-7.5"><span class="toc-item-num">7.5&nbsp;&nbsp;</span>Butcher tableau [$\star$]</a></span><ul class="toc-item"><li><span><a href="#Explicit-Runge-Kutta-Butcher-tableau-examples-[$\star$]" data-toc-modified-id="Explicit-Runge-Kutta-Butcher-tableau-examples-[$\star$]-7.5.1"><span class="toc-item-num">7.5.1&nbsp;&nbsp;</span>Explicit Runge-Kutta Butcher tableau examples [$\star$]</a></span></li><li><span><a href="#Implicit-Runge-Kutta-Butcher-tableau-examples" data-toc-modified-id="Implicit-Runge-Kutta-Butcher-tableau-examples-7.5.2"><span class="toc-item-num">7.5.2&nbsp;&nbsp;</span>Implicit Runge-Kutta Butcher tableau examples</a></span></li><li><span><a href="#Embedded-Runge-Kutta-pairs-[$\star$]" data-toc-modified-id="Embedded-Runge-Kutta-pairs-[$\star$]-7.5.3"><span class="toc-item-num">7.5.3&nbsp;&nbsp;</span>Embedded Runge-Kutta pairs [$\star$]</a></span></li></ul></li><li><span><a href="#Classical-RK4" data-toc-modified-id="Classical-RK4-7.6"><span class="toc-item-num">7.6&nbsp;&nbsp;</span>Classical RK4</a></span></li><li><span><a href="#An-RK4-schematic" data-toc-modified-id="An-RK4-schematic-7.7"><span class="toc-item-num">7.7&nbsp;&nbsp;</span>An RK4 schematic</a></span></li><li><span><a href="#Runge-Kutta-stability-analysis--[$\star\star$]" data-toc-modified-id="Runge-Kutta-stability-analysis--[$\star\star$]-7.8"><span class="toc-item-num">7.8&nbsp;&nbsp;</span>Runge-Kutta stability analysis  [$\star\star$]</a></span><ul class="toc-item"><li><span><a href="#RK2-stability" data-toc-modified-id="RK2-stability-7.8.1"><span class="toc-item-num">7.8.1&nbsp;&nbsp;</span>RK2 stability</a></span></li><li><span><a href="#RK4-stability" data-toc-modified-id="RK4-stability-7.8.2"><span class="toc-item-num">7.8.2&nbsp;&nbsp;</span>RK4 stability</a></span></li></ul></li><li><span><a href="#Adaptive-time-stepping--[$\star$]" data-toc-modified-id="Adaptive-time-stepping--[$\star$]-7.9"><span class="toc-item-num">7.9&nbsp;&nbsp;</span>Adaptive time-stepping  [$\star$]</a></span></li></ul></li><li><span><a href="#Stiff-problems-[$\star$]" data-toc-modified-id="Stiff-problems-[$\star$]-8"><span class="toc-item-num">8&nbsp;&nbsp;</span>Stiff problems [$\star$]</a></span><ul class="toc-item"><li><span><a href="#An-example-of-a-stiff-problem--[$\star$]" data-toc-modified-id="An-example-of-a-stiff-problem--[$\star$]-8.1"><span class="toc-item-num">8.1&nbsp;&nbsp;</span>An example of a stiff problem  [$\star$]</a></span></li><li><span><a href="#Backward-differentiation-formula-(BDF)-methods--[$\star$]" data-toc-modified-id="Backward-differentiation-formula-(BDF)-methods--[$\star$]-8.2"><span class="toc-item-num">8.2&nbsp;&nbsp;</span>Backward differentiation formula (BDF) methods  [$\star$]</a></span></li><li><span><a href="#Derivation-of-BDF-methods--[$\star\star$]" data-toc-modified-id="Derivation-of-BDF-methods--[$\star\star$]-8.3"><span class="toc-item-num">8.3&nbsp;&nbsp;</span>Derivation of BDF methods  [$\star\star$]</a></span></li><li><span><a href="#BDF-stability-regions--[$\star$]" data-toc-modified-id="BDF-stability-regions--[$\star$]-8.4"><span class="toc-item-num">8.4&nbsp;&nbsp;</span>BDF stability regions  [$\star$]</a></span></li></ul></li><li><span><a href="#Final-remarks" data-toc-modified-id="Final-remarks-9"><span class="toc-item-num">9&nbsp;&nbsp;</span>Final remarks</a></span></li><li><span><a href="#Summary" data-toc-modified-id="Summary-10"><span class="toc-item-num">10&nbsp;&nbsp;</span>Summary</a></span></li></ul></div><section id="learning-objectives-a-class-tocskip">
<h2>Learning objectives:  <a class="tocSkip"><a class="headerlink" href="#learning-objectives-a-class-tocskip" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>To extend the simple time-stepping schemes seen previously to families of far more sophisticated and powerful methods, including more on RK methods briefly introduced in Comp Math.</p></li>
<li><p>To introduce linear multistep methods as a second family/class of methods.</p></li>
<li><p>To provide more detail on stability, errors, and time step selection.</p></li>
<li><p>As well as solving ODEs as they are interesting in their own right, in later lectures we will be considering PDEs, and all of the ideas and methods introduced here are important for dealing with <em>time-dependent</em> PDEs.</p></li>
</ul>
<br>
<br>
<p><strong>Note that there are many optional and advanced sections indicated in these notes - as always you can safely ignore all of these.</strong></p>
</section>
<section id="review">
<h2>Review<a class="headerlink" href="#review" title="Permalink to this heading">#</a></h2>
</section>
<section id="problem-definition">
<h2>Problem definition<a class="headerlink" href="#problem-definition" title="Permalink to this heading">#</a></h2>
<p>Recall that the numerical solution of ODEs involves solving approximating the solution to problems such as</p>
<div class="math notranslate nohighlight">
\[\text{find} \;\;\;\; \boldsymbol{y}\equiv\boldsymbol{y}\,(t) \;\;\;\;\;\; \text{such that} \;\;\;\;\;\; 
\frac{d{\boldsymbol{y}}}{dt} = \boldsymbol{f}\,(t,\boldsymbol{y}\,(t)),\;\;\;\;\;\; \boldsymbol{y}(0)=\boldsymbol{y}_0,\]</div>
<p>where <span class="math notranslate nohighlight">\(\boldsymbol{f}\,\)</span> is a given function of time as well as the unknown variable <span class="math notranslate nohighlight">\(\boldsymbol{y}\,\)</span>, which is itself a function of <span class="math notranslate nohighlight">\(t\)</span> (we won’t always bother explicitly writing this dependence).</p>
<p><span class="math notranslate nohighlight">\(\boldsymbol{y}_0\)</span> is a prescribed <em>initial condition</em>.</p>
<br>
<br>
<p>We can think of <span class="math notranslate nohighlight">\(\boldsymbol{y}\equiv\boldsymbol{y}(t)\)</span> as mapping out a trajectory in a <a class="reference external" href="https://en.wikipedia.org/wiki/Phase_space"><em>phase space</em></a> which is the same dimension as our ODE system</p>
<p>For example, in 1D</p>
<br>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/FE-one-step.png"><img alt="../_images/FE-one-step.png" src="../_images/FE-one-step.png" style="width: 75%;" /></a>
</figure>
<p>in 2D</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/circular_orbits_trajectories.png"><img alt="../_images/circular_orbits_trajectories.png" src="../_images/circular_orbits_trajectories.png" style="width: 75%;" /></a>
</figure>
<p>and in 3D</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/lorenz_attractor.png"><img alt="../_images/lorenz_attractor.png" src="../_images/lorenz_attractor.png" style="width: 75%;" /></a>
</figure>
<br>
<br>
<p>At any point in time the first-order ODE above is telling us the local direction of the trajectory and our job is to move forward in time, mapping out this trajectory.</p>
<p>We generally assume that the RHS function  <span class="math notranslate nohighlight">\(\,\boldsymbol{f}\,\)</span> is “<em>nice</em>”, in that the derivatives of <span class="math notranslate nohighlight">\(\,\boldsymbol{f}\,\)</span> and smooth and we can make use of <a class="reference external" href="https://en.wikipedia.org/wiki/Taylor_series">Taylor series</a> based analysis to both derive and analyse the expected behaviour of different ODE solvers.</p>
<br>
<p>Recall also that the RHS function may be a function of the independent variable (here <span class="math notranslate nohighlight">\(t\)</span>), the dependent variable(s) (here <span class="math notranslate nohighlight">\(\boldsymbol{y}\)</span>) or both.</p>
</section>
<section id="notation">
<h2>Notation<a class="headerlink" href="#notation" title="Permalink to this heading">#</a></h2>
<p>To form a discrete version of our problem, i.e. one that is solvable on a finite computer, we approximate the problem/solution at a series of time levels</p>
<div class="math notranslate nohighlight">
\[t_0&lt;t_1&lt;t_2&lt;\cdots\]</div>
<p>where <span class="math notranslate nohighlight">\(\,t_0\,\)</span> is our initial time, i.e. we will generally assume for simplicity that <span class="math notranslate nohighlight">\(\;t_0 = 0\)</span>.</p>
<p>We will use the notation <span class="math notranslate nohighlight">\(T\)</span> if there is an upper limit on how far we will integrate in time - but note that this might be unbounded (<span class="math notranslate nohighlight">\(t \in [0,T]\)</span> or <span class="math notranslate nohighlight">\(t \in [0,\infty)\)</span>).</p>
<p>It will often (but not always) be the case that our time step size is constant, i.e. <span class="math notranslate nohighlight">\(\;\;t_{n+1} - t_{n} = \Delta t\)</span>, <span class="math notranslate nohighlight">\(\;\;\forall\, n=1,2,\ldots\)</span>.</p>
<p>Otherwise we can specify a local time step size as <span class="math notranslate nohighlight">\(\;\;t_{n+1} - t_{n} = \Delta t_{n}\)</span>.</p>
<p>Our discrete numerical solution (approximation) at each of these time levels will be denoted by</p>
<div class="math notranslate nohighlight">
\[\boldsymbol{y}_n \approx \boldsymbol{y}\,(t_{n}).\]</div>
<p>Note that we will use the notation <span class="math notranslate nohighlight">\(n\)</span> to indicate a time level.</p>
<p><br><br></p>
<p>In later lectures where we are solving PDEs in time and space we will use <em>sub</em>scripts <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(j\)</span> and <span class="math notranslate nohighlight">\(k\)</span> (with the number of indices needed depending on the number of spatial dimensions) to represent spatial points, and will still use <span class="math notranslate nohighlight">\(n\)</span> to indicate time level but will use a superscript following standard convention (i.e. <span class="math notranslate nohighlight">\(u_{ij}^n \approx u(x_i,y_j,t_{n})\)</span>). Here, as we have no spatial indices to worry about and get in the way, the norm is generally for <span class="math notranslate nohighlight">\(n\)</span> to be written as a subscript.</p>
</section>
<section id="convergence">
<h2>Convergence<a class="headerlink" href="#convergence" title="Permalink to this heading">#</a></h2>
<p>We will generally require that our numerical solution satisfies two properties:</p>
<ol class="arabic simple">
<li><p><strong>Convergence</strong> - this can be defined formally as</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\max_{0\,\le \,t_n\, \le\, T}\| \boldsymbol{y}_n - \boldsymbol{y}\,(t_{n})\| \longrightarrow 0 \;\;\;\; \text{as} \;\;\;\; \Delta t \longrightarrow 0. \]</div>
<ol class="arabic simple" start="2">
<li><p><strong>Correct qualitative behaviour</strong> - even for finite (non infinitesimally small) <span class="math notranslate nohighlight">\(\Delta t\)</span> we ideally would like numerical methods which yield approximations having the same qualitative behaviour as the exact solution. For example, they respect properties such as <em>conservation laws</em>, converge to a certain value or periodic orbit, or are bounded, e.g. they do not go negative when we know the quantity being integrated cannot physically be negative, such as would be the case for a concentration.</p></li>
</ol>
</section>
<section id="model-problem-exponential-decay">
<h2>Model Problem: exponential decay<a class="headerlink" href="#model-problem-exponential-decay" title="Permalink to this heading">#</a></h2>
<p>Recall our model problem</p>
<div class="math notranslate nohighlight">
\[\frac{dy}{dt} = K(y_r - y),\]</div>
<p>where <span class="math notranslate nohighlight">\(K\)</span> is a coefficient that dictates how quickly the relaxation occurs, and <span class="math notranslate nohighlight">\(y_r\)</span> is the value which we are relaxing to (can you see what the units of <span class="math notranslate nohighlight">\(K\)</span> must be?).</p>
<p>This linear IVP has the exact (analytic) solution</p>
<div class="math notranslate nohighlight">
\[ y(t) = y_r + (y(0) - y_r)\exp(-Kt).\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yr</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">C_14_half_life</span> <span class="o">=</span> <span class="mf">5730.</span> <span class="c1">#  our temporal units here are assumed to be years</span>
<span class="c1"># and the following is how you turn a &quot;half life value&quot; into a &quot;decay constant&quot;</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">2.</span><span class="p">)</span><span class="o">/</span><span class="n">C_14_half_life</span> 

<span class="c1"># let&#39;s plot things over 100,000 years</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100000.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to evaluate the exact solution to the exponential decay problem.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">return</span> <span class="p">(</span><span class="n">yr</span> <span class="o">+</span> <span class="p">(</span><span class="n">y0</span><span class="o">-</span><span class="n">yr</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">t</span><span class="p">))</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># red dashed lines and dot emphasise the meaning of &quot;half life&quot;</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">5730</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5730</span><span class="p">,</span> <span class="mi">5730</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;r--&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$ [years]&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Radioactive decay - exact solution&#39;</span><span class="p">,</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">100000</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/719188697f4b752f38eac3f52876f6fb82bf45b48ff3028f30c011876221d0ee.png" src="../_images/719188697f4b752f38eac3f52876f6fb82bf45b48ff3028f30c011876221d0ee.png" />
</div>
</div>
</section>
<section id="simple-numerical-approximations">
<h2>Simple numerical approximations<a class="headerlink" href="#simple-numerical-approximations" title="Permalink to this heading">#</a></h2>
<p>Recall that there are several approaches for us to formulate a numerical approximation to this problem.</p>
</section>
<section id="forward-euler">
<h2>Forward Euler<a class="headerlink" href="#forward-euler" title="Permalink to this heading">#</a></h2>
<p>The first is to note that this ODE provides information about the local gradient of the solution.</p>
<p>If we decide to use information about the current time <span class="math notranslate nohighlight">\(t_{n}\)</span> and state <span class="math notranslate nohighlight">\(y_{n} \approx y(t_{n})\)</span> only, then the simplest possible discretisation of our ODE <span class="math notranslate nohighlight">\(\,(\dot{y}=f(y))\,\)</span>  is to use a so-called <em>forward difference</em> to approximate the gradient:</p>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1}-y_{n}}{\Delta t} = f(y_n),\]</div>
<p>where for our model problem, <span class="math notranslate nohighlight">\(\;\;f(y) := K(y_r - y)\)</span>.</p>
<p>This corresponds to linear extrapolation and the scheme is usually referred to as a <strong>forward Euler</strong>, or <strong>explicit Euler</strong>, discretisation. The terms forward or explicit are appropriate descriptions as we are using on the RHS information we already know (what would a straightforward alternative be?)</p>
<p>Rearranging (e.g. for implementation in code as we will see below) we have the update formula:</p>
<div class="math notranslate nohighlight">
\[y_{n+1} = y_{n} + \Delta t K(y_r - y_n).\]</div>
<p>Next we plot a schematic to see what the scheme is doing over one time step,</p>
<p>then we will implement the scheme in full and compare to our exact solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;One step of Forward Euler&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># an example solution trajectory (or solution to ODE $\dot{y}=f(y)$)</span>
<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># and this is the derivative of that y which has to equal the RHS of the ODE</span>
<span class="k">def</span> <span class="nf">dy</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Trajectory $y=y(t)$&#39;</span><span class="p">)</span>

<span class="c1"># this is just some location in time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="c1"># and an example of a time step size large enough we can see what the method is doing</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.4</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">),</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dy</span><span class="p">(</span><span class="n">t0</span><span class="p">)],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$y&#39;=f(t_0,y_0)$&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)],</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)],</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact soln at $t_0 + \Delta t$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">dy</span><span class="p">(</span><span class="n">t0</span><span class="p">)],</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FE numerical soln at $t_0 + \Delta t$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/1b32646f458f0f073102e967046f20017154a8540028344b6e44f9c553aa4ef2.png" src="../_images/1b32646f458f0f073102e967046f20017154a8540028344b6e44f9c553aa4ef2.png" />
</div>
</div>
<section id="comments">
<h3>Comments<a class="headerlink" href="#comments" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>In the above image we assume we know the exact solution, i.e. we start from the red dot that lies on the exact solution (i.e. the curve the solution makes in <span class="math notranslate nohighlight">\((t, y(t))\)</span> space).</p></li>
<li><p>At a later time the black dot shows where we should be; the green dot shows where the numerical method takes us; the difference is the error.</p></li>
<li><p>Since we assumed we started at the exact solution, this error is called the <em>local</em> or the <em>one-step error</em>. Note that for every subsequent time step where we cannot assume we start from a point on the exact solution trajectory there is potential (indeed a likelihood) for these <em>local errors to accumulate and grow</em> We will define these terms below, but perhaps unsurprisingly this is termed the <em>global error</em>.</p></li>
<li><p>It should hopefully also be clear that the error in the image above can get worse in one of two ways: (1) it will be larger if we take a larger sized step; (2) it will also be larger if the black line diverges from the blue line more rapidly - in this case of the forward Euler method this rate of divergence depends on the second derivative of <span class="math notranslate nohighlight">\(y(t)\)</span>, or equivalently the first derivative of <span class="math notranslate nohighlight">\(f\)</span> w.r.t. <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
</ul>
</section>
</section>
<section id="taylor-series-approximation">
<h2>Taylor series approximation<a class="headerlink" href="#taylor-series-approximation" title="Permalink to this heading">#</a></h2>
<p>Recall that Taylor series in one dimension tells us that we can approximate the value of the function at a location in terms of its value, and value of its derivative, at a nearby point:</p>
<div class="math notranslate nohighlight">
\[ y(t+\Delta t) = y(t) + \Delta t \, y'(t) + \frac{\Delta t^2}{2!}y''(t) + \frac{\Delta t^3}{3!}y'''(t) + \mathcal{O}(\Delta t^4),\]</div>
<p>where <span class="math notranslate nohighlight">\(\mathcal{O}(\Delta t^4)\)</span> represents the collection of terms that are fourth-order in <span class="math notranslate nohighlight">\(\Delta t\)</span> and higher.</p>
<p>Using the notation <span class="math notranslate nohighlight">\(y_n=y(t_n)\)</span>, and assuming a uniform time step, this is equivalent to</p>
<div class="math notranslate nohighlight">
\[ y_{n+1} = y_n + \Delta t\, y'_n + \frac{\Delta t^2}{2!}y''_n + \frac{\Delta t^3}{3!}y'''_n + \mathcal{O}(\Delta t^4).\]</div>
<p>Dropping second-order and higher terms, or <em>truncating</em> the expansion, (which we can justify if <span class="math notranslate nohighlight">\(y\)</span> is “smooth”, which means that <span class="math notranslate nohighlight">\(y''\)</span> is “well-behaved”, and <span class="math notranslate nohighlight">\(\Delta t\)</span> being sufficiently small), and noting that <span class="math notranslate nohighlight">\(y'_n = f(t_n,y_n)\)</span> we are left with</p>
<div class="math notranslate nohighlight">
\[y_{n+1} = y_n + \Delta t \, f(t_n,y_n),\]</div>
<p>i.e. our forward Euler method from just above.</p>
</section>
<section id="using-numerical-differentiation">
<h2>Using numerical differentiation<a class="headerlink" href="#using-numerical-differentiation" title="Permalink to this heading">#</a></h2>
<p>Another approach is to consider the ODE at a single point in time (assuming for simplicity we have a scalar system so drop the bold vector notation):</p>
<div class="math notranslate nohighlight">
\[\left.\frac{d{y}}{dt}\right|_{t=t_{n}} =\; {f}(t_{n},{y}(t_{n})).\]</div>
<p>[The vertical bar with <span class="math notranslate nohighlight">\(t=\ldots\)</span> at the bottom just means “evaluated at” that <span class="math notranslate nohighlight">\(t\)</span> value.]</p>
<br>
<p>Then we can use a <em>finite difference</em> formula to approximate the LHS, and substitute the numerical solution at level <span class="math notranslate nohighlight">\(n\)</span> <span class="math notranslate nohighlight">\((y_{n}\approx y(t_{n}))\)</span> into the RHS (i.e.
<span class="math notranslate nohighlight">\({f}(t_{n},{y}(t_{n}))\approx {f}(t_{n},{y}_{n})\)</span>).</p>
<p>[We will explain <em><strong>finite difference formulae</strong></em> properly next lecture, but in the meantime just note that we can approximate a derivative in the following ways:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\left.\frac{d{y}}{dt}\right|_{t=t_{n}} &amp; = \lim_{h\rightarrow 0} \frac{y(t_n+h)-y(t_n)}{h} \\[5pt]
&amp; \approx \frac{y(t_n+\Delta t)-y(t_n)}{\Delta t} = \frac{y(t_{n+1})-y(t_n)}{\Delta t} 
 \approx  \frac{y_{n+1}-y_n}{\Delta t} 
\\[10pt]
\text{or} \;\;\; &amp; \approx \frac{y(t_n)-y(t_n-\Delta t)}{\Delta t} = \frac{y(t_n)-y(t_{n-1})}{\Delta t}  \approx \frac{y_n-y_{n-1}}{\Delta t} \\[10pt]
\text{or} \;\;\; &amp; \approx \frac{y(t_n+\Delta t)-y(t_n-\Delta t)}{2\Delta t} = \frac{y(t_{n+1})-y(t_{n-1})}{2\Delta t} \approx \frac{y_{n+1}-y_{n-1}}{2\Delta t},
\end{align*}
\end{split}\]</div>
<p>with the three approximate expressions all being valid
discretisations of the derivative; with all of them being increasingly accurate for smaller choices of <span class="math notranslate nohighlight">\(\Delta t\)</span>.]</p>
<section id="four-simple-schemes">
<h3>Four simple schemes<a class="headerlink" href="#four-simple-schemes" title="Permalink to this heading">#</a></h3>
<p>With this approach we can immediately write down forward Euler as well as three new equally valid schemes:</p>
<ul class="simple">
<li><p>a <em>forward difference</em> leads to</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1} - y_{n}}{\Delta t} = {f}(t_{n},{y}_{n}) \;\;\; \iff \;\;\; y_{n+1} = y_{n} + {\Delta t}\,{f}(t_{n},{y}_{n})\]</div>
<p>which we recognise as the <strong>forward Euler</strong> or <strong>explicit Euler</strong> method from the previous lectue.</p>
<ul class="simple">
<li><p>a <em>backward difference</em> leads to [this comes from the second approximate derivative above, but where we have updated the notation <span class="math notranslate nohighlight">\(n\rightarrow n+1\)</span> to follow normal notation convention]</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1} - y_{n}}{\Delta t} = {f}(t_{n+1},{y}_{n+1}) \;\;\; \iff \;\;\; y_{n+1} - {\Delta t}\,{f}(t_{n+1},{y}_{n+1}) = y_{n}\]</div>
<p>which is called the <strong>backward Euler</strong> or <strong>implicit Euler</strong> method. Note that this results in an <em>implicit</em> equation for <span class="math notranslate nohighlight">\(y_{n+1}\)</span>, and</p>
<ul class="simple">
<li><p>a <em>central difference</em> leads to [this is the third approximate derivative above]</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1} - y_{n-1}}{2\Delta t} = {f}(t_{n},{y}_{n}) \;\;\; \iff \;\;\;  y_{n+1} = y_{n-1} + 2\,{\Delta t}\,{f}(t_{n},{y}_{n})  \]</div>
<p>which is called the <strong>leapfrog</strong> method.</p>
<section id="id1">
<h4>Comments<a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>One observation here is that forward Euler and leapfrog are what are termed <em>explicit</em> schemes in that <span class="math notranslate nohighlight">\(y_{n+1}\)</span> can be computed explicitly using information already available (e.g. from previous time levels), this leads to simple time stepping loops (and implementations in code).</p></li>
<li><p>Backward Euler on the other hand is what is termed an <em>implicit</em> scheme in that it leads to an equation for <span class="math notranslate nohighlight">\(y_{n+1}\)</span> which can not be written in the form of <span class="math notranslate nohighlight">\(y_{n+1}=\)</span> <em>some combination of known values</em>, as <span class="math notranslate nohighlight">\(y_{n+1}\)</span> appears on both sides of the equation.</p></li>
<li><p>For implicit relations, the approach needed to solve the problem depends on whether we are dealing with a scalar or vector system, and whether <span class="math notranslate nohighlight">\(f\)</span> is linear or nonlinear in <span class="math notranslate nohighlight">\(y\)</span>.</p></li>
<li><p>A further observation is that for leapfrog we have a problem at the start where we only know <span class="math notranslate nohighlight">\(y_0\)</span>, but we need <span class="math notranslate nohighlight">\(y_1\)</span> to use the formula to compute <span class="math notranslate nohighlight">\(y_2\)</span> in the first leapfrog step.  This problem is described by the phrase that the scheme is <em><strong>not self-starting</strong></em>. To address this we need to use a self-starting scheme to compute enough values from <span class="math notranslate nohighlight">\(y_0\)</span> to get the non-self-starting method going. We could just use a simpler methods such as forward or backward Euler, and if concerned that the simplicity may introduce unacceptable errors, we could solve over the initial period with a smaller time step. We could also use an explicit scheme with the correct order of accuracy (we will see an example of this in the homework). In the example below we will just use an initial forward Euler step to estimate <span class="math notranslate nohighlight">\(y_1\)</span>.</p></li>
</ul>
<p>A further obvious scheme (which can be obtained by adding together forward and backward Euler schemes, and hence cancelling some of their errors (cf. the lecture on quadrature where we combined estimated from two rules to obtain a third more accurate estimate) as we shall see below) is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\frac{y_{n+1} - y_{n}}{\Delta t} &amp; = \frac{1}{2}\left({f}(t_{n},{y}_{n}) + {f}(t_{n+1},{y}_{n+1})\right) \\[5pt] 
\iff \;\;\;  
 y_{n+1} - \frac{\Delta t}{2}{f}(t_{n+1},{y}_{n+1}) &amp; =  y_{n} + \frac{\Delta t}{2}{f}(t_{n},{y}_{n}),
 \end{align*}
\end{split}\]</div>
<p>which is called the <strong>trapezoidal</strong> scheme.</p>
<p>Note that as the function <span class="math notranslate nohighlight">\(f\)</span> evaluated at our newest time level appears in this relation, this scheme is also implicit.</p>
</section>
</section>
</section>
<section id="an-example-application">
<h2>An example application<a class="headerlink" href="#an-example-application" title="Permalink to this heading">#</a></h2>
<p>Let’s now write some code to see how these four simple methods perform for our exponential decay model problem (where for simplicity we set the value we relax to, <span class="math notranslate nohighlight">\(y_r\)</span>, to zero).</p>
<p>Note that in the case of a <em><strong>scalar linear</strong></em> problem, as is the current case we’re considering, it’s easy for us to deal with the issue of implicit schemes simply by rearranging our time-stepping update formula.</p>
<p>Note that this won’t be the case for vector and/or nonlinear systems as we shall see later, and thus more work is required in these cases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define physical parameter</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># initial condition</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># and some numerical parameters</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">y</span>

<span class="k">def</span> <span class="nf">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to evaluate the exact solution to the exponential decay problem with y_r=0</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">return</span> <span class="n">y0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># let&#39;s use a finer resolution to plot the exact solution </span>
<span class="c1"># to give a smooth curve in our plot</span>
<span class="n">tfine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># set up figure with 4 subplots to plot our 4 methods</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># our time levels for the numerical solution</span>
<span class="n">N_dt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tend</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_dt</span><span class="p">,</span> <span class="n">N_dt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># an alterntive would be two use</span>
<span class="c1"># t = np.arange(0, tend, dt)</span>
<span class="c1"># but round-off means that can miss the tend value</span>
<span class="c1"># alternatively we could use something like</span>
<span class="c1"># t = np.arange(0, tend+1.e-10, dt)</span>
<span class="c1"># but the 1.e-10 increment needs to be relative</span>

<span class="c1"># a time loop to implement forward Euler</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">t_n</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="c1"># note for this example this is the same as y[n]*(1-dt*K)</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t_n</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;forward Euler&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">tfine</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact solution&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Numerical vs exact solution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># backward Euler</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># note that for this simple problem we can rearrange the </span>
    <span class="c1"># implicit expression and hence do not need to use the </span>
    <span class="c1"># f function - if we did we would need to use an </span>
    <span class="c1"># implicit equation solver such as was introduced in L4</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;backward Euler&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">tfine</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact solution&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Numerical vs exact solution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># leapfrog</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c1"># leapfrog not self-starting so do a FE step here</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># as a two step scheme this uses the solution at level n as well as n-1</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t_n</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leapfrog&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">tfine</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact solution&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Numerical vs exact solution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># trapezoidal</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># as for BE rearrange the implicit relation to obtain an update formula</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">K</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">K</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;trapezoidal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">tfine</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact solution&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Numerical vs exact solution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/be9795f0ebcaef6b6d32276d80cbc198b1697c098ce4896b46cb716022beb1a0.png" src="../_images/be9795f0ebcaef6b6d32276d80cbc198b1697c098ce4896b46cb716022beb1a0.png" />
</div>
</div>
<section id="id2">
<h3>Comments<a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Note that in the implementations above we stored the solution at all time levels - this is because this is cheap for us to do here, and we want the option of plotting the whole solution trajectory. In general, and for larger problems, this won’t be feasible. In which case we might just return the final solution, or the solution at specified times (as the SciPy solvers typically do for example). If we don’t store all time levels we need to think what information we do need to know for each update. Notice in the code above that the leapfrog scheme is the only one where we need to keep track of anything other than the <em>current</em> solution value to compute the next solution value - for leapfrog we also need to store the immediately previous solution. This is therefore a <em>two step (or level) scheme</em>, whereas the other three are all <em>single step</em>. We will return to this point shortly.</p></li>
<li><p>For each of these cases think about where the gradient is being evaluated, and hence why (given knowledge of the qualitative behaviour of the exact solution trajectory for this test case) the above behaviour for each numerical scheme is exactly as we would expect.</p></li>
</ul>
</section>
<section id="id3">
<h3>Convergence<a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We’re given the exact solution in the above code for plotting purposes, but we can of course also use knowledge of this to compute the exact errors in our numerical solution. Let’s compute the errors for each scheme, and see how this changes as we change the time step size. (Q: what error norm are we computing and plotting in the code below?)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define physical parameter</span>
<span class="n">K</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># initial condition</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># and some numerical parameters</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="c1"># the range of time step sizes we will consider</span>
<span class="n">dts</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">y</span>

<span class="k">def</span> <span class="nf">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to evaluate the exact solution to the exponential decay problem with y_r=0</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">return</span> <span class="n">y0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>


<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># somewhere to store our errors for each time step size</span>
<span class="n">FE_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="p">))</span>
<span class="n">BE_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="p">))</span>
<span class="n">leapfrog_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="p">))</span>
<span class="n">trap_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dts</span><span class="p">))</span>

<span class="c1"># loop over our different time step sizes, compute solution and corresponding error</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dts</span><span class="p">):</span>
    <span class="c1"># our time levels for the numerical solution</span>
    <span class="n">N_dt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tend</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_dt</span><span class="p">,</span> <span class="n">N_dt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># forward Euler</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">t_n</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
        <span class="c1"># note for this example this is the same as y[n]*(1-dt*K)</span>
        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t_n</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="n">FE_error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="c1"># backward Euler</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># for this simple problem we can rearrange the implicit expression</span>
        <span class="c1"># and hence do not need to use the f function - if we did we would</span>
        <span class="c1"># need to use an implicit equation solver.</span>
        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>

    <span class="n">BE_error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="c1"># leapfrog</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t_n</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

    <span class="n">leapfrog_error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

    <span class="c1"># trapezoidal</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
    <span class="c1"># note here FOR THIS TEST CASE we can write an amplification factor</span>
    <span class="c1"># outside the loop to save some computations, and help explain the</span>
    <span class="c1"># stability discussion below. We could have done likewise of the other</span>
    <span class="c1"># schemes of course.</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">K</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">K</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="n">amp</span>

    <span class="n">trap_error</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

<span class="n">axs</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">FE_error</span><span class="p">,</span> <span class="s1">&#39;k.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;forward Euler&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">BE_error</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;backward Euler&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span><span class="n">leapfrog_error</span><span class="p">,</span><span class="s1">&#39;r.-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;leapfrog&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dts</span><span class="p">,</span> <span class="n">trap_error</span><span class="p">,</span> <span class="s1">&#39;g.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;trapezoidal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Convergence plot&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">annotation</span><span class="o">.</span><span class="n">slope_marker</span><span class="p">((</span><span class="mf">1.5e-2</span><span class="p">,</span> <span class="mf">4e-3</span><span class="p">),</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span>
                        <span class="n">size_frac</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">pad_frac</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">text_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">))</span>
<span class="n">annotation</span><span class="o">.</span><span class="n">slope_marker</span><span class="p">((</span><span class="mf">1.1e-1</span><span class="p">,</span> <span class="mf">1.0e-3</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span>
                        <span class="n">size_frac</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">pad_frac</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">text_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">fontsize</span> <span class="o">=</span> <span class="mi">14</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5afe5446274a4ca918fbe371cb39e27b141f5bab1c6c97c2c3b010f70816b9bc.png" src="../_images/5afe5446274a4ca918fbe371cb39e27b141f5bab1c6c97c2c3b010f70816b9bc.png" />
</div>
</div>
<section id="id4">
<h4>Comments<a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>We see that <em>for this problem</em> that forward and backward Euler are both first-order accurate and that their errors, at least in the asymptotic limit, are pretty much identical.</p></li>
<li><p>Leapfrog and trapezoidal are both second-order accurate.</p></li>
<li><p>The oscillations we see with leapfrog are still present with smaller time step sizes, but we see from this error plot that they decay at a rate consistent with the overall second-order accuracy of the scheme. However, their presence clearly leads to higher errors in comparison to the trapezoidal scheme. Below a certain time step size, even though oscillations are present, the errors in leapfrog are less than for the first-order methods, but it performs worse at larger time step sizes.</p></li>
<li><p>Note that the leapfrog scheme is popular in numerical weather prediction where <em>filters</em> have been developed to deal with the oscillatory issue we see above. Part of this popularity is the fact that it is a second-order scheme, while only needing once function evaluation per time step which minimises cost. This could be a big advantage if <span class="math notranslate nohighlight">\(f\)</span> is very expensive to compute.</p></li>
</ul>
</section>
</section>
</section>
<section id="implementing-implicit-schemes">
<h2>Implementing implicit schemes<a class="headerlink" href="#implementing-implicit-schemes" title="Permalink to this heading">#</a></h2>
<p>We’ve seen two implicit methods</p>
<ul class="simple">
<li><p>the <strong>backward Euler</strong> or <strong>implicit Euler</strong> method:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1} - y_{n}}{\Delta t} = {f}(t_{n+1},{y}_{n+1}) \;\;\; \iff \;\;\; y_{n+1} - {\Delta t}\,{f}(t_{n+1},{y}_{n+1}) = y_{n}\]</div>
<br>
<ul class="simple">
<li><p>and the <strong>trapezoidal</strong> method:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\frac{y_{n+1} - y_{n}}{\Delta t} &amp; = \frac{1}{2}\left({f}(t_{n},{y}_{n}) + {f}(t_{n+1},{y}_{n+1})\right) \\[5pt] 
\iff \;\;\;  
 y_{n+1} - \frac{\Delta t}{2}{f}(t_{n+1},{y}_{n+1}) &amp; =  y_{n} + \frac{\Delta t}{2}{f}(t_{n},{y}_{n}),
 \end{align*}
\end{split}\]</div>
<br>
<br>
<p>We need to comment more on the implementation of these schemes in practice.</p>
<br>
<p>For the model problem</p>
<div class="math notranslate nohighlight">
\[\frac{dy}{dt} = -K y\]</div>
<p>which is both linear and scalar, this is actually quite easy to deal with.</p>
<br>
<p>Backward Euler applied to this problem requires us to solve</p>
<div class="math notranslate nohighlight">
\[y_{n+1} + {\Delta t}\,Kz, {y}_{n+1} = y_{n}\]</div>
<p>but we can just rearrange this to</p>
<div class="math notranslate nohighlight">
\[y_{n+1} (1 +  {\Delta t}\,Kz) = y_{n} \implies 
y_{n+1} = \frac{1}{(1 +  {\Delta t}\,Kz)} = y_{n}
\]</div>
<p>which is exactly what we used in the code above.</p>
<br>
<p>For Trapezoidal we have</p>
<div class="math notranslate nohighlight">
\[y_{n+1} + \frac{\Delta t}{2} \, K\, {y}_{n+1}  =  y_{n} - \frac{\Delta t}{2} \, K \, {y}_{n}\]</div>
<p>which we can again easily rearrange to</p>
<div class="math notranslate nohighlight">
\[y_{n+1}\left(1 +  \frac{\Delta t}{2}\,  K\right)  =  y_{n}\left(1 -  \frac{\Delta t}{2}\,  K\right)
\implies
y_{n+1} =   \frac{\left(1 -  \frac{\Delta t}{2}\,  K\right)}{\left(1 +  \frac{\Delta t}{2}\,  K\right)}y_{n}
\]</div>
<br>
<br>
<p>Things get more complicated if we have a linear system (rather than scalar) of ODEs in which case the above manupulation is possible but requires the solution of a linear system.</p>
<p>If we are solving an ODE whose RHS function is nonlinear in <span class="math notranslate nohighlight">\(y\)</span>, then we can’t use the trick used above of pulling out and dividing through by a factor, instead we need to make use of a nonlinear solver such as Newton’s method.</p>
<p>The hardest case is where we have a system of nonlinear ODEs - then we need to use a nonlinear <em>system</em> solver.</p>
</section>
<section id="using-numerical-quadrature">
<h2>Using numerical quadrature<a class="headerlink" href="#using-numerical-quadrature" title="Permalink to this heading">#</a></h2>
<p>Another, essentially equivalent, way of thinking about how we can go about tackling our problem numerically is to start by integrating both sides of our ODE over a small interval <span class="math notranslate nohighlight">\([t_{n},t_{n+1}]\)</span> to yield (assuming again for notational simplicity that we have a scalar system):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\int_{t_{n}}^{t_{n+1}}\frac{d{y}}{dt}\,dt &amp;= \int_{t_{n}}^{t_{n+1}} {f}(t,{y}(t))\, dt \\[10pt]
\implies y_{n+1} - y_{n} &amp;= \int_{t_{n}}^{t_{n+1}} {f}(t,{y}(t))\, dt,
\end{align*}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(y_{n+1}=y(t_{n+1})\)</span> and <span class="math notranslate nohighlight">\(y_{n}=y(t_{n})\)</span>.</p>
<p>[Aside (notation clarification): At this point these are exact equalities in our notation since we haven’t yet discretised the problem. If <span class="math notranslate nohighlight">\(y_{n}\)</span> is exact, and we evaluate the integral exactly then this expression tells us <span class="math notranslate nohighlight">\(y_{n+1}\)</span> exactly. But if <span class="math notranslate nohighlight">\(y_{n}\)</span> is only approximate and/or we evaluate the integral only approximately, then the new <span class="math notranslate nohighlight">\(y_{n+1}\)</span> will only be an approximation to the true solution].</p>
<p>If we introduce the notation</p>
<div class="math notranslate nohighlight">
\[\bar{f} := \frac{1}{\Delta t} \int_{t_{n}}^{t_{n+1}} {f}(t,{y}(t))\, dt,\]</div>
<p>where <span class="math notranslate nohighlight">\(\Delta t = t_{n+1} - t_{n}\)</span> (note we’re assuming here that the time step size is constant - this won’t always be the case and so we will use the notation <span class="math notranslate nohighlight">\(\Delta t_{n}\)</span> when needed), then we have</p>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1} - y_{n}}{\Delta t} = \bar{f}.\]</div>
<p>From its definition we can see that <span class="math notranslate nohighlight">\(\,\bar{f}\,\)</span> is the average of <span class="math notranslate nohighlight">\(\,f\,\)</span>, equivalently the average gradient of <span class="math notranslate nohighlight">\(\,y\,\)</span> (the gradient being given by <span class="math notranslate nohighlight">\({f}(t,{y}(t))\)</span>), over the interval <span class="math notranslate nohighlight">\(t\in [t_{n},t_{n+1}]\)</span>.</p>
<br>
<p>There are lots of ways that we can estimate/approximate the average gradient <span class="math notranslate nohighlight">\(\bar{f}\)</span>, each of which leads to a different time-stepping scheme with different costs, accuracy, orders of convergence, etc.</p>
<p>The simplest approach to estimating <span class="math notranslate nohighlight">\(\,\bar{f}\,\)</span> (the average value of <span class="math notranslate nohighlight">\(f\)</span> over the interval <span class="math notranslate nohighlight">\([t_{n},t_{n+1}]\)</span>) is just to take its value at the start of this interval (cf. a variant of the midpoint quadrature rule from previous lectures), i.e. to take</p>
<div class="math notranslate nohighlight">
\[\bar{f} \equiv \frac{1}{\Delta t} \int_{t_{n}}^{t_{n+1}} {f}(t,{y}(t))\, dt \approx \frac{1}{\Delta t} \,{\Delta t} \, {f}(t_{n},{y}_{n}) =  {f}(t_{n},{y}_{n}), \]</div>
<p>in which case our time-stepping scheme becomes</p>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1} - y_{n}}{\Delta t} = {f}(t_{n},{y}_{n}) \;\;\; \iff \;\;\; {y_{n+1} - y_{n}} = {\Delta t}\; {f}(t_{n},{y}_{n}),\]</div>
<p>which we recognise as the <em>forward Euler</em>, or <em>explicit Euler</em> method introduced previously.</p>
<p>We can similarly derive the backward Euler, leapfrog and trapezoidal schemes - think about these schematically and in terms of quadrature rules.</p>
<p>We can therefore derive a number of schemes either through thinking about numerical differentiation (equivalently through Taylor series analysis) or via the integral based derivation above and choices of different quadrature schemes to evaluate <span class="math notranslate nohighlight">\(\bar{f}\)</span>.</p>
</section>
<section id="errors">
<h2>Errors<a class="headerlink" href="#errors" title="Permalink to this heading">#</a></h2>
</section>
<section id="definitions-errors">
<h2>Definitions (errors)<a class="headerlink" href="#definitions-errors" title="Permalink to this heading">#</a></h2>
<section id="local-truncation-error">
<h3>Local truncation error<a class="headerlink" href="#local-truncation-error" title="Permalink to this heading">#</a></h3>
<p>The <em>local truncation error</em> (LTE; or often just <em>truncation error</em>) is defined, and computed, by <em>substituting the exact solution to the problem into the numerical scheme</em>.</p>
<p>[Note that this definition requires that the numerical scheme is scaled such that it approximates the derivatives in the differential equations, i.e. in the form</p>
<div class="math notranslate nohighlight">
\[\frac{y_{n+1}-y_{n}}{\Delta t} = \ldots \;\;\;\;  \text{not}  \;\;\;\; y_{n+1} = y_{n} + \Delta t \times \ldots.\]</div>
<p>Be warned though: some people don’t make this a requirement and so the powers of <span class="math notranslate nohighlight">\(\Delta t\)</span> flying around in their analysis will be one out compared to us!]</p>
<p>For forward Euler for example the LTE (<span class="math notranslate nohighlight">\(\tau\)</span>) therefore takes the form</p>
<div class="math notranslate nohighlight">
\[\tau := \frac{y(t_{n+1})-y(t_{n})}{\Delta t}- \boldsymbol{f}\,(t,\boldsymbol{y}\,(t)).\]</div>
<p>By construction (up to round-off errors) the numerical solution satisfies this relation exactly (i.e. the terms of the RHS balance out), but this will not in general be true for the <em>exact solution</em> and so the above quantity will not be zero, and this discrepancy is termed the LTE.</p>
<br>
<br>
<p>Using the notation <span class="math notranslate nohighlight">\(y_n=y(t_n)\)</span>, Taylor series tells us that</p>
<div class="math notranslate nohighlight">
\[ y_{n+1} = y_n + \Delta ty'_n + \frac{\Delta t^2}{2!}y''_n + \frac{\Delta t^3}{3!}y'''_n + \mathcal{O}(\Delta t^4),\]</div>
<p>and since <span class="math notranslate nohighlight">\(y'_n = f(t_n,y_n)\)</span>, this tells us that</p>
<div class="math notranslate nohighlight">
\[ \tau = \frac{y_{n+1} -  y_n}{\Delta t} - f(t_n,y_n) = \frac{\Delta t}{2!}y''_n + \frac{\Delta t^2}{3!}y'''_n + \mathcal{O}(\Delta t^3).\]</div>
</section>
<section id="order-of-convergence-consistency">
<h3>Order of convergence &amp; consistency<a class="headerlink" href="#order-of-convergence-consistency" title="Permalink to this heading">#</a></h3>
<p>A scheme is said to have an <em>order of accuracy</em> (or a <em>convergence order</em>) of <span class="math notranslate nohighlight">\(p\)</span> if</p>
<div class="math notranslate nohighlight">
\[ |\tau|\le C \Delta t ^p \;\;\;\; \text{as} \;\;\;\; \Delta t \longrightarrow 0, \]</div>
<p>(and this bound in not valid for any higher value of <span class="math notranslate nohighlight">\(p\)</span>), for some constant <span class="math notranslate nohighlight">\(C\)</span>.</p>
<p>An equivalent way to write this is <span class="math notranslate nohighlight">\( \tau = \mathcal{O}(\Delta t^p)\)</span>.</p>
<p>A method is called <em>consistent</em> if the LTE converges to zero as <span class="math notranslate nohighlight">\(\Delta t\)</span> tends to zero. Note that this is equivalent to having a convergence order <span class="math notranslate nohighlight">\(p&gt;0\)</span>.</p>
<p>Recall our discussion in a previous lecture on estimating convergence orders of algorithms via finding the slopes of lines on log-log plots - we will do this exact thing here where we plot <span class="math notranslate nohighlight">\(\tau\)</span> against <span class="math notranslate nohighlight">\(\Delta t\)</span>.</p>
<br>
<br>
<p>Based on the above Taylor series analysis we can say that the forward Euler method has a leading order term in its local truncation error of order <span class="math notranslate nohighlight">\(\mathcal{\Delta t}\)</span> and so is consistent, with an order of accuracy (<span class="math notranslate nohighlight">\(p\)</span>) of one.</p>
</section>
<section id="local-error">
<h3>Local error<a class="headerlink" href="#local-error" title="Permalink to this heading">#</a></h3>
<p>Assuming previous time levels are known exactly, the <em>local error</em> can be defined as the error committed by the numerical method in one time step. As we shall see below, it is equal to the LTE multiplied by the time step size.</p>
<p>Or said another way the LTE is the local error per time step.</p>
<br>
<br>
<p>In the case of forward Euler, if we assume that <span class="math notranslate nohighlight">\(y_n=y(t_n)\)</span>, i.e. the numerical solution is exact at time level <span class="math notranslate nohighlight">\(n\)</span>, then one step forward of the numerical method satisfies</p>
<div class="math notranslate nohighlight">
\[ y_{n+1} = y_n + \Delta t\, f(t_n,y_n),\]</div>
<p>whereas the true solution satisfies</p>
<div class="math notranslate nohighlight">
\[ y(t_{n+1}) = y_n + \Delta ty'_n + \frac{\Delta t^2}{2!}y''_n + \frac{\Delta t^3}{3!}y'''_n + \mathcal{O}(\Delta t^4),\]</div>
<p>the difference <span class="math notranslate nohighlight">\(y(t_{n+1}) - y_{n+1}\)</span> is thus</p>
<div class="math notranslate nohighlight">
\[\text{Local error} = \frac{\Delta t^2}{2!}y''_n + \mathcal{O}(\Delta t^3),\]</div>
<p>which is consistent with what we said above:  the local error is the “LTE multiplied by the time step size”:</p>
<div class="math notranslate nohighlight">
\[\text{Local error} = \Delta t \, \times \, \tau\]</div>
</section>
<section id="global-error">
<h3>Global error<a class="headerlink" href="#global-error" title="Permalink to this heading">#</a></h3>
<p>The <em>global error</em> was given in the definition of convergence above:</p>
<div class="math notranslate nohighlight">
\[E := \max_{t_0 \, \le \, t_n \, \le \, T}\| \boldsymbol{y}_{n} - \boldsymbol{y}\,(t_{n})\|.\]</div>
<p>[Recall that convergence was defined as <span class="math notranslate nohighlight">\(E \longrightarrow 0\)</span> as <span class="math notranslate nohighlight">\(\Delta t \longrightarrow 0\)</span>.]</p>
</section>
<section id="links-between-errors-and-stability">
<h3>Links between errors and stability<a class="headerlink" href="#links-between-errors-and-stability" title="Permalink to this heading">#</a></h3>
<p>Note that consistency alone does not imply convergence of the overall scheme as defined above.</p>
<p>Instead</p>
<blockquote>
<div><p>Consistency <span class="math notranslate nohighlight">\(+\)</span> Stability <span class="math notranslate nohighlight">\(\iff\)</span> Convergence</p>
</div></blockquote>
</section>
</section>
<section id="stability">
<h2>Stability<a class="headerlink" href="#stability" title="Permalink to this heading">#</a></h2>
<p>Recall that we said that stability of a numerical solver is established by considering when does a continuous (linear) model problem converge to zero, or diverge to infinity, and when does a numerical solver exhibit consistent behaviour when applied to the same linear model problem.</p>
</section>
<section id="continuous-case">
<h2>Continuous case<a class="headerlink" href="#continuous-case" title="Permalink to this heading">#</a></h2>
<p>The linear model problem we need to consider is</p>
<div class="math notranslate nohighlight">
\[\frac{dz}{dt} = \lambda z, \]</div>
<p>where we need to consider the case where <span class="math notranslate nohighlight">\(\lambda\)</span> is a complex number.</p>
<p>This has the exact solution</p>
<div class="math notranslate nohighlight">
\[z(t) = z(0) \text{e}^{\lambda\,t}. \]</div>
<br>
<p>The important thing to note is that the long-term solution behaviour of this problem is governed by whether or not <span class="math notranslate nohighlight">\(\lambda\)</span> is greater than or less than zero:</p>
<ul class="simple">
<li><p>if <span class="math notranslate nohighlight">\(\lambda&gt;0\)</span> then <span class="math notranslate nohighlight">\(z \longrightarrow\infty\)</span>,</p></li>
<li><p>if <span class="math notranslate nohighlight">\(\lambda&lt;0\)</span> then <span class="math notranslate nohighlight">\(z \longrightarrow 0\)</span>,</p></li>
<li><p>if <span class="math notranslate nohighlight">\(\lambda=0\)</span> then <span class="math notranslate nohighlight">\(z \equiv z(0)\)</span>,</p></li>
</ul>
<p>as <span class="math notranslate nohighlight">\(t\longrightarrow\infty\)</span>.</p>
<p>You could of course write some code to check this for a few examples.</p>
<p><strong>Aside:</strong> Now you might be thinking that while that may be interesting, this is a special (linear) case and so how useful can this be in general. Well it turns out that consideration of this simple case is extremely valuable and tells us a lot about more complex (e.g. nonlinear) problems as well. See Section 7.4.3 of LeVeque’s book on finite difference methods.</p>
<p>However, it is very important that we extend the above analysis to systems (i.e. vector problems with more than one component):</p>
</section>
<section id="discrete-case">
<h2>Discrete case<a class="headerlink" href="#discrete-case" title="Permalink to this heading">#</a></h2>
<p>To analyse the stability of our numerical method we perform a similar analysis.</p>
<p>Or said another way, we ask the question: how does the act of discretising the problem change the solution behaviour we found above for this test problem?</p>
<p>[We will see that the answer to this question is dependent on the underlying problem’s physical parameters (which here in this abstract test problem are all encoded within the <span class="math notranslate nohighlight">\(\,\lambda\,\)</span> parameter), but is also a function of numerical parameters such as the time step size <span class="math notranslate nohighlight">\(\Delta t\)</span>].</p>
<p>The forward Euler scheme applied to our model problem takes the form</p>
<div class="math notranslate nohighlight">
\[\frac{{z}_{n+1}-{z}_{n}}{\Delta t} = \lambda z_{n}\;\;\;\iff\;\;\;
z_{n+1} = (1+\lambda\Delta t)z_{n}. \]</div>
<p>The solution of this sequence can be written in terms of the initial condition as</p>
<div class="math notranslate nohighlight">
\[z_{n} = (1+\lambda\Delta t)^{n} z_0,\]</div>
<p>which clearly tends to zero provided</p>
<div class="math notranslate nohighlight">
\[\left|\;1+\lambda\Delta t\;\right|&lt;1,\]</div>
<p>(this quantity can be termed the <em>amplification factor</em> for the scheme).</p>
<p>Substituting <span class="math notranslate nohighlight">\(\lambda=\lambda_R + i\lambda_I\)</span>, we have the stability condition</p>
<div class="math notranslate nohighlight">
\[\sqrt{(1+\lambda_R\Delta t)^2 + (\lambda_I\Delta t)^2}&lt;1.\]</div>
<p>[For the absolute value of a complex number see: <a class="reference external" href="https://en.wikipedia.org/wiki/Absolute_value#Complex_numbers">https://en.wikipedia.org/wiki/Absolute_value#Complex_numbers</a>].</p>
<p>For the case of forward Euler the stable region can therefore be visualised as a circle in the complex plane centred at <span class="math notranslate nohighlight">\((-1,0)\)</span> with radius 1, with the quantities <span class="math notranslate nohighlight">\(\lambda_R\Delta t\)</span> and <span class="math notranslate nohighlight">\(\lambda_I\Delta t\)</span> on the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> axes.</p>
<p>Note that this is significantly more restrictive than the continuous case (which for stability simply required that <span class="math notranslate nohighlight">\(\,\lambda_R&lt;0\)</span>), and for larger eigenvalues <span class="math notranslate nohighlight">\(\lambda\)</span> requires a smaller time step size <span class="math notranslate nohighlight">\(\Delta t\)</span> to ensure stability.</p>
<p>Let’s plot both of these stability regions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s try calculating and plotting the stability region for the discrete (FE) and continuous problems</span>

<span class="c1"># set up a mesh in x,y, sufficiently fine to get a nice image, with the bounds chosen appropriately</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># define a complex parameter which is our  lambda * dt  quantity</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>

<span class="c1"># compute the &quot;amplification factor&quot; for the forward Euler scheme</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span>

<span class="c1"># and its magnitude - we want this to be less than one for stability</span>
<span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>

<span class="c1"># set up our figs for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  <span class="c1"># add some padding otherwise axes labels overlap</span>

<span class="c1"># plot the forward Euler stability region</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (forward Euler)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># as we didn&#39;t do it previously let&#39;s also plot the stability region for the continuous problem</span>
<span class="c1"># note no dt in the axis labels as &quot;timestep&quot; is meaningless in the continuous world</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (continuous problem)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a9be2d9b365adc70af9dec439358c71639f1e149bbf83fc404208e25982b751a.png" src="../_images/a9be2d9b365adc70af9dec439358c71639f1e149bbf83fc404208e25982b751a.png" />
</div>
</div>
<p>We can similarly derive an amplification factor for our other three initial simple schemes, plots of which look like the following:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s calculate and plot the stability region for our discrete schemes</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>

<span class="c1"># forward Euler amplification factor,  and its magnitude</span>
<span class="n">FEamp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span>
<span class="n">FEampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">FEamp</span><span class="p">)</span>

<span class="c1"># backward Euler amplification factor,  and its magnitude</span>
<span class="n">BEamp</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lamdt</span><span class="p">)</span>
<span class="n">BEampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">BEamp</span><span class="p">)</span>

<span class="c1"># trapezoidal amplification factor,  and its magnitude</span>
<span class="n">trapamp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">lamdt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">trapampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">trapamp</span><span class="p">)</span>

<span class="c1"># set up our figs for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># reshape the list of axes as we are going to use in a loop</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot the forward Euler stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">FEampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">FEampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (forward Euler)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.45</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># plot the backward Euler stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">BEampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">BEampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (backward Euler)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># plot the leapfrog stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (leapfrog)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mf">5.</span><span class="o">/</span><span class="mf">6.</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span> 
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">2.4</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># plot the trapezoidal stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">trapampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">trapampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (trapezoidal)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f8c0c77a9f7f0a12a8ac6e978ffa2a2d66188f8fbdc00fffaded8be34988e918.png" src="../_images/f8c0c77a9f7f0a12a8ac6e978ffa2a2d66188f8fbdc00fffaded8be34988e918.png" />
</div>
</div>
<section id="id5">
<h3>Comments<a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Recall that the stability region for the <em>continuous problem</em> is given by <span class="math notranslate nohighlight">\(Re(\lambda)&lt;0\)</span>, so ideally we would like the numerical scheme to be consistent with this, if it isn’t we need to choose our time step size carefully to ensure stability (and for some schemes note that this may not be possible).</p></li>
<li><p>Backward Euler’s stability region <em>contains</em> that of the continuous problem and so the scheme is termed <strong>unconditionally stable</strong> - this analysis indicates that the scheme should be stable (for problems with  <span class="math notranslate nohighlight">\(Re(\lambda)&lt;0\)</span>) no matter how large we choose <span class="math notranslate nohighlight">\(\Delta t\)</span>.</p></li>
<li><p>This is also the case for the trapezoidal scheme.</p></li>
<li><p>Note however that the backward Euler stability region is actually <em>larger</em> than for the continuous problem. E.g. this means that even for a positive (real component of) <span class="math notranslate nohighlight">\(\lambda\)</span> (for which while of course the exact solution, being an exponential, goes off to infinity), our analysis indicates that if we choose a large enough <span class="math notranslate nohighlight">\(\Delta t\)</span> backward Euler will be stable - but what does this mean in practice? - See the example directly below.</p></li>
<li><p>Leapfrog (as a two step method) is a bit more complicated. As we saw above the method possesses a “spurious mode”, this grows with time when excited and hence the method is unstable, except in situations where this “mode” is never initially excited. This is the case when the eigenvalues of the problem are purely imaginary, as indicated in the above stability region plot. Filters do exist to periodically kill off the spurious mode and make the method usable for more general applications. We won’t go into any more detail on this, but if interested search for “Robert-Asselin time filter”.</p></li>
</ul>
</section>
<section id="backward-euler-excess-stability-test">
<h3>Backward Euler excess stability test<a class="headerlink" href="#backward-euler-excess-stability-test" title="Permalink to this heading">#</a></h3>
<p>We should say more about what Backward Euler and what it means for its stability region to be larger than that of the continuous problem.</p>
<p>Let’s consider a continuous problem whose true solution behaviour involves exponential growth to infinity, and see what happens if we use FE and BE on this case with a relatively large time step size.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># choosing K to be negative means that the true solution goes off to infinity</span>
<span class="n">K</span> <span class="o">=</span> <span class="o">-</span><span class="mi">10</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.25</span>  <span class="c1"># also try dt = 0.15 which would place us inside the &quot;unstable circular region&quot; for BE</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">y</span>

<span class="k">def</span> <span class="nf">y_ex</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to evaluate the exact solution to the exponential decay problem with y_r=0</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="k">return</span> <span class="n">y0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">K</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># let&#39;s use a finer resolution to plot the exact solution </span>
<span class="c1"># to give a smooth curve in our plot</span>
<span class="n">tfine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="o">/</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># set up figure with 4 subplots to plot our 4 methods</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># our time levels for the numerical solution</span>
<span class="n">N_dt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">tend</span><span class="o">/</span><span class="n">dt</span><span class="p">))</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N_dt</span><span class="p">,</span> <span class="n">N_dt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="c1"># an alterntive would be two use</span>
<span class="c1"># t = np.arange(0, tend, dt)</span>
<span class="c1"># but round-off means that can miss the tend value</span>
<span class="c1"># alternatively we could use something like</span>
<span class="c1"># t = np.arange(0, tend+1.e-10, dt)</span>
<span class="c1"># but the 1.e-10 increment needs to be relative</span>

<span class="c1"># a time loop to implement forward Euler</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">t_n</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">t</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
    <span class="c1"># note for this example this is the same as C[n]*(1-dt*K)</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">t_n</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;forward Euler&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">tfine</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact solution&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Numerical vs exact solution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>

<span class="c1"># backward Euler</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
<span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">y0</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    <span class="c1"># note that for this simple problem we can rearrange the </span>
    <span class="c1"># implicit expression and hence do not need to use the </span>
    <span class="c1"># f function - if we did we would need to use an </span>
    <span class="c1"># implicit equation solver such as was introduced in L4</span>
    <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">K</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;backward Euler&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tfine</span><span class="p">,</span> <span class="n">y_ex</span><span class="p">(</span><span class="n">tfine</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact solution&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y(t)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Numerical vs exact solution&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-1.0, 10.0)
</pre></div>
</div>
<img alt="../_images/0eaa8d96af02c259ed7b147dca75948a04cb093cde08d2ef2358412882f034f6.png" src="../_images/0eaa8d96af02c259ed7b147dca75948a04cb093cde08d2ef2358412882f034f6.png" />
</div>
</div>
<p>So note that it is BE here that is actually the one that’s displaying spurious behaviour - the solution is spuriously damped to the degree that it does not tend to infinity as it should.</p>
<p>Smaller time step sizes here will result in it recovering the correct qualitative behaviour.</p>
</section>
</section>
<section id="absolute-stability">
<h2>Absolute stability<a class="headerlink" href="#absolute-stability" title="Permalink to this heading">#</a></h2>
<p>Note that this form of stability is actually termed <strong>absolute stability</strong> and is concerned with <em>practical limitations</em> on time step sizes which give reasonable numerical results - i.e. for a given problem (e.g. here for a given value of <span class="math notranslate nohighlight">\(\lambda\)</span>) the choice of a time step size <span class="math notranslate nohighlight">\(\Delta t\)</span> that places us inside that schemes stability region.</p>
<p>And even before we get to that point, importantly this concept also gives us a means to select an appropriate time stepping scheme which allows us to use a reasonable time step.</p>
<br>
<p>Below, the concept of <strong>zero stability</strong> will also be introduced.</p>
<br>
<p>Note that although an absolute stability analysis is based on consideration of a linear test problem it is also generally of significant use in determining appropriate time step sizes for nonlinear problems, see LeVeque - FD - Section 7.4.3 for a discussion of this point. We also commented on this fact in the previous lecture.</p>
<p>For forward Euler we state the method is absolutely stable provided the time step is chosen such that <span class="math notranslate nohighlight">\(|1+\lambda\Delta t| \le 1\)</span> (we call the region of the complex plane where this is true the <em><strong>region of absolute stability</strong></em>); otherwise it is unstable.</p>
<br>
<section id="a-stability-a-stable-methods">
<h3>“A” stability / A-stable methods<a class="headerlink" href="#a-stability-a-stable-methods" title="Permalink to this heading">#</a></h3>
<p>For a method such as backward Euler (and trapezoidal) where its region of absolute stability contains all of the left hand complex plane, we call the method <em>A-stable</em>.</p>
</section>
<section id="a-alpha-stability-star">
<h3>A(<span class="math notranslate nohighlight">\(\alpha\)</span>) stability [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#a-alpha-stability-star" title="Permalink to this heading">#</a></h3>
<p>For many problems the eigenvalues (i.e. the <span class="math notranslate nohighlight">\(\lambda\)</span>’s in the above stability analysis) have large negative real parts, but relatively small imaginary parts.</p>
<p>For these types of problems we don’t actually need schemes which contain the entire negative complex plane in their region of absolute stability (i.e. not fully A-stable), rather we would like the negative real axis and a certain region either side of it to be in the region of absolute stability.</p>
<p>Methods which have a region of absolute stability that encompass a <em>wedge</em> extending to the left from the origin with angles <span class="math notranslate nohighlight">\(\alpha\)</span> above and below the real axis are termed A(<span class="math notranslate nohighlight">\(\alpha\)</span>)-stable (so full A-stability is the same as A(<span class="math notranslate nohighlight">\(\pi/2\)</span>)-stability or  A(<span class="math notranslate nohighlight">\(90\)</span>)-stability).</p>
<p>BDF methods we introduce near the end of this lecture have this property.</p>
</section>
</section>
<section id="l-stability-star-star">
<h2>L-stability [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#l-stability-star-star" title="Permalink to this heading">#</a></h2>
<p>L-stability is a stronger property than full A-stability which is sometimes useful for problems with very large eigenvalues.</p>
<p>Consider backward Euler and the Trapezoidal scheme which are both A-stable and so we should be able to take an arbitrarily large time step size and remain stable for problems where the real part of <span class="math notranslate nohighlight">\(\lambda\)</span> is negative.</p>
<p>The amplification factors (<span class="math notranslate nohighlight">\(R(z)\)</span> where <span class="math notranslate nohighlight">\(z:=\lambda\,\Delta t\)</span>) we used in the above code to plot their stability regions tell us we can write the two schemes as</p>
<div class="math notranslate nohighlight">
\[ z_{n+1}^{\text{(BE)}} = R(z)^{\text{(BE)}} z_{n}^{\text{(BE)}} \;\;\;\;\text{where}\;\;\;\; R(z)^{\text{(BE)}} = \frac{1}{1-z},\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[ z_{n+1}^{\text{(TR)}} = R(z)^{\text{(TR)}} z_{n}^{\text{(TR)}} \;\;\;\;\text{where}\;\;\;\; R(z)^{\text{(TR)}} = \frac{1+\tfrac{1}{2}z}{1-\tfrac{1}{2}z}.\]</div>
<p>But consider what happens in the limit of <span class="math notranslate nohighlight">\(|z|\longrightarrow\infty\)</span>, i.e. as the time step size increases to infinity:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|R(z)^{\text{(BE)}}| \longrightarrow 0\)</span> and we have the correct qualitative behaviour in our solution;</p></li>
<li><p><span class="math notranslate nohighlight">\(|R(z)^{\text{(TR)}}| \longrightarrow 1\)</span>, so while the solution does not diverge, it does not converge to the correct solution.</p></li>
</ul>
<p>We would therefore say that BE is L-stable while Trap is not.</p>
<section id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this heading">#</a></h3>
<p>Let’s see an example of this.</p>
<p>Consider the problem</p>
<div class="math notranslate nohighlight">
\[y'(t) = \lambda(y - \cos(t)) - \sin(t), \;\;\;\; y(0) = y_0.\]</div>
<p>The exact solution to this problem is</p>
<div class="math notranslate nohighlight">
\[y(t) = \text{e}^{\lambda t}(y_0 - 1) + \cos(t).\]</div>
<p>Notice that the initial condition <span class="math notranslate nohighlight">\(y_0 = 1\)</span> leads to the simple solution <span class="math notranslate nohighlight">\(y(t) = \cos(t)\)</span>.</p>
<p>However, for other initial conditions the additional term <span class="math notranslate nohighlight">\(\text{e}^{\lambda t}(y_0 - 1)\)</span> is non-zero. Clearly in the case of a negative real <span class="math notranslate nohighlight">\(\lambda\)</span> parameter this term decays to zero, i.e. solutions with initial condition <span class="math notranslate nohighlight">\(y_0 \ne 1\)</span> converge to the solution <span class="math notranslate nohighlight">\(y(t) = \cos(t)\)</span>.</p>
<p>If <span class="math notranslate nohighlight">\(\lambda\)</span> is large then this initial “transient” will be very short-lived. Let’s suppose that it is the long term behaviour we want to simulate accurately. Well for a start explicit methods are out as we would need to choose a very small time step size to be in the stability region. But BE and TR are both A-stable so should be reasonable choices shouldn’t they? Let’s check this.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/L-stability_example.png"><img alt="../_images/L-stability_example.png" src="../_images/L-stability_example.png" style="width: 75%;" /></a>
</figure>
<p>Confirming this behaviour is a homework exercise. Note that reducing the time step does not help. This problem with the trapezoidal scheme does not manifest if we start with the initial condition <span class="math notranslate nohighlight">\(y_0=1\)</span>.</p>
</section>
</section>
<section id="time-stepping-errors">
<h2>Time-stepping errors<a class="headerlink" href="#time-stepping-errors" title="Permalink to this heading">#</a></h2>
<p>Recall from a previous lecture on numerical integration that we performed a mathematical analysis to compute local quadrature errors over each sub-interval, and then summed these to calculate/estimate a global error for composite schemes over the total interval we cared about.</p>
<p>As we see from the discussion above, we can think of time here as being the equivalent of this integration interval, and hence approximation of the integral over each sub-interval introduces a <em>local error</em>, but now in the time-stepping case we cannot simply sum these to compute a global error as we use the numerical solution (which contains all the errors up to that point), to compute the next step along the solution trajectory. Thus errors <em>accumulate</em> and we need to take this into account in our analysis.</p>
</section>
<section id="a-little-bit-of-maths-to-bound-the-global-error-star-star">
<h2>A little bit of maths to bound the global error  [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#a-little-bit-of-maths-to-bound-the-global-error-star-star" title="Permalink to this heading">#</a></h2>
<p>Recall our definition of global error:</p>
<div class="math notranslate nohighlight">
\[E := \max_{t_0\, \le \, t_n \, \le \, T}\| {y}_{n} - {y}(t_{n})\|.\]</div>
<p>As the global error ‘accumulates’ this (the maximum value over all time levels) may well be the error at the final time, but it is also possible for some errors to cancel out, or for a long term trend to be accurately captured by the solver and thus for the errors to actually decrease at later times, hence the maximum error may not necessarily be at the final time.  We saw an example of this previously where the forward Euler scheme seemed to converge to the correct solution in the exponential decay/relaxation problem, even though there were large errors at early and intermediate times.</p>
<p>Let’s define the error at an arbitrary time level as</p>
<div class="math notranslate nohighlight">
\[E_n := {y}_{n} - {y}(t_{n}).\]</div>
<p>Let’s assume we are solving our linear model problem</p>
<div class="math notranslate nohighlight">
\[ y' = \lambda y, \;\;\;\;\;\; y(0)=y_0,\]</div>
<p>with forward Euler, and so we have the relation for the discrete solution</p>
<div class="math notranslate nohighlight">
\[y_{n+1} = y_n + \Delta t f(t_n,y_n) = (1+\lambda\Delta t)y_n.\]</div>
<p>The local truncation error from the previous lecture tells us about the exact continuous solution</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
&amp; \;\;\;\; \tau_{n} := \frac{y(t_{n+1}) -  y(t_n)}{\Delta t} - f(t_n,y(t_n))\\[10pt] 
\iff\;\;\;\; &amp; \;\;\;\;
y(t_{n+1}) =  y(t_n) + \Delta t  f(t_n,y(t_n)) - \Delta t  \tau_{n}\\[10pt] 
\iff\;\;\;\; &amp; \;\;\;\;
y(t_{n+1}) =  (1+\lambda\Delta t)y(t_n)  - \Delta t  \tau_{n},
\end{align*}
\end{split}\]</div>
<p>(the final term emphasising the comment from the previous lecture that the local error is the LTE multiplied by the time step size).</p>
<p>Subtracting we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
E_{n+1} := {y}_{n+1} - {y}(t_{n+1}) &amp; = y_n + \Delta t f(t_n,y_n) - \left[y(t_n) + \Delta t  f(t_n,y(t_n)) - \Delta t  \tau_{n}\right] \\[10pt] 
&amp; = (1+\lambda\Delta t)y_n - (1+\lambda\Delta t)y(t_n) +  \Delta t  \tau_{n}\\[10pt]
&amp; = (1+\lambda\Delta t) ( y_n - y(t_n)) +  \Delta t  \tau_{n}
\\[10pt]
&amp; = (1+\lambda\Delta t) E_n +  \Delta t  \tau_{n},
\end{align*}
\end{split}\]</div>
<p>this gives us a recursive relation for the global error, which additionally demonstrates the effect of the local truncation error at every time step.</p>
<p>[If it helps you could think about a financial analogue here - <span class="math notranslate nohighlight">\(E\)</span> being your savings, <span class="math notranslate nohighlight">\(\lambda\Delta t\)</span> an interest rate, with <span class="math notranslate nohighlight">\(\Delta t  \tau_{n}\)</span> then being an additional investment made each period - cf. a homework exercise form L4].</p>
<p>This is true for all <span class="math notranslate nohighlight">\(n\)</span>, and so we can expand it out backwards as follows:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
E_{n+1} &amp; = (1+\lambda\Delta t) E_n +  \Delta t  \tau_{n}\\[10pt] 
&amp; = (1+\lambda\Delta t) [ (1+\lambda\Delta t) E_{n-1} +  \Delta t  \tau_{n-1} ]  +  \Delta t  \tau_{n}\\[10pt] 
&amp; = (1+\lambda\Delta t) [ (1+\lambda\Delta t) \{ (1+\lambda\Delta t) E_{n-2} +  \Delta t  \tau_{n-2} \} +  \Delta t  \tau_{n-1} ]  +  \Delta t  \tau_{n}.
\end{align*}
\end{split}\]</div>
<p>If we continue this all the way back to the start of the time-stepping iteration we would clearly be left with an <span class="math notranslate nohighlight">\(E_0\)</span> term (i.e. to account for any potential error in our representation of the exact initial condition), along with a sum of the truncation errors at each time level multiplied by the appropriate power of the amplification factor [we’ve also taken the opportunity here to replace <span class="math notranslate nohighlight">\(n+1\)</span> with <span class="math notranslate nohighlight">\(n\)</span>, which we can do as <span class="math notranslate nohighlight">\(n\)</span> is arbitrary]:</p>
<div class="math notranslate nohighlight">
\[ E_{n} = (1+\lambda\Delta t)^{n} E_0 + \Delta t\sum_{i=1}^{n} (1+\lambda\Delta t)^{n-i}\tau_{i-1}. \]</div>
<p>[Again you may find it helpful to think about the financial analogue mentioned above and this being a form of “compounding”.]</p>
<p>Since <span class="math notranslate nohighlight">\(\,|1+\lambda\Delta t| \le e^{\,|\lambda|\, \Delta t}\,\)</span> (which follows from <span class="math notranslate nohighlight">\(\,e^{\,|\lambda|\, \Delta t} = 1 + |\lambda|\, \Delta t + (|\lambda|\, \Delta t)^2/2 + \ldots\)</span>), we know that</p>
<div class="math notranslate nohighlight">
\[  |1 + \Delta t \lambda|^{n  - i} \leq e^{\,(n-i)\, \Delta t\, |\lambda|} \leq e^{\,n\,\Delta t\, |\lambda|} = e^{\,|\lambda| \, T}\;\;\;\;\;\text{and similarly} \;\;\;\;\;  
|1 + \Delta t \lambda|^{n} \leq  e^{\,|\lambda| \, T},
\]</div>
<p>where <span class="math notranslate nohighlight">\(T = n\Delta t\)</span> is the end point of our integration.</p>
<p>Therefore taking the absolute value of our error estimate we can establish the following <em>bound</em> on our error:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*} 
|E_{n}| 
&amp; \le  e^{\,|\lambda|\, T} \left( |E_0| + \Delta t 
\sum_{i=1}^{n} |\tau_{i-1}|\right)\\[10pt]
&amp; \le  e^{\,|\lambda|\, T} \left( |E_0| + n\Delta t \max_{1\le i\le n}|\tau_{i-1}| \right)
= e^{\,|\lambda|\, T} \left( |E_0| + T \max_{1\le i\le n}|\tau_{i-1}| \right)
\end{align*}
\end{split}\]</div>
<p>We know from the previous lecture that the LTE for forward Euler is, for any <span class="math notranslate nohighlight">\(n\)</span>,</p>
<div class="math notranslate nohighlight">
\[ \tau_n = \frac{y_{n+1} -  y_n}{\Delta t} - f(t_n,y_n) = \frac{\Delta t}{2!}y''_n + \mathcal{O}(\Delta t^2),\]</div>
<p>and if we assume the initial error <span class="math notranslate nohighlight">\(|E_0|\)</span> is zero (i.e. we are given and use an exact initial condition) then</p>
<div class="math notranslate nohighlight">
\[|E_{n}| \le  
e^{\,|\lambda|\, T} T  \max_{1\le i\le n}|\tau_{i-1}| 
=  e^{\,|\lambda|\, T} T \left( \frac{\Delta t}{2}\,\max |y''| + \mathcal{O}(\Delta t^2)\right),\]</div>
<p>and hence the method converges at the same order as the LTE, i.e. the global error is first-order in <span class="math notranslate nohighlight">\(\Delta t\)</span>.</p>
<section id="id6">
<h3>Comments<a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>A key thing to note here is that the global error is the same order as the LTE, hence a truncation error analysis also tells us about the expected convergence order globally (although we showed this for forward Euler, this result holds more generally for all stable schemes).</p></li>
<li><p>The <span class="math notranslate nohighlight">\(e^{\,|\lambda|\, T} T\)</span> factor grows with <span class="math notranslate nohighlight">\(T\)</span> and hence the global error can only get larger the larger time interval we consider.</p></li>
<li><p>The size of the global error is also a function of an appropriate derivative of the solution <span class="math notranslate nohighlight">\(y\)</span> (here for a first-order scheme this is the second derivative that came from the definition of the LTE) - more complex or sharply varying problems would be expected to have larger global errors.</p></li>
<li><p>Note that essentially nothing changes if this analysis was instead performed on the model problem</p></li>
</ul>
<div class="math notranslate nohighlight">
\[ y' = \lambda y + g(t),\]</div>
<p>(see LeVeque (FD book) sections 6.2, 6.3.1).</p>
<ul class="simple">
<li><p>Also, as long as <span class="math notranslate nohighlight">\(f\)</span> is well-behaved then the same analysis holds for nonlinear problems (LeVeque section 6.3.3, 7.4.3), with <span class="math notranslate nohighlight">\(\lambda\)</span> essentially replaced by (a bound on) the derivative of <span class="math notranslate nohighlight">\(f\)</span> w.r.t. <span class="math notranslate nohighlight">\(y\)</span> (or more generally the eigenvalues of the Jacobian matrix).</p></li>
<li><p>See also LeVeque - Chapter 6 for similar results for more general time-stepping schemes.</p></li>
</ul>
</section>
</section>
<section id="zero-stability-star-star">
<h2>Zero stability  [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#zero-stability-star-star" title="Permalink to this heading">#</a></h2>
<p>Note that the one-step error at step <span class="math notranslate nohighlight">\(m\)</span>: <span class="math notranslate nohighlight">\(\,\Delta t\tau_m\)</span>, contributes the term introduced in the <span class="math notranslate nohighlight">\(m\)</span>-th step: <span class="math notranslate nohighlight">\((1+\lambda\Delta t)^{n-m}\Delta t\tau_m\)</span> to the global error.</p>
<p>Since the factor <span class="math notranslate nohighlight">\((1+\lambda\Delta t)^{n-m}\)</span> is bounded (by <span class="math notranslate nohighlight">\(e^{\,|\lambda| \,T}\)</span> - note this bound is independent of <span class="math notranslate nohighlight">\(\Delta t\)</span>) as we reduce the time step size, this tells us that each one step contribution to the global error is bounded.</p>
<p>So although the local error can be amplified significantly by the exponential factor, and will grow with time, this factor is bounded independent of the time step size, and so does not impact on the <em>order of convergence</em> (in the asymptotic limit - this means that we might have to use an incredibly small time step to actually observe this convergence).</p>
<p>Hence, here for forward Euler the global error also converges at first order (in the asymptotic limit).</p>
<p>Note that the fact that individual local errors are bounded in their contribution to the global error is of course a desirable (vital!) condition, and is termed <em><strong>zero stability</strong></em> - one of several definitions of stability.</p>
<p>LeVeque - FD - section 6.4, example 6.2 gives an example of a time stepping scheme which although consistent (is first-order accurate) does not converge in general and so is, by definition, <em>not</em> zero stable.</p>
<p>Further to this, see LeVeque - FD - section 7.1 for an example of why a zero stable method can also give useless results for a <em>finite (i.e. practical)</em> value of the time step.</p>
<p>To establish whether a numerical method will produce reasonable results with a given finite time step size (and to guide us in the choice of a reasonable time step size), we need a different concept of stability.</p>
<p>A common and practical example of this is termed <em><strong>absolute stability</strong></em> and was the flavour of stability we defined above and considered in the previous lecture (as well as the four ‘simple’ schemes introduced above) where we plotted forward Euler’s stability region in the complex plane - we will return to this concept for some of our new (more advanced and higher order) schemes below.</p>
</section>
<section id="practical-choice-of-step-size">
<h2>Practical choice of step size<a class="headerlink" href="#practical-choice-of-step-size" title="Permalink to this heading">#</a></h2>
<p>NB. This text is taken essentially directly from LeVeque - FD - section 7.5:</p>
<p>” … obtaining computed results that are within some error tolerance requires two conditions:</p>
<ol class="arabic simple">
<li><p>The time step <span class="math notranslate nohighlight">\(\Delta t\)</span> must be small enough that the local truncation error is acceptably small. This gives a constraint of the form <span class="math notranslate nohighlight">\(\Delta t &lt; \Delta t_{\text{acc}}\)</span> (“acc” for accuracy), where <span class="math notranslate nohighlight">\(\Delta t_{\text{acc}}\)</span> depends on several things:</p>
<ul class="simple">
<li><p>What method is being used, which determines the expansion for the local truncation error;</p></li>
<li><p>How smooth the solution is, which determines how large the high order derivatives occurring in this (LTE) expansion are; and</p></li>
<li><p>What accuracy is required.</p></li>
</ul>
</li>
<li><p>The time step <span class="math notranslate nohighlight">\(\Delta t\)</span> must be small enough that the method is absolutely stable on this particular problem. This gives a constraint of the form <span class="math notranslate nohighlight">\(\Delta t &lt; \Delta t_{\text{stab}}\)</span> that depends on the magnitude and location of the eigenvalues of the Jacobian matrix <span class="math notranslate nohighlight">\(\,f'(y)\,\)</span> [or our <span class="math notranslate nohighlight">\(\lambda\)</span> above].</p></li>
</ol>
<p>Typically we would like to choose our time step based on accuracy considerations, so we hope <span class="math notranslate nohighlight">\(\Delta t_{\text{stab}} &gt; \Delta t_{\text{acc}}\)</span>. For a given method and problem, we would like to choose <span class="math notranslate nohighlight">\(\Delta t\)</span> so that the local error in each step is sufficiently small that the accumulated error will satisfy our error tolerance, assuming some <em>reasonable</em> growth of errors. ….</p>
<p>If stability considerations force us to use a much smaller time step than the local truncation error indicates should be needed, then this particular method is probably not optimal for this problem. This happens, for example, if we try to use an explicit method on a “stiff” problem, for which special methods have been developed” [as discussed below]</p>
</section>
<section id="linear-multistep-lms-methods">
<h2>Linear multistep (LMS) methods<a class="headerlink" href="#linear-multistep-lms-methods" title="Permalink to this heading">#</a></h2>
</section>
<section id="popular-time-stepping-schemes">
<h2>Popular time-stepping schemes<a class="headerlink" href="#popular-time-stepping-schemes" title="Permalink to this heading">#</a></h2>
<p>Two very famous/popular families of time-stepping schemes are:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Linear_multistep_method"><em>Linear multistep (LMS) methods</em></a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods"><em>Runge-Kutta (RK) methods</em></a></p></li>
</ul>
<p>They take fundamentally different approaches which have major implications for their implementations in code and suitability for different applications.</p>
</section>
<section id="introduction-lms">
<h2>Introduction - LMS<a class="headerlink" href="#introduction-lms" title="Permalink to this heading">#</a></h2>
<p>As an extension of the (four simple) example time-stepping schemes above, consider the most general linear relation between solutions spanning <span class="math notranslate nohighlight">\(k+1\)</span> levels (termed a <span class="math notranslate nohighlight">\(k\)</span>-step method):</p>
<div class="math notranslate nohighlight">
\[\sum_{j=0}^k \alpha_j \, y_{n+j} = \Delta t \sum_{j=0}^k \beta_j \, f(t_{n+j},y_{n+j}).\]</div>
<ul class="simple">
<li><p>Note that we can generally divide through by <span class="math notranslate nohighlight">\(\alpha_k\)</span>, i.e. normalise, and hence simply assume that <span class="math notranslate nohighlight">\(\alpha_k=1\)</span>. This helps emphasise that this is a scheme designed to calculate <span class="math notranslate nohighlight">\(y_{n+k}\)</span> using the previous <span class="math notranslate nohighlight">\(k\)</span> time levels.</p></li>
<li><p>The second thing to note is that if <span class="math notranslate nohighlight">\(\beta_k=0\)</span> then the corresponding method is explicit,</p></li>
<li><p>if <span class="math notranslate nohighlight">\(\beta_k\ne 0\)</span> then the corresponding method is implicit.</p></li>
<li><p>Since multistep methods make use of information from previous time levels this information needs to be stored for the appropriate number of future time levels. This is not the case with all methods, as we shall see later, and thus the LMS approach does come at the cost of memory usage.</p></li>
<li><p>The <em>Adams</em> methods we will introduce now make the choice <span class="math notranslate nohighlight">\(\alpha_k=1\)</span>, <span class="math notranslate nohighlight">\(\alpha_{k-1}=-1\)</span>, with the rest of the <span class="math notranslate nohighlight">\(\alpha\)</span> parameters chosen to be zero; the <span class="math notranslate nohighlight">\(\beta\)</span> parameters are then chosen to maximise the order of accuracy of the particular scheme. For explicit methods we need <span class="math notranslate nohighlight">\(\beta_k=0\)</span> and the remaining <span class="math notranslate nohighlight">\(k\)</span> coefficients can be chosen such that the method has order <span class="math notranslate nohighlight">\(k\)</span>. For implicit methods we can go one order higher.</p></li>
</ul>
<p>Not every method can be written in this form, consider for example the improved Euler method introduced at the end of the previous lecture (although note that IE can be interpreted as a predictor-corrector type of LMS method - see below).</p>
</section>
<section id="explicit-linear-multistep-methods-adams-bashforth-schemes">
<h2>Explicit linear multistep methods - Adams-Bashforth schemes<a class="headerlink" href="#explicit-linear-multistep-methods-adams-bashforth-schemes" title="Permalink to this heading">#</a></h2>
<p>So-called <em>Adams</em> schemes can be thought of as methods which start from the expression we saw above linking time stepping to quadrature:</p>
<div class="math notranslate nohighlight">
\[y_{n+1} - y_{n} = \int_{t_{n}}^{t_{n+1}} {f}(t,{y}(t))\, dt.\]</div>
<p>The LHS is in the form of the general LMS expression written above, with <span class="math notranslate nohighlight">\(\alpha_k=1\)</span>, <span class="math notranslate nohighlight">\(\alpha_{k-1}=-1\)</span>.</p>
<p>The <span class="math notranslate nohighlight">\(\{\beta_j\}\)</span> coefficients are then chosen such that the RHS of the general LMS expression in the cell above approximates the integral on the RHS of this expression.</p>
<p>By using information from more and more previous time levels (i.e. increasing <span class="math notranslate nohighlight">\(k\)</span>), we can approximate the integral to increasing accuracies, and this consequently leads to a family of time-stepping schemes of increasing accuracy.</p>
<p>[This doesn’t really map onto any of the approaches we saw in our lecture on quadrature as there we never used information from outside a (sub-)interval under consideration. The motivation to do this here comes from the fact that we have information (function evaluations) from previous time levels and so seek to make use of this.]</p>
<br>
<p>The <em><strong>Adams-Bashforth schemes</strong></em> are the <strong>explicit</strong> variants of the Adams family - we enforce <span class="math notranslate nohighlight">\(\beta_k=0\)</span> so that the function evaluated at the newest time level does not appear on the RHS.</p>
<p>The first four schemes in this family are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
k=1\; \textrm{(1-step AB scheme):} \;\;\;  y_{n+1} &amp;= y_{n} +\Delta t  f_{n} \\
k=2\; \textrm{(2-step AB scheme):} \;\;\;  y_{n+2} &amp;= y_{n+1} + \frac{\Delta t}{2}\; (-f_{n} + 3 f_{n+1}) \\
k=3\; \textrm{(3-step AB scheme):} \;\;\;  y_{n+3} &amp;= y_{n+2} + \frac{\Delta t}{12}\; (5 f_{n} - 16 f_{n+1} + 23 f_{n+2}) \\
k=4\; \textrm{(4-step AB scheme):} \;\;\;  y_{n+4} &amp;= y_{n+3} + \frac{\Delta t}{24}\; (-9 f_{n} + 37 f_{n+1} -59 f_{n+2} + 55 f_{n+3})
\end{align*}
\end{split}\]</div>
<p>where to save space we have introduced the notation <span class="math notranslate nohighlight">\(f_{j}:=f(t_j,y_j)\)</span>.</p>
<ul class="simple">
<li><p>Notice that the 1-step scheme in this family is <em>forward Euler</em>.</p></li>
<li><p>Notice that the leapfrog scheme is an example of an explicit LMS scheme, just NOT of Adams type.</p></li>
<li><p>The order of accuracy of these schemes is equal to <span class="math notranslate nohighlight">\(k\)</span>.</p></li>
<li><p>Note that as these expressions are valid for all <span class="math notranslate nohighlight">\(n\)</span> (apart from at the start, as per the <em>self-starting</em> comment above), we can rewrite them all to provide formulae for the <span class="math notranslate nohighlight">\((n+1)\)</span>-th time level, e.g. we could equivalently write:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\begin{align*}
k=4\; \textrm{(4-step AB scheme):} \;\;\;  y_{n+1} &amp;= y_{n} + \frac{\Delta t}{24} (55 f_{n} -59 f_{n-1} + 37 f_{n-2} -9 f_{n-3})
\end{align*}
\]</div>
</section>
<section id="adams-bashforth-scheme-sketch-of-derivation-star">
<h2>Adams-Bashforth scheme - sketch of derivation [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#adams-bashforth-scheme-sketch-of-derivation-star" title="Permalink to this heading">#</a></h2>
<p>Here we sketch how the above schemes can be derived [another example is in the homework exercises].</p>
<p>Consider as an example <span class="math notranslate nohighlight">\(k=2\)</span>, i.e. the two-step method (in the form where the newest time level we are solving for is level <span class="math notranslate nohighlight">\(\,n+1\)</span>):</p>
<div class="math notranslate nohighlight">
\[y_{n+1} - y_n = \Delta t \left( \beta_0 \, f_{n-1} + \beta_1 \, f_n \right) \approx  \int_{t_{n}}^{t_{n+1}} {f}(t,{y}(t))\, dt,\]</div>
<p>where we want to choose <span class="math notranslate nohighlight">\(\beta_0\)</span> and <span class="math notranslate nohighlight">\(\beta_1\)</span> such that we have a good approximation to the integral.</p>
<p>We considered the accuracy (or degree of precision) of quadrature rules in Lecture 2 by asking that our rule exactly integrated polynomials of up to some degree.  The <span class="math notranslate nohighlight">\(k=1\)</span> forward Euler scheme integrates exactly constant (<span class="math notranslate nohighlight">\(p=0\)</span>) polynomials. With two free parameters, <span class="math notranslate nohighlight">\(\beta_0\)</span> and <span class="math notranslate nohighlight">\(\beta_1\)</span>, let’s ask that our <span class="math notranslate nohighlight">\(k=2\)</span> scheme is exact for polynomials of degree 0 and 1.</p>
<p>Recall from L2 that we can do this by considering the monomials <span class="math notranslate nohighlight">\(f(t) = t^p\)</span> for <span class="math notranslate nohighlight">\(p = 0\)</span> and 1.</p>
<p>To make things a little easier we can assume that <span class="math notranslate nohighlight">\(t_{n-1} = -\Delta t,\; t_n = 0\)</span>, <span class="math notranslate nohighlight">\(t_{n+1} = \Delta t\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
  f(t)\equiv 1: \;\;\;\; \int_{t_{n}}^{t_{n+1}} \, dt &amp; = \Delta t  = \Delta t \left( \beta_0  + \beta_1 \right) \;\;\;\; \implies \;\;\;\; 1 =  \beta_0  + \beta_1  , \\[10pt]
  f(t)\equiv t: \;\;\;\; \int_{t_{n}}^{t_{n+1}} t\, dt &amp; = \frac{\Delta t^2}{2}  = \Delta t \left(-\Delta t \,\beta_0 \right) \;\;\;\; \implies \;\;\;\; \frac{1}{2} = -\beta_0  .
\end{align*}
\end{split}\]</div>
<p>This gives a system two simultaneous equations we can trivially solve to yield <span class="math notranslate nohighlight">\(\beta_0=-1/2\)</span> and <span class="math notranslate nohighlight">\(\beta_1=3/2\)</span>, which is indeed the AB2 scheme given in the cell directly above:</p>
<div class="math notranslate nohighlight">
\[y_{n+1} = y_{n} + \Delta t \left( \beta_0 \, f_{n-1} + \beta_1 \, f_n \right) = y_{n} + \frac{\Delta t}{2}\; (-f_{n-1} + 3 f_{n}).\]</div>
<p>By extending this analysis to more free parameters <span class="math notranslate nohighlight">\(\{\beta_j\}\)</span>, and higher-order polynomials, we can derive all the AB schemes - see the homework exercise where we do this for AB4.</p>
<p>Note than an alternative derivation that arrives at the same scheme involves replacing the integral of <span class="math notranslate nohighlight">\(f\)</span> on the RHS with the integral of the Lagrange interpolating polynomial that passes through the function values at the appropriate time levels. Different order schemes then result from different order interpolating polynomials (equivalently number of time levels considered).</p>
</section>
<section id="implicit-linear-multistep-methods-adams-moulton-schemes">
<h2>Implicit linear multistep methods - Adams-Moulton schemes<a class="headerlink" href="#implicit-linear-multistep-methods-adams-moulton-schemes" title="Permalink to this heading">#</a></h2>
<p>The <em><strong>Adams-Moulton schemes</strong></em> are the <strong>implicit</strong> variants of the Adams family - they are very similar to the AB schemes in that the same ‘Adams’ constraint applies to the <span class="math notranslate nohighlight">\(\alpha\)</span> parameters, but now  <span class="math notranslate nohighlight">\(\beta_k\ne 0\)</span>, and hence the schemes are all <em>implicit</em>.</p>
<p>The first five schemes in this family are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
&quot;k=0&quot;\; \textrm{(1-step AM scheme):} \;\;\;  y_{n+1} &amp;= y_{n} +{\Delta t}\; f_{n+1} \\
k=1\; \textrm{(1-step AM scheme):} \;\;\;  y_{n+1} &amp;= y_{n} +\frac{\Delta t}{2}\; (f_{n} + f_{n+1}) \\
k=2\; \textrm{(2-step AM scheme):} \;\;\;  y_{n+2} &amp;= y_{n+1} + \frac{\Delta t}{12}\; (-f_{n} + 8 f_{n+1} + 5f_{n+2}) \\
k=3\; \textrm{(3-step AM scheme):} \;\;\;  y_{n+3} &amp;= y_{n+2} + \frac{\Delta t}{24}\; (f_{n} - 5 f_{n+1} + 19 f_{n+2} + 9 f_{n+3}) \\
k=4\; \textrm{(4-step AM scheme):} \;\;\;  y_{n+4} &amp;= y_{n+3} + \frac{\Delta t}{720}\; (-19 f_{n} + 106 f_{n+1} - 264 f_{n+2} + 646 f_{n+3} + 251 f_{n+4})
\end{align*}
\end{split}\]</div>
<ul class="simple">
<li><p>Note that both the <span class="math notranslate nohighlight">\(&quot;k=0&quot;\)</span> and the <span class="math notranslate nohighlight">\(k=1\)</span> schemes use information from two time levels, and so both can be termed 1-step methods (i.e. they both <em>step</em> from <span class="math notranslate nohighlight">\(n\)</span> to <span class="math notranslate nohighlight">\(n+1\)</span>).</p></li>
<li><p>Note that the <span class="math notranslate nohighlight">\(k=0\)</span> scheme is <em>backward Euler</em>,</p></li>
<li><p>and the <span class="math notranslate nohighlight">\(k=1\)</span> scheme is <em>trapezoidal</em> (both seen at the start of this lecture).</p></li>
<li><p>The order of accuracy of these schemes is equal to <span class="math notranslate nohighlight">\(k+1\)</span> (one higher than AB for the same <span class="math notranslate nohighlight">\(k\)</span> as we have an additional parameter to play with here).</p></li>
<li><p>We can re-write the schemes to provide formulae for an update at time level <span class="math notranslate nohighlight">\(n+1\)</span>, e.g.:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[k=3\; \text{(3-step AM scheme):} \;\;\;  y_{n+1} = y_{n} + \frac{\Delta t}{24}\; (
9 f_{n+1} + 19 f_{n} - 5 f_{n-1}  + f_{n-2}).\]</div>
</section>
<section id="linear-multistep-methods-error-analysis-and-consistency-order-conditions-star-star">
<h2>Linear Multistep Methods - error analysis and consistency/order conditions  [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#linear-multistep-methods-error-analysis-and-consistency-order-conditions-star-star" title="Permalink to this heading">#</a></h2>
<p>Through the derivations above (and in homework) we’ve seen that, by construction, the methods are consistent with a given order of accuracy (since they are based on a consistent approximation to the integral in the integrated form of the ODE).</p>
<p>But let’s also see what an explicit derivation of the truncation error tells us.</p>
<p>The general from of LMS schemes is given by</p>
<div class="math notranslate nohighlight">
\[\sum_{j=0}^k \alpha_j \, y_{n+j} = \Delta t \sum_{j=0}^k \beta_j \, f(t_{n+j},y_{n+j}),\]</div>
<p>and hence the local truncation error for LMS schemes is defined by [recall we stipulated in our definition of the LTE that the scheme needs to be scaled so that it matches the ODE - so we need to divide above by the time step]:</p>
<div class="math notranslate nohighlight">
\[\tau := \frac{1}{\Delta t}\left[ \sum_{j=0}^k \alpha_j \, y(t_{n+j}) - \Delta t \sum_{j=0}^k \beta_j \, y'(t_{n+j})\right],\]</div>
<p>where we have replaced the numerical solution <span class="math notranslate nohighlight">\(y_{n+j}\)</span> with the exact solution <span class="math notranslate nohighlight">\(y(t_{n+j})\)</span> and used the fact that for the exact solution <span class="math notranslate nohighlight">\(f(t_{n+j},y(t_{n+j})) = y'(t_{n+j})\)</span>.</p>
<p>Taylor series tells us that</p>
<div class="math notranslate nohighlight">
\[ y(t_{n+j}) = y(t_n) + j\Delta t\, y'(t_n) + \frac{j^2\Delta t^2}{2!}y''_n + \mathcal{O}(\Delta t^3),\]</div>
<p>with derivative</p>
<div class="math notranslate nohighlight">
\[ y'(t_{n+j}) = y'(t_n) + j\Delta t\, y''(t_n) + \frac{j^2\Delta t^2}{2!}y'''_n + \mathcal{O}(\Delta t^3).\]</div>
<p>Substituting into the truncation error expression above and collecting terms yields</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\tau = \frac{1}{\Delta t}\left( \sum_{j=0}^k \alpha_j \right)y(t_n)
+ \left( \sum_{j=0}^k (j\alpha_j - \beta_j)\right)y'(t_n)
&amp; + \Delta t\left( \sum_{j=0}^k \left(\frac{1}{2}j^2\alpha_j - j\beta_j\right)\right)y''(t_n)\\[10pt]
+ \ldots
&amp; + \Delta t^{q-1}\left( \sum_{j=0}^k \left(\frac{1}{q!}j^q\alpha_j - \frac{1}{(q-1)!}j^{q-1}\beta_j\right)\right)y^{(q)}(t_n) \\[10pt]
&amp; + \ldots.
\end{align*}
\end{split}\]</div>
<p>For the method to be consistent we need that <span class="math notranslate nohighlight">\(\tau=\mathcal{O}(\Delta t^p)\)</span> where <span class="math notranslate nohighlight">\(p\)</span> is at least one.</p>
<p>Hence, for an LMS scheme to be consistent we require that the first two terms in the above expansion be zero, i.e.</p>
<div class="math notranslate nohighlight">
\[\sum_{j=0}^k \alpha_j = 0 \;\;\;\;\;\;\;\text{and}\;\;\;\;\;\;\;
\sum_{j=0}^k j\alpha_j =  \sum_{j=0}^k\beta_j.\]</div>
<p>Note further that if we choose the coefficients such that the first <span class="math notranslate nohighlight">\(p+1\)</span> terms vanish then the methods will the <span class="math notranslate nohighlight">\(p\)</span>-th order accurate.</p>
<p>For <em>Adams</em> methods specifically to be consistent (as <span class="math notranslate nohighlight">\(\alpha_k=1\)</span>, <span class="math notranslate nohighlight">\(\alpha_{k-1}=-1\)</span>, and all the other <span class="math notranslate nohighlight">\(\alpha\)</span> parameters are zero, the first relation is clearly satisfied) we need</p>
<div class="math notranslate nohighlight">
\[\sum_{j=0}^k\beta_j = \sum_{j=0}^k j\alpha_j = k - (k-1) = 1.\]</div>
<p>In the cell below we can check that this is true, as well as the coefficients of even higher order terms to confirm that AB4 and AM3 are indeed both fourth oder accurate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>

<span class="c1">#AB4 coefficients</span>
<span class="n">AB4_alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
<span class="n">AB4_betas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">9.</span><span class="o">/</span><span class="mf">24.</span><span class="p">,</span> <span class="mf">37.</span><span class="o">/</span><span class="mi">24</span><span class="p">,</span> <span class="o">-</span><span class="mf">59.</span><span class="o">/</span><span class="mf">24.</span><span class="p">,</span> <span class="mf">55.</span><span class="o">/</span><span class="mf">24.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">AB4_betas</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;AB4_betas.sum(): &#39;</span><span class="p">,</span> <span class="n">AB4_betas</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hence AB4 is consistent: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="n">AB4_betas</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>


<span class="c1">#AM3 coefficients</span>
<span class="n">AM3_alphas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
<span class="n">AM3_betas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="o">/</span><span class="mf">24.</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.</span><span class="o">/</span><span class="mf">24.</span><span class="p">,</span>  <span class="mf">19.</span><span class="o">/</span><span class="mf">24.</span><span class="p">,</span> <span class="mf">9.</span><span class="o">/</span><span class="mf">24.</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">AM3_betas.sum(): &#39;</span><span class="p">,</span><span class="n">AM3_betas</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Hence AM3 is consistent: &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="n">AM3_betas</span><span class="o">.</span><span class="n">sum</span><span class="p">()))</span>

<span class="c1"># while we&#39;re at it test the higher order terms:</span>

<span class="c1"># first order terms</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">First-order coefficient for AB4: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">AB4_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="n">AB4_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AB4_alphas</span><span class="p">))]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;First-order coefficient for AM3: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">AM3_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">j</span><span class="o">*</span><span class="n">AM3_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AM3_alphas</span><span class="p">))]))</span>

<span class="c1"># second order terms</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Second-order coefficient for AB4: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">AB4_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">AB4_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AB4_alphas</span><span class="p">))]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Second-order coefficient for AM3: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">AM3_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">AM3_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AM3_alphas</span><span class="p">))]))</span>

<span class="c1"># third order terms</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Third-order coefficient for AB4: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">AB4_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">AB4_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AB4_alphas</span><span class="p">))]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Third-order coefficient for AM3: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">AM3_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">3</span><span class="o">*</span><span class="n">AM3_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AM3_alphas</span><span class="p">))]))</span>

<span class="c1"># fourth order terms</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Fourth-order coefficient for AB4: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">5</span><span class="o">*</span><span class="n">AB4_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">AB4_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AB4_alphas</span><span class="p">))]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fourth-order coefficient for AM3: &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">5</span><span class="o">*</span><span class="n">AM3_alphas</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span><span class="o">*</span><span class="n">j</span><span class="o">**</span><span class="mi">4</span><span class="o">*</span><span class="n">AM3_betas</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">AM3_alphas</span><span class="p">))]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999999999999998
AB4_betas.sum():  0.9999999999999998
Hence AB4 is consistent:  True

AM3_betas.sum():  1.0
Hence AM3 is consistent:  True

First-order coefficient for AB4:  0.0
First-order coefficient for AM3:  4.440892098500626e-16

Second-order coefficient for AB4:  0.0
Second-order coefficient for AM3:  0.0

Third-order coefficient for AB4:  -1.7763568394002505e-15
Third-order coefficient for AM3:  4.440892098500626e-16

Fourth-order coefficient for AB4:  0.3486111111111132
Fourth-order coefficient for AM3:  -0.026388888888888795
</pre></div>
</div>
</div>
</div>
<section id="id7">
<h3>Comments<a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>So AB4 and AM3 are both expected to be fourth-order accurate (as for both schemes the first, second and third order terms are zero (to round-off), while the fourth order term is non zero.</p></li>
</ul>
</section>
</section>
<section id="linear-multistep-methods-predictor-corrector-approach">
<h2>Linear Multistep Methods - Predictor-Corrector approach<a class="headerlink" href="#linear-multistep-methods-predictor-corrector-approach" title="Permalink to this heading">#</a></h2>
<p>Note that to avoid the problem of needing to solve an implicit system to realise an Adams-Moulton (i.e. an implicit LMS) scheme, a standard approach is to use replace the  function evaluation at the newest time levels (i.e. <span class="math notranslate nohighlight">\(f_{n+k}\)</span>) on the RHS of the AM methods, with an approximation based on substituting in a value for this obtained from an explicit AB method, i.e. computing an estimate, or a <em>prediction</em>, of the solution <span class="math notranslate nohighlight">\(y_{n+k}\)</span>, calling this <span class="math notranslate nohighlight">\(y^*\)</span>, and substituting in <span class="math notranslate nohighlight">\(f(t_{n+k}, y^*)\)</span> into the AM formula, and solving the resulting now explicit relation for a new, or <em>corrected</em>, <span class="math notranslate nohighlight">\(y_{n+k}\)</span>.</p>
<br>
<p>Notice that the combination of AB1 (forward Euler) with AM2 (trapezoidal) as a predictor-corrector pair, is exactly the method introduced in the Comp Math ODE lecture and variously known as
<em>explicit trapezoidal</em>/<em>Euler-trapezoidal</em>,  <a class="reference external" href="https://en.wikipedia.org/wiki/Heun%27s_method"><em>Heun’s</em></a>, or the <em>improved/modified Euler’s</em> method:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    y^* &amp;= y_{n} + \Delta t {f}(t_{n},{y}_{n}), \\[10pt]
    y_{n+1} &amp;= y_{n} + \frac{1}{2} \Delta t \left({f}(t_{n},{y}_{n}) + {f}(t_{n+1},{y}^*)\right).
\end{align*}
\end{split}\]</div>
<br>
<p>Another popular example of a predictor-corrector pair based upon LMS methods (but not of Adams type) is the Milne or Milne-Simpson method: <a class="reference external" href="http://mathworld.wolfram.com/MilnesMethod.html">http://mathworld.wolfram.com/MilnesMethod.html</a>.</p>
<section id="stability-of-predictor-corrector-methods">
<h3>Stability of predictor-corrector methods<a class="headerlink" href="#stability-of-predictor-corrector-methods" title="Permalink to this heading">#</a></h3>
<p>Since the overall method is explicit a PC pair cannot have as large a stability region as the implicit scheme on its own.</p>
<p>As an example, improved Euler is made up of AB1 (forward Euler) and AM1 (trapezoidal) whose stability regions are plotted near the start of this lecture.  It turns our that this pair can also be interpreted as the method RK2 described shortly, and whose stability region is plotted a little later in this context - you will see that the stability region is somewhere in between that of AB1 and AM1 (a little larger than AB1 in the imaginary direction, but no-where near as large as the A-stable AM1!)</p>
</section>
</section>
<section id="linear-multistep-methods-stability">
<h2>Linear Multistep Methods - stability<a class="headerlink" href="#linear-multistep-methods-stability" title="Permalink to this heading">#</a></h2>
<p>We won’t go through the derivation of the following absolute stability regions for the AB and AM families of the LMS schemes, but will plot them via the code below.</p>
<p>Note that the lowest order AB and AM methods are the same as schemes we plotted the stability region for above. Also note that AM1 is the trapezoidal scheme, whose stability region we also plotted above, and so we omit this in the plots below in the interests of space.</p>
<p>If interested in the formal derivations for the expressions that yield these plots, and more on LMS stability in general, see LeVeque - FD section 7.3 and 7.6 for details.</p>
<p>Notice that the stability regions decrease in size significantly as we move to higher order - why does this perhaps make some sense if we think back to the use of high order and equal interval sizes in Lectures 1 and 2?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s calculate and plot the stability region for our discrete schemes (AB)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>

<span class="c1"># forward Euler amplification factor,  and its magnitude</span>
<span class="n">FEamp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span>
<span class="n">FEampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">FEamp</span><span class="p">)</span>

<span class="c1"># backward Euler amplification factor,  and its magnitude</span>
<span class="n">BEamp</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lamdt</span><span class="p">)</span>
<span class="n">BEampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">BEamp</span><span class="p">)</span>

<span class="c1"># trapezoidal amplification factor,  and its magnitude</span>
<span class="n">trapamp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">lamdt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">trapampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">trapamp</span><span class="p">)</span>

<span class="c1"># set up our figs for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># reshape the list of axes as we are going to use in a loop</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot the forward Euler stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">FEampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">FEampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">add_fig_niceties</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;Stability regions (forward Euler)&#39;</span><span class="p">)</span>

<span class="c1"># plot the AB2 stability region</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">e_i_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span>

<span class="n">rho</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_i_theta</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">3.</span> <span class="o">*</span> <span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">1.</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;Stability regions (AB2)&#39;</span><span class="p">)</span>

<span class="c1"># plot the AB3 stability region</span>
<span class="n">rho</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">12.</span> <span class="o">*</span> <span class="p">(</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>   
<span class="n">sigma</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">23.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">16.</span> <span class="o">*</span> <span class="n">e_i_theta</span> <span class="o">+</span> <span class="mf">5.</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;Stability regions (AB3)&#39;</span><span class="p">)</span>

<span class="c1"># plot the AB4 stability region</span>
<span class="n">rho</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">24.</span> <span class="o">*</span> <span class="p">(</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> 
<span class="n">sigma</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">55.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">59.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">37.</span> <span class="o">*</span> <span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">9.</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">[</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">],</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">[</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;Stability regions (AB4)&#39;</span><span class="p">)</span>



<span class="c1">## plot the AB5 stability region</span>
<span class="c1">#rho = lambda e_i_theta: 720. * (e_i_theta**5 - e_i_theta**4) </span>
<span class="c1">#sigma = lambda e_i_theta: 1901. * e_i_theta**4 - 2774. * e_i_theta**3 + 2616. * e_i_theta**2 - 1274. * e_i_theta + 251.</span>
<span class="c1">#z = rho(e_i_theta) / sigma(e_i_theta)</span>
<span class="c1">#axs[4].plot(z.real, z.imag, &#39;k&#39;)</span>
<span class="c1">#axs[4].fill_between(z.real[z.real&lt;0], z.imag[z.real&lt;0], color=(&#39;grey&#39;))# where=[z.real&lt;0],</span>
<span class="c1">#add_fig_niceties(axs[4],&#39;Stability regions (AB5)&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/93331f766c59e8444952c762f3fab9e206ff04c361924e1b846e1ad16609e6da.png" src="../_images/93331f766c59e8444952c762f3fab9e206ff04c361924e1b846e1ad16609e6da.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s calculate and plot the stability region for our discrete schemes (AM)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mi">700</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>

<span class="c1"># forward Euler amplification factor,  and its magnitude</span>
<span class="n">FEamp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span>
<span class="n">FEampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">FEamp</span><span class="p">)</span>

<span class="c1"># backward Euler amplification factor,  and its magnitude</span>
<span class="n">BEamp</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lamdt</span><span class="p">)</span>
<span class="n">BEampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">BEamp</span><span class="p">)</span>

<span class="c1"># trapezoidal amplification factor,  and its magnitude</span>
<span class="n">trapamp</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">lamdt</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
<span class="n">trapampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">trapamp</span><span class="p">)</span>

<span class="c1"># set up our figs for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># reshape the list of axes as we are going to use in a loop</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot the backward Euler stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">BEampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">BEampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    
<span class="k">def</span> <span class="nf">add_fig_niceties</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">])</span>
    
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;Stability regions (backward Euler)&#39;</span><span class="p">)</span>


<span class="c1"># note that AM1 is the trapezoidal scheme</span>


<span class="c1"># plot the AM2 stability region</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">e_i_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span>

<span class="n">rho</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">12.</span> <span class="o">*</span> <span class="p">(</span><span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_i_theta</span>  
<span class="n">sigma</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">5.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">8.</span> <span class="o">*</span> <span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">1.</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;Stability regions (AM2)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># plot the AM3 stability region</span>
<span class="n">rho</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">24.</span> <span class="o">*</span> <span class="p">(</span><span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span>  
<span class="n">sigma</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">9.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">19.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">5.</span> <span class="o">*</span> <span class="n">e_i_theta</span> <span class="o">+</span> <span class="mf">1.</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;Stability regions (AM3)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># plot the AM4 stability region</span>
<span class="n">rho</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">720.</span> <span class="o">*</span> <span class="p">(</span><span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span>  
<span class="n">sigma</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">e_i_theta</span><span class="p">:</span> <span class="mf">251.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">646.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">264.</span> <span class="o">*</span> <span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="mf">106.</span> <span class="o">*</span> <span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">19.</span>

<span class="n">z</span> <span class="o">=</span> <span class="n">rho</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span> <span class="o">/</span> <span class="n">sigma</span><span class="p">(</span><span class="n">e_i_theta</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;Stability regions (AM4)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f590bf3e8c3d701d68fb7a699e85c79bce4dcdd369f1cb6f6c39731629d28de2.png" src="../_images/f590bf3e8c3d701d68fb7a699e85c79bce4dcdd369f1cb6f6c39731629d28de2.png" />
</div>
</div>
</section>
<section id="runge-kutta-rk-methods">
<h2>Runge-Kutta (RK) methods<a class="headerlink" href="#runge-kutta-rk-methods" title="Permalink to this heading">#</a></h2>
<p>As was already discussed in Computational Mathematics, Runge-Kutta (RK) methods are perhaps the most popular class of time-stepping schemes.</p>
<p>Rather than using information from previous time levels to increase accuracy, they make use of <em>intermediate steps</em>, that is the RHS function is evaluated at locations in between <span class="math notranslate nohighlight">\(t_n\)</span> and <span class="math notranslate nohighlight">\(t_{n+1}\)</span>.</p>
<p>Hence they can be referred to as <em>intermediate step methods</em>.</p>
<p>With RK methods these intermediate steps are often called <em>stages</em>.</p>
</section>
<section id="lms-vs-rk-methods">
<h2>LMS vs RK methods<a class="headerlink" href="#lms-vs-rk-methods" title="Permalink to this heading">#</a></h2>
<p>Before we even get into any details on RK methods, we can make a few comments based on the above description:</p>
<ol class="arabic simple">
<li><p>As a single step method, we do not have the self-starting issue we identified with LMS schemes. Indeed a RK method is often used to provide the initial data required to get an LMS method started.</p></li>
<li><p>As a single step it makes it easier to change the time step, i.e. to perform adaptive time-stepping.</p></li>
<li><p>An advantage of LMS schemes was that we can store and re-use function evaluations which mitigates some of the cost of moving to higher order schemes. This is a potential advantage if it is expensive to evaluate the function (e.g. if it comes from the spatial discretisation of a PDE), but of course does require storage. With RK methods, however, we cannot re-use this information as we move to the next time step.</p></li>
</ol>
</section>
<section id="two-stage-runge-kutta-example-rk2-aka-improved-euler-explicit-trapezoidal-euler-trapezoidal-heun-s-method-from-comp-math">
<h2>Two stage Runge-Kutta example (RK2) - aka improved Euler / explicit trapezoidal / Euler-trapezoidal / Heun’s method [from Comp Math]<a class="headerlink" href="#two-stage-runge-kutta-example-rk2-aka-improved-euler-explicit-trapezoidal-euler-trapezoidal-heun-s-method-from-comp-math" title="Permalink to this heading">#</a></h2>
<p>We saw above that the trapezoidal rule had good stability and accuracy properties, its drawback is that it’s implicit and so in general requires the solution of a nonlinear and/or matrix system.</p>
<p>The scheme takes the form</p>
<div class="math notranslate nohighlight">
\[{y_{n+1} - y_{n}} = \frac{1}{2} {\Delta t} \left({f}(t_{n},{y}_{n}) + {f}(t_{n+1},{y}_{n+1})\right).\]</div>
<p>The problem is the <span class="math notranslate nohighlight">\({y}_{n+1}\)</span> on the RHS, but as we have already seen we can approximate this using forward Euler, and substitute this into the scheme, yielding the explicit 2 stage method:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    y^* &amp;= y_{n} + \Delta t {f}(t_{n},{y}_{n}), \\[10pt]
    y_{n+1} &amp;= y_{n} + \frac{1}{2} \Delta t \left({f}(t_{n},{y}_{n}) + {f}(t_{n+1},{y}^*)\right).
\end{align*}
\end{split}\]</div>
<p>The scheme is an explicit “2 stage” method which uses FE in the first stage (to give a “guess” (<span class="math notranslate nohighlight">\(y^*\)</span>) at the new solution), but then uses the result from this to evaluate a more accurate RHS to our ODE.</p>
<br>
<p>This method is variously called the <em>explicit trapezoidal</em>/<em>Euler-trapezoidal</em> (as motivated by the above derivation), <em>Heun’s</em>, or the <em>improved/modified Euler’s</em> method.</p>
<p>It is an example of a <em>predictor-corrector</em> method, as commented on above.</p>
<p>However, it can also be considered as an example of a single step, multi-stage method, i.e. can also be interpreted as an explicit Runge-Kutta method.</p>
<p>[So note that there is some degree of overlap between time-stepping ODE solver families, with some simple schemes being interetable  in several different ways, and as examples of different families. This overlap lessens as we move to more complex, higher order schemes of course].</p>
<section id="rk2-schematic-visualisation-of-method">
<h3>RK2 - schematic visualisation of method<a class="headerlink" href="#rk2-schematic-visualisation-of-method" title="Permalink to this heading">#</a></h3>
<p>The figure below demonstrates what RK2 is doing for an ODE problem with RHS function  <span class="math notranslate nohighlight">\(\,f(t,{y}(t)) = y+t^3\,\)</span> which has the  exact solution
<span class="math notranslate nohighlight">\(\,y(t) =  7\exp(t) - t^3 - 3t^2 - 6t - 6\)</span>.</p>
<p>NB. this problem is taken from the Wikipedia page on RK methods: <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">https://en.wikipedia.org/wiki/Runge–Kutta_methods</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># example problem taken from Wikipedia entry on RK</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>


<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="mi">6</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Runge-Kutta example (RK2 - version 1)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>
<span class="c1"># define our x for plotting purposes</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># plot the exact solution</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># initial time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="c1"># initial y</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
<span class="c1"># example time step</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># the stages k </span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exact solution: &#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RK2 approximation: &#39;</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>

<span class="c1"># length of the arrows indicating slopes</span>
<span class="n">grad_length</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">grad_length</span><span class="o">*</span><span class="n">k1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k1</span> <span class="o">+</span> <span class="n">grad_length</span><span class="o">*</span><span class="n">k2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="s1">&#39;$y_0$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="s1">&#39;$y_0+\Delta t k_1$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0+\Delta t$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">),</span> <span class="s1">&#39;$y_0+\Delta t (k_1 + k_2)/2$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">),</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span><span class="o">+</span><span class="mf">0.03</span><span class="p">,</span> <span class="s1">&#39;$(t_1,y_1)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exact solution:  3.027972799213316
RK2 approximation:  3.0
</pre></div>
</div>
<img alt="../_images/b02a6470a1621fe5af227cadfb71729f187aef762ff35fb1da8e2d5573cf92d7.png" src="../_images/b02a6470a1621fe5af227cadfb71729f187aef762ff35fb1da8e2d5573cf92d7.png" />
</div>
</div>
<section id="id8">
<h4>Comments<a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h4>
<p>What is happening here?  These are the key steps in the code above:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the stages k </span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="n">k2</span><span class="p">)</span>
</pre></div>
</div>
<p>Let’s match this up with the figure above …</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(k_1\)</span> gives the initial slope (function evaluation) and can be represented by the slope of the first black arrow.</p></li>
<li><p>We use this to evaluate a new location given by the end point of the lower dashed line, at which we calculate <span class="math notranslate nohighlight">\(k_2\)</span> - an estimate for the slope at this location further along the time step interval.  In the case of this particular two stage scheme, this is actually located at the new time level, but we will see examples later where intermediate locations within the time step are also or instead used.</p></li>
<li><p>Using these two estimates for the slope (the two short black solid arrows), we derive a new estimate for the slope (the upper dashed line in the plot above, and for this particular scheme the simple average of the two <span class="math notranslate nohighlight">\(k\)</span> values) and use this to actually provide the solution at the new time level - the red star.</p></li>
<li><p>Note that the red star is not on the blue exact solution curve - there is an error introduced here.</p></li>
</ul>
</section>
</section>
</section>
<section id="another-rk2-example-rk2-version-2-aka-explicit-midpoint-modified-euler-from-comp-math">
<h2>Another RK2 example (RK2 version 2) - aka explicit midpoint / modified Euler … [from Comp Math]<a class="headerlink" href="#another-rk2-example-rk2-version-2-aka-explicit-midpoint-modified-euler-from-comp-math" title="Permalink to this heading">#</a></h2>
<p>Note that the <em>explicit two stage RK method</em> introduced above is not the only example of such a scheme.</p>
<p>If instead of trapezoidal, we start from the <em>implicit midpoint rule</em>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
{y_{n+1} - y_{n}} &amp;= {\Delta t}\, {f}\left(  \frac{1}{2} (t_{n}+t_{n+1}),\frac{1}{2} (y_{n}+y_{n+1})\right) \\[5pt] 
\iff \;\;
{y_{n+1} } &amp;= y_{n} + {\Delta t}\, {f}\left(t_{n}+ \frac{\Delta t}{2} , \frac{1}{2} (y_{n}+y_{n+1}) \right),
\end{align*}
\end{split}\]</div>
<p>we can similarly formulate an explicit two stage method:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
    y^* &amp;= y_{n} + \frac{1}{2} \Delta t\, {f}(t_{n},{y}_{n}), \\[5pt] 
    {y_{n+1} } &amp;= y_{n} + {\Delta t}\, {f}\left(t_{n}+ \frac{\Delta t}{2} , y^* \right).
\end{align*}
\end{split}\]</div>
<p>This scheme is termed <em>explicit midpoint</em> and sometimes modified Euler (although be warned there is some re-use of the terms modified/improved Euler between explicit midpoint and explicit trapezoidal in the literature).</p>
<p>Let’s plot a schematic of what this scheme is doing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># example problem taken from Wikipedia entry on RK</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>


<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="mi">6</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Runge-Kutta example (RK2 - version 2)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>
<span class="c1"># define our t for plotting purposes</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># plot the exact solution</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># initial time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="c1"># initial y</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
<span class="c1"># example time step</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="c1"># the stages k </span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k2</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exact solution: &#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RK2 (ver 2) approximation: &#39;</span><span class="p">,</span> <span class="n">y_new</span><span class="p">)</span>

<span class="c1"># length of the arrows indicating slopes</span>
<span class="n">grad_length</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">grad_length</span><span class="o">*</span><span class="n">k1</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span> <span class="o">+</span> <span class="n">grad_length</span><span class="o">*</span><span class="n">k2</span><span class="p">),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="s1">&#39;$y_0$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="s1">&#39;$y_0+\Delta t k_1/2$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0+\Delta t/2$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="s1">&#39;$y_0+\Delta t k_2$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0+\Delta t$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="p">],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">dt</span><span class="o">*</span><span class="n">k2</span><span class="o">+</span><span class="mf">0.03</span><span class="p">,</span> <span class="s1">&#39;$(t_1,y_1)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exact solution:  3.027972799213316
RK2 (ver 2) approximation:  2.625
</pre></div>
</div>
<img alt="../_images/0904ad46be9f5a7390e50e2fb4a4c9a2537631acd2d9347f1977b3ca503e4bea.png" src="../_images/0904ad46be9f5a7390e50e2fb4a4c9a2537631acd2d9347f1977b3ca503e4bea.png" />
</div>
</div>
<section id="id9">
<h3>Comments<a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<p>For this method the key code is:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="c1"># the stages k </span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">dt</span><span class="o">*</span><span class="n">k2</span>
</pre></div>
</div>
<ul class="simple">
<li><p>For this case <span class="math notranslate nohighlight">\(k_1\)</span> is used to provide <span class="math notranslate nohighlight">\(k_2\)</span> located at the mid point of the interval.</p></li>
<li><p>It is this slope estimate that is used directly to provide the final update to the solution at the new time level (i.e. we make no use of <span class="math notranslate nohighlight">\(k_1\)</span> for the final update in this scheme).</p></li>
<li><p>We see from both the plots, as well as the print outs of the exact vs the numerical solution for the two examples, that the former scheme is clearly more accurate <strong>for this problem</strong>.</p></li>
<li><p>You could implement the fully implicit trapezoidal and midpoint schemes to check that this difference in accuracy is also the case there. You could also derive the local truncation errors in the two cases to establish this more formally.</p></li>
</ul>
<p>How does one come up with these schemes?</p>
</section>
</section>
<section id="runge-kutta-scheme-derivation-via-taylor-series-methods-star">
<h2>Runge-Kutta scheme derivation (via Taylor series methods) [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#runge-kutta-scheme-derivation-via-taylor-series-methods-star" title="Permalink to this heading">#</a></h2>
<section id="taylor-series-methods-from-comp-math">
<h3>Taylor series methods [from Comp Math]<a class="headerlink" href="#taylor-series-methods-from-comp-math" title="Permalink to this heading">#</a></h3>
<p>The above two examples of RK2 schemes were arguably kind of easy/obvious to just write down. How can we derive a suite of (higher-order) methods more methodically?</p>
<p>Recall the Taylor series expansion of the exact solution</p>
<div class="math notranslate nohighlight">
\[ y_{n+1} = y_n + \Delta t\, y'_n + \frac{\Delta t^2}{2!}y''_n + \frac{\Delta t^3}{3!}y'''_n + \mathcal{O}(\Delta t^4),\]</div>
<p>where we’re using the notation <span class="math notranslate nohighlight">\(\,y_n := y(t_n)\,\)</span> and <span class="math notranslate nohighlight">\(\,y'_n := f(t_n,y_n)\,\)</span>.</p>
<p>We used this expansion, dropping second-order terms, as a means to derive the forward Euler scheme in the previous lecture.</p>
<p>As we saw in the Comp Math module, to derive higher-order schemes we could seek to keep additional terms in this expansion. This should clearly, by definition, result in a scheme with a higher-order LTE!</p>
<p>But to obtain a usable scheme we need to write these additional terms in terms of things that we know - we don’t know <span class="math notranslate nohighlight">\(\,y'', \, y'''\,\)</span> etc, but we do know <span class="math notranslate nohighlight">\(f\)</span> …</p>
<p>and using the chain rule we know that</p>
<div class="math notranslate nohighlight">
\[ y'' = \frac{dy'}{dt} = \frac{df(t,y(t))}{dt} = \frac{\partial f}{\partial t} + \frac{\partial f}{\partial y}\frac{d y}{d t} = f_t + f_y \, y' = f_t + f \, f_y.  \]</div>
<p>Similarly,</p>
<div class="math notranslate nohighlight">
\[ y''' = f_{tt} + 2f\,f_{yt} + f_t\,f_y + f\,f_y^2 + f^2\,f_{yy}. \]</div>
<p>Now since we know <span class="math notranslate nohighlight">\(f\)</span> as a function of <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(y\)</span> we can in principle compute these terms and evaluate them at the old time level to achieve a higher-order time-stepping method.</p>
<section id="an-example">
<h4>An example<a class="headerlink" href="#an-example" title="Permalink to this heading">#</a></h4>
<p>The following is an example convergence test for the problem <span class="math notranslate nohighlight">\(y'=y + t^3\)</span> (chosen as <span class="math notranslate nohighlight">\(f\)</span> has both <span class="math notranslate nohighlight">\(y\)</span> and <span class="math notranslate nohighlight">\(t\)</span> dependence).</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/Taylor_series_methods_ODE.png"><img alt="../_images/Taylor_series_methods_ODE.png" src="../_images/Taylor_series_methods_ODE.png" style="width: 75%;" /></a>
</figure>
</section>
<section id="id10">
<h4>Comments<a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>So this approach indeed works, and the corresponding methods can be termed <em>Taylor series methods</em> [which were part of the Comp Math assessment!]</p></li>
<li><p>and in principle this allows us to generate methods of arbitrary order.</p></li>
<li><p>But this approach is not really satisfactory as we have to compute the various derivatives of <span class="math notranslate nohighlight">\(f\)</span>, and as we see from the chain rule expansions above the number of terms rapidly increases with the order of the method - this adds significant cost as well as complexity.</p></li>
<li><p>Can we do better?</p></li>
</ul>
</section>
</section>
<section id="runge-kutta-derivation-star">
<h3>Runge-Kutta derivation  [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#runge-kutta-derivation-star" title="Permalink to this heading">#</a></h3>
<p>From the previous subsection we have</p>
<div class="math notranslate nohighlight">
\[ y_{n+1} = y_n + \Delta t\, y'_n + \frac{\Delta t^2}{2!}y''_n + \frac{\Delta t^3}{3!}y'''_n + \mathcal{O}(\Delta t^4),\]</div>
<p>where  <span class="math notranslate nohighlight">\(y'_n = f(t_n,y_n)\)</span> and thus</p>
<div class="math notranslate nohighlight">
\[ y'' = \frac{dy'}{dt} = \frac{df(t,y(t))}{dt} = \frac{\partial f}{\partial t} + \frac{\partial f}{\partial y}\frac{d y}{d t} = f_t + f_y \, y' = f_t + f \, f_y.  \]</div>
<p>Hence, restricting ourselves to writing out explicitly only the second order terms we have</p>
<div class="math notranslate nohighlight">
\[ y_{n+1} = y_n + \Delta t\, f_n + \frac{\Delta t^2}{2!}(f_{t_n} + f_n \, f_{y_n}) + \mathcal{O}(\Delta t^3), \]</div>
<p>(we’ve added some subscript <span class="math notranslate nohighlight">\(n\)</span>’s here to help emphasise where these functions are evaluated, i.e. at time level <span class="math notranslate nohighlight">\(n\)</span>).</p>
<p>This is what the exact solution satisfies.</p>
<p>To progress in the derivation of a numerical method we need to construct a discrete scheme that agrees with this up to a desired order - let’s do this now using a general two stage scheme.</p>
<section id="deriving-the-rk2-family">
<h4>Deriving the RK2 family<a class="headerlink" href="#deriving-the-rk2-family" title="Permalink to this heading">#</a></h4>
<p>As already commented, and as seen in the examples presented so far, the idea behind the <em>intermediate</em> step Runge-Kutta methods is to increase accuracy by evaluating <span class="math notranslate nohighlight">\(f\)</span> at locations within a time step.</p>
<p>The general <em>two stage</em> scheme can be written as</p>
<div class="math notranslate nohighlight">
\[y_{n+1} = y_n + \gamma_1\, \Delta t\,  k_1 + \gamma_2\, \Delta t\,  k_2,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
k_1 &amp; = f(t_n, y_n),\\[10pt]
k_2 &amp; =  f(t_n + \alpha \Delta t, y_n + \beta \, \Delta t\,k_1).
\end{align*}
\end{split}\]</div>
<p>Note that (for explicit RK methods) we generally define the first state, <span class="math notranslate nohighlight">\(k_1\)</span>, in this manner, but we have flexibility here over <span class="math notranslate nohighlight">\(k_2\)</span> and how
the stage information is used to given the final update, i.e.
the parameters <span class="math notranslate nohighlight">\(\gamma_1\)</span>, <span class="math notranslate nohighlight">\(\gamma_2\)</span>, <span class="math notranslate nohighlight">\(\alpha\)</span> and <span class="math notranslate nohighlight">\(\beta\)</span> are free parameters to be chosen.</p>
<p>Expanding <span class="math notranslate nohighlight">\(k_2\)</span> via a 2D Taylor series</p>
<div class="math notranslate nohighlight">
\[ k_2 = \left[ f(t_n , y_n ) + \alpha \Delta t f_{t_n} + 
\beta k_1 f_{y_n} + \mathcal{O}(\Delta t^2)\right], \]</div>
<p>and substituting this and  <span class="math notranslate nohighlight">\(\,k_1 =  f_n\,\)</span> into <span class="math notranslate nohighlight">\(\,y_{n+1} = y_n + \gamma_1\, \Delta t\,  k_1 + \gamma_2\, \Delta t\,  k_2\,\)</span> yields</p>
<div class="math notranslate nohighlight">
\[y_{n+1} = y_n + (\gamma_1 + \gamma_2)\,\Delta t\, f_n + \gamma_2\,\beta\,\Delta t^2 \,f_n\,f_{y_n} + \gamma_2\,\alpha\,\Delta t^2\, f_{t_n} + \ldots.\]</div>
<p>This is the expression that our discrete scheme will satisfy.</p>
<p>As we know, the order of a scheme is governed by how well the <em>exact</em> solution satisfies this discrete relation, but from the above we already have the Taylor series expansion the <em>exact</em> solution satisfies:</p>
<div class="math notranslate nohighlight">
\[ y_{n+1} = y_n + \Delta t\, f_n + \frac{\Delta t^2}{2!}(f_{t_n} + f_n \, f_{y_n}) + \mathcal{O}(\Delta t^3), \]</div>
<p>By matching terms in the two expansions we see that these two expressions agree at up to and including second-order terms provided that the following is true</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
\gamma_1 + \gamma_2 = 1, \\[10pt]
\gamma_2\alpha = \frac{1}{2}, \\[10pt]
\gamma_2\beta = \frac{1}{2},
\end{align*}
\end{split}\]</div>
<p>and if we choose our free parameters to satisfy these constraints then we can conclude that our scheme will be second-order accurate.</p>
<p>Notice that we actually have four unknowns and only three equations to satisfy, therefore this is an under-determined system with infinitely many solutions:</p>
<div class="math notranslate nohighlight">
\[ \gamma_2 = \frac{1}{2\alpha},\;\;\;\; \beta = \alpha,\;\;\;\; \gamma_1 = 1- \frac{1}{2\alpha},\]</div>
<p>where <span class="math notranslate nohighlight">\(\alpha\)</span> can be considered a free parameter which can take any value and the resulting Runge-Kutta scheme will always be second-order accurate. (NB. if we consider the complexity of the Taylor series expansion we see that the extra free parameter is not enough for use to try and achieve third-order accuracy).</p>
<p>We thus have a <em>family</em> of second-order Runge-Kutta schemes:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
k_1 &amp; =  f(t_n, y_n), \\[10pt]
k_2 &amp; =  f(t_n + \alpha \Delta t, y_n + \alpha\,\Delta t\, k_1), \\[10pt]
y_{n+1} &amp;= y_n + \left( 1 - \frac{1}{2\alpha}\right)\, \Delta t\, k_1 + 
 \frac{1}{2\alpha} \, \Delta t\, k_2.
\end{align*}
\end{split}\]</div>
<p>Notice that the choice <span class="math notranslate nohighlight">\(\alpha=1\)</span> corresponds to the explicit trapezoidal (improved Euler) scheme, and <span class="math notranslate nohighlight">\(\alpha=1/2\)</span> is the explicit midpoint scheme, both introduced above.</p>
</section>
</section>
</section>
<section id="butcher-tableau-star">
<h2>Butcher tableau [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#butcher-tableau-star" title="Permalink to this heading">#</a></h2>
<p>More generally, all <em>explicit</em> Runge–Kutta methods may be written in the form</p>
<div class="math notranslate nohighlight">
\[y_{n+1}=y_{n}+\Delta t\sum _{i=1}^{s}b_{i}k_{i},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
k_{1} &amp; = f(t_{n},y_{n})\\[10pt]
k_{2} &amp; = f(t_{n}+\Delta t c_{2},\; y_{n}+\Delta t \;(a_{21}k_{1}))\\[10pt]
k_{3} &amp; = f(t_{n}+\Delta t c_{3},\; y_{n}+\Delta t \;(a_{31}k_{1}+a_{32}k_{2}))\\[10pt]
&amp; \vdots  \\[10pt]
k_{s}&amp;=f(t_{n}+\Delta t c_{s},\; y_{n}+\Delta t \;(a_{s1}k_{1}+a_{s2}k_{2}+\cdots +a_{s,s-1}k_{s-1}))
\end{align*}
\end{split}\]</div>
<p>The method can thus be fully described by the values in the following arrays</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{array}
{c|c}
\boldsymbol{c} &amp; A\\
\hline
  &amp; \boldsymbol{b}^T
\end{array}
\;\;\;
\equiv
\;\;\;
\begin{array}
{c|ccccc}
0\\
c_2 &amp; a_{21}\\
c_3 &amp; a_{31} &amp; a_{32}\\
\vdots &amp; \vdots &amp; \ddots &amp; \ddots\\
c_s &amp; a_{s1} &amp; a_{s2} &amp; \cdots &amp; a_{s,s-1} \\
\hline
&amp;  b_{1} &amp; b_{2} &amp; \cdots &amp; b_{s-1} &amp; b_{s}
\end{array}
\end{split}\]</div>
<p>This is known as a <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#Explicit_Runge%E2%80%93Kutta_methods"><em>Butcher tableau</em></a>.</p>
<section id="id11">
<h3>Comments<a class="headerlink" href="#id11" title="Permalink to this heading">#</a></h3>
<p>The integer <span class="math notranslate nohighlight">\(s\)</span> refers to the number of stages, the coefficients <span class="math notranslate nohighlight">\(a_{ij}\)</span> form a matrix termed the <em>Runge–Kutta matrix</em>, the <span class="math notranslate nohighlight">\(b_i\)</span> coefficients are termed the <em>weights</em> and the <span class="math notranslate nohighlight">\(c_i\)</span> coefficients are termed the <em>nodes</em>.</p>
<p>We haven’t bothered to explicitly write out the zeros that appear above the main diagonal in the <span class="math notranslate nohighlight">\(A\)</span> matrix.</p>
<p>Note that the fact that only zeros appear above the diagonal is equivalent to saying that the corresponding scheme is <em>explicit</em>.</p>
<p>Additionally the <span class="math notranslate nohighlight">\(c_1=0\)</span> entry confirms that our first stage is simply <span class="math notranslate nohighlight">\(\,k_1=f(t_n,y_n)\,\)</span> as stated above and the general case for explicit methods.</p>
<p>The above can be extended to represent <em>implicit</em> Runge-Kutta schemes in the obvious manner (i.e. through the presence of non-zero entries above the diagonal).</p>
<p>An extensive list of methods/Butcher tableau may be found here: <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Runge%E2%80%93Kutta_methods">https://en.wikipedia.org/wiki/List_of_Runge–Kutta_methods</a></p>
<p>Below we give a few examples.</p>
</section>
<section id="explicit-runge-kutta-butcher-tableau-examples-star">
<h3>Explicit Runge-Kutta Butcher tableau examples [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#explicit-runge-kutta-butcher-tableau-examples-star" title="Permalink to this heading">#</a></h3>
<p>Armed with this notation we can (a) write down the Butcher tableau for some of the schemes we’ve already encountered, and (b) write a generic implementation that takes in a Butcher tableau.</p>
<p>Here are some examples - check that you are happy that with the above definitions of the stages and the final update that these indeed agree with the schemes we wrote our on “long-hand”.</p>
<ul class="simple">
<li><p>forward Euler</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
{c|c}
0 &amp; 0\\
\hline
&amp; 1 
\end{array}\end{split}\]</div>
<ul class="simple">
<li><p>explicit trapezoidal</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
{c|cc}
0 &amp; 0 &amp; 0\\
1 &amp; 1 &amp; 0\\
\hline
&amp; 1/2 &amp; 1/2 
\end{array}\end{split}\]</div>
<ul class="simple">
<li><p>explicit midpoint</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
{c|cc}
0 &amp; 0 &amp; 0\\
1/2 &amp; 1/2 &amp; 0\\
\hline
&amp; 0 &amp; 1
\end{array}\end{split}\]</div>
<ul class="simple">
<li><p>RK2(<span class="math notranslate nohighlight">\(\alpha\)</span>) - i.e. our RK2 family we derived above with the dependence on a free parameter made explicit, we see that the above two schemes are special cases of this</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
{c|cc}
0 &amp; 0 &amp; 0\\
\alpha &amp; \alpha &amp; 0\\
\hline
&amp; 1 - \frac{1}{2\alpha} &amp; \frac{1}{2\alpha}
\end{array}\end{split}\]</div>
</section>
<section id="implicit-runge-kutta-butcher-tableau-examples">
<h3>Implicit Runge-Kutta Butcher tableau examples<a class="headerlink" href="#implicit-runge-kutta-butcher-tableau-examples" title="Permalink to this heading">#</a></h3>
<p>Some examples of implicit Runge-Kutta schemes include:</p>
<ul class="simple">
<li><p>backward Euler</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
{c|c}
1 &amp; 1\\
\hline
&amp; 1 
\end{array}\end{split}\]</div>
<ul class="simple">
<li><p>implicit midpoint</p></li>
</ul>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
{c|c}
1/2 &amp; 1/2\\
\hline
&amp; 1 
\end{array}\end{split}\]</div>
</section>
<section id="embedded-runge-kutta-pairs-star">
<h3>Embedded Runge-Kutta pairs [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#embedded-runge-kutta-pairs-star" title="Permalink to this heading">#</a></h3>
<p>Note finally that so-called <em>embedded Runke-Kutta</em> methods exist: <a class="reference external" href="https://en.wikipedia.org/wiki/List_of_Runge%E2%80%93Kutta_methods#Embedded_methods">https://en.wikipedia.org/wiki/List_of_Runge–Kutta_methods#Embedded_methods</a>.</p>
<p>These represent a pair of methods which make use of the same stage information for efficiency, i.e. the same <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(\boldsymbol{c}\)</span> values, but two different <span class="math notranslate nohighlight">\(\boldsymbol{b}\)</span> values. These give two different estimates of the new solution, of different order which can be used as a means to provide estimates of the local truncation error, and thus select an appropriate local time step size - i.e. these approaches are used to perform <em>adaptive time-stepping</em> (see section on this below and the homework question on RK45).</p>
</section>
</section>
<section id="classical-rk4">
<h2>Classical RK4<a class="headerlink" href="#classical-rk4" title="Permalink to this heading">#</a></h2>
<p>Perhaps the most widely used multi-(i.e. <span class="math notranslate nohighlight">\(&gt;2\)</span>)-stage RK method is the four stage explicit method often termed as the <em>classical RK(4) method</em> or just <em>RK4</em>.</p>
<p>It has the <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#Explicit_Runge%E2%80%93Kutta_methods"><em>Butcher tableau</em></a> [which we haven’t explained so you can ignore this and focus on the code and images below]</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{array}
{c|cccc}
0\\
\frac{1}{2} &amp; \frac{1}{2}\\
\frac{1}{2} &amp; 0 &amp;\frac{1}{2} \\
1 &amp; 0 &amp; 0 &amp; 1\\
\hline
&amp; \frac{1}{6} &amp;\frac{1}{3} &amp;\frac{1}{3} &amp;\frac{1}{6} 
\end{array}\end{split}\]</div>
</section>
<section id="an-rk4-schematic">
<h2>An RK4 schematic<a class="headerlink" href="#an-rk4-schematic" title="Permalink to this heading">#</a></h2>
<p>The figure below demonstrates what RK4 is doing for the problem where <span class="math notranslate nohighlight">\(f(t,{y}(t)) = y+t^3\)</span> with exact solution
<span class="math notranslate nohighlight">\(y(t) =  7\exp(t) - t^3 - 3t^2 - 6t - 6\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># example problem taken from Wikipedia entry on RK</span>
<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span>


<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">-</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">t</span> <span class="o">-</span> <span class="mi">6</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Runge-Kutta example (RK4)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.1</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.9</span><span class="p">,</span><span class="mf">3.5</span><span class="p">])</span>
<span class="c1"># define our x for plotting purposes</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># plot the exact solution</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">)</span>

<span class="c1"># initial time</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="c1"># initial y</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
<span class="c1"># example time step</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="c1"># the stages k multiplied by dt</span>
<span class="n">k1</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">)</span>
<span class="n">k2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">)</span>
<span class="n">k3</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">)</span>
<span class="n">k4</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">k3</span><span class="p">)</span>
<span class="n">y_new</span> <span class="o">=</span> <span class="n">y0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Exact solution, RK4 approximation: &#39;</span><span class="p">,</span> <span class="n">y</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">),</span> <span class="n">y_new</span><span class="p">)</span>

<span class="c1"># length of the arrows indicating slopes</span>
<span class="n">grad_length</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">grad_length</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span><span class="o">/</span><span class="n">dt</span><span class="p">)),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="n">y0</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="o">+</span><span class="n">grad_length</span><span class="o">*</span><span class="p">(</span><span class="n">k2</span><span class="o">/</span><span class="n">dt</span><span class="p">)),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span> <span class="o">+</span> <span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="o">+</span><span class="n">grad_length</span><span class="o">*</span><span class="p">(</span><span class="n">k3</span><span class="o">/</span><span class="n">dt</span><span class="p">)),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">k3</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">grad_length</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">k3</span><span class="o">+</span><span class="n">grad_length</span><span class="o">*</span><span class="p">(</span><span class="n">k4</span><span class="o">/</span><span class="n">dt</span><span class="p">)),</span> <span class="n">xytext</span><span class="o">=</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">k3</span><span class="p">),</span> <span class="n">arrowprops</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="s1">&#39;$y_0$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="s1">&#39;$y_0+\Delta t k_1/2$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0+\Delta t/2$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="s1">&#39;$y_0+\Delta t k_2/2$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">k3</span><span class="p">,</span> <span class="s1">&#39;$y_0+\Delta t k_3$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="s1">&#39;$t_0+\Delta t$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="n">k3</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">k3</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="n">k3</span><span class="p">],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">),</span> <span class="s1">&#39;$y_0+\Delta t (k_1 + 2k_2 + 2k_3 + k_4)/6$&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">),</span> <span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">,</span> <span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)],</span> <span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="p">],</span> <span class="p">[</span><span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)],</span> <span class="s1">&#39;r*&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t0</span><span class="o">+</span><span class="n">dt</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">y0</span><span class="o">+</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span><span class="o">+</span><span class="mf">0.03</span><span class="p">,</span> <span class="s1">&#39;$(t_1,y_1)$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Exact solution, RK4 approximation:  3.027972799213316 3.0104166666666665
</pre></div>
</div>
<img alt="../_images/71c4e3fac72dc2316fcaaa1a1ea6a075cd82d96570437c1aebfe7d02fb1213f8.png" src="../_images/71c4e3fac72dc2316fcaaa1a1ea6a075cd82d96570437c1aebfe7d02fb1213f8.png" />
</div>
</div>
<section id="id12">
<h3>Comments<a class="headerlink" href="#id12" title="Permalink to this heading">#</a></h3>
<p>As we hoped, we’ve clearly done more work here but have got a more accurate result.</p>
</section>
</section>
<section id="runge-kutta-stability-analysis-star-star">
<h2>Runge-Kutta stability analysis  [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#runge-kutta-stability-analysis-star-star" title="Permalink to this heading">#</a></h2>
<p>In order to understand the stability of RK schemes, let’s consider again our linear model problem</p>
<section id="rk2-stability">
<h3>RK2 stability<a class="headerlink" href="#rk2-stability" title="Permalink to this heading">#</a></h3>
<div class="math notranslate nohighlight">
\[y'=\lambda y, \;\;\;\;\; y(0)=y_0.\]</div>
<p>Let’s consider our RK2(<span class="math notranslate nohighlight">\(\alpha\)</span>) scheme applied to this problem.</p>
<p>Recall that this method takes the general form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
k_1 &amp; =  f(t_n, y_n), \\[10pt]
k_2 &amp; =  f(t_n + \alpha\, \Delta t, y_n + \alpha \, \Delta t\, k_1), \\[10pt]
y_{n+1} &amp;= y_n + \left( 1 - \frac{1}{2\alpha}\right) \, \Delta t\, k_1 + 
 \frac{1}{2\alpha} \, \Delta t\, k_2, 
\end{align*}
\end{split}\]</div>
<p>and so in the case of this particular model problem we have</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
k_1 &amp; =  \lambda y_n, \\[10pt]
k_2 &amp; =  \lambda \left( y_n + \alpha \, \Delta t\, k_1 \right)
 =  \lambda \left( 1 + \alpha \, \Delta t \, \lambda \right) y_n, \\[10pt]
y_{n+1} &amp;= y_n + \left( 1 - \frac{1}{2\alpha}\right)\, \Delta t\, k_1 + 
 \frac{1}{2\alpha}\, \Delta t\, k_2 \\[10pt]
 &amp; = y_n + \left( 1 - \frac{1}{2\alpha}\right) \Delta t \lambda y_n + 
 \frac{1}{2\alpha} \Delta t \lambda \left( 1 + \alpha \Delta t \lambda \right) y_n\\[10pt]
 &amp; = y_n  \left( 1 + \lambda \Delta t + \frac{\lambda^2\Delta t^2}{2}\right).
\end{align*}
\end{split}\]</div>
<p>So the <em>amplification factor</em> for the RK2 family of methods is given by</p>
<div class="math notranslate nohighlight">
\[\sigma = \left( 1 + \lambda \Delta t + \frac{\lambda^2\Delta t^2}{2}\right).\]</div>
<p>Note from this that the stability of the scheme is not dependent on the choice of the parameter <span class="math notranslate nohighlight">\(\alpha\)</span>.</p>
<p><strong>Aside:</strong></p>
<p>Note that the expansion that appeared in the derivation above is equivalent to</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
y_{n+1} &amp; =  y_n + \Delta t \lambda  y_n + \frac{\Delta t^2}{2!}\lambda^2 y_n \\[10pt]
&amp; = y_n + \Delta t f_n + \frac{\Delta t^2} {2!}   (f_{t_n} + f_n \, f_{y_n}),
\end{align*}
\end{split}\]</div>
<p>since for this test case <span class="math notranslate nohighlight">\(\;\;f_n = \lambda y_n\;\;\)</span> and <span class="math notranslate nohighlight">\(\;\;f_{t_n} + f_n \, f_{y_n} = 0 + \lambda y_n \lambda = \lambda^2 y_n\)</span>.</p>
<p>Which, recalling the Taylor series methods above, confirms the method is second-order accurate for this problem,</p>
<p>(as we already know more generally by construction of course!)</p>
<p>Given the amplification factor we can plot the stability region in the same way as we did for the simpler schemes at the start of this lecture:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RK2 stability region</span>

<span class="c1"># set up a mesh in x,y</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># define a complex parameter which is our lambda * dt quantity</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>

<span class="c1"># compute the &quot;amplification factor&quot; for RK2</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">*</span><span class="n">lamdt</span><span class="o">/</span><span class="mf">2.</span>

<span class="c1"># and its magnitude - we want this to be less than one for stability</span>
<span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>

<span class="c1"># set up our figs for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># plot the RK2 stability region</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (RK2)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">2.25</span><span class="p">,</span> <span class="mf">1.75</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d8c0fd9a9b23ee154a933942c52b7fd15ef7ffc02f680a9db722529d90e6806f.png" src="../_images/d8c0fd9a9b23ee154a933942c52b7fd15ef7ffc02f680a9db722529d90e6806f.png" />
</div>
</div>
<section id="id13">
<h4>Comments<a class="headerlink" href="#id13" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>For purely real <span class="math notranslate nohighlight">\(\lambda\)</span> this represents the same stability bound as forward Euler, but there is an improvement for complex <span class="math notranslate nohighlight">\(\lambda\)</span>.</p></li>
<li><p>The method is still unconditionally unstable for purely imaginary <span class="math notranslate nohighlight">\(\lambda\)</span>, i.e. for a purely imaginary eigenvalue no choice of time step size leads to stability.</p></li>
</ul>
</section>
</section>
<section id="rk4-stability">
<h3>RK4 stability<a class="headerlink" href="#rk4-stability" title="Permalink to this heading">#</a></h3>
<p>If we go through the same process for RK4 we arrive at the amplification factor</p>
<div class="math notranslate nohighlight">
\[\sigma =  \left( 1 + \lambda \Delta t + \frac{\lambda^2\Delta t^2}{2} + \frac{\lambda^3\Delta t^3}{6} + \frac{\lambda^4\Delta t^4}{24} \right).\]</div>
<p>Let’s plot this to see what it tells us.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RK4 stability region</span>

<span class="c1"># set up a mesh in x,y</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

<span class="c1"># define a complex parameter which is our lambda * dt quantity</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>

<span class="c1"># compute the &quot;amplification factor&quot; for RK4</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mi">24</span>

<span class="c1"># and its magnitude - we want this to be less than one for stability</span>
<span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>

<span class="c1"># set up our figs for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># plot the RK4 stability region</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Stability region (RK4)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">1.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s1">&#39;Stable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">2.75</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="s1">&#39;Unstable&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/6af9c364ef8c90021e32490104668a674f8a8db509e69702fc5d9fb97a950bdc.png" src="../_images/6af9c364ef8c90021e32490104668a674f8a8db509e69702fc5d9fb97a950bdc.png" />
</div>
</div>
<section id="id14">
<h4>Comments<a class="headerlink" href="#id14" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>So this represents a significant improvement for both purely real, as well as complex valued <span class="math notranslate nohighlight">\(\lambda\)</span>.</p></li>
<li><p>Note that it is also stable for a large range of purely imaginary values.</p></li>
<li><p>It is actually also stable in a couple of patches for <span class="math notranslate nohighlight">\(\lambda\)</span> values with positive real parts, i.e. in situations where the exact solution actually grows in time RK4 is artificially stable (the numerical solution decays). Physically this is clearly wrong, but there may be situations where this extra “robustness” could be useful.</p></li>
<li><p>Note that Runge-Kutta schemes achieve high order through additional function evaluations; RK4 uses only four function evaluations to achieve fourth-order accuracy (note that for higher-order explicit methods even larger numbers of function evaluations are needed: 5th order RK needs six function evaluations for example. So RK4 represents a bit of a sweet spot. A table of minimum number of stages to achieve a given order, from 1 up to 8, is given <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods#Explicit_Runge%E2%80%93Kutta_methods">here</a>).</p></li>
<li><p>This efficiency, along with its good stability and accuracy properties, and ease of implementation, is the <em><strong>reason that RK4 is an extremely popular method</strong></em>.</p></li>
</ul>
<p>For more on the topic of choosing RK methods, and in particular which order, take a look at the interesting discussion here: <a class="reference external" href="https://scicomp.stackexchange.com/questions/25581/why-are-higher-order-runge-kutta-methods-not-used-more-often">https://scicomp.stackexchange.com/questions/25581/why-are-higher-order-runge-kutta-methods-not-used-more-often</a></p>
</section>
</section>
</section>
<section id="adaptive-time-stepping-star">
<h2>Adaptive time-stepping  [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#adaptive-time-stepping-star" title="Permalink to this heading">#</a></h2>
<p>An advantage of multi-stage, single step methods is that it is (relatively!) easy to change the time step size.  But we need to know something about the error in the solution to decide on an appropriate local time step size.</p>
<p>Similarly to some of the ideas from Lecture 2 on quadrature methods, there are two ways to estimate the error.</p>
<p>The first is to apply the integration scheme with two different time step sizes and use the difference as the basis for an error estimate.</p>
<p>The second is to use two schemes with different orders of accuracy. If this is done carefully then the majority of the function evaluations can be reused (cf. our comment on “embedded Runge-Kutta pairs” above), i.e. without the cost of evaluating two arbitrary schemes.</p>
<p>There are several popular schemes to achieve this, e.g.
<a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta%E2%80%93Fehlberg_method">https://en.wikipedia.org/wiki/Runge–Kutta–Fehlberg_method</a>
<a class="reference external" href="https://en.wikipedia.org/wiki/Dormand%E2%80%93Prince_method">https://en.wikipedia.org/wiki/Dormand–Prince_method</a></p>
<p>For more information on error estimators, including the one we will implement in the homework, see  Chapter II.4 (Practical Error Estimation and Step Size Selection) of <em>Solving Ordinary Differential Equations I: Nonstiff Problems</em> by Hairer, Nørsett and Wanner.</p>
</section>
<section id="stiff-problems-star">
<h2>Stiff problems [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#stiff-problems-star" title="Permalink to this heading">#</a></h2>
<p>An ODE can be characterised as being <a class="reference external" href="https://uk.mathworks.com/company/newsletters/articles/stiff-differential-equations.html"><em>stiff</em></a> if some of the following describe it:</p>
<ul class="simple">
<li><p>the step size required for stability is much smaller than the step size required for accuracy</p></li>
<li><p>it contains some transients that decay rapidly compared to the major transient of interest (what we mean here is that there is dynamics in the system that we do not necessarily care about (for the question we’re solving) and can potentially safely ignore, or not care if we excessively damp) - we saw an example of this under the L-stability section</p></li>
<li><p>one eigenvalue of the system is negative and large compared to the other eigenvalues of the system</p></li>
</ul>
<br>
<p>Whether a problem is stiff or non-stiff has important implications for the stability and the selection of appropriate time step size as well as appropriate numerical methods to use: <a class="reference external" href="https://en.wikipedia.org/wiki/Stiff_equation">https://en.wikipedia.org/wiki/Stiff_equation</a> - stiff problems are in general more difficult to deal with numerically.</p>
</section>
<section id="an-example-of-a-stiff-problem-star">
<h2>An example of a stiff problem  [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#an-example-of-a-stiff-problem-star" title="Permalink to this heading">#</a></h2>
<p>For example, the problem</p>
<div class="math notranslate nohighlight">
\[ y'' - 1001 y' + 1000y = 0 , \]</div>
<p>or equivalently</p>
<div class="math notranslate nohighlight">
\[\begin{split} \boldsymbol{z}'=A\boldsymbol{z}\;\;\;\text{where}
\;\;\;\; \boldsymbol{z} = 
\begin{bmatrix}
y\\
y'
\end{bmatrix}
\;\;\;\text{and}
\;\;\;\; 
A =
\begin{bmatrix}
0 &amp; 1\\
-1000 &amp; -1001
\end{bmatrix},\end{split}\]</div>
<p>is stiff (and of course is a variant of our MSD problem
from the previous lecture).</p>
<p>The eigenvalues here are <span class="math notranslate nohighlight">\(\lambda_1 = -1000\)</span> and <span class="math notranslate nohighlight">\(\lambda_2 = -1\)</span>. Hence, this problem satsifies our definition of stiffness as per the eigenvalue based characterisation given above.</p>
<p>Also, the general solution to this problem is given by</p>
<div class="math notranslate nohighlight">
\[ y(t) = C_1 \text{e}^{-1000t} + C_2 \text{e}^{-t}, \]</div>
<p>so after the <span class="math notranslate nohighlight">\(\text{e}^{-1000t}\)</span> component has died away
(or due to the initial conditions is never excited in the first place) we would hope to be able to use a larger time step, but the presence of the large eigenvalue prevents us from doing this.</p>
<p>A generalisation of this problem is considered in the homework. The van der Pol oscillator is another example of a stiff  (depending on choice of a physical parameter) problem considered in the homework.</p>
</section>
<section id="backward-differentiation-formula-bdf-methods-star">
<h2>Backward differentiation formula (BDF) methods  [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#backward-differentiation-formula-bdf-methods-star" title="Permalink to this heading">#</a></h2>
<p>Note that while the <em>Adams</em> family of LMS methods introduced above are popular for non-stiff problems,</p>
<p>for stiff problems so-called BDF methods are preferred.</p>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Backward_differentiation_formula"><em>Backward differentiation formula (BDF) methods</em></a> represent a family of (linear multistep) methods well-suited to solve stiff ODEs.</p>
<p>The entire family of BDF methods are:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{alignat}{4}
\textrm{BDF1:} &amp;\;\;\;\; &amp;  y_{n+1}-y_{n}  &amp;= &amp;{\Delta t}\; f_{n+1} \\
\textrm{BDF2:} &amp;\;\;\;\; &amp; 3y_{n+2} - 4y_{n+1} + y_{n} &amp;= 2 &amp;{\Delta t}\; f_{n+2} \\
\textrm{BDF3:} &amp;\;\;\;\; &amp; 11y_{n+3} - 18y_{n+2} + 9y_{n+1} - 2y_{n} &amp;= 6 &amp;{\Delta t}\; f_{n+3} \\
\textrm{BDF4:} &amp;\;\;\;\; &amp; 25y_{n+4} - 48y_{n+3} + 36y_{n+2} - 16y_{n+1} + 3y_{n} &amp;= 12 &amp;{\Delta t}\; f_{n+4} \\
\textrm{BDF5:} &amp;\;\;\;\; &amp; 137y_{n+5} -300y_{n+4} + 300y_{n+3} - 200y_{n+2} + 75y_{n+1} - 12y_{n} &amp;= 60 &amp;{\Delta t}\; f_{n+5} \\
\textrm{BDF6:} &amp;\;\;\;\; &amp; 147y_{n+6} -360y_{n+5} +450y_{n+4} - 400y_{n+3} + 225y_{n+2} - 72y_{n+1} + 10y_{n} &amp;= 60 &amp;{\Delta t}\; f_{n+6} 
\end{alignat}
\end{split}\]</div>
<p>and it should be no surprise that BDF1 is simply backward Euler.</p>
<p>The order of each method is one lower than the number of levels employed, i.e. BDF1 is first-order and BDF6 is sixth-order.</p>
<p>Note that these are clearly not of “Adams” type since they move all of the free parameter choice over to the <span class="math notranslate nohighlight">\(\alpha\)</span>’s rather than the <span class="math notranslate nohighlight">\(\beta\)</span>’s, with <span class="math notranslate nohighlight">\(f\)</span> on the RHS evaluated at the new time level only.</p>
</section>
<section id="derivation-of-bdf-methods-star-star">
<h2>Derivation of BDF methods  [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#derivation-of-bdf-methods-star-star" title="Permalink to this heading">#</a></h2>
<p>The BDF schemes can be derived by fitting a Lagrange interpolating polynomial to <span class="math notranslate nohighlight">\(y\)</span> (i.e. the <span class="math notranslate nohighlight">\(y\)</span> data at a certain number of previous time levels, as well as the new level) and differentiating this to approximate the derivative of <span class="math notranslate nohighlight">\(y\)</span> w.r.t. <span class="math notranslate nohighlight">\(t\)</span> appearing on the LHS of the ODE, and then setting this equal to the RHS function evaluated at the new time leve.</p>
<p>Consider the case <span class="math notranslate nohighlight">\(s=2\)</span>, i.e. we have data from levels <span class="math notranslate nohighlight">\(n\)</span>, <span class="math notranslate nohighlight">\(n+1\)</span> and are seeking the solution at time level <span class="math notranslate nohighlight">\(n+2\)</span>.</p>
<p>Recall that the Lagrange interpolating polynomial is given by</p>
<div class="math notranslate nohighlight">
\[L(t) := \sum_{i=0}^{N} y_i \ell_i(t),\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}\ell_i(t) := \prod_{\begin{smallmatrix}0\le m\le N\\ m\neq i\end{smallmatrix}} \frac{t-t_m}{t_i-t_m} = \frac{(t-t_0)}{(t_i-t_0)} \cdots \frac{(t-t_{i-1})}{(t_i-t_{i-1})} \frac{(t-t_{i+1})}{(t_i-t_{i+1})} \cdots \frac{(t-t_N)}{(t_i-t_N)},\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(0\le i\le N\)</span>.</p>
<p>In our case where <span class="math notranslate nohighlight">\(N=2\)</span> and our indices run over <span class="math notranslate nohighlight">\(n\)</span>, <span class="math notranslate nohighlight">\(n+1\)</span> and <span class="math notranslate nohighlight">\(n+2\)</span> we have</p>
<div class="math notranslate nohighlight">
\[y(t) \approx L(t) :=  y_{n} \ell_n(t) + y_{n+1} \ell_{n+1}(t) y_{n+1} +  \ell_{n+2}(t)y_{n+2},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[ \ell_n(t) = \frac{(t-t_{n+1})(t-t_{n+2})}{ (t_n-t_{n+1})(t_n-t_{n+2})}, \;\;\;
\ell_{n+1}(t) = \frac{(t-t_{n})(t-t_{n+2})}{ (t_{n+1}-t_{n})(t_{n+1}-t_{n+2})}, \;\;\;
\ell_{n+2}(t) = \frac{(t-t_{n})(t-t_{n+1})}{ (t_{n+2}-t_{n})(t_{n+2}-t_{n+1})}. \]</div>
<p>We actually want <span class="math notranslate nohighlight">\(dy/dt\)</span> which we can approximate via</p>
<div class="math notranslate nohighlight">
\[ \frac{dy}{dt} \approx\frac{dL}{dt} = y_{n} \frac{d\ell_n(t)}{dt} + y_{n+1} \frac{\ell_{n+1}(t)}{dt} +  y_{n+2} \frac{\ell_{n+2}(t)}{dt}.\]</div>
<p>Assuming for simplicity that the time step is uniform and of size <span class="math notranslate nohighlight">\(\Delta t\)</span>, then the derivatives of the individual Lagrange basis polynomials are</p>
<div class="math notranslate nohighlight">
\[ 
\frac{d\ell_n(t)}{dt} = \frac{2t - t_{n+1} -t_{n+2}}{ 2\Delta t^2 }, \;\;\;
\ell_{n+1}(t) = \frac{2t -t_{n} -t_{n+2}}{ -\Delta t^2 }, \;\;\;
\ell_{n+2}(t) = \frac{2t -t_{n} -t_{n+1}}{ 2\Delta t^2 }. \]</div>
<p>Finally, given that we evaluate the RHS of the ODE at the new time level, i.e. <span class="math notranslate nohighlight">\(f_{n+2}\)</span> in this case, we want to evaluate our approximation to the derivative of <span class="math notranslate nohighlight">\(y\)</span> also at this new time level:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align*}
f_{n+2} = \left. \frac{dy(t)}{dt} \right|_{t=t_{n+2}} \approx \left.\frac{dL}{dt}\right|_{t=t_{n+2}}  
&amp; =  
y_{n} \frac{2t_{n+2} - t_{n+1} -t_{n+2}}{ 2\Delta t^2 } + y_{n+1} \frac{2t_{n+2} -t_{n} -t_{n+2}}{ -\Delta t^2 } +   y_{n+2} \frac{2t_{n+2} -t_{n} -t_{n+1}}{ 2\Delta t^2 }\\[10pt]
&amp; =  
y_{n} \frac{\Delta t}{ 2\Delta t^2 } + y_{n+1} \frac{2\Delta t}{ -\Delta t^2 } +   y_{n2} \frac{3\Delta t}{ 2\Delta t^2 }
\\[10pt]
&amp; =  
y_{n} \frac{1}{ 2\Delta t } - y_{n+1} \frac{2}{ \Delta t } +   y_{n+2} \frac{3}{ 2\Delta t }.
\end{align*}
\end{split}\]</div>
<p>Therefore (multiplying through by <span class="math notranslate nohighlight">\(2\,\Delta t\)</span>) we have</p>
<div class="math notranslate nohighlight">
\[ 3y_{n+2} - 4y_{n+1} + y_{n} = 2 {\Delta t}\; f_{n+2}. \]</div>
</section>
<section id="bdf-stability-regions-star">
<h2>BDF stability regions  [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#bdf-stability-regions-star" title="Permalink to this heading">#</a></h2>
<p>Again, we skip the details and just plot the absolute stability regions:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># let&#39;s calculate and plot the stability region for our discrete schemes</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>

<span class="c1"># backward Euler amplification factor,  and its magnitude</span>
<span class="n">BEamp</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lamdt</span><span class="p">)</span>
<span class="n">BEampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">BEamp</span><span class="p">)</span>

<span class="c1"># set up our figs for plotting</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># reshape the list of axes as we are going to use in a loop</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># plot the backward Euler stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">BEampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">BEampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">add_fig_niceties</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>

<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;Stability regions (backward Euler)&#39;</span><span class="p">)</span>
    
<span class="c1"># plot the BDF2 stability region</span>

<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">e_i_theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span>

<span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mf">3.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">4.</span><span class="o">*</span><span class="n">e_i_theta</span> <span class="o">+</span> <span class="mf">1.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="s1">&#39;Stability regions (BDF2)&#39;</span><span class="p">)</span>


<span class="c1"># plot the BDF3 stability region</span>
<span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mf">11.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">18.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">9.</span><span class="o">*</span><span class="n">e_i_theta</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">6.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;Stability regions (BDF3)&#39;</span><span class="p">)</span>

<span class="c1"># plot the BDF4 stability region</span>
<span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="mf">25.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">4</span> <span class="o">-</span> <span class="mf">48.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mf">36.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">16.</span><span class="o">*</span><span class="n">e_i_theta</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">12.</span><span class="o">*</span><span class="n">e_i_theta</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="s1">&#39;Stability regions (BDF4)&#39;</span><span class="p">)</span>


<span class="c1"># plot the BDF5 stability region</span>
<span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="n">e_i_theta</span><span class="p">)</span><span class="o">**</span><span class="n">i</span> <span class="o">/</span> <span class="n">i</span> 

<span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="s1">&#39;Stability regions (BDF5)&#39;</span><span class="p">)</span>

<span class="c1"># plot the BDF6 stability region</span>
<span class="n">z</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="n">e_i_theta</span><span class="p">)</span><span class="o">**</span><span class="n">i</span> <span class="o">/</span> <span class="n">i</span> 

<span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">-</span><span class="mi">100</span><span class="p">],</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">z</span><span class="o">.</span><span class="n">real</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">imag</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">))</span>
<span class="n">add_fig_niceties</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="s1">&#39;Stability regions (BDF6)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3deab5f8688e98e679dddaba70248433570f9561e1b42624b6bc3dc95f91302e.png" src="../_images/3deab5f8688e98e679dddaba70248433570f9561e1b42624b6bc3dc95f91302e.png" />
</div>
</div>
<section id="id15">
<h3>Comments<a class="headerlink" href="#id15" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Recall our definition of A(<span class="math notranslate nohighlight">\(\alpha\)</span>) stability from above - the BDF methods are A(<span class="math notranslate nohighlight">\(\alpha\)</span>) with <span class="math notranslate nohighlight">\(\alpha\)</span> values of 90, 90, 88, 73, 51 and 18 <em>degrees</em> for BDF 1 - 6 respectively [LeVeque - FD - section 8.4].</p></li>
<li><p>BDF methods of order greater than 6, i.e. which use more than 7 levels, are not zero stable and so are unusable.</p></li>
</ul>
</section>
</section>
<section id="final-remarks">
<h2>Final remarks<a class="headerlink" href="#final-remarks" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>Stability increases robustness but generally comes at computational expense, particularly if the ODE is nonlinear.</p></li>
<li><p>Stability does not imply accuracy!</p></li>
<li><p>For a given truncation error, there is a trade-off between how much past information you store in memory (multi-step methods) and how many calculations you make (intermediate-step methods).</p></li>
<li><p>Which time-integration scheme you choose depends on the problem under consideration.</p></li>
</ul>
</section>
<section id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<p>In this lecture we extended our knowledge of ODE solvers through the introduction and derivation of both the linear multi-step (LMS) and Runge-Kutta (RK) families of methods, including implicit versions of these.</p>
<p>We went into more detail on stability, error analysis and time step size selection.</p>
<p>We discussed some of the practical considerations.</p>
<p>Next we will start considering the discretisation of space, leading on to the solutions of PDEs.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter10"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">10. ODE Solvers 2</p>
      </div>
    </a>
    <a class="right-next"
       href="../Chapter11/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">9. PDE Solvers: Finite Difference Methods 2</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Imperial College London
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>