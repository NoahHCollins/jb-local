

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Solutions &#8212; Modelling and Numerical Methods</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter9/Solutions';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="Homework" href="Homework.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Modelling and Numerical Methods
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Analytical Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter1/intro.html">1. Intro to Vector/Tensor Calculus</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.1%20-%20Intro%20to%20Vectors.html">1.1 Continuum Mechanics and Vector Calculus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.2%20-%20Vector%20Transformations.html">1.2 Vector Transformations  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.3%20-%20Intro%20to%20Tensors.html">1.3 Intro to Tensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/exercises.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/solutions.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter2/intro.html">2. Stress Tensor</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/Lecture%202%20-%20Stress%20and%20Tensors.html">2.1 Stress and Tensors  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/exercises2.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/solutions2.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter3/intro.html">3. Kinematics and Strain</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/Lecture%203%20-%20Kinematics.html">3.1 Kinematics   <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/exercises3.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/solutions3.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter4/intro.html">4. Conservation Equations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Lecture%204.1%20-%20Conservation%20Equations.html">4.1 Conservation Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Lecture%204.2%20-%20Rheology.html">4.2 Rheology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/exercises4.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/solutions4.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter5/intro.html">5. Dimensional Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter5/Lecture%205%20-%20Dimensions%20and%20Dimensional%20Analysis.html">5.1 Dimensions and Dimensional Analysis</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Numerical Solutions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter7/intro.html">7. Navier-Stokes</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/Lecture%207.1%20-%20Navier-Stokes.html">7.1 Solving Navier-Stokes Numerically</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/SolversIntro.html">Solvers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter8/intro.html">8. Turbulence and Non-Newtonian Flows</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Lecture%208.1%20-%20Turbulent%20and%20Non-Newtonian%20Flows.html">8.1 Turbulent and Non-Newtonian Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Solutions.html">Solutions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Numerical Techniques</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">9. Interpolation Quadrature 2</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Lecture%209.1%20-%20interpolation%20quadrature.html">Interpolation &amp; Quadrature 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="Homework.html">Homework <a class="tocSkip"></a></a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Solutions <a class="tocSkip"></a></a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FChapter9/Solutions.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapter9/Solutions.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Solutions <a class="tocSkip"></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%html</span>
<span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="nt">div</span><span class="p">.</span><span class="nc">optional</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#d7e2ff</span><span class="p">;</span>
<span class="w">    </span><span class="k">border-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#d7e2ff</span><span class="p">;</span>
<span class="w">    </span><span class="k">border-left</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#d7e2ff</span><span class="p">;</span>
<span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">div</span><span class="p">.</span><span class="nc">advanced</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">display</span><span class="p">:</span><span class="w"> </span><span class="kc">block</span><span class="p">;</span>
<span class="w">    </span><span class="k">background-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff4d7</span><span class="p">;</span>
<span class="w">    </span><span class="k">border-color</span><span class="p">:</span><span class="w"> </span><span class="mh">#fff4d7</span><span class="p">;</span>
<span class="w">    </span><span class="k">border-left</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="kt">px</span><span class="w"> </span><span class="kc">solid</span><span class="w"> </span><span class="mh">#fff4d7</span><span class="p">;</span>
<span class="w">    </span><span class="k">padding</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="kt">em</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>
div.optional {
    display: block;
    background-color: #d7e2ff;
    border-color: #d7e2ff;
    border-left: 5px solid #d7e2ff;
    padding: 0.5em;
}
div.advanced {
    display: block;
    background-color: #fff4d7;
    border-color: #fff4d7;
    border-left: 5px solid #fff4d7;
    padding: 0.5em;
}
</style>
</div></div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="solutions-a-class-tocskip">
<h1>Solutions <a class="tocSkip"><a class="headerlink" href="#solutions-a-class-tocskip" title="Permalink to this heading">#</a></h1>
<section id="interpolation-quadrature-2-a-class-tocskip">
<h2>Interpolation &amp; Quadrature 2 <a class="tocSkip"><a class="headerlink" href="#interpolation-quadrature-2-a-class-tocskip" title="Permalink to this heading">#</a></h2>
<h1>Table of Contents<span class="tocSkip"></span></h1>
<div class="toc"><ul class="toc-item"><li><span><a href="#Homework" data-toc-modified-id="Homework-1"><span class="toc-item-num">1&nbsp;&nbsp;</span>Homework</a></span><ul class="toc-item"><li><span><a href="#Homework---Newton-polynomial-[$\star$]" data-toc-modified-id="Homework---Newton-polynomial-[$\star$]-1.1"><span class="toc-item-num">1.1&nbsp;&nbsp;</span>Homework - Newton polynomial [$\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Newton-polynomial--[$\star$]" data-toc-modified-id="Solution---Newton-polynomial--[$\star$]-1.1.1"><span class="toc-item-num">1.1.1&nbsp;&nbsp;</span>Solution - Newton polynomial  [$\star$]</a></span></li></ul></li><li><span><a href="#Homework---Hat-functions-and-their-derivatives" data-toc-modified-id="Homework---Hat-functions-and-their-derivatives-1.2"><span class="toc-item-num">1.2&nbsp;&nbsp;</span>Homework - Hat functions and their derivatives</a></span><ul class="toc-item"><li><span><a href="#Solutions---Hat-functions-and-their-derivatives" data-toc-modified-id="Solutions---Hat-functions-and-their-derivatives-1.2.1"><span class="toc-item-num">1.2.1&nbsp;&nbsp;</span>Solutions - Hat functions and their derivatives</a></span></li></ul></li><li><span><a href="#Homework---Error-bound-for-polynomial-interpolation-of-the-Runge-function-[$\star$]" data-toc-modified-id="Homework---Error-bound-for-polynomial-interpolation-of-the-Runge-function-[$\star$]-1.3"><span class="toc-item-num">1.3&nbsp;&nbsp;</span>Homework - Error bound for polynomial interpolation of the Runge function [$\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution----Error-bound-for-polynomial-interpolation-of-the-Runge-function" data-toc-modified-id="Solution----Error-bound-for-polynomial-interpolation-of-the-Runge-function-1.3.1"><span class="toc-item-num">1.3.1&nbsp;&nbsp;</span>Solution -  Error bound for polynomial interpolation of the Runge function</a></span></li></ul></li><li><span><a href="#Homework---Chebyshev-interpolation-[$\star$]" data-toc-modified-id="Homework---Chebyshev-interpolation-[$\star$]-1.4"><span class="toc-item-num">1.4&nbsp;&nbsp;</span>Homework - Chebyshev interpolation [$\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Chebyshev-interpolation" data-toc-modified-id="Solution---Chebyshev-interpolation-1.4.1"><span class="toc-item-num">1.4.1&nbsp;&nbsp;</span>Solution - Chebyshev interpolation</a></span></li></ul></li><li><span><a href="#Homework---Chebyshev-polynomials-as-basis-functions-[$\star\star$]" data-toc-modified-id="Homework---Chebyshev-polynomials-as-basis-functions-[$\star\star$]-1.5"><span class="toc-item-num">1.5&nbsp;&nbsp;</span>Homework - Chebyshev polynomials as basis functions [$\star\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Chebyshev-polynomials-as-basis-functions" data-toc-modified-id="Solution---Chebyshev-polynomials-as-basis-functions-1.5.1"><span class="toc-item-num">1.5.1&nbsp;&nbsp;</span>Solution - Chebyshev polynomials as basis functions</a></span></li></ul></li><li><span><a href="#Homework---Cubic-spline-interpolation-[$\star\star$]" data-toc-modified-id="Homework---Cubic-spline-interpolation-[$\star\star$]-1.6"><span class="toc-item-num">1.6&nbsp;&nbsp;</span>Homework - Cubic spline interpolation [$\star\star$]</a></span><ul class="toc-item"><li><span><a href="#Cubic-spline----derivation" data-toc-modified-id="Cubic-spline----derivation-1.6.1"><span class="toc-item-num">1.6.1&nbsp;&nbsp;</span>Cubic spline -  derivation</a></span></li><li><span><a href="#Solution---Cubic-spline-interpolation" data-toc-modified-id="Solution---Cubic-spline-interpolation-1.6.2"><span class="toc-item-num">1.6.2&nbsp;&nbsp;</span>Solution - Cubic spline interpolation</a></span></li></ul></li><li><span><a href="#Homework---Implement-Weddle's-rule" data-toc-modified-id="Homework---Implement-Weddle's-rule-1.7"><span class="toc-item-num">1.7&nbsp;&nbsp;</span>Homework - Implement Weddle's rule</a></span><ul class="toc-item"><li><span><a href="#Solution---Implement-Weddle's-rule" data-toc-modified-id="Solution---Implement-Weddle's-rule-1.7.1"><span class="toc-item-num">1.7.1&nbsp;&nbsp;</span>Solution - Implement Weddle's rule</a></span></li></ul></li><li><span><a href="#Homework---Midpoint-rule-error-[$\star$]" data-toc-modified-id="Homework---Midpoint-rule-error-[$\star$]-1.8"><span class="toc-item-num">1.8&nbsp;&nbsp;</span>Homework - Midpoint rule error [$\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Midpoint-rule-error" data-toc-modified-id="Solution---Midpoint-rule-error-1.8.1"><span class="toc-item-num">1.8.1&nbsp;&nbsp;</span>Solution - Midpoint rule error</a></span></li></ul></li><li><span><a href="#Homework---Derive-Simpson's-rule-as-quadratic-fit-[$\star\star$]" data-toc-modified-id="Homework---Derive-Simpson's-rule-as-quadratic-fit-[$\star\star$]-1.9"><span class="toc-item-num">1.9&nbsp;&nbsp;</span>Homework - Derive Simpson's rule as quadratic fit [$\star\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Derive-Simpson's-rule-as-quadratic-fit" data-toc-modified-id="Solution---Derive-Simpson's-rule-as-quadratic-fit-1.9.1"><span class="toc-item-num">1.9.1&nbsp;&nbsp;</span>Solution - Derive Simpson's rule as quadratic fit</a></span></li></ul></li><li><span><a href="#Homework---Open-vs-closed-Newton-Cotes-[$\star\star$]" data-toc-modified-id="Homework---Open-vs-closed-Newton-Cotes-[$\star\star$]-1.10"><span class="toc-item-num">1.10&nbsp;&nbsp;</span>Homework - Open vs closed Newton-Cotes [$\star\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Open-vs-closed-Newton-Cotes" data-toc-modified-id="Solution---Open-vs-closed-Newton-Cotes-1.10.1"><span class="toc-item-num">1.10.1&nbsp;&nbsp;</span>Solution - Open vs closed Newton-Cotes</a></span></li></ul></li><li><span><a href="#Homework---Implement-adaptive-quadrature-[$\star$]" data-toc-modified-id="Homework---Implement-adaptive-quadrature-[$\star$]-1.11"><span class="toc-item-num">1.11&nbsp;&nbsp;</span>Homework - Implement adaptive quadrature [$\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Implement-adaptive-quadrature" data-toc-modified-id="Solution---Implement-adaptive-quadrature-1.11.1"><span class="toc-item-num">1.11.1&nbsp;&nbsp;</span>Solution - Implement adaptive quadrature</a></span></li></ul></li><li><span><a href="#Homework---Implement-a-&quot;composite&quot;-version-of-Gauss-Legendre-quadrature-[$\star\star$]" data-toc-modified-id="Homework---Implement-a-&quot;composite&quot;-version-of-Gauss-Legendre-quadrature-[$\star\star$]-1.12"><span class="toc-item-num">1.12&nbsp;&nbsp;</span>Homework - Implement a "composite" version of Gauss-Legendre quadrature [$\star\star$]</a></span><ul class="toc-item"><li><span><a href="#Solution---Implement-a-&quot;composite&quot;-version-of-Gauss-Legendre-quadrature" data-toc-modified-id="Solution---Implement-a-&quot;composite&quot;-version-of-Gauss-Legendre-quadrature-1.12.1"><span class="toc-item-num">1.12.1&nbsp;&nbsp;</span>Solution - Implement a "composite" version of Gauss-Legendre quadrature</a></span></li></ul></li></ul></li></ul></div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="c1"># the following allows us to plot triangles indicating convergence order</span>
<span class="kn">from</span> <span class="nn">mpltools</span> <span class="kn">import</span> <span class="n">annotation</span>
<span class="c1"># as this lecture is about interpolation we will make use of this SciPy library</span>
<span class="kn">import</span> <span class="nn">scipy.interpolate</span> <span class="k">as</span> <span class="nn">si</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="k">as</span> <span class="nn">integrate</span>

<span class="c1"># some default font sizes for plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;sans-serif&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.sans-serif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arial&#39;</span><span class="p">,</span> <span class="s1">&#39;Dejavu Sans&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="optional">
</section>
<section id="homework-newton-polynomial-star">
<h2>Homework - Newton polynomial [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#homework-newton-polynomial-star" title="Permalink to this heading">#</a></h2>
<p>From the lecture we defined the Newton polynomial as</p>
<div class="math notranslate nohighlight">
\[ P_N(x) = a_0 +(x-x_0)a_1 + (x-x_0)(x-x_1)a_2 + \cdots + (x-x_0)(x-x_1)\ldots(x-x_{N-1})a_N,\]</div>
<p>where <span class="math notranslate nohighlight">\(a_0, a_1, \ldots, a_N\)</span> are our <span class="math notranslate nohighlight">\(N+1\)</span> free parameters we need to find using the <span class="math notranslate nohighlight">\(N+1\)</span> pieces of information we have in the given data.</p>
<p>We introduced the divided difference notation</p>
<p>\begin{alignat*}{2}
\Delta y_i &amp;= \frac{y_i-y_0}{x_i-x_0},;;    &amp;&amp; i=1,2,\ldots, N,\[10pt]
\Delta^2 y_i &amp;= \frac{\Delta y_i-\Delta y_1}{x_i-x_1},;;    &amp;&amp; i=2, 3,\ldots, N,\[10pt]
&amp;\vdots\[5pt]
\Delta^N y_N &amp;= \frac{\Delta^{N-1} y_N-\Delta^{N-1} y_{N-1}}{x_N-x_{N-1}},
\end{alignat*}</p>
<p>and saw that the unknown coefficients <span class="math notranslate nohighlight">\(a\)</span> are given by</p>
<div class="math notranslate nohighlight">
\[a_0=y_0,\;\;\;\;\; a_1 = \Delta y_1, \;\;\;\;\; a_2 = \Delta^2 y_2, \;\;\;\;\; \ldots \;\;\;\;\; a_N = \Delta^N y_N.\]</div>
<p>Based upon the following pseudo code implement functions to (1) calculate the coefficients of the Newton polynomial, and (2) evaluate it for the purposes of plotting. Check visually that your plotted curve of the interpolant agrees with what we saw for the Lagrange polynomial (obtained either with SciPy our our own implementation: <code class="docutils literal notranslate"><span class="pre">Lagrange_basis_poly</span></code> and <code class="docutils literal notranslate"><span class="pre">Lagrange_interp_poly</span></code>) and passes through our data points - use the same data made up of 6 points we used in the lecture:</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">])</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
</pre></div>
</div>
<p><em>Pseudo-code / code skeleton:</em></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_newton_poly_coeffs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to evaluate the coefficients a_i recursively</span>
<span class="sd">    using Newton&#39;s method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi, yi : array_like</span>
<span class="sd">        The N+1 data points (i = 0, 1, ..., N)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array_like</span>
<span class="sd">        Array containing the Newton polynomial coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialise the array &#39;a&#39; with yi, but take a copy to ensure we don&#39;t</span>
    <span class="c1"># overwrite our yi data!</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">yi</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># we have N+1 data points, and so</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># for each k, we compute Δ^k y_i from the a_i = Δ^(k-1) y_i of the previous iteration:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># but only for i&gt;=k</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">***</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">fill</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">maths</span> <span class="n">here</span> <span class="o">***</span>

    <span class="k">return</span> <span class="n">a</span>
    
    
<span class="k">def</span> <span class="nf">eval_newton_poly</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to evaluate the Newton polynomial</span>
<span class="sd">    at x, given the data point xi and the polynomial coeffs a.</span>

<span class="sd">    a : array_like</span>
<span class="sd">        Newton polynomial coefficients</span>
<span class="sd">    xi : array_like</span>
<span class="sd">        The x-component of the data</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the Newton polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    P : array_like</span>
<span class="sd">        Newton polynomial values for points x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># polynomial degree</span>
    <span class="c1"># recursively build up polynomial evaluated at xx</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">P</span> <span class="o">=</span> <span class="o">***</span> <span class="n">you</span> <span class="n">need</span> <span class="n">to</span> <span class="n">fill</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">maths</span> <span class="n">here</span> <span class="o">***</span>
        
    <span class="k">return</span> <span class="n">P</span>
    
<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># add a small margin </span>
<span class="n">ax1</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Evaluate the coefficients of the Newton polynomial</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">calculate_newton_poly_coeffs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="c1"># Evaluate the polynomial at high resolution and plot</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">eval_poly</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Newton poly&#39;</span><span class="p">)</span>

<span class="c1"># Overlay raw data</span>
<span class="n">plot_raw_data</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Newton interpolating polynomial (our implementation)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Add a legend</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div><section id="solution-newton-polynomial-star">
<h3>Solution - Newton polynomial  [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#solution-newton-polynomial-star" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># consider the above example data again</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">])</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">calculate_newton_poly_coeffs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to evaluate the coefficients a_i recursively</span>
<span class="sd">    using Newton&#39;s method.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi, yi : array_like</span>
<span class="sd">        The N+1 data points (i = 0, 1, ..., N)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    a : array_like</span>
<span class="sd">        Array containing the Newton polynomial coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># initialise the array &#39;a&#39; with yi, but take a copy to ensure we don&#39;t</span>
    <span class="c1"># overwrite our yi data!</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">yi</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># we have N+1 data points, and so</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># for each k, we compute Δ^k y_i from the a_i = Δ^(k-1) y_i of the previous iteration:</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># but only for i&gt;=k</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">a</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">xi</span><span class="p">[</span><span class="n">k</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">a</span>


<span class="c1"># Given the coefficients a, and the data locations x,</span>
<span class="c1"># define a function to evaluate the Newton polynomial</span>
<span class="c1"># at locations given in the array xx.</span>
<span class="c1"># NB. this is just an evaluation of the P_n(x) = ... formula</span>
<span class="c1"># given at the start of this section.</span>

<span class="k">def</span> <span class="nf">eval_newton_poly</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to evaluate the Newton polynomial</span>
<span class="sd">    at x, given the data point xi and the polynomial coeffs a.</span>

<span class="sd">    a : array_like</span>
<span class="sd">        Newton polynomial coefficients</span>
<span class="sd">    xi : array_like</span>
<span class="sd">        The x-component of the data</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the Newton polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    P : array_like</span>
<span class="sd">        Newton polynomial values for points x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># polynomial degree</span>
    <span class="c1"># recursively build up polynomial evaluated at xx</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">N</span><span class="o">-</span><span class="n">k</span><span class="p">])</span><span class="o">*</span><span class="n">P</span>
    <span class="k">return</span> <span class="n">P</span>


<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="c1"># add a small margin </span>
<span class="n">ax1</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="c1"># Evaluate the coefficients of the Newton polynomial</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">calculate_newton_poly_coeffs</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>
<span class="c1"># Evaluate the polynomial at high resolution and plot</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">eval_newton_poly</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Newton poly&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_raw_data</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;plot x vs y on axes ax, </span>
<span class="sd">    add axes labels and turn on grid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
<span class="c1"># Overlay raw data</span>
<span class="n">plot_raw_data</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Newton interpolating polynomial (our implementation)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Add a legend</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a86c41af495d7cd65e1ef47dfe84953216b24b439581e7b8710820126c28f2d7.png" src="../_images/a86c41af495d7cd65e1ef47dfe84953216b24b439581e7b8710820126c28f2d7.png" />
</div>
</div>
</section>
</section>
<section id="homework-hat-functions-and-their-derivatives">
<h2>Homework - Hat functions and their derivatives<a class="headerlink" href="#homework-hat-functions-and-their-derivatives" title="Permalink to this heading">#</a></h2>
<p>Recall that the hat functions we used as basis functions for p/w linear interpolation
are defined as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\phi_i(x) = 
\begin{cases}
\frac{x - x_{i-1}}{\Delta x_{i-1}}, &amp;\text{if}\;\;\; x\in e_{i-1}\equiv[x_{i-1},x_{i}] \\[5pt]
\frac{x_{i+1} - x}{\Delta x_{i}}, &amp;\text{if}\;\;\; x\in e_{i}\equiv[x_{i},x_{i+1}] \\[5pt]
0, &amp; \text{otherwise} \\
\end{cases}
\end{split}\]</div>
<p>which looks like the following:</p>
<img src="figures/fem_basis_functions.svg" style="width: 800px">
<br>
<p>Compute an analytical expression for their derivatives and write a function to evaluate them. Plot your results, what happens if you have non-uniform interval sizes (distances between data points)?</p>
<section id="solutions-hat-functions-and-their-derivatives">
<h3>Solutions - Hat functions and their derivatives<a class="headerlink" href="#solutions-hat-functions-and-their-derivatives" title="Permalink to this heading">#</a></h3>
<p>The derivatives are given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\phi'_i(x) = 
\begin{cases}
\frac{1}{\Delta x_{i-1}}, &amp;\text{if}\;\;\; x\in e_{i-1}\equiv[x_{i-1},x_{i}] \\[5pt]
\frac{-1}{\Delta x_{i}}, &amp;\text{if}\;\;\; x\in e_{i}\equiv[x_{i},x_{i+1}] \\[5pt]
0, &amp; \text{otherwise} \\
\end{cases}
\end{split}\]</div>
<p>i.e. they are constant within intervals.</p>
<p>Let’s write a function to return these values, and plot them to make sure they look right.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hat_function</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Linear continuous basis function at node i.</span>
<span class="sd">    Returns a function for later use in quadrature rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">hat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span> <span class="n">x</span><span class="o">&lt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span> <span class="p">[</span> <span class="p">(</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span> <span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">hat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span> <span class="n">x</span><span class="o">&gt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span> <span class="p">[</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span> <span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([[</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>  
                  <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([[</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]],[</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="p">,</span>
                <span class="p">[</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span> <span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hat</span>

<span class="c1"># let&#39;s plot what this function returns</span>
<span class="c1"># first set up the nodes, a fine mesh to use to plot and the axes</span>
<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>
<span class="n">x_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="n">x_nodes</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">((</span><span class="s1">&#39;$x_0$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_3$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_4$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_5$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_6$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_7$&#39;</span> <span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;P1 basis function&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># you can change the following to be in [0,n] to change what the </span>
<span class="c1"># function returns for a given node number</span>
<span class="n">node</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">hat_function</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">)</span>
<span class="c1"># it&#39;s returned a function phi, so just evaluate this on the mesh</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">phi</span><span class="p">(</span><span class="n">x_fine</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5e15193f04d3bd74e461fcdbb253fea7394b3b504be8d245664e3c04cbc903cd.png" src="../_images/5e15193f04d3bd74e461fcdbb253fea7394b3b504be8d245664e3c04cbc903cd.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hat_function_deriv</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Derivative of linear continuous basis function at node i.</span>
<span class="sd">    Returns a function for later use in quadrature rules.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span><span class="p">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&lt;=</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">hat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span> <span class="n">x</span><span class="o">&lt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span> <span class="p">[</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span> <span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">i</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">hat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span> <span class="n">x</span><span class="o">&gt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">],</span> <span class="p">[</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">]</span> <span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">hat</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
                <span class="p">[</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([[</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]],[</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>  
                  <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">([[</span><span class="n">x</span><span class="o">&gt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">]],[</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="p">,</span>
                <span class="p">[</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">]</span> <span class="p">,</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">hat</span>

<span class="n">x_nodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">)</span>

<span class="c1"># uncommenting the following line would give you variable interval sizes!</span>
<span class="c1">#x_nodes = x_nodes + ((x_nodes[-1]-x_nodes[0])/5)*np.random.rand(len(x_nodes))</span>

<span class="n">x_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="n">x_nodes</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">((</span><span class="s1">&#39;$x_0$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_3$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_4$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_5$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_6$&#39;</span><span class="p">,</span><span class="s1">&#39;$x_7$&#39;</span> <span class="p">),</span> 
                    <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;P1 basis function and its derivative&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># you can change the following to be in [0,n]</span>
<span class="n">node</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">phi</span> <span class="o">=</span> <span class="n">hat_function</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_fine</span><span class="p">,</span> <span class="n">phi</span><span class="p">(</span><span class="n">x_fine</span><span class="p">),</span> <span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\phi(x)$&#39;</span><span class="p">);</span>
<span class="n">phi_x</span> <span class="o">=</span> <span class="n">hat_function_deriv</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">x_nodes</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_nodes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_fine</span><span class="p">[(</span><span class="n">x_fine</span><span class="o">&gt;</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_fine</span><span class="o">&lt;</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])],</span> 
             <span class="n">phi_x</span><span class="p">(</span><span class="n">x_fine</span><span class="p">[(</span><span class="n">x_fine</span><span class="o">&gt;</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_fine</span><span class="o">&lt;</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])]),</span> 
             <span class="s1">&#39;b-&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;$\phi&#39;(x)$&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">node</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">],</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">node</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">node</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">x_nodes</span><span class="p">[</span><span class="n">node</span><span class="o">+</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span><span class="s1">&#39;k:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span><span class="mf">1.0</span><span class="p">),</span> <span class="n">shadow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f6fb9f040a0&gt;
</pre></div>
</div>
<img alt="../_images/3b357ba2b4c19ef78ed77a209ba777f6bcc2677173c01155e0a450d0d3ad2fe8.png" src="../_images/3b357ba2b4c19ef78ed77a209ba777f6bcc2677173c01155e0a450d0d3ad2fe8.png" />
</div>
</div>
<div class="optional">
</section>
</section>
<section id="homework-error-bound-for-polynomial-interpolation-of-the-runge-function-star">
<h2>Homework - Error bound for polynomial interpolation of the Runge function [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#homework-error-bound-for-polynomial-interpolation-of-the-runge-function-star" title="Permalink to this heading">#</a></h2>
<p>We can use SymPy to calculate and then plot the derivatives of the Runge function for example we can do something like</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">25.</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>
<span class="n">f_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

<span class="n">dfdx</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f&#39;(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dfdx</span><span class="p">)))</span>
<span class="n">dfdx_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dfdx</span><span class="p">)</span>

<span class="n">dfdx2</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dfdx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dfdx2</span><span class="p">)))</span>
<span class="n">dfdx2_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dfdx2</span><span class="p">)</span>

<span class="n">dfdx3</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dfdx2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dfdx3</span><span class="p">)))</span>
<span class="n">dfdx3_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dfdx3</span><span class="p">)</span>

<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">f_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f(x)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">dfdx_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f&#39;(x)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">dfdx2_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;(x)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">dfdx3_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;&#39;(x)&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>and to compute an <span class="math notranslate nohighlight">\((N+1)\)</span>-st derivative, say, we could do something like</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 
</pre></div>
</div>
<p>Play around a bit with SymPy and try plotting our error bound</p>
<div class="math notranslate nohighlight">
\[\left| f(x) - P_N(x) \right| \le \frac{1}{(N+1)!}\, M\, \left|\Psi_N(x)\right|
\;\;\;\;\;\;\text{where}\;\;\;\;\;\;
M:=\max_{x\in(a,b)}\, \left| f^{(N+1)}(x) \right|,\]</div>
<p>you should see that as you increase <span class="math notranslate nohighlight">\(N\)</span> the error bound gets larger quite rapidly and more and more focused at the end points of our interval.</p>
</div><section id="solution-error-bound-for-polynomial-interpolation-of-the-runge-function">
<h3>Solution -  Error bound for polynomial interpolation of the Runge function<a class="headerlink" href="#solution-error-bound-for-polynomial-interpolation-of-the-runge-function" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>

<span class="c1"># calculate and plot derivatives of the Runge function</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="mf">25.</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">f</span><span class="p">)))</span>
<span class="n">f_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>

<span class="n">dfdx</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f&#39;(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dfdx</span><span class="p">)))</span>
<span class="n">dfdx_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dfdx</span><span class="p">)</span>

<span class="n">dfdx2</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dfdx</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dfdx2</span><span class="p">)))</span>
<span class="n">dfdx2_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dfdx2</span><span class="p">)</span>

<span class="n">dfdx3</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">dfdx2</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;&#39;(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">dfdx3</span><span class="p">)))</span>
<span class="n">dfdx3_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">dfdx3</span><span class="p">)</span>

<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">f_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f(x)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">dfdx_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f&#39;(x)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">dfdx2_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;(x)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">dfdx3_</span><span class="p">(</span><span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;f&#39;&#39;&#39;(x)&quot;</span><span class="p">)</span>

<span class="c1"># use SymPy to calculate 5th derivative</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="c1"># print &amp; plot error bound</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f^{(5)}(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span>
<span class="n">df_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([(</span><span class="n">xf</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_</span><span class="p">(</span><span class="n">xf</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Psi</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Error bound. N=</span><span class="si">{0:2d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

<span class="c1"># use SymPy to calculate 6th derivative</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="c1"># print &amp; plot error bound</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f^{(6)}(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span>
<span class="n">df_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([(</span><span class="n">xf</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_</span><span class="p">(</span><span class="n">xf</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Psi</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Error bound. N=</span><span class="si">{0:2d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

<span class="c1"># use SymPy to calculate 12th derivative</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">f</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> 

<span class="c1"># print &amp; plot error bound</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;f^{(12)}(x) = &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">df</span><span class="p">)))</span>
<span class="n">df_</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">df</span><span class="p">)</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">([(</span><span class="n">xf</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">factorial</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">df_</span><span class="p">(</span><span class="n">xf</span><span class="p">)))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Psi</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">);</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Error bound. N=</span><span class="si">{0:2d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">sympy</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">factorial</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># calculate and plot derivatives of the Runge function</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;sympy&#39;
</pre></div>
</div>
</div>
</div>
<div class="optional">
</section>
</section>
<section id="homework-chebyshev-interpolation-star">
<h2>Homework - Chebyshev interpolation [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#homework-chebyshev-interpolation-star" title="Permalink to this heading">#</a></h2>
<p>Consider the cell in the lecture where we computed and plotted the Chebyshev interpolant using a call to <code class="docutils literal notranslate"><span class="pre">si.lagrange</span></code> (from inside the function <code class="docutils literal notranslate"><span class="pre">plot_approximation</span></code>), i.e. where the loop read</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="c1"># the Chebyshev nodes</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">degree</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
    <span class="c1"># compute and plot the Lagrange polynomial using Chebyshev nodes as data locations</span>
    <span class="n">plot_approximation</span><span class="p">(</span><span class="n">runge</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Degree </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">degree</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<p>Recreate the four plots that resulted, but update the code (specifically our function <code class="docutils literal notranslate"><span class="pre">plot_approximation</span></code>) so that it instead calls our Lagrangian interpolation function <code class="docutils literal notranslate"><span class="pre">Lagrange_interp_poly</span></code>.</p>
</div><section id="solution-chebyshev-interpolation">
<h3>Solution - Chebyshev interpolation<a class="headerlink" href="#solution-chebyshev-interpolation" title="Permalink to this heading">#</a></h3>
<p>The key change here is really just to update</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>    <span class="n">lp</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">lagrange</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lp</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;approximation&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>for</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>    <span class="n">L</span> <span class="o">=</span> <span class="n">Lagrange_interp_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;approximation&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Lagrange_basis_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate Lagrange basis polynomials.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi : array_like</span>
<span class="sd">        The x-component of the data</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    l : ndarray</span>
<span class="sd">        The Lagrange polynomials evaluated at x, has size (len(xi), len(x))</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># we have N+1 data points, and so the polynomial degree N must be the length of xi minus 1</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="c1"># the Lagrange basis polynomials are a product, so let&#39;s initialise them with 1</span>
    <span class="c1"># (cf. for a summation where we would most likely initialise with zero)</span>
    <span class="c1"># we have N+1 of them, and we want their values at locations x, hence size (N+1)xlen(x)</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="c1"># we want to iterate over i ranging from zero to N</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">m</span> <span class="o">!=</span> <span class="n">i</span><span class="p">):</span>
                <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">m</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">l</span>


<span class="k">def</span> <span class="nf">Lagrange_interp_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculates Lagrange interpolation polynomial from N+1 data points.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi, yi : array_like</span>
<span class="sd">        The N+1 data points (i = 0, 1, ..., N)</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    L : ndarray</span>
<span class="sd">        Lagrange interpolation polynomial evaluated at x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># first call our function above to calculate the individual basis functions l</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">Lagrange_basis_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;len(xi), len(x), l.shape: &#39;</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">l</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="c1"># L is our Lagrange polynomial evaluated at the locations x</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">L</span> <span class="o">+</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">L</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">runge</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">25.0</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_approximation2</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to plot the Lagrange interpolation polynomial of</span>
<span class="sd">    the Runge function f</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    f : callable</span>
<span class="sd">        The Runge function</span>
<span class="sd">    xi : array_like</span>
<span class="sd">        The x-component of the data</span>
<span class="sd">    ax : matplotlib axes</span>
<span class="sd">        The axes to plot on</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Runge&#39;</span><span class="p">)</span>

    <span class="c1">#lp = si.lagrange(xi, f(xi))</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">Lagrange_interp_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;approximation&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    

<span class="n">degrees</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="c1"># set up our figs for plotting </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">degrees</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># add some padding otherwise axes labels overlap</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="c1"># the Chebyshev nodes</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">degree</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
    <span class="c1"># compute and plot the Lagrange polynomial using Chebyshev nodes as data locations</span>
    <span class="n">plot_approximation2</span><span class="p">(</span><span class="n">runge</span><span class="p">,</span> <span class="n">xi</span><span class="p">,</span> <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Degree </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">degree</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>len(xi), len(x), l.shape:  6 100 (6, 100)
len(xi), len(x), l.shape:  10 100 (10, 100)
len(xi), len(x), l.shape:  13 100 (13, 100)
len(xi), len(x), l.shape:  21 100 (21, 100)
</pre></div>
</div>
<img alt="../_images/66f506f289d1d88e55d48aedbe5064872a8e0549fbdefb633f79a4f23766c581.png" src="../_images/66f506f289d1d88e55d48aedbe5064872a8e0549fbdefb633f79a4f23766c581.png" />
</div>
</div>
<div class="advanced">
</section>
</section>
<section id="homework-chebyshev-polynomials-as-basis-functions-star-star">
<h2>Homework - Chebyshev polynomials as basis functions [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#homework-chebyshev-polynomials-as-basis-functions-star-star" title="Permalink to this heading">#</a></h2>
<p>Recall from lectures that the degree <span class="math notranslate nohighlight">\(N\)</span> Lagrange polynomial interpolating <span class="math notranslate nohighlight">\(N+1\)</span> data points is given by</p>
<div class="math notranslate nohighlight">
\[L(x) := \sum_{i=0}^{N} y_i \ell_i(x),\]</div>
<p>where the <span class="math notranslate nohighlight">\(\ell_i(x)\)</span> are the Lagrange basis functions defined by</p>
<div class="math notranslate nohighlight">
\[\begin{split}\ell_i(x) := \prod_{\begin{smallmatrix}0\le m\le N\\ m\neq i\end{smallmatrix}} \frac{x-x_m}{x_i-x_m},\end{split}\]</div>
<p>[note that each of these basis functions is itself a degree <span class="math notranslate nohighlight">\(N\)</span> polynomial].</p>
<p>A general result is the following:</p>
<p>If the <span class="math notranslate nohighlight">\(N+1\)</span> data locations, <span class="math notranslate nohighlight">\(x_0 &lt; x_1 &lt; \ldots &lt; x_N,\)</span> are the roots of some (N+1) degree polynomial <span class="math notranslate nohighlight">\(\phi_{N+1}(x)\)</span>  (from an <a class="reference external" href="https://en.wikipedia.org/wiki/Orthogonal_polynomials"><em>orthogonal family</em> of polynomials</a>, e.g. the <a class="reference external" href="https://en.wikipedia.org/wiki/Chebyshev_polynomials"><em>Chebyshev polynomials</em></a>) we introduced in lecture and have a nice minimal error property, then the Lagrange basis functions are equivalent to</p>
<div class="math notranslate nohighlight">
\[\ell_i(x) \equiv \frac{\phi_{N+1}(x)}{(x - x_i)\phi'_{N+1}(x_i)},\]</div>
<p>where <span class="math notranslate nohighlight">\(\phi'\)</span> is the derivative of <span class="math notranslate nohighlight">\(\phi\)</span>.  [See Chebyshev Polynomials, by J.C. Mason, D.C. Handscomb (Chapter 6)].</p>
<p>In the specific case we discussed in class where the <span class="math notranslate nohighlight">\(x_0 &lt; x_1 &lt; \ldots &lt; x_N,\)</span> are the roots of the Chebyshev polynomial (which was the choice which minimised the issue we had with interpolation of the Runge function) we have that the Lagrange basis functions are equivalent to</p>
<div class="math notranslate nohighlight">
\[\ell_i(x) = \frac{T_{N+1}(x)}{(N+1)(x - x_i)U_{N}(x_i)},\]</div>
<p>where <span class="math notranslate nohighlight">\(T\)</span> and <span class="math notranslate nohighlight">\(U\)</span> are the Chebyshev polynomials of the first and second kind respectively, i.e. the Lagrange basis functions are equivalent to scaled Chebyshev polynomials.</p>
<p>Now of course we end up at the same final interpolating polynomial as we did with the standard Lagrange polynomial approach, but now the basis functions are not all degree <span class="math notranslate nohighlight">\(N\)</span> polynomials (as we will see in the code and web links directly below).</p>
<p>Try updating our function <code class="docutils literal notranslate"><span class="pre">Lagrange_interp_poly</span></code> so that instead of calling the function <code class="docutils literal notranslate"><span class="pre">Lagrange_basis_poly</span></code> to compute the Lagrange basis functions using the expression at the top of this cell, it calls a new function which computes the basis functions in terms of the above formula involving Chebyshev polynomials of the first (<span class="math notranslate nohighlight">\(T\)</span>) and second (<span class="math notranslate nohighlight">\(U\)</span>) kind.</p>
<p>You can use the recurrence relations defining these families of polynomials here: <a class="reference external" href="https://en.wikipedia.org/wiki/Chebyshev_polynomials#Definition">https://en.wikipedia.org/wiki/Chebyshev_polynomials#Definition</a></p>
<p>As a hint here is a function which computes the polynomial of the first kind (you’ll need to code up the second kind yourself)</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Chebyshev_first_kind</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to compute the Chebyshev polynomial of the first kind.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int</span>
<span class="sd">        Degree of the polynomial</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    T : ndarray</span>
<span class="sd">        Chebyshev polynomial of the first kind evaluated at x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">T</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">T</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span>
    <span class="k">return</span> <span class="n">T</span>
</pre></div>
</div>
<p>And as a further hint, in my solution I replace these lines from <code class="docutils literal notranslate"><span class="pre">Lagrange_interp_poly</span></code></p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>    <span class="n">l</span> <span class="o">=</span> <span class="n">Lagrange_basis_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">L</span> <span class="o">+</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">l</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span>    <span class="n">T</span> <span class="o">=</span> <span class="n">Chebyshev_first_kind</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">Chebyshev_second_kind</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span>
    <span class="n">Chebyshev_interpolant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="n">Chebyshev_interpolant</span> <span class="o">=</span> <span class="n">Chebyshev_interpolant</span>  \
            <span class="o">+</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">/</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">U</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
</pre></div>
</div>
<p>I called the new function <code class="docutils literal notranslate"><span class="pre">Chebyshev_interp_poly</span></code>.</p>
<p>Test your answer by recreating the above plots of the approximation (obtained using <code class="docutils literal notranslate"><span class="pre">Lagrange_interp_poly</span></code>) to the Runge functions using <code class="docutils literal notranslate"><span class="pre">degrees</span> <span class="pre">=</span> <span class="pre">[5,</span> <span class="pre">9,</span> <span class="pre">12,</span> <span class="pre">20]</span></code>.</p>
</div><section id="solution-chebyshev-polynomials-as-basis-functions">
<h3>Solution - Chebyshev polynomials as basis functions<a class="headerlink" href="#solution-chebyshev-polynomials-as-basis-functions" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">Chebyshev_first_kind</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to compute the Chebyshev polynomial of the first kind.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int</span>
<span class="sd">        Degree of the polynomial</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    T : ndarray</span>
<span class="sd">        Chebyshev polynomial of the first kind evaluated at x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">T</span>
    <span class="n">T</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">x</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">T</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">T</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span>
    <span class="k">return</span> <span class="n">T</span>

<span class="k">def</span> <span class="nf">Chebyshev_second_kind</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to compute the Chebyshev polynomial of the second kind.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    N : int</span>
<span class="sd">        Degree of the polynomial</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    U : ndarray</span>
<span class="sd">        Chebyshev polynomial of the second kind evaluated at x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">U</span>
    <span class="n">U</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">U</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">U</span><span class="p">[</span><span class="n">n</span><span class="p">,:]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">U</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">U</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span>
    <span class="k">return</span> <span class="n">U</span>

<span class="k">def</span> <span class="nf">Chebyshev_interp_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to compute Chebyshev interpolation polynomial from</span>
<span class="sd">    N+1 data points.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi, yi : array_like</span>
<span class="sd">        The N+1 data points (i = 0, 1, ..., N)</span>
<span class="sd">    x : array_like</span>
<span class="sd">        Array of x-locations the polynomial is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Chebyshev_interpolant : array_like</span>
<span class="sd">        Chebyshev interpolation polynomial evaluated at x</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">Chebyshev_first_kind</span><span class="p">(</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">Chebyshev_second_kind</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span>
    <span class="n">Chebyshev_interpolant</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)):</span>
        <span class="n">Chebyshev_interpolant</span> <span class="o">=</span> <span class="n">Chebyshev_interpolant</span>  \
            <span class="o">+</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span><span class="o">/</span><span class="p">((</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">U</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">Chebyshev_interpolant</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">degrees</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">]</span>

<span class="c1"># set up our figs for plotting </span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">degrees</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># add some padding otherwise axes labels overlap</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">degree</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
    <span class="c1"># the Chebyshev nodes</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">degree</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">degree</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">yi</span> <span class="o">=</span> <span class="n">runge</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span><span class="mf">1.</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">Chebyshev_interpolant</span> <span class="o">=</span> <span class="n">Chebyshev_interp_poly</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Chebyshev_interpolant</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;approximation&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Runge&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">runge</span><span class="p">(</span><span class="n">xi</span><span class="p">),</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Degree </span><span class="si">%i</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">degree</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/0aba00e28420fc945953ed01da7b4a7deb8ccf4cf4602975dae373cc84735fbe.png" src="../_images/0aba00e28420fc945953ed01da7b4a7deb8ccf4cf4602975dae373cc84735fbe.png" />
</div>
</div>
<div class="advanced">
</section>
</section>
<section id="homework-cubic-spline-interpolation-star-star">
<h2>Homework - Cubic spline interpolation [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#homework-cubic-spline-interpolation-star-star" title="Permalink to this heading">#</a></h2>
<p>Write some code to implement and plot a cubic spline and recreate the figure from class obtained using SciPy, based on the theory below. If you get this right and if you do a little bit of extrapolation outside our data range then you will see that the behaviour here does not quite agree with SciPy. Read the SciPy docs to see why this is (consider the default boundary conditions) and redo the SciPy plot to agree with your code.</p>
</div><section id="cubic-spline-derivation">
<h3>Cubic spline -  derivation<a class="headerlink" href="#cubic-spline-derivation" title="Permalink to this heading">#</a></h3>
<p>[See Elementary Numerical Analysis by Kendall Atkinson page 132 and Kiusalaas page 121].</p>
<p>There are a few different ways to derive a linear system which can be solved for the unknowns to prescribe a cubic spline. The Wikipedia entry for example formulates the problem such that it leads to a linear system for <span class="math notranslate nohighlight">\(k\)</span> defined as the first derivatives of the spline. Here we follow a derivation where we define <span class="math notranslate nohighlight">\(k\)</span> to the the second derivatives (or curvatures) of the spline (Atkinson uses the notation <span class="math notranslate nohighlight">\(M\)</span> for these curvatures; Moin uses <span class="math notranslate nohighlight">\(g''\)</span> in the text and gpp in code).</p>
<p>Recall we cubic splines we are looking for a curve <span class="math notranslate nohighlight">\(y = f(x)\)</span> which is cubic between the data points (the knots), and whose first and second derivatives are continuous across the knots.</p>
<p>Use the notation <span class="math notranslate nohighlight">\(f_{i,i+1}(x)\)</span> to denote this cubic in the interval between knot <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(i+1\)</span> (for <span class="math notranslate nohighlight">\(i = 0, \ldots, n-1\)</span>), so</p>
<div class="math notranslate nohighlight">
\[ f_{i,i+1}(x) = \alpha + \beta x + \gamma x^2 + \delta x^3,\]</div>
<p>with different constants (<span class="math notranslate nohighlight">\(\alpha,\beta,\gamma,\delta\)</span>) in each interval.</p>
<p>Introduce the notation <span class="math notranslate nohighlight">\(k_i\)</span> for the second derivative of the (overall) spline at knot <span class="math notranslate nohighlight">\(i\)</span>, then by continuity of second derivatives across <span class="math notranslate nohighlight">\(knots\)</span>, the second derivatives of <span class="math notranslate nohighlight">\(f_{i-1,i}\)</span> and <span class="math notranslate nohighlight">\(f_{i,i+1}\)</span> at their common knot <span class="math notranslate nohighlight">\(x_i\)</span> must be equal,
and this value is <span class="math notranslate nohighlight">\(k_i\)</span>:</p>
<div class="math notranslate nohighlight">
\[ k_i = f''_{i-1,i}(x) = f''_{i,i+1}(x), \;\;\;\; \text{for} \;\;\;\;\; i=1,\ldots, n-1.\]</div>
<p>In the case of <em>natural</em> splines we use the boundary at the end point of the domain</p>
<div class="math notranslate nohighlight">
\[ k_0 = k_n = 0.\]</div>
<p>Now since <span class="math notranslate nohighlight">\(f\)</span> is cubic, we know that <span class="math notranslate nohighlight">\(f''(x)\)</span> must be p/w linear and continuous, i.e. on each subinterval <span class="math notranslate nohighlight">\(f''_{i,i+1}(x)\)</span> is linear and completely defined by its values at the two knots either end of that interval (<span class="math notranslate nohighlight">\(k_i\)</span> and <span class="math notranslate nohighlight">\(k_{i+1}\)</span>). We can use Lagrange interpolation to write this as</p>
<div class="math notranslate nohighlight">
\[ f''_{i,i+1}(x) = k_i\ell_i(x) + k_{i+1}\ell_{i+1}(x),\]</div>
<p>where the Lagrange basis polynomials are (see the cell on linear interpolation in L1)</p>
<div class="math notranslate nohighlight">
\[ \ell_i(x) = \frac{x - x_{i+1}}{x_i-x_{i+1}}, \;\;\;\;\;\;\;\;  \ell_{i+1}(x) = \frac{x - x_i}{x_{i+1}-x_i}. \]</div>
<p>Hence,</p>
<div class="math notranslate nohighlight">
\[ f''_{i,i+1}(x) = \frac{ k_i(x - x_{i+1}) + k_{i+1}(x - x_i) }{x_i-x_{i+1}}.\]</div>
<p>If we integrate this linear expression up twice with respect to <span class="math notranslate nohighlight">\(x\)</span> we get</p>
<div class="math notranslate nohighlight">
\[ f_{i,i+1}(x) = \frac{ k_i(x - x_{i+1})^3 - k_{i+1}(x - x_i)^3 }{6(x_i-x_{i+1})} + C_1 x + C_2,\]</div>
<p>where <span class="math notranslate nohighlight">\(C_1\)</span> and <span class="math notranslate nohighlight">\(C_2\)</span> are two arbitrary constants of integration. The way to check this is to see that if we differentiate this twice those two terms with the constants disappear, and the first term when integrated twice does indeed give us the term on the LHS of our expression for <span class="math notranslate nohighlight">\( f''_{i,i+1}(x) \)</span>.</p>
<p>Now note we can also write the extra <span class="math notranslate nohighlight">\(C_1 x + C_2\)</span> terms in the form <span class="math notranslate nohighlight">\(A(x - x_{i+1}) - B(x - x_i)\)</span>, where we have simply redefined that constants via <span class="math notranslate nohighlight">\(C_1=A-B\)</span> and <span class="math notranslate nohighlight">\(C_2 = -Ax_{i+1} - Bx_i\)</span>. We can do this as the constants are arbitrary at this stage, and this will prove more convenient in what follows.</p>
<p>If you’re confused about this just note that</p>
<div class="math notranslate nohighlight">
\[ f_{i,i+1}(x) = \frac{ k_i(x - x_{i+1})^3 - k_{i+1}(x - x_i)^3 }{6(x_i-x_{i+1})} + A(x - x_{i+1}) - B(x - x_i),\]</div>
<p>for arbitrary constants <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> also differentiates twice to our desired expression for <span class="math notranslate nohighlight">\( f''_{i,i+1}(x)\)</span>.</p>
<p>So, along with the <span class="math notranslate nohighlight">\(k_i\)</span>’s being unknown at this stage, we also have two arbitrary constants on integration left to find: <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> (and note there is a different set of these for every interval <span class="math notranslate nohighlight">\(i=0,\ldots, n-1\)</span>).</p>
<p>But we have more information to impose. The first is that the spline passes through the data:</p>
<div class="math notranslate nohighlight">
\[ y_i = f_{i,i+1}(x_i) = \frac{ k_i(x_i - x_{i+1})^3 }{6(x_i-x_{i+1})} + A(x_i - x_{i+1}), \]</div>
<p>and so rearranging</p>
<div class="math notranslate nohighlight">
\[ A = \frac{y_i}{x_i - x_{i+1}} - \frac{k_i}{6}(x_i - x_{i+1}). \]</div>
<p>Similarly</p>
<div class="math notranslate nohighlight">
\[ y_{i+1} = f_{i,i+1}(x_{i+1}) = \frac{ - k_{i+1}(x_{i+1} - x_i)^3 }{6(x_i-x_{i+1})} - B(x_{i+1} - x_i), \]</div>
<p>which rearranging yields</p>
<div class="math notranslate nohighlight">
\[ B = \frac{y_{i+1}}{x_{i} - x_{i+1}} - \frac{k_{i+1}}{6}(x_i - x_{i+1}). \]</div>
<p>Substituting these expressions for <span class="math notranslate nohighlight">\(A\)</span> and <span class="math notranslate nohighlight">\(B\)</span> back into our expression above for <span class="math notranslate nohighlight">\( f_{i,i+1}(x) \)</span> yields the following expression for the cubic spline over each subinterval:</p>
<div class="math notranslate nohighlight">
\[ f_{i,i+1}(x) = \frac{k_i}{6}\left( \frac{ (x - x_{i+1})^3 }{x_i-x_{i+1}} - (x - x_{i+1})(x_i - x_{i+1}) \right)
-  \frac{k_{i+1}}{6}\left( \frac{ (x - x_{i})^3 }{x_i-x_{i+1}} - (x - x_{i})(x_i - x_{i+1}) \right)
+ \frac{y_i(x - x_{i+1}) - y_{i+1}(x - x_{i})}{x_i - x_{i+1}}.\]</div>
<p>[See Atkinson (5.68) and Kiusalaas (3.10)].</p>
<p>This is the expression for the cubic spline we implement over each subinterval, once we know values for the curvatures at the knots at either end of the subinterval, i.e. <span class="math notranslate nohighlight">\(k_i\)</span> and <span class="math notranslate nohighlight">\(k_{i+1}\)</span>.</p>
<p>The final piece of information we have to apply to find these values is continuity of the first derivatives of the spline across the knots:</p>
<div class="math notranslate nohighlight">
\[ f'_{i-1,i}(x_i) = f'_{i,i+1}(x_i), \;\;\;\;\;\text{for}\;\;\;\;\;\; i=1, \ldots, n-1.\]</div>
<p>Substituting in our expression for <span class="math notranslate nohighlight">\(f_{i,i+1}(x)\)</span> containing only the unknowns <span class="math notranslate nohighlight">\(k\)</span>’s,
Atkinson and Kiusalaas agree that after “a great deal of simplification” we arrive at the system of linear/simultaneous equations</p>
<div class="math notranslate nohighlight">
\[(x_{i-1} - x_{i})k_{i-1} + 2(x_{i-1} - x_{i+1})k_i + (x_{i} - x_{i+1})k_{i+1} = 6\left( \frac{y_{i-1} - y_{i}}{x_{i-1} - x_{i}} - \frac{y_{i} - y_{i+1}}{x_{i} - x_{i+1}}  \right),  \;\;\;\;\;\text{for}\;\;\;\;\;\; i=1, \ldots, n-1.\]</div>
<p>We can formulate this as an <span class="math notranslate nohighlight">\(n-1\)</span> by <span class="math notranslate nohighlight">\(n-1\)</span> linear system, solve for <span class="math notranslate nohighlight">\(k_1, \ldots, k_{n-1}\)</span>, combine with the natural boundary conditions <span class="math notranslate nohighlight">\(k_0=k_n=0\)</span>, and substitute these values into our expression for <span class="math notranslate nohighlight">\(f_{i,i+1}(x)\)</span> and we are done.</p>
<p>The final step when given a new data location, <span class="math notranslate nohighlight">\(x\)</span>, to evaluate the cubic spline at is to identify which subinterval we are in, and hence which two <span class="math notranslate nohighlight">\(k\)</span> values to use. Note that if you want your code to do some extrapolation (as we did in the plots in class - we plotted over <span class="math notranslate nohighlight">\([0.4, 9.1]\)</span> even though our data we only over  <span class="math notranslate nohighlight">\([0.4, 9]\)</span>) you will need to treat data outside all subintervals as a special case.</p>
</section>
<section id="solution-cubic-spline-interpolation">
<h3>Solution - Cubic spline interpolation<a class="headerlink" href="#solution-cubic-spline-interpolation" title="Permalink to this heading">#</a></h3>
<p>Let’s first see what SciPy’s implementation gives us.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is the cell and the corresponding plots we are trying to recreate.</span>

<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">])</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>

<span class="c1"># use SciPy to compute the cubic spline</span>
<span class="n">Pcs</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">CubicSpline</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">9.1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Scipy actually formed a function Pcs for us that we need to evaluate at x to plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Pcs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cubic Spline&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">plot_raw_data</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;plot x vs y on axes ax, </span>
<span class="sd">    add axes labels and turn on grid</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="s1">&#39;ko&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;raw data&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    
    
<span class="c1"># Overlay raw data</span>
<span class="n">plot_raw_data</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cubic spline approximation to our data&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/00cf848b6c6f4b7c6d8727877326a722c80a5a51929df40e5f54dbfa17dbaa7a.png" src="../_images/00cf848b6c6f4b7c6d8727877326a722c80a5a51929df40e5f54dbfa17dbaa7a.png" />
</div>
</div>
<p>Write some functions to compute and then evaluate the cubic spline.</p>
<p>Note you could either solve the <span class="math notranslate nohighlight">\(n-1\)</span> by <span class="math notranslate nohighlight">\(n-1\)</span> tridiagonal system derived above and then add in the two natural BCs, or as here you can just formulate an <span class="math notranslate nohighlight">\(n+1\)</span> by <span class="math notranslate nohighlight">\(n+1\)</span> and add in the two additional equations <span class="math notranslate nohighlight">\(k_0=0\)</span> and <span class="math notranslate nohighlight">\(k_n=0\)</span> in the first and last row.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">cubic_spline_k</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the second derivative values of the spline at the data location.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi, yi : array_like</span>
<span class="sd">        The N+1 data points (i = 0, 1, ..., N)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    k : ndarray</span>
<span class="sd">        Second derivative values of the spline at data locations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># we have n+1 data points </span>
    <span class="c1"># form the tridiagonal matrix for the k&#39;s</span>
    <span class="n">del_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="c1"># same as xi[1:] - xi[:-1]</span>
    <span class="n">del_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">yi</span><span class="p">)</span>
    <span class="n">Amat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">RHS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">main_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">lower_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">upper_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="n">main_diag</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">del_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">del_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">main_diag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">main_diag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">lower_diag</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">del_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">lower_diag</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">upper_diag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">del_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">upper_diag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">Amat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">lower_diag</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">main_diag</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">upper_diag</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  
    <span class="n">RHS</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">6.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">del_y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">/</span><span class="n">del_x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">del_y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">del_x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">RHS</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="c1"># solve the linear system - see L3 for details</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Amat</span><span class="p">,</span> <span class="n">RHS</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>

<span class="c1"># This is a little test to check our result with a solution from Kiusalaas</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Test (Kiusalaas Ex. 3.7): &#39;</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">cubic_spline_k</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])),</span> \
                           <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.</span><span class="p">,</span><span class="o">-</span><span class="mf">30.</span><span class="o">/</span><span class="mf">7.</span><span class="p">,</span><span class="mf">36.</span><span class="o">/</span><span class="mf">7.</span><span class="p">,</span><span class="o">-</span><span class="mf">30.</span><span class="o">/</span><span class="mf">7.</span><span class="p">,</span><span class="mf">0.</span><span class="p">])))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Test (Kiusalaas Ex. 3.7):  True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">evaluate_cubic_spline</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="n">xx</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Construct the cubic spline passing through the points (xi,yi)</span>
<span class="sd">    with natural boundary conditions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    xi, yi : array_like</span>
<span class="sd">        The N+1 data points (i = 0, 1, ..., N)</span>
<span class="sd">    xx : array_like</span>
<span class="sd">        Array of x-locations the spline is evaluated at</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    yy : ndarray</span>
<span class="sd">        The evaluation of the cubic spline at the locations in xx.</span>
<span class="sd">    &quot;&quot;&quot;</span> 
    <span class="n">k</span> <span class="o">=</span> <span class="n">cubic_spline_k</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">)</span>
    <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span>
    <span class="c1"># we have two options here, we could loop over the intervals and find and evaluate all xx locations </span>
    <span class="c1"># within it, or instead loop over the xx values and for each find the interval. The former will likely</span>
    <span class="c1"># be more efficient, but the second perhaps simpler to understand and code - let&#39;s do the second!</span>
    <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">xx</span><span class="p">):</span>
        <span class="c1"># first find the interval this x lies within</span>
        <span class="c1"># first two conditionals here allow us to extrapolate</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">xi</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="n">xi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;=</span><span class="n">xi</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># actually evaluate the cubic</span>
        <span class="n">yy</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="n">h</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mf">6.0</span> \
               <span class="o">-</span> <span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="n">h</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">6.0</span> \
               <span class="o">+</span> <span class="p">(</span><span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">yi</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xi</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="n">h</span>
    <span class="k">return</span> <span class="n">yy</span>

<span class="c1"># Now see if this recreates the figures obtained using SciPy</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">])</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Plot our cubic spline</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">evaluate_cubic_spline</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">yi</span><span class="p">,</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cubic Spline&#39;</span><span class="p">)</span>

<span class="c1"># Overlay raw data</span>
<span class="n">plot_raw_data</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cubic spline approximation to our data&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9b119ab637b96827a8a8232cced3cede39201496852a15f7fd9c59ff67046dc4.png" src="../_images/9b119ab637b96827a8a8232cced3cede39201496852a15f7fd9c59ff67046dc4.png" />
</div>
</div>
<p>If you look closely (at the end points) you will see that this doesn’t quite agree with what we have from SciPy, but with a bit of thought and looking at the SciPy docs we see that the <em>natural</em> BC is not the default. We can ask SciPy to apply this BC instead and re-plot to show an identical result in the eyeball norm.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">9.0</span><span class="p">])</span>
<span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>

<span class="c1"># use SciPy to compute the cubic spline</span>
<span class="n">Pcs</span> <span class="o">=</span> <span class="n">si</span><span class="o">.</span><span class="n">CubicSpline</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">bc_type</span><span class="o">=</span><span class="s1">&#39;natural&#39;</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">9.3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Plot SciPy spline</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Pcs</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cubic Spline&#39;</span><span class="p">)</span>

<span class="c1"># Overlay raw data</span>
<span class="n">plot_raw_data</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">,</span> <span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cubic spline approximation to our data&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9b119ab637b96827a8a8232cced3cede39201496852a15f7fd9c59ff67046dc4.png" src="../_images/9b119ab637b96827a8a8232cced3cede39201496852a15f7fd9c59ff67046dc4.png" />
</div>
</div>
</section>
</section>
<section id="homework-implement-weddle-s-rule">
<h2>Homework - Implement Weddle’s rule<a class="headerlink" href="#homework-implement-weddle-s-rule" title="Permalink to this heading">#</a></h2>
<p>As explained in the lecture, we can implement Weddle’s rule using appropriate calls to the <code class="docutils literal notranslate"><span class="pre">simpsons_composite_rule</span></code> function.</p>
<p>Do this and try to recreate the convergence plot from the lecture:</p>
<img src="./figures/weddle_convergence.png" width=500x>
<section id="solution-implement-weddle-s-rule">
<h3>Solution - Implement Weddle’s rule<a class="headerlink" href="#solution-implement-weddle-s-rule" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">composite_simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to evaluate the composite Simpson&#39;s rule only using</span>
<span class="sd">    function evaluations at (number_intervals + 1) points.</span>
<span class="sd">    </span>
<span class="sd">    This implementation requires that the number of subintervals (number_intervals) be even</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">number_intervals</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;number_intervals is not even&quot;</span>

    <span class="n">interval_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_intervals</span>
    <span class="c1"># start with the two end member values</span>
    <span class="n">I_cS2</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">function</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="c1"># add in those terms with a coefficient of 4</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">I_cS2</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">interval_size</span><span class="p">)</span>

    <span class="c1"># and those terms with a coefficient of 2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">I_cS2</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">interval_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">I_cS2</span> <span class="o">*</span> <span class="p">(</span><span class="n">interval_size</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">weddles_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to evaluate Weddle&#39;s quadrature rule using</span>
<span class="sd">    appropriate calls to the composite_simpson function</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">composite_simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">S2</span> <span class="o">=</span> <span class="n">composite_simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="n">S2</span> <span class="o">-</span> <span class="n">S</span><span class="p">)</span><span class="o">/</span><span class="mf">15.</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function we wish to integrate&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Now let&#39;s test the Weddle&#39;s rule function.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The exact area found by direct integration = 2&quot;</span><span class="p">)</span>
<span class="n">interval_sizes_W</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">errors_W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">interval_sizes_W</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_sizes_W</span><span class="p">):</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">weddles_rule</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">errors_W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">area</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Area </span><span class="si">{0:&lt;4d}</span><span class="s1"> interval(s), </span><span class="si">{1:&lt;4d}</span><span class="s1"> function evaluations for Weddle = </span><span class="si">{2:.16f}</span><span class="s1"> (error = </span><span class="si">{3:.16e}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">number_intervals</span><span class="p">,</span> <span class="p">((</span><span class="n">number_intervals</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">number_intervals</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">area</span><span class="p">,</span> <span class="n">errors_W</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">interval_sizes_W</span><span class="p">,</span> <span class="n">errors_W</span><span class="p">,</span> <span class="s1">&#39;go-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Weddle&#39;</span><span class="p">)</span>
<span class="c1"># need to run the other quadrature rules to allow the following 3 lines</span>
<span class="c1">#ax1.loglog(interval_sizes_S, errors_S, &#39;ro-&#39;, lw=2, label=&#39;Simpson&#39;)</span>
<span class="c1">#ax1.loglog(interval_sizes_T, errors_T, &#39;bo-&#39;, lw=2, label=&#39;Trapezoidal&#39;)</span>
<span class="c1">#ax1.loglog(interval_sizes_M, errors_M, &#39;ko-&#39;, lw=2, label=&#39;Midpoint&#39;)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;log(number_intervals)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Quadrature rule convergence&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># need to run the other quadrature rules to allow the following 2 lines</span>
<span class="c1">#annotation.slope_marker((5e1, 1e-4), (-2, 1), invert=True, ax=ax1, size_frac=0.15, pad_frac=0.05)</span>
<span class="c1">#annotation.slope_marker((5e1, 5e-9), (-4, 1), invert=True, ax=ax1, size_frac=0.15, pad_frac=0.05)</span>
<span class="n">annotation</span><span class="o">.</span><span class="n">slope_marker</span><span class="p">((</span><span class="mf">5e1</span><span class="p">,</span> <span class="mf">8e-13</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">size_frac</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span> <span class="n">pad_frac</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

<span class="c1"># this generates the image seen in lecture</span>
<span class="c1">#fig.savefig(&#39;weddle_convergence.png&#39;, dpi=600, format=&#39;png&#39;, facecolor=&#39;w&#39;, edgecolor=&#39;w&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The exact area found by direct integration = 2
Area 2    interval(s), 8    function evaluations for Weddle = 1.9985707318238357 (error = 1.4292681761642889e-03)
Area 4    interval(s), 14   function evaluations for Weddle = 1.9999831309459859 (error = 1.6869054014101437e-05)
Area 8    interval(s), 26   function evaluations for Weddle = 1.9999997524545721 (error = 2.4754542793381518e-07)
Area 16   interval(s), 50   function evaluations for Weddle = 1.9999999961908446 (error = 3.8091554355190738e-09)
Area 32   interval(s), 98   function evaluations for Weddle = 1.9999999999407072 (error = 5.9292792897736035e-11)
Area 100  interval(s), 302  function evaluations for Weddle = 1.9999999999999376 (error = 6.2394533983933798e-14)
Area 1000 interval(s), 3002 function evaluations for Weddle = 1.9999999999999991 (error = 8.8817841970012523e-16)
</pre></div>
</div>
<img alt="../_images/2023750138334ac297e7f4a2da57435ca199248c091426d0c1d7f8fe8398cb2f.png" src="../_images/2023750138334ac297e7f4a2da57435ca199248c091426d0c1d7f8fe8398cb2f.png" />
</div>
</div>
<div class="optional">
</section>
</section>
<section id="homework-midpoint-rule-error-star">
<h2>Homework - Midpoint rule error [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#homework-midpoint-rule-error-star" title="Permalink to this heading">#</a></h2>
<p>In class we stated that a bound on the midpoint rule’s error is given by</p>
<div class="math notranslate nohighlight">
\[ \left| E_M^n \right| \le \frac{(b-a)^3}{24n^2}  \max_{x\in[a,b]}\, \left| f''(x) \right|. \]</div>
<p>And we noted that for midpoint (and all odd order Newton-Cotes rules including Simpson’s rule) we gain an order of precision/accuracy over what we might expect, i.e. here this error bound indicates that the method is second-order accurate
and integrates linear polynomials exactly.</p>
<p>If we follow the error bound derivation we performed in lecture for the Trapezoidal rule, we would progress by
taking <span class="math notranslate nohighlight">\(N=0\)</span> (as the midpoint rule is fitting a constant, degree zero, function) and using our Lagrange remainder result to estimate the <em>interpolation error</em> over the interval <span class="math notranslate nohighlight">\([a,b]\)</span> as:</p>
<div class="math notranslate nohighlight">
\[R_0(x) = \left(x - \frac{1}{2}(a+b)\right) {f'(c_x)}.\]</div>
<p>Our Midpoint rule quadrature error over a single interval <span class="math notranslate nohighlight">\([a,b]\)</span> could then be estimated via</p>
<p>\begin{align*}
E_M \equiv E_0 = I - I_0
&amp;= \int_{a}^{b} f\left ( x \right ), dx - \int_a^b,P_0\left ( x \right ),dx \[5pt]
&amp;= \int_{a}^{b} f\left ( x \right ) - P_0\left ( x \right ) , dx\[5pt]
&amp;= \int_{a}^{b} R_0\left ( x \right ), dx.
\end{align*}</p>
<p>Substitute in the above expression for <span class="math notranslate nohighlight">\(R_0(x)\)</span> and demonstrate that this leading order term in the error expansion is indeed zero.</p>
<p>Once you’ve convinced yourself of this I suggest take a look at my derivation of the error bound in the sample solution which involves taking the next order term in the Taylor series expansion about the midpoint of an interval.</p>
</div><section id="solution-midpoint-rule-error">
<h3>Solution - Midpoint rule error<a class="headerlink" href="#solution-midpoint-rule-error" title="Permalink to this heading">#</a></h3>
<p>If we start the error bound derivation for the midpoint rule as we did for the Trapezoidal scheme then we would begin by taking <span class="math notranslate nohighlight">\(N=0\)</span> and using our Lagrange remainder result to estimate the interpolation error over the interval <span class="math notranslate nohighlight">\([a,b]\)</span> as:</p>
<div class="math notranslate nohighlight">
\[R_0(x) = \left(x - \frac{1}{2}(a+b)\right) {f'(c_x)}.\]</div>
<p>But we encounter a problem if we progress as for the Trapezoidal scheme and integrate this to find the quadrature error</p>
<p>\begin{align*}
E_M \equiv E_0
&amp; = \int_a^b \left(x - \frac{1}{2}(a+b)\right) {f’(c_x)} ,dx \[5pt]
&amp; = {f’(c_x)}  \int_a^b \left(x - \frac{1}{2}(a+b)\right) ,dx \[5pt]
&amp; = {f’(c_x)}  \left[\frac{1}{2}x^2 - \frac{(a+b)}{2}x \right]_a^b\[5pt]
&amp; = {f’(c_x)}  \left[ \frac{1}{2}b^2 - \frac{(a+b)}{2}b -  \frac{1}{2}a^2 + \frac{(a+b)}{2}a \right]\[5pt]
&amp; = {f’(c_x)}  \left[ \frac{1}{2}b^2 - \frac{ab}{2} - \frac{b^2}{2} -  \frac{1}{2}a^2 + \frac{a^2}{2} + \frac{ab}{2} \right]\[5pt]
&amp; = 0
\end{align*}</p>
<p>The error isn’t actually zero, just the leading order term we considered based upon the Lagrange remainder, when integrated, is zero. This just tells us that the error is one order higher than we might expect (reinforcing what we saw in the lectures). Recall that we noted something similar for Simpson’s rule, and it turns out to be true that we gain an extra order of accuracy with all Newton-Cotes rules based upon fitting an even degree polynomial.</p>
<p>So actually what we need to do to estimate the error is to consider the next term in the Taylor series expansion.</p>
<p>If you’re feeling brave you could also attempt this using a Taylor series about the midpoint: <span class="math notranslate nohighlight">\(c:=(a+b)/2\)</span></p>
<div class="math notranslate nohighlight">
\[f(x) = f(c) + (x-c)f'(c) + \frac{1}{2!}(x-c)^2f''(c) + \frac{1}{3!}(x-c)^3f'''(c) + \ldots\]</div>
<p>and integrating the second term to show that</p>
<div class="math notranslate nohighlight">
\[\int_{a}^{b}  \frac{1}{2!}(x-c)^2\,f''(c)  \, dx = \frac{(b-a)^3 }{24}\, f''(c).\]</div>
<p>We need more terms in the Taylor series expansion; for the Midpoint rule it make sense to expand the Taylor series about the midpoint: <span class="math notranslate nohighlight">\(c:=(a+b)/2\)</span></p>
<div class="math notranslate nohighlight">
\[f(x) = f(c) + (x-c)f'(c) + \frac{1}{2!}(x-c)^2f''(c) + \frac{1}{3!}(x-c)^3f'''(c) + \ldots\]</div>
<p>In which case, as the polynomial <span class="math notranslate nohighlight">\(P_0\left ( x \right )\)</span> in this case is constant and equal to <span class="math notranslate nohighlight">\(f(c)\)</span>, we have</p>
<p>\begin{align*}
E_M<br />
&amp;= \int_{a}^{b} f\left ( x \right ), dx - \int_a^b,P_0\left ( x \right ),dx \[5pt]
&amp;= \int_{a}^{b} f\left ( x \right ) - f(c) , dx\[5pt]
&amp;= \int_{a}^{b}  \left( (x-c),f’(c) + \frac{1}{2!}(x-c)^2,f’’(c) + h.o.t \right)  , dx,
\end{align*}</p>
<p>now the first term we know from above integrates to zero, <span class="math notranslate nohighlight">\(h.o.t.\)</span> refers to higher order terms we can ignore with some care, and provided the <span class="math notranslate nohighlight">\(f''\)</span> term doesn’t also integrate to zero, which we will now check.</p>
<p>The second order term integrates as follows:</p>
<p>\begin{align*}
E_M<br />
&amp;\approx \int_{a}^{b}  \frac{1}{2!}(x-c)^2,f’’(c)  , dx \[5pt]
&amp;= \frac{f’’(c)}{2}\int_{a}^{b} (x-c)^2 , dx \[5pt]
&amp;= \frac{f’’(c)}{2} \left[ \frac{1}{3}(x-c)^3 \right]_a^b \[5pt]
&amp;= \frac{f’’(c)}{6} \left[ (b-c)^3 - (a-c)^3 \right] \[5pt]
&amp;= \frac{f’’(c)}{6} \left[ \left( \frac{1}{2}(b-a) \right)^3 - \left( \frac{1}{2}(a-b) \right)^3 \right] \[5pt]
&amp;= \frac{f’’(c)}{48} \left[ (b-a)^3 - (a-b)^3 \right] \[5pt]
&amp;= \frac{f’’(c)}{48} \left[ (b-a)^3 + (b-a)^3 \right] \[5pt]
&amp;= \frac{(b-a)^3 }{24}, f’’(c)
\end{align*}</p>
<p>To account for the potential contributions of the h.o.t. terms we ignored, the Lagrange remainder theorem tells us we just need to evaluate the function (derivative) at some location within the interval we are considering, i.e. we have</p>
<div class="math notranslate nohighlight">
\[E_M = \frac{(b-a)^3 }{24}\, f''(c_x),\]</div>
<p>where <span class="math notranslate nohighlight">\(c_x\)</span> is <em>some</em> value/point within the interval.</p>
<p>Note that this is exactly a factor <span class="math notranslate nohighlight">\(-\frac{1}{2}\)</span> the single interval error for the Trapezoidal rule derived in the lecture.</p>
<p>The composite Midpoint rule error follows just as for the Trapezoidal rule, applying above to an interval of size <span class="math notranslate nohighlight">\(\Delta x\)</span> and summing up over <span class="math notranslate nohighlight">\(n\)</span> intervals to yield</p>
<div class="math notranslate nohighlight">
\[ \left| E_M^n \right| \le \frac{(b-a)^3}{24n^2}  \max_{x\in[a,b]}\, \left| f''(x) \right|. \]</div>
<div class="advanced">
</section>
</section>
<section id="homework-derive-simpson-s-rule-as-quadratic-fit-star-star">
<h2>Homework - Derive Simpson’s rule as quadratic fit [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#homework-derive-simpson-s-rule-as-quadratic-fit-star-star" title="Permalink to this heading">#</a></h2>
<p>We stated in the lecture that:</p>
<p>Note that an alternate derivation of the same rule involves fitting a <em>quadratic function</em> (i.e. <span class="math notranslate nohighlight">\(P_2(x)\)</span> rather than the constant and linear approximations already considered) that interpolates the integral at the two end points of the interval, <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>, as well as at the midpoint, <span class="math notranslate nohighlight">\(c = \left ( a+b\right )/2\)</span>, and calculating the integral under that polynomial approximation. We’ll come back to this idea a bit later.</p>
<p>Take a look also at the Newton-Cotes section of the lecture where we derived the Trapezoidal rule with the choice <span class="math notranslate nohighlight">\(N=1\)</span>. We arrive at Simpson’s (1/3) rule if we repeat this process with <span class="math notranslate nohighlight">\(N=2\)</span>.</p>
<p>Do this.</p>
<br>
<p><strong>Hint:</strong> Note that following the derivation of the Trapezoidal rule from lectures you will need to evaluate integrals of the form</p>
<p>\begin{align*}
A_0 &amp;= \int_{x_0}^{x_2}, \ell_0(x), dx \[5pt]
&amp; = \frac{1}{(x_0-x_1)(x_0-x_2)}\int_{x_0}^{x_2}, (x-x_1)(x - x_2) , dx.
\end{align*}</p>
<p>This integral is much easier to do if you introduce the new variable (i.e. a <a class="reference external" href="https://en.wikipedia.org/wiki/Integration_by_substitution">change of variables</a>) <span class="math notranslate nohighlight">\(\xi\)</span> such that <span class="math notranslate nohighlight">\(d\xi = dx\)</span> and <span class="math notranslate nohighlight">\(\xi=0\)</span> corresponds to <span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(\xi = -h\)</span> corresponds to <span class="math notranslate nohighlight">\(x_0\)</span> and <span class="math notranslate nohighlight">\(\xi = h\)</span> corresponds to <span class="math notranslate nohighlight">\(x_2\)</span>. Note therefore that the interval size <span class="math notranslate nohighlight">\(x_2-x_0 = 2h\)</span>.</p>
<p>Your integral then becomes</p>
<p>\begin{align*}
A_0 &amp; = \frac{1}{(x_0-x_1)(x_0-x_2)}\int_{x_0}^{x_2}, (x-x_1)(x - x_2) , dx \[5pt]
&amp; = \frac{1}{(-h)(-2h)}\int_{-h}^{h}, \xi(\xi - h) , d\xi = \ldots = \frac{h}{3}.
\end{align*}</p>
<p>Fill in the gaps and do the other integrals to complete the derivation.</p>
</div><section id="solution-derive-simpson-s-rule-as-quadratic-fit">
<h3>Solution - Derive Simpson’s rule as quadratic fit<a class="headerlink" href="#solution-derive-simpson-s-rule-as-quadratic-fit" title="Permalink to this heading">#</a></h3>
<p>Consider the case <span class="math notranslate nohighlight">\(N=2\)</span> where we have data at two end points of an interval <span class="math notranslate nohighlight">\([a,b]\)</span> as well as the midpoint <span class="math notranslate nohighlight">\(c := \left ( a+b\right )/2\)</span>. To simplify the terminology below call these three points <span class="math notranslate nohighlight">\(x_0\)</span>, <span class="math notranslate nohighlight">\(x_1\)</span> and <span class="math notranslate nohighlight">\(x_2\)</span>, with <span class="math notranslate nohighlight">\(x_1\)</span> the midpoint <span class="math notranslate nohighlight">\(c\)</span>.</p>
<p>The three Lagrange basis functions in this case are</p>
<p>\begin{align*}
\ell_0(x) &amp;= \frac{(x-x_1)(x - x_2)}{(x_0-x_1)(x_0-x_2)}, \[5pt]
\ell_1(x) &amp;= \frac{(x-x_0)(x - x_2)}{(x_1-x_0)(x_1-x_2)}, \[5pt]
\ell_2(x) &amp;= \frac{(x-x_0)(x - x_1)}{(x_2-x_0)(x_2-x_1)}.
\end{align*}</p>
<p>The integral of the first of these is</p>
<p>\begin{align*}
A_0 &amp;= \int_{x_0}^{x_2}, \ell_0(x), dx \[5pt]
&amp; = \frac{1}{(x_0-x_1)(x_0-x_2)}\int_{x_0}^{x_2}, (x-x_1)(x - x_2) , dx.
\end{align*}</p>
<p>This integral is much easier to do if we introduce the new variable (i.e. a <a class="reference external" href="https://en.wikipedia.org/wiki/Integration_by_substitution">change of variables</a>) <span class="math notranslate nohighlight">\(\xi\)</span> such that <span class="math notranslate nohighlight">\(d\xi = dx\)</span> and <span class="math notranslate nohighlight">\(\xi=0\)</span> corresponds to <span class="math notranslate nohighlight">\(x_1\)</span>, <span class="math notranslate nohighlight">\(\xi = -h\)</span> corresponds to <span class="math notranslate nohighlight">\(x_0\)</span> and <span class="math notranslate nohighlight">\(\xi = h\)</span> corresponds to <span class="math notranslate nohighlight">\(x_2\)</span>. Note therefore that the interval size <span class="math notranslate nohighlight">\(x_2-x_0 = 2h\)</span>.</p>
<p>Our integral now becomes</p>
<p>\begin{align*}
A_0 &amp; = \frac{1}{(x_0-x_1)(x_0-x_2)}\int_{x_0}^{x_2}, (x-x_1)(x - x_2) , dx \[5pt]
&amp; = \frac{1}{(-h)(-2h)}\int_{-h}^{h}, \xi(\xi - h) , d\xi
\[5pt]
&amp; = \frac{1}{2h^2}\left[\frac{\xi^3}{3} - h \frac{\xi^2}{2}\right]_{-h}^{h}
\[5pt]
&amp; = \frac{1}{2h^2}\left[\frac{h^3}{3} - h \frac{h^2}{2} - \frac{(-h)^3}{3} + h \frac{(-h)^2}{2}   \right] \[5pt]
&amp; = \frac{1}{2h^2}\left[\frac{h^3}{3} - \frac{h^3}{2} + \frac{h^3}{3} +  \frac{h^3}{2}   \right]
\[5pt]
&amp; = \frac{1}{2h^2}2\frac{h^3}{3} \[5pt]
&amp; = \frac{h}{3}.
\end{align*}</p>
<p>Similarly,</p>
<p>\begin{align*}
A_1 &amp;= \int_{x_0}^{x_2}, \ell_1(x), dx \[5pt]
&amp; = \int_{x_0}^{x_2}, \frac{(x-x_0)(x - x_2)}{(x_1 - x_0)(x_1-x_2)}  , d\xi \[5pt]
&amp; = \frac{1}{(x_1-x_0)(x_1-x_2)}\int_{x_0}^{x_2}, (\xi + h)(\xi - h) , d\xi\[5pt]
&amp; = \frac{1}{(h)(-h)}\int_{-h}^{h}, \xi^2 - h^2 , d\xi
\[5pt]
&amp; = \frac{1}{-h^2}\left[\frac{\xi^3}{3} - h^2 \xi\right]_{-h}^{h}
\[5pt]
&amp; = \frac{1}{-h^2}\left[\frac{h^3}{3} - h^2 h - \frac{(-h)^3}{3} + h^2(-h) \right] \[5pt]
&amp; = \frac{1}{-h^2}\left[\frac{h^3}{3} - h^3 + \frac{h^3}{3} - h^3 \right] \[5pt]
&amp; = \frac{1}{-h^2}\frac{-4h^3}{3} \[5pt]
&amp; = \frac{4h}{3}.
\end{align*}</p>
<p>And finally</p>
<p>\begin{align*}
A_2 &amp;= \int_{x_0}^{x_2}, \ell_2(x), dx \[5pt]
&amp; = \int_{x_0}^{x_2}, \frac{(x-x_0)(x - x_1)}{(x_2-x_0)(x_2-x_1)}  , dx \[5pt]
&amp; = \frac{1}{(x_2-x_0)(x_2-x_1)}\int_{x_0}^{x_2}, (\xi + h)\xi ,d\xi \[5pt]
&amp; = \frac{1}{(2h)(h)}\int_{-h}^{h}, \xi^2 + h\xi , d\xi
\[5pt]
&amp; = \frac{1}{2h^2}\left[\frac{\xi^3}{3} + h \frac{\xi^2}{2}\right]_{-h}^{h}
\[5pt]
&amp; = \frac{1}{2h^2}\left[\frac{h^3}{3} + h \frac{h^2}{2} - \frac{(-h)^3}{3} -  h \frac{(-h)^2}{2} \right] \[5pt]
&amp; = \frac{1}{2h^2}\left[\frac{h^3}{3} +  \frac{h^3}{2} + \frac{h^3}{3} - \frac{h^3}{2} \right] \[5pt]
&amp; = \frac{1}{2h^2}\frac{2h^3}{3} \[5pt]
&amp; = \frac{h}{3}.
\end{align*}</p>
<p>Therefore,
\begin{align*}
I \approx \sum_{i=0}^{2}, A_i , f(x_i)
&amp;= A_0 f(a) + A_1 f\left( \frac{a+b}{2} \right) + A_2 f(b) \[5pt]
&amp;=  \frac{h}{3} \left( f(a) + 4 f\left( \frac{a+b}{2} \right) + f(b)  \right)\[5pt]
&amp;=  \frac{(b-a)}{6} \left( f(a) + 4 f\left( \frac{a+b}{2} \right) + f(b)  \right)
\end{align*}</p>
<p>which is Simpson’s rule we derived in another way in the lecture.</p>
<div class="advanced">
</section>
</section>
<section id="homework-open-vs-closed-newton-cotes-star-star">
<h2>Homework - Open vs closed Newton-Cotes [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#homework-open-vs-closed-newton-cotes-star-star" title="Permalink to this heading">#</a></h2>
<p>Implement an open Newton-Cotes formula and use it to integrate <span class="math notranslate nohighlight">\(1/\sqrt{x}\)</span>  from 0 to 1.</p>
<p><strong>Hint:</strong> Check the open formulae here <a class="reference external" href="https://en.wikipedia.org/wiki/Newton%E2%80%93Cotes_formulas#Open_Newton%E2%80%93Cotes_formulas">https://en.wikipedia.org/wiki/Newton–Cotes_formulas#Open_Newton–Cotes_formulas</a>.  My solution makes use of  Milne’s rule which evaluates the function at the appropriate points within each sub-interval, and so uses more function evaluations for a given number of intervals compared to the composite version of Simpson’s rule.</p>
<p>Compare your solution with a closed scheme such as Simpson’s, e.g. by recreating a convergence plot such as that presented in the Lecture.</p>
<p><strong>Hint:</strong>  Note that to avoid divide by zero warning you could define your integrand via something like:
<code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">1./(np.maximum(1e-16,np.sqrt(x)))</span></code></p>
</div><section id="solution-open-vs-closed-newton-cotes">
<h3>Solution - Open vs closed Newton-Cotes<a class="headerlink" href="#solution-open-vs-closed-newton-cotes" title="Permalink to this heading">#</a></h3>
<p>The integral of <span class="math notranslate nohighlight">\(1/\sqrt{x}\)</span> is <span class="math notranslate nohighlight">\(2\sqrt{x}\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span>
<span class="n">sympy</span><span class="o">.</span><span class="n">init_printing</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Math</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">sympy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">sympy</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">Math</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\int f(x)\,dx =&#39;</span><span class="p">))</span> 
<span class="n">display</span><span class="p">(</span><span class="n">sympy</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[\displaystyle \int f(x)\,dx =\]</div>
<img alt="../_images/e3af3a76056ab4cc06456559dedfaf9f2b822ba7f0259e369dc96479450ed702.png" src="../_images/e3af3a76056ab4cc06456559dedfaf9f2b822ba7f0259e369dc96479450ed702.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># So the exact definite integral over [0,1] is</span>
<span class="nb">print</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> 
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">composite_simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to evaluate the composite Simpson&#39;s rule only using</span>
<span class="sd">    function evaluations at (number_intervals + 1) points.</span>
<span class="sd">    </span>
<span class="sd">    This implementation requires that the number of subintervals (number_intervals) be even</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">number_intervals</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;number_intervals is not even&quot;</span>

    <span class="n">interval_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">/</span> <span class="n">number_intervals</span>
    <span class="c1"># start with the two end member values</span>
    <span class="n">I_cS2</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="n">function</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

    <span class="c1"># add in those terms with a coefficient of 4</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">I_cS2</span> <span class="o">+=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">interval_size</span><span class="p">)</span>

    <span class="c1"># and those terms with a coefficient of 2</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">I_cS2</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">interval_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">I_cS2</span> <span class="o">*</span> <span class="p">(</span><span class="n">interval_size</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span>


<span class="c1"># compute and store the integrals computed using Simpsons rule</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">intervals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)]</span>
<span class="n">areas_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ints</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
    <span class="n">areas_S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">composite_simpsons_rule</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">1e-16</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="n">ints</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ints</span><span class="p">,</span> <span class="n">areas_S</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2 2617993877991495.0
4 1308996938995748.5
8 654498469497875.6
16 327249234748938.9
32 163624617374470.6
64 81812308687236.55
128 40906154343619.484
256 20453077171810.992
512 10226538585906.74
1024 5113269292954.62
2048 2556634646478.571
4096 1278317323240.5457
8192 639158661621.5356
16384 319579330812.0328
32768 159789665407.28152
65536 79894832704.90709
131072 39947416353.72048
262144 19973708178.1274
524288 9986854090.331163
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">milnes_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Our implementation of Milne&#39;s rule, </span>
<span class="sd">    using 3 function evaluations within each subinterval</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">interval_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">number_intervals</span>

    <span class="k">assert</span> <span class="n">interval_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">number_intervals</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span>

    <span class="n">I_Milne</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_intervals</span><span class="p">):</span>
        <span class="n">this_bin_start</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">interval_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">this_bin_1</span> <span class="o">=</span> <span class="n">this_bin_start</span> <span class="o">+</span> <span class="mf">1.</span><span class="o">*</span><span class="n">interval_size</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">this_bin_2</span> <span class="o">=</span> <span class="n">this_bin_start</span> <span class="o">+</span> <span class="mf">2.</span><span class="o">*</span><span class="n">interval_size</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">this_bin_3</span> <span class="o">=</span> <span class="n">this_bin_start</span> <span class="o">+</span> <span class="mf">3.</span><span class="o">*</span><span class="n">interval_size</span><span class="o">/</span><span class="mf">4.</span>
        <span class="n">I_Milne</span> <span class="o">+=</span> <span class="p">(</span><span class="n">interval_size</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">this_bin_1</span><span class="p">)</span> <span class="o">-</span>
                                         <span class="n">function</span><span class="p">(</span><span class="n">this_bin_2</span><span class="p">)</span> <span class="o">+</span> 
                                         <span class="mi">2</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">this_bin_3</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">I_Milne</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compute and store the integrals computed using Simpsons rule</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">intervals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">)]</span>
<span class="n">areas_Milne</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">intervals</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ints</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">intervals</span><span class="p">):</span>
    <span class="n">areas_Milne</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span><span class="n">milnes_rule</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">1e-16</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">))),</span> <span class="n">ints</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">ints</span><span class="p">,</span> <span class="n">areas_Milne</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>   
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2 1.739342016376355
4 1.8156666424532315
8 1.8696552456080366
16 1.9078322513952648
32 1.934827554363889
64 1.9539161213941882
128 1.9674137769125688
256 1.9769580606802521
512 1.983706888455231
1024 1.988479030340063
2048 1.991853444227608
4096 1.994239515170033
8192 1.995926722113802
16384 1.9971197575850272
32768 1.997963361056898
65536 1.99855987879252
131072 1.9989816805284122
262144 1.9992799393962486
524288 1.9994908402641889
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the errors</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">areas_S</span><span class="p">),</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Simpson (closed)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">intervals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mf">2.</span> <span class="o">-</span> <span class="n">areas_Milne</span><span class="p">),</span> <span class="s1">&#39;ko-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Milne (open)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;log(number_intervals)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Quadrature rule convergence&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># add a triangle to indicate the line slope</span>
<span class="n">annotation</span><span class="o">.</span><span class="n">slope_marker</span><span class="p">((</span><span class="mf">2e3</span><span class="p">,</span> <span class="mf">5e-3</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">invert</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">size_frac</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">pad_frac</span><span class="o">=</span><span class="mf">0.05</span><span class="p">);</span>

<span class="c1"># save figure to use in lecture</span>
<span class="c1">#fig.savefig(&#39;open_vs_closed_newton_cotes.png&#39;, dpi=600, format=&#39;png&#39;, facecolor=&#39;w&#39;, edgecolor=&#39;w&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/56ff8e4a7b7a17e8a51338645fc2d22de63e20230c9293d7ab5eeb38ad57dd1d.png" src="../_images/56ff8e4a7b7a17e8a51338645fc2d22de63e20230c9293d7ab5eeb38ad57dd1d.png" />
</div>
</div>
<div class="optional">
</section>
</section>
<section id="homework-implement-adaptive-quadrature-star">
<h2>Homework - Implement adaptive quadrature [<span class="math notranslate nohighlight">\(\star\)</span>]<a class="headerlink" href="#homework-implement-adaptive-quadrature-star" title="Permalink to this heading">#</a></h2>
<p>Based on the algorithm description from the lecture, try to implement an adaptive quadrature algorithm and apply it to our complicated function given in the following cell.</p>
<br>
<p><strong>Hint:</strong>  My function and an explanatory docstring starts</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adaptive_simpson_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; S is a Simpson rule estimate of the integral over interval [a,b]</span>
<span class="sd">    This function computes S2 by splitting the current interval in half </span>
<span class="sd">    and evaluating Simpson&#39;s rule over each of the two resulting sub-intervals. </span>
<span class="sd">    It then evaluates an estimate of the quadrature error over the interval as </span>
<span class="sd">    (S2-S)/15, and if we have not yet reached the desired error tolerance it </span>
<span class="sd">    divides the current interval [a,b] in two and applies the same function to </span>
<span class="sd">    each half: [a,c] and [c,b]. </span>
<span class="sd">    If an error tolerance has been reached it returns the Weddle estimate for</span>
<span class="sd">    the integral over [a,b]: S2 + (S2 - S)/15.0.</span>
<span class="sd">    The function recursively sums the result from each subinterval considered. </span>
<span class="sd">    `locs&#39; is a global variable that contains all the locations we evaluate the</span>
<span class="sd">    function at.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>
</div>
<br>
<p><strong>I’ve listed this as optional rather than advanced as I think it’s a good one to work through, but it is quite involved and could easily have been tagged as “advanced”.</strong></p>
<p><strong>Note that you should NOT assume I’ve done this as I’m planning on this being part of the assessment - it will NOT be.</strong></p>
</div><div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># a more complex example (taken from Moin which quotes the exact integral as −0.56681975015)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function we wish to integrate.</span>
<span class="sd">    </span>
<span class="sd">    This a more complicated example which has been taken from the book by Moin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">-</span>
            <span class="p">(</span><span class="mf">0.01</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">))</span> <span class="o">+</span>
            <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># exact solution obtained with (si.quad(f, -1, 1, epsabs=1e-16))</span>
<span class="c1"># NB. the &quot;exact&quot; value given in Moin only to 11 s.f.s: −0.56681975015</span>
<span class="n">I_exact</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5668197501529302</span>
</pre></div>
</div>
</div>
</div>
<section id="solution-implement-adaptive-quadrature">
<h3>Solution - Implement adaptive quadrature<a class="headerlink" href="#solution-implement-adaptive-quadrature" title="Permalink to this heading">#</a></h3>
<p>We’ll implement the method using our Simpson’s rule function, and write a recursive function.</p>
<p>Note that we can either base this on a call to the composite Simpson’s rule function with two intervals, or our first Simpson’s rule implementation with one interval (note that implementation evaluated the function at the midpoint, <span class="math notranslate nohighlight">\(c = (a+b)/2\)</span>).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to evaluate Simpson&#39;s rule. </span>
<span class="sd">    </span>
<span class="sd">    Note that this implementation takes the function as an argument, </span>
<span class="sd">    and evaluates this at the midpoint of subintervals, hence additional </span>
<span class="sd">    information is generated through additional function evaluations. </span>
<span class="sd">    </span>
<span class="sd">    This is different to the function/implementation available with Scipy  </span>
<span class="sd">    where discrete data only is passed to the function. </span>
<span class="sd">    </span>
<span class="sd">    Bear this in mind when comparing results - there will be a factor of two</span>
<span class="sd">    in the definition of &quot;n&quot; we need to be careful about!</span>
<span class="sd">    </span>
<span class="sd">    Also that this version of the function performs redundant function evaluations -</span>
<span class="sd">    see the composite implementation below.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">interval_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">number_intervals</span>

    <span class="k">assert</span> <span class="n">interval_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">number_intervals</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span>

    <span class="n">I_S</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="c1"># Loop to valuate Simpson&#39;s formula over each interval </span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_intervals</span><span class="p">):</span>
        <span class="c1"># Find a, c, and b</span>
        <span class="n">this_bin_start</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">interval_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">this_bin_mid</span> <span class="o">=</span> <span class="n">this_bin_start</span> <span class="o">+</span> <span class="n">interval_size</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">this_bin_end</span> <span class="o">=</span> <span class="n">this_bin_start</span> <span class="o">+</span> <span class="n">interval_size</span>
        <span class="c1"># Calculate the rule and add to running total.</span>
        <span class="n">I_S</span> <span class="o">+=</span> <span class="p">(</span><span class="n">interval_size</span><span class="o">/</span><span class="mi">6</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">function</span><span class="p">(</span><span class="n">this_bin_start</span><span class="p">)</span> <span class="o">+</span>
                                  <span class="mi">4</span> <span class="o">*</span> <span class="n">function</span><span class="p">(</span><span class="n">this_bin_mid</span><span class="p">)</span> <span class="o">+</span> <span class="n">function</span><span class="p">(</span><span class="n">this_bin_end</span><span class="p">))</span>

    <span class="c1"># Return our running total result</span>
    <span class="k">return</span> <span class="n">I_S</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adaptive_simpson_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; S is a Simpson rule estimate of the integral over interval [a,b]</span>
<span class="sd">    This function computes S2 by splitting the current interval in half </span>
<span class="sd">    and evaluating Simpson&#39;s rule over each of the two resulting sub-intervals. </span>
<span class="sd">    It then evaluates an estimate of the quadrature error over the interval as </span>
<span class="sd">    (S2-S)/15, and if we have not yet reached the desired error tolerance it </span>
<span class="sd">    divides the current interval [a,b] in two and applies the same function to </span>
<span class="sd">    each half: [a,c] and [c,b]. </span>
<span class="sd">    If an error tolerance has been reached it returns the Weddle estimate for</span>
<span class="sd">    the integral over [a,b]: S2 + (S2 - S)/15.0.</span>
<span class="sd">    The function recursively sums the result from each subinterval considered. </span>
<span class="sd">    `locs&#39; is a global variable that contains all the locations we evaluate the</span>
<span class="sd">    function at.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">locs</span>
    <span class="c1"># the midpoint of the current interval</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">locs</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
    <span class="c1"># compute S over each half of the current interval to provide S2</span>
    <span class="n">Sa</span> <span class="o">=</span> <span class="n">simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">Sb</span> <span class="o">=</span> <span class="n">simpsons_rule</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">S2</span> <span class="o">=</span> <span class="n">Sa</span> <span class="o">+</span> <span class="n">Sb</span>
    <span class="n">error</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">S2</span> <span class="o">-</span> <span class="n">S</span><span class="p">)</span> <span class="o">/</span> <span class="mf">15.0</span>
    <span class="k">if</span> <span class="n">error</span> <span class="o">&lt;=</span> <span class="n">tol</span><span class="p">:</span>
        <span class="c1"># we have reached our error tolerance so return our best estimate of the</span>
        <span class="c1"># integral, in this case this is the Weddle estimate given by</span>
        <span class="k">return</span> <span class="n">S2</span> <span class="o">+</span> <span class="p">(</span><span class="n">S2</span> <span class="o">-</span> <span class="n">S</span><span class="p">)</span><span class="o">/</span><span class="mf">15.0</span>
    <span class="k">return</span> <span class="n">adaptive_simpson_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">tol</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Sa</span><span class="p">)</span> <span class="o">+</span> <span class="n">adaptive_simpson_recursive</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">tol</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">Sb</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">adaptive_simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">tol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the integral of function from a to b to a tolerance of tol.</span>
<span class="sd">    `locs&#39; is a global variable that contains all the locations we evaluate the</span>
<span class="sd">    function at.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">locs</span>
    <span class="c1"># initialise locs with points a and b as we will evaluate the function there.</span>
    <span class="c1"># In subsequent calls to adaptive_simpson_recursive &#39;locs&#39; will be appended with the</span>
    <span class="c1"># midpoints of all the sub-intervals considered as the function is additionally</span>
    <span class="c1"># evaluated at these locations.</span>
    <span class="n">locs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">adaptive_simpson_recursive</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">simpsons_rule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">locs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function we wish to integrate&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># let&#39;s test on our example from above</span>

<span class="n">I</span><span class="p">,</span> <span class="n">locs</span> <span class="o">=</span> <span class="n">adaptive_simpsons_rule</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mf">1.e-4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;estimate of integral: </span><span class="si">{:.16f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with function evaluations at: &#39;</span><span class="p">,</span> <span class="n">locs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>estimate of integral: 1.9999997524545721
with function evaluations at:  [0.         3.14159265 1.57079633 0.78539816 0.39269908 1.17809725
 2.35619449 1.96349541 2.74889357]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot where we evaluated function</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function we wish to integrate&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># Get the value of pi from numpy and generate equally spaced values from 0 to pi.</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Label axis.</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;sin(x)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adaptive quadrature applied to a simple function&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Overlay a grid.</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


<span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">loc</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">loc</span><span class="p">,</span> <span class="n">loc</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">loc</span><span class="p">)],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    
<span class="c1">#fig.savefig(&#39;adaptive_quadrature_simple_example.png&#39;, dpi=600, format=&#39;png&#39;, facecolor=&#39;w&#39;, edgecolor=&#39;w&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b96092744526cd9f579ed3aa7eed22f6664bf17500fcb1662f97be4ed9604192.png" src="../_images/b96092744526cd9f579ed3aa7eed22f6664bf17500fcb1662f97be4ed9604192.png" />
</div>
</div>
<p>It’s pretty clear for this example that adaptive quadrature (based on Simpson’s rule) is not going to beat Simpson’s rule applied on equally spaced intervals.</p>
<p>But the story should be different for a more complex function with some regions of rapid variation, and other with more sedate variation - let’s see an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># a more complex example (taken from Moin which quotes the exact integral as −0.56681975015)</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function we wish to integrate.</span>
<span class="sd">    </span>
<span class="sd">    This a more complicated example which has been taken from the book by Moin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">-</span>
            <span class="p">(</span><span class="mf">0.01</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">))</span> <span class="o">+</span>
            <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>

<span class="n">I</span><span class="p">,</span> <span class="n">locs</span> <span class="o">=</span> <span class="n">adaptive_simpsons_rule</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="mf">1.e-3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;estimate of integral: </span><span class="si">{:.16f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">I</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Label axis.</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adaptive quadrature applied to a complex function&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>


<span class="c1"># Overlay a grid.</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">locs</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">loc</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ko&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">loc</span><span class="p">,</span> <span class="n">loc</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">loc</span><span class="p">)],</span> <span class="s1">&#39;k--&#39;</span><span class="p">)</span>
    
<span class="c1">#fig.savefig(&#39;adaptive_quadrature_example.png&#39;, dpi=600, format=&#39;png&#39;, facecolor=&#39;w&#39;, edgecolor=&#39;w&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>estimate of integral: -0.5668253232143081
</pre></div>
</div>
<img alt="../_images/f612da25717f0d3c7079848a8e3afede431be0d5b8b395fcca700df9be70f339.png" src="../_images/f612da25717f0d3c7079848a8e3afede431be0d5b8b395fcca700df9be70f339.png" />
</div>
</div>
<p>Let’s compare errors vs number of function evaluations</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># exact solution obtained with (si.quad(f, -1, 1, epsabs=1e-16))</span>
<span class="c1"># NB. the &quot;exact&quot; value given in Moin only to 11 s.f.s: −0.56681975015</span>
<span class="n">I_exact</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5668197501529302</span>

<span class="c1"># compute errors for composite Simpson with different numbers of intervals</span>
<span class="n">interval_sizes_S</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">4096</span><span class="p">,</span> <span class="mi">8192</span><span class="p">,</span> <span class="mi">16384</span><span class="p">]</span>
<span class="c1"># function evaluations</span>
<span class="n">N_S</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">errors_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">composite_simpsons_rule</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">errors_S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">I_exact</span><span class="p">)</span>


<span class="c1"># compute errors with Weddle different numbers of intervals</span>
<span class="n">interval_sizes_W</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">4096</span><span class="p">]</span>
<span class="c1"># function evaluations</span>
<span class="n">N_W</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interval_sizes_W</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interval_sizes_W</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">errors_W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">interval_sizes_W</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_sizes_W</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">weddles_rule</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">errors_W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">I_exact</span><span class="p">)</span>


<span class="c1"># compute errors for adaptive Simpson with different error tolerances</span>
<span class="n">tols</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.e-1</span><span class="p">,</span> <span class="mf">1.e-2</span><span class="p">,</span> <span class="mf">1.e-3</span><span class="p">,</span> <span class="mf">1.e-4</span><span class="p">,</span> <span class="mf">1.e-5</span><span class="p">,</span> <span class="mf">1.e-6</span><span class="p">,</span>
        <span class="mf">1.e-7</span><span class="p">,</span> <span class="mf">1.e-8</span><span class="p">,</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="mf">1e-10</span><span class="p">,</span> <span class="mf">1e-11</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">]</span>
<span class="n">errors_AS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="n">N_AS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">tols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tols</span><span class="p">):</span>
    <span class="n">I</span><span class="p">,</span> <span class="n">locs</span> <span class="o">=</span> <span class="n">adaptive_simpsons_rule</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">tol</span><span class="p">)</span>
    <span class="n">errors_AS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">I_exact</span><span class="p">)</span>
    <span class="n">N_AS</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">locs</span><span class="p">)</span>


<span class="c1"># Romberg values from running the code below with different error tolerances</span>
<span class="n">errors_R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.02460476877415807</span><span class="p">,</span> <span class="mf">0.0008145743266728678</span><span class="p">,</span> <span class="mf">6.502735143276706e-05</span><span class="p">,</span>
                     <span class="mf">1.4018870156951024e-06</span><span class="p">,</span> <span class="mf">3.703290563095152e-09</span><span class="p">,</span> <span class="mf">5.242806189187377e-12</span><span class="p">,</span> <span class="mf">9.880984919163893e-15</span><span class="p">])</span>
<span class="n">N_R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">65</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">257</span><span class="p">,</span> <span class="mi">513</span><span class="p">,</span> <span class="mi">1025</span><span class="p">,</span> <span class="mi">2049</span><span class="p">,</span> <span class="mi">4097</span><span class="p">])</span>
<span class="c1"># The Romberg code:</span>
<span class="c1">## Note we have to increase the maximum order of extrapolation by</span>
<span class="c1">## increasing divmax from the default value of 10, otherwise we get a warning.</span>
<span class="c1">#I_R = si.romberg(f, -1, 1, show=True, divmax=13, rtol=1.e-12, tol=1.e-12)</span>
<span class="c1">#print(&#39;\nError = {:.16f}&#39;.format(np.abs(I_R - I_exact)))</span>

<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_S</span><span class="p">,</span> <span class="n">errors_S</span><span class="p">,</span> <span class="s1">&#39;ko-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Simpson&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_W</span><span class="p">,</span> <span class="n">errors_W</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Weddle&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_AS</span><span class="p">,</span> <span class="n">errors_AS</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Adaptive Simpson&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_R</span><span class="p">,</span> <span class="n">errors_R</span><span class="p">,</span> <span class="s1">&#39;go-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Romberg&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;log(function evaluations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1">#fig.savefig(&#39;compare_quad_methods_complex_function.png&#39;, dpi=600, format=&#39;png&#39;, facecolor=&#39;w&#39;, edgecolor=&#39;w&#39;)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1e71f6cee48&gt;
</pre></div>
</div>
<img alt="../_images/94f838108fb7e17a06f8384081913e80f326232f895d4b774f29b45ddd945f80.png" src="../_images/94f838108fb7e17a06f8384081913e80f326232f895d4b774f29b45ddd945f80.png" />
</div>
</div>
<p>Let’s see how Romberg integration gets on with this complex example (NB. we don’t expect it to do that well given Weddle wasn’t obviously better than Simpson’s rule).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Note we have to increase the maximum order of extrapolation by</span>
<span class="c1"># increasing divmax from the default value of 10, otherwise we get a warning.</span>
<span class="n">I_R</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">romberg</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">divmax</span><span class="o">=</span><span class="mi">13</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1.e-12</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1.e-12</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Error = </span><span class="si">{:.16f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">I_R</span> <span class="o">-</span> <span class="n">I_exact</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Romberg integration of &lt;function vectorize1.&lt;locals&gt;.vfunc at 0x000001E720E5D730&gt; from [-1, 1]

 Steps  StepSize   Results
     1  2.000000 -0.044283 
     2  1.000000  9.938018 13.265451 
     4  0.500000 -0.035986 -3.360654 -4.469061 
     8  0.250000 -0.102750 -0.125005  0.090705  0.163082 
    16  0.125000 -0.221047 -0.260479 -0.269511 -0.275229 -0.276948 
    32  0.062500 -0.370618 -0.420474 -0.431141 -0.433706 -0.434328 -0.434482 
    64  0.031250 -0.492005 -0.532467 -0.539933 -0.541660 -0.542083 -0.542189 -0.542215 
   128  0.015625 -0.546681 -0.564907 -0.567070 -0.567500 -0.567602 -0.567627 -0.567633 -0.567634 
   256  0.007812 -0.561746 -0.566767 -0.566891 -0.566888 -0.566886 -0.566885 -0.566885 -0.566885 -0.566885 
   512  0.003906 -0.565549 -0.566817 -0.566820 -0.566819 -0.566818 -0.566818 -0.566818 -0.566818 -0.566818 -0.566818 
  1024  0.001953 -0.566502 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 
  2048  0.000977 -0.566740 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 
  4096  0.000488 -0.566800 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 
  8192  0.000244 -0.566815 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 -0.566820 

The final result is -0.5668197501529307 after 8193 function evaluations.

Error = 0.0000000000000006
</pre></div>
</div>
</div>
</div>
<div class="advanced">
</section>
</section>
<section id="homework-implement-a-composite-version-of-gauss-legendre-quadrature-star-star">
<h2>Homework - Implement a “composite” version of Gauss-Legendre quadrature [<span class="math notranslate nohighlight">\(\star\star\)</span>]<a class="headerlink" href="#homework-implement-a-composite-version-of-gauss-legendre-quadrature-star-star" title="Permalink to this heading">#</a></h2>
<p>Implement a “composite” version of Gauss-Legendre, i.e. split up the total interval into sub-intervals, apply Gauss-Legendre on each subinterval and sum.</p>
<p>Compare this method, for differing degrees, against the composite Simpson rule for our <span class="math notranslate nohighlight">\(\sin\)</span> and more complex function we considered in lecture.</p>
</div><section id="solution-implement-a-composite-version-of-gauss-legendre-quadrature">
<h3>Solution - Implement a “composite” version of Gauss-Legendre quadrature<a class="headerlink" href="#solution-implement-a-composite-version-of-gauss-legendre-quadrature" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># code from the lecture</span>
<span class="k">def</span> <span class="nf">gauss_legendre</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">5</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to evaluate Gauss Legendre quadrature</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># compute the Gauss-Legendre nodes and weights</span>
    <span class="n">xi</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">polynomial</span><span class="o">.</span><span class="n">legendre</span><span class="o">.</span><span class="n">leggauss</span><span class="p">(</span><span class="n">degree</span><span class="p">)</span>

    <span class="c1"># Translate the node locations from the interval [-1, 1] to [a, b]</span>
    <span class="n">x</span> <span class="o">=</span>  <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">xi</span>
 
    <span class="k">return</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">w</span> <span class="o">*</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># and a new function which calls above over each subinterval</span>
<span class="k">def</span> <span class="nf">composite_gauss_legendre</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">number_intervals</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; A composite version of Gauss-Legendre</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interval_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">b</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span><span class="o">/</span><span class="n">number_intervals</span>

    <span class="k">assert</span> <span class="n">interval_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">number_intervals</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span>

    <span class="n">I_cgl</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">number_intervals</span><span class="p">):</span>
        <span class="n">this_bin_start</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">interval_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span>
        <span class="n">this_bin_end</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">interval_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">I_cgl_this_interval</span> <span class="o">=</span> <span class="n">gauss_legendre</span><span class="p">(</span><span class="n">this_bin_start</span><span class="p">,</span> <span class="n">this_bin_end</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">degree</span><span class="p">)</span>
        <span class="n">I_cgl</span> <span class="o">+=</span> <span class="n">I_cgl_this_interval</span>
    <span class="k">return</span> <span class="n">I_cgl</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># test on the simple function from class</span>

<span class="c1"># you should play around with &quot;degree&quot; to see what happens</span>
<span class="c1"># you also need to make sure you get the formula for the number</span>
<span class="c1"># of function evaluations (in N_cgl below) correct otherwise it</span>
<span class="c1"># will be an unfair comparison</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function we wish to integrate&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># compute errors for composite Gauss-Legendre with different numbers of intervals</span>
<span class="n">degree</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">interval_sizes_cgl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">]</span>
<span class="c1"># function evaluations</span>
<span class="n">N_cgl</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interval_sizes_cgl</span><span class="p">))</span><span class="o">*</span><span class="n">degree</span> <span class="c1"># number of func evals = degree per interval</span>
<span class="n">errors_cgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">interval_sizes_cgl</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_sizes_cgl</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">composite_gauss_legendre</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">errors_cgl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span>

<span class="c1"># compute errors for composite Simpson with different numbers of intervals</span>
<span class="n">interval_sizes_S</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">]</span>
<span class="c1"># function evaluations</span>
<span class="n">N_S</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">errors_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">composite_simpsons_rule</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">errors_S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span>
    
<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_cgl</span><span class="p">,</span> <span class="n">errors_cgl</span><span class="p">,</span> <span class="s1">&#39;ko-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;composite G-L&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_S</span><span class="p">,</span> <span class="n">errors_S</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;composite S&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;log(function evaluations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison between composite Simpson and composite Gauss-Legendre quadrature&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1e720e6ff60&gt;
</pre></div>
</div>
<img alt="../_images/60c83bcc6b0e98cd41b2b5c3793a2e6804f57855eb9529cad50a892b27c21e57.png" src="../_images/60c83bcc6b0e98cd41b2b5c3793a2e6804f57855eb9529cad50a892b27c21e57.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># repeat for our more complex function</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The function we wish to integrate.</span>
<span class="sd">    </span>
<span class="sd">    This a more complicated example which has been taken from the book by Moin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">50</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">-</span>
            <span class="p">(</span><span class="mf">0.01</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">))</span> <span class="o">+</span>
            <span class="mi">5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">x</span><span class="p">))</span>

<span class="c1"># exact solution obtained with (si.quad(f, -1, 1, epsabs=1e-16))</span>
<span class="c1"># NB. the &quot;exact&quot; value given in Moin only to 11 s.f.s: −0.56681975015</span>
<span class="n">I_exact</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5668197501529302</span>

<span class="c1"># compute errors for composite Gauss-Legendre with different numbers of intervals</span>
<span class="n">degree</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">interval_sizes_cgl</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">4096</span><span class="p">]</span>
<span class="c1"># function evaluations</span>
<span class="n">N_cgl</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interval_sizes_cgl</span><span class="p">))</span><span class="o">*</span><span class="n">degree</span> <span class="c1"># number of func evals = degree per interval</span>
<span class="n">errors_cgl</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">interval_sizes_cgl</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_sizes_cgl</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">composite_gauss_legendre</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">degree</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">errors_cgl</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">I_exact</span><span class="p">)</span>

<span class="c1"># compute errors for composite Simpson with different numbers of intervals</span>
<span class="n">interval_sizes_S</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">1024</span><span class="p">,</span> <span class="mi">2048</span><span class="p">,</span> <span class="mi">4096</span><span class="p">,</span> <span class="mi">8192</span><span class="p">,</span> <span class="mi">16384</span><span class="p">]</span>
<span class="c1"># function evaluations</span>
<span class="n">N_S</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
<span class="n">errors_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">interval_sizes_S</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">composite_simpsons_rule</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">number_intervals</span><span class="p">)</span>
    <span class="n">errors_S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">I</span><span class="o">-</span><span class="n">I_exact</span><span class="p">)</span>
    
<span class="c1"># plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_cgl</span><span class="p">,</span> <span class="n">errors_cgl</span><span class="p">,</span> <span class="s1">&#39;ko-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;composite G-L&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">N_S</span><span class="p">,</span> <span class="n">errors_S</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;composite S&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;log(function evaluations)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;log(error)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Comparison between composite Simpson and composite Gauss-Legendre quadrature&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1e71f4f8470&gt;
</pre></div>
</div>
<img alt="../_images/2d9b8f5503d63951017a6810fc5191adf1db16d6d88f92a082906773281ed742.png" src="../_images/2d9b8f5503d63951017a6810fc5191adf1db16d6d88f92a082906773281ed742.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter9"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Homework.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Homework <a class="tocSkip"></p>
      </div>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Imperial College London
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>