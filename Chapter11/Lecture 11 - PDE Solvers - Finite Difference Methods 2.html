

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>11.1 PDE Solvers: Finite Difference Methods 2 &#8212; Modelling and Numerical Methods</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter11/Lecture 11 - PDE Solvers - Finite Difference Methods 2';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Homework" href="Homework.html" />
    <link rel="prev" title="11. PDE Solvers: Finite Difference Methods 2" href="intro.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Modelling and Numerical Methods
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Analytical Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter1/intro.html">1. Intro to Vector/Tensor Calculus</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.1%20-%20Intro%20to%20Vectors.html">1.1 Continuum Mechanics and Vector Calculus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.2%20-%20Vector%20Transformations.html">1.2 Vector Transformations  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/Lecture%201.3%20-%20Intro%20to%20Tensors.html">1.3 Intro to Tensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/exercises.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter1/solutions.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter2/intro.html">2 Stress and Tensors</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/Lecture%202%20-%20Stress%20and%20Tensors.html">2.1 Stress and Tensors  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/exercises2.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter2/solutions2.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter3/intro.html">3. Kinematics and Strain</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/Lecture%203%20-%20Kinematics.html">3.1 Kinematics   <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/exercises3.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter3/solutions3.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter4/intro.html">4. Conservation Equations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Lecture%204.1%20-%20Conservation%20Equations.html">4.1 Conservation Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/Lecture%204.2%20-%20Rheology.html">4.2 Rheology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/exercises4.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter4/solutions4.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter5/intro.html">5. Dimensional Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter5/Lecture%205%20-%20Dimensions%20and%20Dimensional%20Analysis.html">5.1 Dimensions and Dimensional Analysis  <a class="tocSkip"></a></a></li>





<li class="toctree-l2"><a class="reference internal" href="../Chapter5/Worksheet.html">Worksheet  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter5/Solutions.html">Solutions  <a class="tocSkip"></a></a></li>

</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Numerical Solutions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter6/intro.html">6. Potential Flow</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/Lecture%206%20-%20Potential%20Flow.html">6.1 Potential Flow  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/Worksheet.html">Worksheet  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter6/Solutions.html">Solutions  <a class="tocSkip"></a></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter7/intro.html">7. Navier-Stokes</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/Lecture%207.1%20-%20Navier-Stokes.html">7.1 Solving Navier-Stokes Numerically</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter7/SolversIntro.html">Solvers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter8/intro.html">8. Turbulence and Non-Newtonian Flows</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Lecture%208.1%20-%20Turbulent%20and%20Non-Newtonian%20Flows.html">8.1 Turbulent and Non-Newtonian Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter8/Solutions.html">Solutions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Numerical Techniques</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter9/intro.html">9. Interpolation Quadrature 2</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter9/Lecture%209.1%20-%20interpolation%20quadrature.html">9.1 Interpolation &amp; Quadrature 2 <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter9/Homework.html">Homework <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter9/Solutions.html">Solutions <a class="tocSkip"></a></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter10/intro.html">10. ODE Solvers 2</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter10/Lecture%2010.1%20-%20ODE%20Solver.html">10.1 ODE solvers 2 <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter10/Homework.html">Homework <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter10/Solutions.html">Solutions <a class="tocSkip"></a></a></li>

</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="intro.html">11. PDE Solvers: Finite Difference Methods 2</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-11"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">11.1 PDE Solvers: Finite Difference Methods 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="Homework.html">Homework <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="Solutions.html">Solutions <a class="tocSkip"></a></a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Chapter12/intro.html">12. Finite Element Methods</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-12"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Chapter12/Lecture%2012.1%20-%20FEM.html">12.1 Finite Element Methods <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter12/Homework.html">Homework <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../Chapter12/Solutions.html">Solutions <a class="tocSkip"></a></a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FChapter11/Lecture 11 - PDE Solvers - Finite Difference Methods 2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Chapter11/Lecture 11 - PDE Solvers - Finite Difference Methods 2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>11.1 PDE Solvers: Finite Difference Methods 2</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning objectives:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-differences-review">Finite differences - review</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-forward-difference">The forward difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-backward-difference">The backward difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-central-difference">The central difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#taylor-series-to-estimate-accuracy">Taylor series to estimate accuracy</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-difference">Forward difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-difference">Backward difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#central-difference">Central difference</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-approximation-of-second-and-higher-order-derivatives">Finite difference approximation of second (and higher order) derivatives</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-method-of-undetermined-coefficients-star">The method of undetermined coefficients [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advection-diffusion-a-very-important-model-problem">Advection-diffusion: a very important model problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-non-dimensionalisation">Problem non-dimensionalisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-steady-state-advection-diffusion-problem-a-bvp">The steady-state advection-diffusion problem (a BVP)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-grid-or-mesh">Defining a grid (or mesh)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discretising-using-a-three-point-stencil-and-central-differences-for-advection-and-diffusion">Discretising using a three-point stencil and central differences for advection and diffusion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-dirichlet-boundary-conditions">Dealing with Dirichlet boundary conditions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-fluxes-star">Discrete fluxes [<span class="math notranslate nohighlight">\(\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#stability">Stability</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upwind-for-advection">Upwind for advection</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-upwind-scheme-star">Analysis of the upwind scheme [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practicalities">Practicalities!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monotonicity">Monotonicity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-uniform-and-adaptive-meshes-star-star">Non-uniform (and adaptive) meshes [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-transformations-star-star">Coordinate transformations [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-an-ocean-domain-star-star">An example - an ocean domain [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-theory-star-star">1D theory  [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#choice-of-stretching-function-star-star">Choice of stretching function [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-star-star">Implementation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimisation-star-star">Optimisation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comments">Comments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-time-dependent-unsteady-advection-diffusion-problem">The time-dependent (unsteady) advection-diffusion problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretising-in-space">Discretising in space</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#including-dirichlet-boundary-conditions">Including Dirichlet boundary conditions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-semi-discretised-system">The (semi-) discretised system</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-semi-disrete-matrix-system">The semi-disrete matrix system</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretising-in-time">Discretising in time</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-euler">Forward Euler</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-advection-diffusion-of-a-gaussian">Example - advection-diffusion of a Gaussian</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#periodic-boundaries">Periodic boundaries</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Comments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Stability</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-peclet-number">Cell Peclet number</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-courant-number-and-the-cfl-condition">The Courant number and the CFL condition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cfl-condition-a-physical-interpretation">The CFL condition - a physical interpretation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-r-number-parameter-for-diffusion">The r-number/parameter for diffusion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-time-stepping-options">Other time stepping options</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-analysis-of-the-continuous-system-star-star">Fourier analysis of the continuous system [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observations-exercises">Observations / exercises</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis">Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eigenvalue-stability-analysis-of-the-semi-discrete-system">Eigenvalue (stability) analysis of the semi-discrete system</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Observations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-criterion-for-diffusion-star">Stability criterion for diffusion [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-criterion-for-advection-star">Stability criterion for advection [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-summary">Stability summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-study-for-advection-diffusion">Stability study for advection-diffusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#von-neumann-fourier-stability-analysis-star-star">Von Neumann / Fourier stability analysis [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aside-the-wave-number-on-a-discrete-mesh">Aside - the wave number on a discrete mesh</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-nyquist-limit-star-star">The Nyquist limit [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-advection-with-central-differences-star-star">Stability analysis - advection with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Comments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-diffusion-with-central-differences-star-star">Stability analysis - diffusion with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Comments</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-advection-with-upwind-differences-star-star">Stability analysis - advection with upwind differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="pde-solvers-finite-difference-methods-2">
<h1><a class="toc-backref" href="#id11" role="doc-backlink">11.1 PDE Solvers: Finite Difference Methods 2</a><a class="headerlink" href="#pde-solvers-finite-difference-methods-2" title="Permalink to this heading">#</a></h1>
<p>Lecture 11.1
Matt Piggott</p>
<section id="table-of-contents">
<h2><a class="toc-backref" href="#id12" role="doc-backlink">Table of Contents</a><a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#pde-solvers-finite-difference-methods-2" id="id11">11.1 PDE Solvers: Finite Difference Methods 2</a></p>
<ul>
<li><p><a class="reference internal" href="#table-of-contents" id="id12">Table of Contents</a></p></li>
<li><p><a class="reference internal" href="#learning-objectives" id="id13">Learning objectives:</a></p></li>
<li><p><a class="reference internal" href="#finite-differences-review" id="id14">Finite differences - review</a></p>
<ul>
<li><p><a class="reference internal" href="#the-forward-difference" id="id15">The forward difference</a></p></li>
<li><p><a class="reference internal" href="#the-backward-difference" id="id16">The backward difference</a></p></li>
<li><p><a class="reference internal" href="#the-central-difference" id="id17">The central difference</a></p></li>
<li><p><a class="reference internal" href="#taylor-series-to-estimate-accuracy" id="id18">Taylor series to estimate accuracy</a></p>
<ul>
<li><p><a class="reference internal" href="#forward-difference" id="id19">Forward difference</a></p></li>
<li><p><a class="reference internal" href="#backward-difference" id="id20">Backward difference</a></p></li>
<li><p><a class="reference internal" href="#central-difference" id="id21">Central difference</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#finite-difference-approximation-of-second-and-higher-order-derivatives" id="id22">Finite difference approximation of second (and higher order) derivatives</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-method-of-undetermined-coefficients-star" id="id23">The method of undetermined coefficients [<span class="math notranslate nohighlight">\(\star\)</span>]</a></p></li>
<li><p><a class="reference internal" href="#advection-diffusion-a-very-important-model-problem" id="id24">Advection-diffusion: a very important model problem</a></p>
<ul>
<li><p><a class="reference internal" href="#problem-non-dimensionalisation" id="id25">Problem non-dimensionalisation</a></p></li>
<li><p><a class="reference internal" href="#the-steady-state-advection-diffusion-problem-a-bvp" id="id26">The steady-state advection-diffusion problem (a BVP)</a></p>
<ul>
<li><p><a class="reference internal" href="#defining-a-grid-or-mesh" id="id27">Defining a grid (or mesh)</a></p></li>
<li><p><a class="reference internal" href="#discretising-using-a-three-point-stencil-and-central-differences-for-advection-and-diffusion" id="id28">Discretising using a three-point stencil and central differences for advection and diffusion</a></p></li>
<li><p><a class="reference internal" href="#dealing-with-dirichlet-boundary-conditions" id="id29">Dealing with Dirichlet boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#discrete-fluxes-star" id="id30">Discrete fluxes [<span class="math notranslate nohighlight">\(\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#stability" id="id31">Stability</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#upwind-for-advection" id="id32">Upwind for advection</a></p>
<ul>
<li><p><a class="reference internal" href="#observations" id="id33">Observations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#analysis-of-the-upwind-scheme-star" id="id34">Analysis of the upwind scheme [<span class="math notranslate nohighlight">\(\star\)</span>]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#practicalities" id="id35">Practicalities!</a></p></li>
<li><p><a class="reference internal" href="#monotonicity" id="id36">Monotonicity</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#non-uniform-and-adaptive-meshes-star-star" id="id37">Non-uniform (and adaptive) meshes [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#coordinate-transformations-star-star" id="id38">Coordinate transformations [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#an-example-an-ocean-domain-star-star" id="id39">An example - an ocean domain [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#d-theory-star-star" id="id40">1D theory  [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#choice-of-stretching-function-star-star" id="id41">Choice of stretching function [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#id1" id="id42">Observations</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#implementation-star-star" id="id43">Implementation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#id2" id="id44">Observations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#optimisation-star-star" id="id45">Optimisation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#comments" id="id46">Comments</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-time-dependent-unsteady-advection-diffusion-problem" id="id47">The time-dependent (unsteady) advection-diffusion problem</a></p>
<ul>
<li><p><a class="reference internal" href="#discretising-in-space" id="id48">Discretising in space</a></p>
<ul>
<li><p><a class="reference internal" href="#including-dirichlet-boundary-conditions" id="id49">Including Dirichlet boundary conditions</a></p></li>
<li><p><a class="reference internal" href="#the-semi-discretised-system" id="id50">The (semi-) discretised system</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#the-semi-disrete-matrix-system" id="id51">The semi-disrete matrix system</a></p></li>
<li><p><a class="reference internal" href="#discretising-in-time" id="id52">Discretising in time</a></p>
<ul>
<li><p><a class="reference internal" href="#forward-euler" id="id53">Forward Euler</a></p>
<ul>
<li><p><a class="reference internal" href="#id3" id="id54">Observations</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#example-advection-diffusion-of-a-gaussian" id="id55">Example - advection-diffusion of a Gaussian</a></p>
<ul>
<li><p><a class="reference internal" href="#id4" id="id56">Observations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#periodic-boundaries" id="id57">Periodic boundaries</a></p>
<ul>
<li><p><a class="reference internal" href="#id5" id="id58">Comments</a></p></li>
</ul>
</li>
</ul>
</li>
<li><p><a class="reference internal" href="#id6" id="id59">Stability</a></p>
<ul>
<li><p><a class="reference internal" href="#cell-peclet-number" id="id60">Cell Peclet number</a></p></li>
<li><p><a class="reference internal" href="#the-courant-number-and-the-cfl-condition" id="id61">The Courant number and the CFL condition</a></p></li>
<li><p><a class="reference internal" href="#the-cfl-condition-a-physical-interpretation" id="id62">The CFL condition - a physical interpretation</a></p></li>
<li><p><a class="reference internal" href="#the-r-number-parameter-for-diffusion" id="id63">The r-number/parameter for diffusion</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#other-time-stepping-options" id="id64">Other time stepping options</a></p></li>
<li><p><a class="reference internal" href="#fourier-analysis-of-the-continuous-system-star-star" id="id65">Fourier analysis of the continuous system [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#observations-exercises" id="id66">Observations / exercises</a></p></li>
<li><p><a class="reference internal" href="#analysis" id="id67">Analysis</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#eigenvalue-stability-analysis-of-the-semi-discrete-system" id="id68">Eigenvalue (stability) analysis of the semi-discrete system</a></p>
<ul>
<li><p><a class="reference internal" href="#id7" id="id69">Observations</a></p></li>
<li><p><a class="reference internal" href="#stability-criterion-for-diffusion-star" id="id70">Stability criterion for diffusion [<span class="math notranslate nohighlight">\(\star\)</span>]</a></p></li>
<li><p><a class="reference internal" href="#stability-criterion-for-advection-star" id="id71">Stability criterion for advection [<span class="math notranslate nohighlight">\(\star\)</span>]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#stability-summary" id="id72">Stability summary</a></p></li>
<li><p><a class="reference internal" href="#stability-study-for-advection-diffusion" id="id73">Stability study for advection-diffusion</a></p></li>
<li><p><a class="reference internal" href="#von-neumann-fourier-stability-analysis-star-star" id="id74">Von Neumann / Fourier stability analysis [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p></li>
<li><p><a class="reference internal" href="#aside-the-wave-number-on-a-discrete-mesh" id="id75">Aside - the wave number on a discrete mesh</a></p>
<ul>
<li><p><a class="reference internal" href="#the-nyquist-limit-star-star" id="id76">The Nyquist limit [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#stability-analysis-advection-with-central-differences-star-star" id="id77">Stability analysis - advection with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#id8" id="id78">Comments</a></p></li>
<li><p><a class="reference internal" href="#id9" id="id79">Observations</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#stability-analysis-diffusion-with-central-differences-star-star" id="id80">Stability analysis - diffusion with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p>
<ul>
<li><p><a class="reference internal" href="#id10" id="id81">Comments</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#stability-analysis-advection-with-upwind-differences-star-star" id="id82">Stability analysis - advection with upwind differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id83">Summary</a></p></li>
</ul>
</li>
</ul>
</nav>
</section>
<section id="learning-objectives">
<h2><a class="toc-backref" href="#id13" role="doc-backlink">Learning objectives:</a><a class="headerlink" href="#learning-objectives" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>To review what we’ve seen several times already on finite difference approximations to derivatives, how to derive them and how to estimate errors.</p></li>
<li><p>To review the numerical solution of advection-diffusion problems (steady and unsteady) using upwind and central difference methods and the very distinct accuracy/stability properties of each.</p></li>
<li><p>Understand and recognise some of the issues that result from rapid (relative to the mesh resolution) variations in the solution - e.g. the presence of sharp boundary layers, and how this related to <em>stability</em>. To understand how a move away from uniform mesh resolution is one way to alleviate these issues.</p></li>
<li><p>To understand <em><strong>three key stability issues</strong></em> - where these come from and how they can be “managed”.  One of these is the <em>cell Peclet number</em> related issue from the previous lecture, while the other two relate to the time derivative and limiting the <em>speed of information propagation</em> on the discrete mesh.</p></li>
<li><p>To consider how eigenvalue analysis of the discretisation matrix can be combined with theory we saw for ODE solvers to consider stability issues for PDEs.</p></li>
</ul>
</section>
<section id="finite-differences-review">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Finite differences - review</a><a class="headerlink" href="#finite-differences-review" title="Permalink to this heading">#</a></h2>
<section id="the-forward-difference">
<h3><a class="toc-backref" href="#id15" role="doc-backlink">The forward difference</a><a class="headerlink" href="#the-forward-difference" title="Permalink to this heading">#</a></h3>
<p>We can turn the formal definition of a derivative</p>
<div class="math notranslate nohighlight">
\[f'(x_0)=\lim_{h\rightarrow 0} \frac{f(x_0+h)-f(x_0)}{h} \]</div>
<p>into an approximation rule by replacing the limit as <span class="math notranslate nohighlight">\(h\)</span> approaches zero (i.e. the <span class="math notranslate nohighlight">\(\text{lim}_{h\rightarrow\infty}\)</span>) with a small but finite <span class="math notranslate nohighlight">\(\Delta x\)</span> value:</p>
<div class="math notranslate nohighlight">
\[ f'(x_0)\approx \frac{f(x_0+\Delta x)-f(x_0)}{\Delta x},\;\;\;\; \Delta x&gt;0. \]</div>
<p>Since this approximate gradient method uses values of <span class="math notranslate nohighlight">\(x\)</span> greater than <span class="math notranslate nohighlight">\(x_0\)</span> (<span class="math notranslate nohighlight">\(\Delta x&gt;0\)</span>) to estimate the derivative at <span class="math notranslate nohighlight">\(x_0\)</span>, this approach is known as a <strong>forward difference</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Forward difference example&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$f(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="c1"># define our x for plotting purposes</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># define our example function and its exact derivative</span>

<span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>

<span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>

<span class="c1"># plot the &#39;exact&#39; solution</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># choose and plot two x locations to take the difference between</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.35</span>
<span class="n">dx</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">dx</span>
<span class="c1"># plot a line representing the discrete derivative</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">)],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Forward diff. approx. deriv.&#39;</span><span class="p">)</span>

<span class="c1"># plot a line representing the exact derivative (given by function f(.)) at x=x0 in blue</span>
<span class="c1"># choose an h purely for plotting purposes, we use the true derivative df to find the slope</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x0</span> <span class="o">-</span> <span class="n">h</span><span class="p">,</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="n">df</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">df</span><span class="p">(</span><span class="n">x0</span><span class="p">)],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Exact derivative&#39;</span><span class="p">)</span>

<span class="c1"># add some axes labels and lines etc</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">((</span><span class="n">x0</span><span class="p">,</span> <span class="n">x1</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">((</span><span class="s1">&#39;$x_0$&#39;</span><span class="p">,</span> <span class="s1">&#39;$x_0+\Delta x$&#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)],</span> <span class="s1">&#39;g:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">)],</span> <span class="s1">&#39;g:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">((</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">)))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">((</span><span class="s1">&#39;$f(x_0)$&#39;</span><span class="p">,</span> <span class="s1">&#39;$f(x_0+\Delta x)$&#39;</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">x0</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x0</span><span class="p">)],</span> <span class="s1">&#39;g:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">x1</span><span class="p">],</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">f</span><span class="p">(</span><span class="n">x1</span><span class="p">)],</span> <span class="s1">&#39;g:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4fdfc2269c06efaec3c564c306a47b6994fb4d0ab0f566659673beb91e6f835b.png" src="../_images/4fdfc2269c06efaec3c564c306a47b6994fb4d0ab0f566659673beb91e6f835b.png" />
</div>
</div>
</section>
<section id="the-backward-difference">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">The backward difference</a><a class="headerlink" href="#the-backward-difference" title="Permalink to this heading">#</a></h3>
<p>The <strong>backward difference</strong> is an equally valid approximation</p>
<div class="math notranslate nohighlight">
\[ f'(x_0)\approx \frac{f(x_0)-f(x_0-\Delta x)}{\Delta x},\qquad \Delta x&gt;0 \]</div>
</section>
<section id="the-central-difference">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">The central difference</a><a class="headerlink" href="#the-central-difference" title="Permalink to this heading">#</a></h3>
<p>Also the <strong>central difference</strong></p>
<div class="math notranslate nohighlight">
\[ f'(x_0) \approx \frac{f(x_0+\Delta x)-f(x_0-\Delta x)}{2\Delta x},\qquad \Delta x&gt;0\]</div>
</section>
<section id="taylor-series-to-estimate-accuracy">
<h3><a class="toc-backref" href="#id18" role="doc-backlink">Taylor series to estimate accuracy</a><a class="headerlink" href="#taylor-series-to-estimate-accuracy" title="Permalink to this heading">#</a></h3>
<p>Recall that it is fairly straightforward to use <a class="reference external" href="http://mathworld.wolfram.com/TaylorSeries.html">Taylor series expansion</a> to estimate the accuracy of the method.</p>
<p>The Taylor series in one dimension tells us that we can approximate the value of the function at a location in terms of its value, and value of its derivative, at a nearby point:</p>
<div class="math notranslate nohighlight">
\[
f(x_0+\Delta x) = f(x_0) + \Delta xf'(x_0) + \frac{\Delta x^2}{2!}f''(x_0) + \frac{\Delta x^3}{3!}f'''(x_0) + \mathcal{O}(\Delta x^4)
\]</div>
<br>
<section id="forward-difference">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">Forward difference</a><a class="headerlink" href="#forward-difference" title="Permalink to this heading">#</a></h4>
<p>Rearranging we find that</p>
<div class="math notranslate nohighlight">
\[ f'(x_0) = \frac{f(x_0+\Delta x)-f(x_0)}{h} + \mathcal{O}(\Delta x) \]</div>
<p>i.e. the error in the forward Euler approximation of the first derivative is</p>
<div class="math notranslate nohighlight">
\[ \left|f'(x_0) - \frac{f(x_0+\Delta x)-f(x_0)}{\Delta x}\right| = \mathcal{O}(\Delta x) \]</div>
<p>and we can include the particular for of the leading order error term:</p>
<div class="math notranslate nohighlight">
\[ f'(x_0) - \frac{f(x_0+\Delta x)-f(x_0)}{\Delta x} = - \frac{\Delta x}{2} f''(x_0) + \mathcal{O}(\Delta x^2) \]</div>
<p>The forward difference therefore represents a first-order accurate approximation to the first derivative.</p>
<br>
</section>
<section id="backward-difference">
<h4><a class="toc-backref" href="#id20" role="doc-backlink">Backward difference</a><a class="headerlink" href="#backward-difference" title="Permalink to this heading">#</a></h4>
<p>Similarly</p>
<div class="math notranslate nohighlight">
\[ f'(x_0)  - \frac{f(x_0)-f(x_0-\Delta x)}{\Delta x} = \frac{\Delta x}{2} f''(x_0) + \mathcal{O}(\Delta x^2) \]</div>
<p>The backard difference therefore also represents a first-order accurate approximation to the first derivative.</p>
<br>
</section>
<section id="central-difference">
<h4><a class="toc-backref" href="#id21" role="doc-backlink">Central difference</a><a class="headerlink" href="#central-difference" title="Permalink to this heading">#</a></h4>
<p>In contrast the central difference represents a second-order approximation:</p>
<div class="math notranslate nohighlight">
\[ \left|f'(x_0) - \frac{f(x_0+\Delta x)-f(x_0-\Delta x)}{2\Delta x}\right|  =  \mathcal{O}(\Delta x^2)\]</div>
</section>
</section>
<section id="finite-difference-approximation-of-second-and-higher-order-derivatives">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Finite difference approximation of second (and higher order) derivatives</a><a class="headerlink" href="#finite-difference-approximation-of-second-and-higher-order-derivatives" title="Permalink to this heading">#</a></h3>
<p>A finite difference approximation of a second derivative can be found by using information from three locations:</p>
<div class="math notranslate nohighlight">
\[
f''(x_0)\approx\frac{f(x_0+\Delta x)-2f(x_0)+f(x_0-\Delta x)}{\Delta x^2}
\]</div>
<p>This is a second-order approximation in the sense that</p>
<div class="math notranslate nohighlight">
\[
\left|f''(x_0) - \frac{f(x_0+\Delta x)-2f(x_0)+f(x_0-\Delta x)}{\Delta x^2}\right|  =  \mathcal{O}(\Delta x^2)
\]</div>
</section>
</section>
<section id="the-method-of-undetermined-coefficients-star">
<h2><a class="toc-backref" href="#id23" role="doc-backlink">The method of undetermined coefficients [<span class="math notranslate nohighlight">\(\star\)</span>]</a><a class="headerlink" href="#the-method-of-undetermined-coefficients-star" title="Permalink to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p>A way to formalise the derivation of numerical approximations is the <em>method of undetermined coefficients</em>.</p>
<p>We approximate the derivative in question using values of the function at neighbouring locations.</p>
<p>For example</p>
<div class="math notranslate nohighlight">
\[ f^{(n)}(x_i) \approx g(\ldots,\; f_{i-2}, \; f_{i-1}, \; f_{i}, \; f_{i+1}, \; f_{i+2}, \; \ldots), \]</div>
<p>where the <span class="math notranslate nohighlight">\(g\)</span> function indicates we are going to combine these values in some way, and we use the shorthand notation <span class="math notranslate nohighlight">\(f_i=f(x_i)\)</span>, etc.</p>
<p>The RHS of this expression will be our finite difference approximation.</p>
<p>The number of nearby function values used to calculate the derivative is called the <em>stencil width</em> or <em>stencil size</em>.</p>
<p>In general the larger the stencil, the better the approximation to the derivative.</p>
<p>The overall idea of this approach is to determine the most accurate discretisation of the derivative at <span class="math notranslate nohighlight">\(x_i\)</span> based on use of an <span class="math notranslate nohighlight">\(N\)</span>-point stencil.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p>Using this notation we can rewrite the approximation above as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
f''(x_0)\approx\frac{f(x_0+\Delta x)-2f(x_0)+f(x_0-\Delta x)}{\Delta x^2}\\
=\frac{f_{i+1} - 2f_i + f_{i-1}}{\Delta x^2}.
\end{split}\]</div>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p>For example, in the case of a second-order derivative and a three-point (symmetric or centred) stencil (and the fact that in the finite difference method we generally assume that <span class="math notranslate nohighlight">\(g\)</span> is a linear function) we have:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
f''(x_i) 
&amp; \approx g(\; f_{i-1}, \; f_{i}, \; f_{i+1}\; )\\[5pt]
&amp; = a_{-1}\;f_{i-1}+ a_0\; f_{i} + a_{1}\; f_{i+1},
\end{split}\]</div>
<p>and our job is to determine the constant coefficients <span class="math notranslate nohighlight">\(\{a_{-1},\;a_0,\;a_{1}\}\)</span>.</p>
<p>We can draw a schematic of this stencil like this</p>
<p>Note that some people call the computational stencil a computational <em>molecule</em></p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p>Using the notation <span class="math notranslate nohighlight">\(f_i = f(x_i)\)</span>, <span class="math notranslate nohighlight">\(\;f'_{i+1}=f'(x_{i+1})\)</span> etc, Taylor series tells us that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
f_{i-1} &amp;= f_i - h f'_i + \frac{h^2}{2} f''_{i} - \frac{h^3}{6!} f'''_{i} + \mathcal{O}(h^4),\\[5pt]
f_{i+1} &amp;= f_i + h f'_i + \frac{h^2}{2} f''_{i} + \frac{h^3}{6!} f'''_{i} + \mathcal{O}(h^4),
\end{split}\]</div>
<p>substituting in to <span class="math notranslate nohighlight">\(\;f''_i = a_{-1}\;f_{i-1}+ a_i\; f_{i} + a_{i+1}\; f_{i+1}\;\)</span> and collecting terms yields</p>
<div class="math notranslate nohighlight">
\[\begin{split}
f''_i &amp; = (a_{-1} + a_i + a_{i+1})\,f_i + (a_1 - a_{-1})\,h\,f'_i \\[5pt]
       &amp; \;\;\;\;\;\;\; + (a_1 + a_{-1})\,\frac{h^2}{2}\,f''_i + (a_{-1} - a_{1})\,\frac{h^3}{6}\,f'''_i + \mathcal{O}(h^4).
\end{split}\]</div>
<br>
<p>The only way we can ensure that the RHS does indeed provide an approximation to the second-order derivative that appears on the LHS is to require that the multipliers in front of the non-second-order derivative term are zero (so they drop out), and the multiplier in front of the second-order terms is one:</p>
<div class="math notranslate nohighlight">
\[ (a_{-1} + a_i + a_{i+1})=0, \;\;\;\;\;\;
(a_1 - a_{-1})\,h = 0, \;\;\;\;\;\;
(a_1 + a_{-1})\,\frac{h^2}{2} = 1. \]</div>
<p>We could write this as a <span class="math notranslate nohighlight">\(3\times 3\)</span> linear system and invert, or here it’s fairly trivial to spot that the solution to this problem is given by</p>
<div class="math notranslate nohighlight">
\[a_{-1}=\frac{1}{h^2},\;\;\;\;\;\; a_0 = -\frac{2}{h^2},\;\;\;\;\;\; a_1 = \frac{1}{h^2},\]</div>
<p>and therefore</p>
<div class="math notranslate nohighlight">
\[ f''_i = a_{-1}\;f_{i-1}+ a_i\; f_{i} + a_{i+1}\; f_{i+1} + \mathcal{O}(h^2) = \frac{f_{i+1} - 2f_i + f_{i-1}}{h^2} + \mathcal{O}(h^2).\]</div>
<p>We have thus derived the same second order accurate central difference scheme as before:</p>
<div class="math notranslate nohighlight">
\[ f''_i \approx \frac{f_{i+1} - 2f_i + f_{i-1}}{h^2}. \]</div>
<p>Note that with this approach of undetermined coefficients we can in principle compute any derivative on any stencil, e.g. a stencil which is not symmetric - such as a one-sided stencil at a boundary. For more on this see the <em>homework exercises</em>.</p>
<p>If we had started from a five point stencil for example, we would have had enough free parameters to cancel enough terms in the Taylor series analysis to result in a fourth-order accurate scheme.</p>
</div>
</section>
<section id="advection-diffusion-a-very-important-model-problem">
<h2><a class="toc-backref" href="#id24" role="doc-backlink">Advection-diffusion: a very important model problem</a><a class="headerlink" href="#advection-diffusion-a-very-important-model-problem" title="Permalink to this heading">#</a></h2>
<p>Recall the important PDE model problem of time-dependent advection-diffusion in one-dimension (1D):</p>
<div class="math notranslate nohighlight">
\[\frac{\partial c}{\partial t} + U\frac{\partial c}{\partial x} = \kappa\frac{\partial^2 c}{\partial x^2},\]</div>
<p>where <span class="math notranslate nohighlight">\(\,t\,\)</span> is time, <span class="math notranslate nohighlight">\(\,x\,\)</span> is our single space dimension. You can think of <span class="math notranslate nohighlight">\(\,c\,\)</span> as being a concentration of some quantity which is being <em>advected</em> with prescribed velocity <span class="math notranslate nohighlight">\(\,U\,\)</span>, and <em>diffused</em> with the diffusivity <span class="math notranslate nohighlight">\(\,\kappa\)</span>.</p>
<p>[<span class="math notranslate nohighlight">\(U\,\)</span> here is a scalar as we’re in one spatial dimension but ultimately we’ll be interested in the multi-dimensional case of course.]</p>
<br>
<p>with <em>initial condition</em> (this is a scalar first-order (in time) problem, as so we only need one):</p>
<div class="math notranslate nohighlight">
\[c(x,0)=c^0(x).\]</div>
<br>
<p>and <em>boundary conditions</em> (this is second-order in space and so we need two conditions, and here they are of “Dirichlet” type):</p>
<div class="math notranslate nohighlight">
\[c(0,t) = 0, \;\;\;\; c(L,t)=c_E. \]</div>
<section id="problem-non-dimensionalisation">
<h3><a class="toc-backref" href="#id25" role="doc-backlink">Problem non-dimensionalisation</a><a class="headerlink" href="#problem-non-dimensionalisation" title="Permalink to this heading">#</a></h3>
<p>This problem can be written in dimensionless form as</p>
<div class="math notranslate nohighlight">
\[\frac{\partial \hat{c}}{\partial \hat{t}} + \frac{\partial \hat{c}}{\partial \hat{x}} = \frac{1}{Pe}\frac{\partial^2 \hat{c}}{\partial \hat{x}^2},\]</div>
<p>with initial/boundary conditions</p>
<div class="math notranslate nohighlight">
\[\hat{c}(\hat{x},0) = \hat{c}^0(x), \;\;\;\; \hat{c}(0,\hat{t}) = 0, \;\;\;\; \hat{c}(1,\hat{t})=1. \]</div>
<p><span class="math notranslate nohighlight">\(Pe\)</span> is termed the Peclet number and is defined by</p>
<div class="math notranslate nohighlight">
\[Pe = \frac{UL}{\kappa},\]</div>
<p>where <span class="math notranslate nohighlight">\(L\)</span> is the length scale used to non-dimensionalise the problem.</p>
<p>Note that <span class="math notranslate nohighlight">\(\,Pe\,\)</span> is now the only parameter in our problem, which emphasises its importance both to the physics of the continuous problem as well as the discrete numerical system as we shall show.</p>
<p>When considering the problem in this non-dimensional form it is common to drop the hats.</p>
</section>
<section id="the-steady-state-advection-diffusion-problem-a-bvp">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">The steady-state advection-diffusion problem (a BVP)</a><a class="headerlink" href="#the-steady-state-advection-diffusion-problem-a-bvp" title="Permalink to this heading">#</a></h3>
<p>If we assume that our problem is indepdent of time (it is steady) then this means that advection and diffusion are balancing one another, and we are then left with the problem for <span class="math notranslate nohighlight">\(c\equiv c(x)\)</span> (we drop the <span class="math notranslate nohighlight">\(t\)</span> dependence here as we’ve stated the solution doesn’t change with time):</p>
<div class="math notranslate nohighlight">
\[\frac{\partial {c}}{\partial {x}} = \frac{1}{Pe}\frac{\partial^2 {c}}{\partial {x}^2},\]</div>
<br>
<p>The solution to this particular problem can be shown to be given by</p>
<div class="math notranslate nohighlight">
\[ c(x) = \frac{\exp\left(Pe \; x\right) - 1}{\exp(Pe) - 1}.\]</div>
<p>(In the dimensional case it would be <span class="math notranslate nohighlight">\( c(x) = c_E\frac{\exp\left(Pe \frac{x}{L}\right) - 1}{\exp(Pe) - 1}\)</span>).</p>
<br>
<p>Recall how for different values of the Peclet number the solution to this problem becomes more and more smooth (small <span class="math notranslate nohighlight">\(Pe\)</span>) or less smooth - forming a boundary layer when <span class="math notranslate nohighlight">\(Pe\)</span> is large:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$c(x)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;BVP exact solution for different values of the Peclet number ($Pe$)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">Pe</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">500</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]):</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Pe = </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Pe</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7bd9fe8021e0ec07e5264028125868d26352674f4cf2018a3d3d2f79f8c6c9ae.png" src="../_images/7bd9fe8021e0ec07e5264028125868d26352674f4cf2018a3d3d2f79f8c6c9ae.png" />
</div>
</div>
<section id="defining-a-grid-or-mesh">
<h4><a class="toc-backref" href="#id27" role="doc-backlink">Defining a grid (or mesh)</a><a class="headerlink" href="#defining-a-grid-or-mesh" title="Permalink to this heading">#</a></h4>
<p>To solve this one dimensional BVP (using a linear algebra approach) we need to convert the continuous PDE into a discrete system to solve on a finite computer.</p>
<p>To do this we first define a discrete (i.e. a finite number of) mesh or grid of points at whose locations we will seek the solution.</p>
<p>To keep things simple for now we will assume these points are equally spaced, and we assume we use <span class="math notranslate nohighlight">\(N\)</span> points to discretise our domain (recall in dimensional units this is <span class="math notranslate nohighlight">\(x\in[0,L]\)</span>).</p>
<p>To deal with the imposition of boundary conditions we will use an approach here where our <span class="math notranslate nohighlight">\(N\)</span> <em>internal</em> mesh nodes are located within the domain, and we introduce two extra <em>ghost</em> nodes just outside the domain as in the figure below.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/1d_grid.svg"><img alt="../_images/1d_grid.svg" src="../_images/1d_grid.svg" width="100%" /></a>
</figure>
<p>As we shall see shortly these ghost nodes will be used to help impose our boundary conditions.</p>
<br>
<p>We have <em><strong>made a choice</strong></em> here over the method we use to deal with our BCs - there are many other options! In particular, approaches where the first and last node coincide exactly with the boundary locations.</p>
<br>
<p>Since we will assume that we don’t yet know anything about the expected solution behaviour it makes sense for our mesh of points to be equally spaced, or <em>equidistant</em>, i.e. we have a constant mesh spacing <span class="math notranslate nohighlight">\(\Delta x\)</span>.</p>
<p>Another way of saying this is that our mesh is <em>uniform</em>.</p>
<p>Our <em>interior</em> mesh points or solution nodes are therefore located at</p>
<div class="math notranslate nohighlight">
\[x_i=\left(i-\frac{1}{2}\right)\Delta x, \;\;\;\;\textrm{for}\;\;\;\;  i=1,\ldots,N, \;\;\;\;\textrm{where}\;\;\;\; \Delta x = \frac{L}{N}.\]</div>
</section>
<section id="discretising-using-a-three-point-stencil-and-central-differences-for-advection-and-diffusion">
<h4><a class="toc-backref" href="#id28" role="doc-backlink">Discretising using a three-point stencil and central differences for advection and diffusion</a><a class="headerlink" href="#discretising-using-a-three-point-stencil-and-central-differences-for-advection-and-diffusion" title="Permalink to this heading">#</a></h4>
<p>Let’s conside the stencil</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/Adv-diff_1D_centred_stencil.svg"><img alt="../_images/Adv-diff_1D_centred_stencil.svg" src="../_images/Adv-diff_1D_centred_stencil.svg" width="75%" /></a>
</figure>
<p>the blue point indicates that we are going to form a discretisation at node <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>The most obvious choice for diffusion is just to use the second-order central scheme we discussed and implemented above:</p>
<div class="math notranslate nohighlight">
\[ \left.\kappa\frac{\partial^2 c}{\partial x^2}\right|_{x_i} \approx \kappa\frac{c_{i+1} - 2c_i + c_{i-1}}{\Delta x^2}.\]</div>
<p>The fact that this is second-order accurate motivates us to attempt to use the same order of accuracy discretisation for the advection term.</p>
<p>The advection term involves a first derivative, and we know from earlier that a central difference of a first derivative is second-order accurate (whereas forward and backward are only first-order accurate).</p>
<p>So a sensible discretisation choice would seem to be</p>
<div class="math notranslate nohighlight">
\[ \left.U\frac{\partial c}{\partial x}\right|_{x_i} \approx U\frac{c_{i+1} - c_{i-1}}{2\Delta x}.\]</div>
<p>We can combine these two discrete terms and update the set of algebraic equations we derived above for the diffusion only problem (note that the discretisation of the boundary conditions does not need to change here now that we have included advection - this won’t always be the case):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \begin{cases}
\frac{1}{2}(c_0 + c_1) &amp;= 0 \\[5pt]
\kappa\frac{c_{i+1} - 2c_i + c_{i-1}}{h^2} - U\frac{c_{i+1} - c_{i-1}}{2\Delta x} &amp;= 0 \\[5pt]
\frac{1}{2}(c_N + c_{N+1}) &amp;= c_E
  \end{cases}
\end{split}\]</div>
<p>for <span class="math notranslate nohighlight">\(i=1,2,\ldots,N\)</span>.</p>
<p>(To keep things looking like the earlier diffusion problem we have considered the BVP in the form <span class="math notranslate nohighlight">\(\kappa\frac{\partial^2 c}{\partial x^2}-U\frac{\partial c}{\partial x}=0\)</span>, we could multiply through by a minus sign here, and in the corresponding set of algebraic equations, and it would change nothing about our discretisation and the corresponding numerical solution.)</p>
<p>This can be written in matrix form as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{pmatrix}
    \frac{1}{2} &amp; \frac{1}{2} &amp; 0 &amp; \ldots &amp; \dots  &amp; 0 \\
    \left\{\frac{\kappa}{\Delta x^2} + \frac{U}{2\Delta x}\right\} &amp; \left\{-\frac{2\kappa}{\Delta x^2}\right\} &amp; \left\{\frac{\kappa}{\Delta x^2} - \frac{U}{2\Delta x}\right\} &amp; 0 &amp; &amp; \vdots \\
    0 &amp;  &amp;  &amp; \ddots &amp;  &amp; \vdots \\
    \vdots &amp;  &amp;  &amp;  &amp;  &amp; 0 \\
      &amp;    &amp; 0 &amp;\left\{\frac{\kappa}{\Delta x^2} + \frac{U}{2\Delta x}\right\} &amp; \left\{-\frac{2\kappa}{\Delta x^2}\right\} &amp; \left\{\frac{\kappa}{\Delta x^2} - \frac{U}{2\Delta x}\right\}\\    
    0 &amp; \ldots &amp; \ldots &amp; 0 &amp; \frac{1}{2}  &amp; \frac{1}{2}
\end{pmatrix}
\begin{pmatrix}
c_0\\
c_1\\
\vdots\\
\\
\vdots\\
c_N\\
c_{N+1}
\end{pmatrix} = 
\begin{pmatrix}
0\\
0\\
\vdots\\
\\
\vdots\\
0\\
c_E
\end{pmatrix}
\end{split}\]</div>
<p>which again can be considered in the form <span class="math notranslate nohighlight">\(\, A\boldsymbol{c}=\boldsymbol{b}\, \)</span> with solution
<span class="math notranslate nohighlight">\(\,\boldsymbol{c}=A^{-1}\boldsymbol{b} \)</span>.</p>
<p>Let’s implement this method and see what difference the inclusion of advection makes to the (numerical) solution.</p>
</section>
<section id="dealing-with-dirichlet-boundary-conditions">
<h4><a class="toc-backref" href="#id29" role="doc-backlink">Dealing with Dirichlet boundary conditions</a><a class="headerlink" href="#dealing-with-dirichlet-boundary-conditions" title="Permalink to this heading">#</a></h4>
<p>Recall that our BCs for this problem were specified in Dirichlet form:</p>
<div class="math notranslate nohighlight">
\[c(0,t) = 0, \;\;\;\; c(L,t)=c_E. \]</div>
<p>Since we set up our mesh above such that <span class="math notranslate nohighlight">\(x=0\)</span> was located exactly mid-way between the left most ghost node and the first interior node (and similarly at the right hand boundary) we can approximate the boundary conditions as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
x=0: &amp; \;\;\;\; \frac{1}{2}(c_0 + c_1) = 0, \\[5pt]
x=L: &amp; \;\;\;\; \frac{1}{2}(c_N + c_{N+1}) = c_E,
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(c_i\)</span> is the numerical solution at node <span class="math notranslate nohighlight">\(i\)</span>. The above expressions are just using linear interpolation of course between the two nodes straddling the boundary location.</p>
<p>Note that if we perform a Taylor series approximation we will be able to see that these approximations at the boundaries are second-order accurate. This is good as it will agree with the order of accuracy of the ODE discretisation we will see shortly.</p>
<p>Note that generally, too high an accuracy in approximating the BCs could be a waste of effort, but too low might compromise the overall accuracy of the solver throughout the entire domain!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">Pe</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">L</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">BVP_AD_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; function to assemble and solve the AD BVP problem</span>
<span class="sd">    using central differences for both adv and diff.</span>
<span class="sd">    </span>
<span class="sd">    Returns the mesh x and the solution C</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1"># interior points</span>
    <span class="n">r_diff</span> <span class="o">=</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">r_adv</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">U</span> <span class="o">/</span> <span class="n">dx</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span> <span class="o">+</span> <span class="n">r_adv</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r_diff</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span> <span class="o">-</span> <span class="n">r_adv</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># BC1</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># BC2</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">b</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CE</span>  <span class="c1"># BC2</span>
    <span class="c1"># invert matrix</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">C</span>


<span class="c1"># call function to generate numerical solution</span>
<span class="n">x</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">BVP_AD_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>

<span class="c1"># construct the exact solution</span>
<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Cex</span> <span class="o">=</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">xf</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">Cex</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact solution&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Numerical solution&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adv-diff BVP - central scheme&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="c1"># to exclude ghost points just restrict the x limit of the plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/91d9b2a39a01c393463f65ac9f2fba575b40d1aae14aaa36e50465ca82173fb0.png" src="../_images/91d9b2a39a01c393463f65ac9f2fba575b40d1aae14aaa36e50465ca82173fb0.png" />
</div>
</div>
<p><em><strong>Observations</strong></em></p>
<ul class="simple">
<li><p>In this plot we have restricted the <span class="math notranslate nohighlight">\(x\)</span> limits to the physical domain and so not plotted the ghost node solutions.</p></li>
<li><p>The result looks pretty good, but let’s check for robustness (a.k.a. stability) and the impact that changing the problem or the mesh resolution has.</p></li>
<li><p>For this problem in non-dimensional form changing <span class="math notranslate nohighlight">\(Pe\)</span> and <span class="math notranslate nohighlight">\(\Delta x\)</span> is actually equivalent - it’s a more challenging problem if we either make <span class="math notranslate nohighlight">\(Pe\)</span> larger (as the boundary layer will get thinner relative to the mesh spacing), or if we make <span class="math notranslate nohighlight">\(\Delta x\)</span> larger.  Let’s experiment with the latter by solving the same problem in a series of coarsening meshes.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">Pe</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">L</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># set up figure with 4 subplots to plot 4 resolutions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="c1"># reshape so that we can iterate below over axs[i] instead of ax[i,j]</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># construct the exact solution on a fine mesh</span>
<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Cex</span> <span class="o">=</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">xf</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># let&#39;s compute solution and plot for 4 different resolutions</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="p">(</span><span class="mi">32</span> <span class="o">*</span> <span class="mf">.5</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="p">):</span>
    <span class="c1"># call function to generate numerical solution</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">BVP_AD_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">Cex</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Exact solution&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;ob&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Numerical solution&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AD BVP - central. $PE = 10$, $N=$</span><span class="si">%2i</span><span class="s1">, $Pe_c$=</span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">U</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">kappa</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c1"># to exclude ghost points just restrict the x limit of the plot</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7bdb86e1e5ec620967f45eeeaee2e96589c93281db99904ea7afa1bb17dd8bc8.png" src="../_images/7bdb86e1e5ec620967f45eeeaee2e96589c93281db99904ea7afa1bb17dd8bc8.png" />
</div>
</div>
<p><em><strong>More observations</strong></em></p>
<ul class="simple">
<li><p>For the first three resolutions we see the accuracy decreasing as we decrease the mesh resolution - this make sense based on our Taylor series error analysis earlier (indeed as we know the overall scheme should be second-order accurate we would expect an approximately four times increase in error every time we double the mesh spacing).</p></li>
<li><p>But something qualitatively different has happened for the coarsest mesh resolution that we have considered - the numerical solution in the bottom-right frame now has spuriously jumped down (and note to a negative value) close to (or within) the boundary layer.</p></li>
<li><p>This is a consequence of not having enough resolution to resolve the rapid change in the solution at this location.</p></li>
<li><p>This behaviour can be referred to as instability, resulting in wiggles, oscillations, under/over-shoots, …</p></li>
<li><p>Note that we have also included a new quantity (the <em><strong>grid or cell Peclet number</strong></em>) in the figure titles. It is defined as:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[Pe_c :=  \frac{U\Delta x}{\kappa}.\]</div>
<ul class="simple">
<li><p>Theory states that the central scheme (for advection) is prone to instability (the presence of wiggles or over/under-shoots) when the grid Peclet number exceeds the value 2 - which is consistent with our plots above.</p></li>
<li><p>NB. a grid Peclet number exceeding 2 does not mean we will definitely get wiggles, just that we may - we cannot rule them out.</p></li>
</ul>
</section>
<section id="discrete-fluxes-star">
<h4><a class="toc-backref" href="#id30" role="doc-backlink">Discrete fluxes [<span class="math notranslate nohighlight">\(\star\)</span>]</a><a class="headerlink" href="#discrete-fluxes-star" title="Permalink to this heading">#</a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p>We can establish this limit of the cell Peclet number for the central scheme by considering <em>discrete fluxes</em>.</p>
<p>First note that for our above discretisation options we can write the discretised form of our continuous equation</p>
<div class="math notranslate nohighlight">
\[U\frac{\partial c}{\partial x} = \kappa\frac{\partial^2 c}{\partial x^2}, \;\;\;\; c(0) = 0, \;\;\;\; c(L)=c_E, \]</div>
<p>as</p>
<div class="math notranslate nohighlight">
\[ U\frac{c_{i+1} - c_{i-1}}{2\Delta x} 
= 
\kappa\frac{c_{i+1} - 2c_i + c_{i-1}}{\Delta x^2}.\]</div>
<p>Notice that this discrete equation is equivalent to the following <em>conservative form</em> for the discrete BVP:</p>
<div class="math notranslate nohighlight">
\[\frac{\phi_i - \phi_{i-1}}{\Delta x} = 0, \]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[ \phi_i : = \frac{U}{2}\left( c_i + c_{i+1} \right)
-\kappa \frac{c_{i+1} - c_{i}}{\Delta x}. \]</div>
<p>This quantity can be called the total (i.e. sum of the advective and diffusive) scalar flux - note that due to its definition we can interpret it as being defined between node <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(i+1\)</span>.</p>
</div>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p><em><strong>Conservative form</strong></em></p>
<p>This is just a discrete version of the continuous BVP written in <em>conservative form</em>:</p>
<div class="math notranslate nohighlight">
\[\frac{\partial}{\partial x}\phi = 0, \,\,\,\,\,\text{where}\,\,\,\,\, \phi = Uc - \kappa \frac{\partial c}{\partial x},\]</div>
<p>we’ll come back to equations written in conservative form like this in lecture 9.</p>
</div>
<section id="stability">
<h5><a class="toc-backref" href="#id31" role="doc-backlink">Stability</a><a class="headerlink" href="#stability" title="Permalink to this heading">#</a></h5>
<p>Consider a case where the advective and diffusive fluxes exactly balance throughout the whole domain, i.e <span class="math notranslate nohighlight">\(\,\phi_i = 0\, \; \forall \; i\)</span>.</p>
<p>At the first node in from the inhomogeneous Dirichlet condition at the right (i.e. at <span class="math notranslate nohighlight">\(i=N\)</span>) we have the disretised equation</p>
<div class="math notranslate nohighlight">
\[ \phi_N  = \frac{U}{2}\left( c_N + c_{N+1} \right)
-\kappa \frac{c_{N+1} - c_{N}}{\Delta x} = 0\]</div>
<p>Substituting the discrete BC</p>
<div class="math notranslate nohighlight">
\[ \frac{1}{2}(c_N + c_{N+1}) = c_E \;\;\;\;\;\;
\iff \;\;\;\;\;\; 
c_{N+1} = 2c_E - c_N\]</div>
<p>into the relation above we have</p>
<div class="math notranslate nohighlight">
\[ Uc_E - 2\kappa\frac{c_E - c_N}{\Delta x} = 0 \;\;\;\;\;\;
\iff \;\;\;\;\;\; 
c_N = c_E\left(1 - \frac{1}{2}Pe_c\right) \]</div>
<p>we can now observe that requiring that we don’t experience an under-shoot at the first node in from the boundary (i.e. requiring that <span class="math notranslate nohighlight">\(c_N&gt;0\)</span>) yields the condition</p>
<div class="math notranslate nohighlight">
\[Pe_c &lt; 2. \]</div>
</section>
</section>
<section id="upwind-for-advection">
<h4><a class="toc-backref" href="#id32" role="doc-backlink">Upwind for advection</a><a class="headerlink" href="#upwind-for-advection" title="Permalink to this heading">#</a></h4>
<p>An alternative means to discretise advection would be to use either a forward or backward difference to approximate the first-order derivative in the advection term.</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/Adv-diff_1D_centred_stencil.svg"><img alt="../_images/Adv-diff_1D_centred_stencil.svg" src="../_images/Adv-diff_1D_centred_stencil.svg" width="70%" /></a>
</figure>
<p>If we think about the direction of information propagation via advection (i.e. in the direction of the velocity <span class="math notranslate nohighlight">\(U\)</span> - which in 1D just means whether <span class="math notranslate nohighlight">\(U\)</span> is positive or negative) this gives us a clue as to whether we should use a forward or a backward difference:</p>
<p>if <span class="math notranslate nohighlight">\(U\)</span> is positive then information is travelling, or being “advected” to the right, this means at node <span class="math notranslate nohighlight">\(i\)</span> we want to make use of the numerical solution to the left (and vice-versa). Think about crossing the road, which direction do you look?</p>
<div class="math notranslate nohighlight">
\[\begin{split} \left.U\frac{\partial c}{\partial x}\right|_{x_i} \approx
  \begin{cases}
 U\frac{c_{i} - c_{i-1}}{\Delta x}\;\;\;\;\text{if} \;\;\;\; U&gt;0 \;\;\;\;\text{(backward difference)}\\[5pt]
 U\frac{c_{i+1} - c_{i}}{\Delta x}\;\;\;\;\text{if} \;\;\;\; U&lt;0\;\;\;\;\text{(forward difference)}
  \end{cases}
\end{split}\]</div>
<p>This approach is called an <em><strong>upwind</strong></em> discretisation of advection.</p>
<p>It seeks to do justice to the fact that for advection problems information travels in the <em>downstream</em> direction.</p>
<p>Hence, the advection operator is skewed towards the upstream direction to better approximate the flow of information - imagine standing in a river, it’s only the water travelling towards us that is affecting us.</p>
<p>However, this scheme is only first-order accurate, and as we shall see it suffers from numerical diffusion/dissipation.</p>
<p>We shall witness both these points now through an implementation of the upwind scheme and plots of the comparison with solutions obtained with the central scheme (for both advection and diffusion).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">Pe</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">L</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">BVP_AD_upwind</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; function to assemble and solve the AD BVP problem</span>
<span class="sd">    using central differences for both adv and diff</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1"># interior points</span>
    <span class="n">r_diff</span> <span class="o">=</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">r_adv</span> <span class="o">=</span> <span class="n">U</span> <span class="o">/</span> <span class="n">dx</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span> <span class="o">+</span> <span class="n">r_adv</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r_diff</span> <span class="o">-</span> <span class="n">r_adv</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># BC1</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># BC2</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">b</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CE</span>  <span class="c1"># BC2</span>
    <span class="c1"># invert matrix</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">C</span>


<span class="c1"># set up figure with 4 subplots to plot 4 resolutions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="c1"># reshape so that we can iterate below over axs[i] instead of ax[i,j]</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># construct the exact solution on a fine mesh</span>
<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Cex</span> <span class="o">=</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">xf</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># let&#39;s compute solution and plot for 4 different resolutions</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="mi">32</span> <span class="o">*</span> <span class="mf">.5</span><span class="o">**</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)):</span>
    <span class="c1"># call function to generate numerical solution</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">BVP_AD_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;ro-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;central&quot;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">BVP_AD_upwind</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;upwind&quot;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">Cex</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
        <span class="s1">&#39;AD BVP. $PE = 10$, $N=$</span><span class="si">%2i</span><span class="s1">, $Pe_c$=</span><span class="si">%.4f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">U</span><span class="o">*</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">kappa</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;numerical&#39;</span><span class="p">,</span> <span class="s1">&#39;exact&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c1"># to exclude ghost points just restrict the x limit of the plot</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/3079d95c098d774bfaf6a9ac2b575a8c999fb1107aab8b42d5a612fcf316320d.png" src="../_images/3079d95c098d774bfaf6a9ac2b575a8c999fb1107aab8b42d5a612fcf316320d.png" />
</div>
</div>
<section id="observations">
<h5><a class="toc-backref" href="#id33" role="doc-backlink">Observations</a><a class="headerlink" href="#observations" title="Permalink to this heading">#</a></h5>
<ul class="simple">
<li><p>The bad news is that as expected the upwind scheme is less accurate, and relatively speaking this gets worse as the resolution is changed due to the first-order vs second-order accuracy of the two schemes [see homework exercise].</p></li>
<li><p>This manifests itself through enhanced (i.e. higher levels of) <em>numerical diffusion</em> with upwind methods, which can be particularly seen in it artificially thickening the width of the boundary layer, or equivalently limiting how fast the numerical solution can vary between grid points.</p></li>
<li><p>The good news of course is that the scheme is stable (does not suffer from wiggles or undershoots) even when the mesh is very coarse (you could try coarsening it even further!) and the central scheme has gone unstable.</p></li>
</ul>
<br>
<ul class="simple">
<li><p><strong>Important point:</strong> What’s the worse situation: (a) instability and obviously a solution we shouldn’t make use of; or (b) a stable but potentially inaccurate result? In many ways (a) is “cleaner” - instability tells us we are asking too much of the simulation and we either need to use more resources (bigger computer or a longer runtime) or scale back our ambitions, but sometimes neither of these things is possible. Then we need to resort to (b), but this is only safe to do if we are aware and understand (and better yet can quantify) the consequences of the limitations to the method. Problems arise when people follow option (b) blindly, with no appreciation of the issues related to spurious numerical behaviour such as the numerical diffusion we’ve seen here.</p></li>
</ul>
</section>
</section>
<section id="analysis-of-the-upwind-scheme-star">
<h4><a class="toc-backref" href="#id34" role="doc-backlink">Analysis of the upwind scheme [<span class="math notranslate nohighlight">\(\star\)</span>]</a><a class="headerlink" href="#analysis-of-the-upwind-scheme-star" title="Permalink to this heading">#</a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p>Returning to our Taylor series derivations of the different finite difference approximations above, specifically where we wrote</p>
<div class="math notranslate nohighlight">
\[ \frac{f(x_0)-f(x_0-\Delta x)}{\Delta x} = f'(x_0) - \frac{\Delta x}{2} f''(x_0) + \mathcal{O}(\Delta x^2), \]</div>
<p>we can conclude that</p>
<div class="math notranslate nohighlight">
\[ U\frac{c_i-c_{i-1}}{\Delta x} = Uc'_i - U\frac{\Delta x}{2} c''_i + \mathcal{O}(\Delta x^2).\]</div>
<p>Hence the leading order part of the <em>truncation error</em> between the exact and the (upwind) numerical representation of the advection term is</p>
<div class="math notranslate nohighlight">
\[ Uc'_i - U\frac{c_i-c_{i-1}}{\Delta x} \approx  \frac{U\Delta x}{2} c''_i,\]</div>
<p>which qualitatively represents a diffusion-like term with a diffusivity coefficient of:</p>
<div class="math notranslate nohighlight">
\[\kappa_{\text{num}} := \frac{U\Delta x}{2}.\]</div>
<p>This analysis of the leading order term in the error tells us that the numerical solution acts like the exact solution but with an error whose dominant component acts like diffusion - note that more generally this type of analysis is called a <em><strong>modified equation analysis</strong></em> and is useful in understanding the qualitative behaviour of different discretisations.  It tells us about an ODE/PDE that our numerical solution is actually in better agreement with than the actual problem we are trying to solve!!</p>
<p>In this particular case our numerics are closer to the exact solution of a modified problem with extra diffusion!!</p>
<p>Note that the ratio of this numerical diffusion to the real physical diffusion is</p>
<div class="math notranslate nohighlight">
\[\frac{\kappa_{\text{num}}}{\kappa} = \frac{U\Delta x}{2\kappa} = \frac{1}{2} Pe_c,\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[Pe_C := \frac{U\Delta x}{\kappa},\]</div>
<p>is the grid or cell Peclet number we introduced above.</p>
<p>This new non-dimensional quantity can therefore be interpreted as telling us about the ratio of real to spurious diffusion in our upwind numerical solution.</p>
<p>We clearly want the spurious numerical diffusion to be small in comparison to the true physical diffusion (otherwise we’d be essentially solving a completely different physical problem where the numerical diffusion would overwhelm the true diffusion), and so for accuracy we really require that</p>
<div class="math notranslate nohighlight">
\[ Pe_c \ll 1. \]</div>
<p>If <span class="math notranslate nohighlight">\(Pe_c\)</span> approaches or even passes unity then the upwind scheme would be stable and give us a result, but it would potentially be completely wrong, especially in terms of representing phenomena where the mesh is too coarse to resolve rapid variations which may be present in the true solution.</p>
<p>Note that the stability limit of the cell Peclet number equalling two is the case where the ratio of real to spurious diffusion is one - i.e. the sizes of these two sources of diffusion in the solution are equivalent. Note that as we <em>additionally</em> include a discretisation of the physical diffusion in our problem this means that our overall discretisation is “double counting” diffusion - hence the reasons that in the example above our upwind solution is always too diffuse.</p>
</div>
</section>
</section>
<section id="practicalities">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">Practicalities!</a><a class="headerlink" href="#practicalities" title="Permalink to this heading">#</a></h3>
<p><strong>Repeating what was said above (because it’s very important):</strong></p>
<p><em><strong>This is a very important point to remember - stability is of course a good thing, but it can lull you into a false sense of security as you can obtain a solution essentially to a different problem with very different qualitative and quantitative behaviour compared to the true solution.</strong></em></p>
<p>Just because you get a solution out of a model and it looks well-behaved (and perhaps even plausible based on what you know of the underlying physics), you cannot assume that it is accurate, especially if the solver makes use of inherently stable discretisation methods such as an upwind scheme - there is often no getting around the need for resolution (although subgrid scale parameterisations such as turbulence models do attempt to do this and very sophisticated/successful approaches have been developed, we won’t have time to go into these in this module).</p>
</section>
<section id="monotonicity">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Monotonicity</a><a class="headerlink" href="#monotonicity" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>Godunov (1959) showed that for linear discretisations, only first-order schemes can remain monotonic, which is known as <a class="reference external" href="https://en.wikipedia.org/wiki/Godunov%27s_theorem">Godunov’s theorem</a>:</p></li>
</ul>
<p>“<em>Linear numerical schemes for solving PDE’s, having the property of not generating new extrema (i.e. a monotone scheme), can be at most first-order accurate</em>”</p>
<br>
<ul class="simple">
<li><p>Higher-order linear schemes (e.g. the central scheme from above) will therefore always generate non-monotonic solutions if there is insufficient resolution - as we saw for the central scheme</p></li>
<li><p>A popular solution is to use so-called <em>high-resolution schemes</em>. The idea with these is to use accurate schemes (i.e. &gt; first-order) as much as possible, but revert to first-order schemes when gradients become too steep to avoid unphysical over- and undershoots. They do this by <em>limiting the fluxes</em>.  We’ll come back to some of these ideas in a later lecture.</p></li>
</ul>
</section>
</section>
<section id="non-uniform-and-adaptive-meshes-star-star">
<h2><a class="toc-backref" href="#id37" role="doc-backlink">Non-uniform (and adaptive) meshes [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#non-uniform-and-adaptive-meshes-star-star" title="Permalink to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<ul class="simple">
<li><p>or getting resolution where you need it, …</p></li>
<li><p>or focusing your finite precious computational resource where it will be most effective (trying to optimise stability and solution accuracy vs computational cost).</p></li>
</ul>
<p>We’ve seen above issues with wiggles (or instabilities) in our numerical solution, the presence and magnitude of these wiggles being a function of how large the solution gradient is, and this “largeness” being relative to the mesh resolution.</p>
<p>We’ve seen that the use of upwind based discretisations is <em>one</em> potential solution to deal with wiggles (but comes at the cost of a loss of accuracy).</p>
<p>The use of higher mesh resolution is another potential solution, but for efficiency reasons we ideally only want this higher resolution where (and when if the problem was also time-dependent) it is needed, and we ideally want to use coarse mesh resolution where and when it is sufficient.</p>
<p>But all of our code and derivations to date have been based on the assumption that the mesh size is uniform and fixed (<span class="math notranslate nohighlight">\(\Delta x = \)</span> Constant, in both space and time).</p>
<p>We have two options to try and generalise this:</p>
<ul class="simple">
<li><p>(1) Use finite difference approximations for non-equidistant grids; these can be derived using the method of undetermined coefficients introduced above.</p></li>
<li><p>(2) Apply a coordinate transformation to map between a non-equidistant grid and an equidistant grid.</p></li>
</ul>
<p>Both have pros and cons, let’s consider the coordinate transformations approach now.</p>
</div>
<section id="coordinate-transformations-star-star">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Coordinate transformations [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#coordinate-transformations-star-star" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>The idea here is to introduce a mapping between:</p>
<ul class="simple">
<li><p><em>physical space</em> - the space our problem is actually posed within and thus the space by default we will attempt to discretise and solve our problem, e.g. <span class="math notranslate nohighlight">\((x,y)\)</span>, and</p></li>
<li><p><em>computational space</em> - this is a space we transform our problem into to discretise and solve.</p></li>
</ul>
<p>There may be several motivations for this:</p>
<ol class="arabic simple">
<li><p>It may allow us to simplify a complex physical geometry, e.g. simplifying our mesh generation and allowing us to use an orthogonal mesh and corresponding finite difference formulae/code.</p></li>
<li><p>With the appropriate stretching, solving on a uniform mesh in computational space is equivalent to solving on a non-uniform mesh in physical space, again without the need for us to update our codes.</p></li>
</ol>
</div>
<section id="an-example-an-ocean-domain-star-star">
<h4><a class="toc-backref" href="#id39" role="doc-backlink">An example - an ocean domain [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#an-example-an-ocean-domain-star-star" title="Permalink to this heading">#</a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>To fix ideas let’s consider an example.</p>
<p>Imagine we are interested in modelling a vertical slice in the ocean (i.e. an <span class="math notranslate nohighlight">\((x,z)\)</span> domain with a complex shaped bottom boundary - the bathymetry). Also be aware that interesting things tend to happen in the oceans near the top and the bottom so we may well be advised to concentrate our mesh resolution in these locations.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># our physical domain - an ocean with z=0 at the top </span>
<span class="c1"># and z = -bathy at bottom</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">30</span><span class="p">)</span>
<span class="n">bathy</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">+</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">9</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.05</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="c1"># plot domain boundaries</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="o">-</span><span class="n">bathy</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="n">bathy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="o">-</span><span class="n">bathy</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mf">0.</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;A physical domain&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># a computational domain and uniform regular mesh</span>
<span class="c1"># use same x as that used to generate bathy</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">zz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>

<span class="c1"># function to plot mesh</span>
<span class="k">def</span> <span class="nf">plot_mesh</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; plot a finite difference mesh using points from xx, zz on axis ax</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span><span class="n">zz</span><span class="p">[</span><span class="n">i</span><span class="p">,:],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="n">zz</span><span class="p">[:,</span><span class="n">j</span><span class="p">],</span><span class="s1">&#39;k-&#39;</span><span class="p">)</span>
        
<span class="n">plot_mesh</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">zz</span><span class="p">,</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Computational domain and uniform mesh&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># scale computational mesh based on bathy</span>
<span class="n">zzs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">zzs</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">zz</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">*</span><span class="n">bathy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="n">plot_mesh</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">zzs</span><span class="p">,</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;A (quasi-uniform) mesh in our physical domain&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># sometimes we want finer resolution at top and/or bottom</span>
<span class="c1"># can achieve this either with a different mesh in computational </span>
<span class="c1"># domain, or by changing the mapping:</span>
<span class="c1"># for background see https://www.myroms.org/wiki/Vertical_S-coordinate</span>
<span class="n">zzs2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
<span class="c1"># stretching parameters</span>
<span class="n">a</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">depth_c</span> <span class="o">=</span> <span class="mf">0.4</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
    <span class="n">Cs</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">b</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">zz</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">+</span> \
         <span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span> <span class="n">zz</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">a</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span>  
    <span class="n">zzs2</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">depth_c</span><span class="o">*</span><span class="n">zz</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">bathy</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">-</span> <span class="n">depth_c</span><span class="p">)</span><span class="o">*</span><span class="n">Cs</span>
    
<span class="n">plot_mesh</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span><span class="n">zzs2</span><span class="p">,</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;A mesh stretched at top and/or bottom&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/e70d09b10f9945806fb02b5269e0ab7c0a5b572a9de8348df33967a981891fb4.png" src="../_images/e70d09b10f9945806fb02b5269e0ab7c0a5b572a9de8348df33967a981891fb4.png" />
</div>
</details>
</div>
</section>
</section>
<section id="d-theory-star-star">
<h3><a class="toc-backref" href="#id40" role="doc-backlink">1D theory  [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#d-theory-star-star" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>To keep things simple let’s just focus on one dimension.</p>
<p>We introduce a mapping</p>
<div class="math notranslate nohighlight">
\[ x \equiv x(\xi), \]</div>
<p>between our physical coordinate <span class="math notranslate nohighlight">\(x\)</span> and a computational coordinate <span class="math notranslate nohighlight">\(\xi\)</span>.</p>
<p>At the moment we are thinking about things in continuous space (we are going to transform our continuous problems, e.g. an ODE or PDE, into the computational domain), so think of <span class="math notranslate nohighlight">\(\,x\,\)</span> here as a function which maps <span class="math notranslate nohighlight">\(\,\xi\,\)</span> locations into <span class="math notranslate nohighlight">\(\,x\,\)</span> locations. In particular, if and when we have a mesh point <span class="math notranslate nohighlight">\(\,\xi_i\)</span>, the corresponding mesh point location in physical space is defined as <span class="math notranslate nohighlight">\(\,x_i:=x(\xi_i)\)</span>.</p>
<br>
<p>To transform our differential equation we need to know how derivatives transform.</p>
<p>Recall that our model problem here is of the form</p>
<div class="math notranslate nohighlight">
\[U\frac{\partial c}{\partial x} = \kappa\frac{\partial^2 c}{\partial x^2}, \;\;\;\; c(0) = 0, \;\;\;\; c(L)=c_E, \]</div>
<p>for the unknown function <span class="math notranslate nohighlight">\(c\equiv c(x)\)</span>.</p>
<p>If we now think of <span class="math notranslate nohighlight">\(\,x\,\)</span> as being a function of <span class="math notranslate nohighlight">\(\,\xi\,\)</span>, then we have <span class="math notranslate nohighlight">\(\,c\equiv c(x(\xi))\,\)</span> and we want/need to know the relationship between the <span class="math notranslate nohighlight">\(\,x\,\)</span> derivatives of <span class="math notranslate nohighlight">\(\,c\,\)</span> (as in our model problem definition), and the <span class="math notranslate nohighlight">\(\,\xi\,\)</span> derivatives of <span class="math notranslate nohighlight">\(\,c\,\)</span> which we need to know to solve the problem in computational space.</p>
<p>This just involves use of the <a class="reference external" href="https://en.wikipedia.org/wiki/Chain_rule">chain rule</a>:</p>
<div class="math notranslate nohighlight">
\[ \frac{d}{d\xi} c(x(\xi)) = \frac{dc}{dx} \frac{dx}{d\xi} = x_{\xi} \frac{dc}{dx}, \]</div>
<p>and again for second derivatives, now needing to make use of the <a class="reference external" href="https://en.wikipedia.org/wiki/Product_rule">product rule</a>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{d^2}{d\xi^2} c(x(\xi)) &amp; = \frac{d}{d\xi}\left(\frac{d}{d\xi} c(x(\xi))\right) = \frac{d}{d\xi} \left( x_{\xi} \frac{dc}{dx}\right)\;\;\;\text{(using the previous result)}\\
&amp;= x_{\xi\xi} \frac{dc}{dx} +  x_{\xi}\frac{d}{d\xi} \left(\frac{dc}{dx}\right)= x_{\xi\xi} \frac{dc}{dx} + x_{\xi}^2\frac{d^2 c}{dx^2}\;\;\;\text{(using the previous result again)},
\end{split}\]</div>
<p>and so rearranging these two relations we have</p>
<div class="math notranslate nohighlight">
\[  \frac{dc}{dx} = \frac{1}{x_{\xi}}\frac{\partial c}{\partial \xi} \;\;\;\;\;\;\text{and}\;\;\;\;\;\;
\frac{d^2 c}{dx^2} = 
\frac{1}{x_{\xi}^2} \left( \frac{d^2 c}{d{\xi}^2} - {x_{\xi\xi}} \frac{d c}{d{x}}\right) =
\frac{1}{x_{\xi}^2} \left( \frac{d^2 c}{d{\xi}^2} - \frac{x_{\xi\xi}}{x_{\xi}} \frac{d c}{d{\xi}}\right). \]</div>
<p>Our differential equation can therefore be transformed into an equation posed in computational space:</p>
<div class="math notranslate nohighlight">
\[U\frac{\partial c}{\partial x} = \kappa\frac{\partial^2 c}{\partial x^2}
\;\;\;\longrightarrow\;\;\;
\tilde{U}\frac{\partial c}{\partial \xi} = \tilde{\kappa}\frac{\partial^2 c}{\partial {\xi}^2},\]</div>
<p>i.e. of the same form as the original problem, but now with coefficients that take the form</p>
<div class="math notranslate nohighlight">
\[\tilde{U}(\xi) := \frac{1}{x_{\xi}}  U + \frac{x_{\xi\xi}}{x_{\xi}^3}\kappa \;\;\;\;\;\;\;\text{and}\;\;\;\;\;\;\; \tilde{\kappa}(\xi):= \frac{1}{x_{\xi}^2}  \kappa. \]</div>
<p>So we now have to solve a linear ODE, with <em>variable coefficients</em>.</p>
</div>
<section id="choice-of-stretching-function-star-star">
<h4><a class="toc-backref" href="#id41" role="doc-backlink">Choice of stretching function [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#choice-of-stretching-function-star-star" title="Permalink to this heading">#</a></h4>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>We will do this below, but to actually implement the code we need to choose the mapping between physical and computational space (i.e. <span class="math notranslate nohighlight">\(\,x\equiv x(\xi)\)</span>).</p>
<p>We have essentially infinite options here. Initially choosing <span class="math notranslate nohighlight">\(\,x\equiv\xi\,\)</span> is a sensible verification test of course since our new code should recreate what we know worked previously, and being able to compare actual discretisation matrices etc provides extremely valuable debugging opportunities if needed!</p>
<p>Once we have checked the identity mapping works, let’s consider a function which is able to concentrate resolution in the boundary layer - we want a uniform mesh in computational space to map to one where the physical mesh points are clustered close to the right-hand boundary of our domain.</p>
<p>An example of such a function is</p>
<div class="math notranslate nohighlight">
\[ x = L \frac{\sinh^{-1}(\sinh(a)\xi)}{a}, \]</div>
<p>where, as we will see in the next plots, the parameter <span class="math notranslate nohighlight">\(a\)</span> controls the degree of stretching.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">U</span> <span class="o">=</span> <span class="n">Pe</span> <span class="o">*</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">L</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># implement the function above</span>
<span class="k">def</span> <span class="nf">stretch_func</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">a</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">L</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">/</span><span class="n">a</span>
    <span class="k">return</span> <span class="n">x</span>

<span class="c1"># create a uniform mesh on computational space</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span><span class="mf">5.</span><span class="p">,</span><span class="mf">10.</span><span class="p">])):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">stretch_func</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span><span class="n">a</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$a=</span><span class="si">{0:.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
    <span class="c1"># plot the exact solution mapped to computational space</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\xi$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$c(x(\xi))$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Exact solution in comp space. $a=</span><span class="si">{0:.1f}</span><span class="s1">$&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
                  
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\xi$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Mapping from $\xi$ into $x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/667d001e17f69b1f6e3deab3c0f50df265c9441a2906813484d61bd8a1f75448.png" src="../_images/667d001e17f69b1f6e3deab3c0f50df265c9441a2906813484d61bd8a1f75448.png" />
</div>
</details>
</div>
<section id="id1">
<h5><a class="toc-backref" href="#id42" role="doc-backlink">Observations</a><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h5>
<ul class="simple">
<li><p>the larger the value for <span class="math notranslate nohighlight">\(a\)</span> the more resolution is focused in the boundary layer</p></li>
<li><p><span class="math notranslate nohighlight">\(a=1\)</span> yields the identity mapping</p></li>
<li><p>if we plot the exact solution <em>in computational space</em> we see that the more we stretch the coordinate the more gentle the behaviour of the solution in computational space - as we will be solving our problem on a uniform mesh in computational space, we have to imagine that this will do good things for both stability and accuracy!</p></li>
</ul>
</section>
</section>
</section>
<section id="implementation-star-star">
<h3><a class="toc-backref" href="#id43" role="doc-backlink">Implementation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#implementation-star-star" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>As you will see below, the implementation is very similar to our previous code (as it should be as we are solving the same equation still on a uniform mesh), but now we additionally need to compute the variable coefficients.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mf">30.</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">Pe</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="k">def</span> <span class="nf">BVP_AD_central_stretch_mesh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">Xfn</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; function to assemble and solve the AD BVP problem</span>
<span class="sd">    using central differences for both adv and diff</span>
<span class="sd">    with a mesh stretching given by the function Xfn</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dxi</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dxi</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dxi</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">Xfn</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
    <span class="n">kappat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">Ut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">Xxi</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">dxi</span><span class="p">)</span>
        <span class="n">Xxixi</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="n">dxi</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">Ut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">Xxi</span><span class="p">)</span> <span class="o">*</span> <span class="n">U</span> <span class="o">+</span> <span class="p">(</span><span class="n">Xxixi</span> <span class="o">/</span> <span class="p">(</span><span class="n">Xxi</span><span class="o">**</span><span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="n">kappa</span>
        <span class="n">kappat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="n">Xxi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">kappa</span>      
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="c1"># interior points</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kappat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">dxi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">dxi</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.</span> <span class="o">*</span> <span class="n">kappat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">dxi</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">A</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kappat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">dxi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">Ut</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">dxi</span>
        <span class="n">b</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># BC1</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1"># BC2</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">A</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">b</span><span class="p">[</span><span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">CE</span>  
    <span class="c1"># invert matrix</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">C</span>

<span class="c1"># construct the exact solution</span>
<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Cex</span> <span class="o">=</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">xf</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># set up figure with 4 subplots to plot 4 resolutions</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># let&#39;s use a relatively small number of grid points</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">8</span>
<span class="c1"># define the function to generate numerical solution</span>
<span class="n">Xfn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="n">L</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">/</span><span class="n">a</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">]):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">BVP_AD_central_stretch_mesh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">Xfn</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;bo-&#39;</span><span class="p">,</span> <span class="n">xf</span><span class="p">,</span> <span class="n">Cex</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;AD BVP. a = </span><span class="si">{0:.4f}</span><span class="s1">, error = </span><span class="si">{1:.4f}</span><span class="s1">&#39;</span><span class="o">.</span>
                     <span class="nb">format</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;numerical&#39;</span><span class="p">,</span> <span class="s1">&#39;exact&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="c1"># to exclude ghost points just restrict the x limit of the plot</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/efb2516b525935fa5c482b2dcadcc0256764d0cabb301ba62cea82cbff8106dc.png" src="../_images/efb2516b525935fa5c482b2dcadcc0256764d0cabb301ba62cea82cbff8106dc.png" />
</div>
</details>
</div>
<section id="id2">
<h4><a class="toc-backref" href="#id44" role="doc-backlink">Observations</a><a class="headerlink" href="#id2" title="Permalink to this heading">#</a></h4>
<p>So with the correct mesh spacing not only can we recover a stable solution, if we are very careful we can optimise the mesh to attain, relatively speaking, a very accurate result for low computational cost!</p>
</section>
</section>
<section id="optimisation-star-star">
<h3><a class="toc-backref" href="#id45" role="doc-backlink">Optimisation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#optimisation-star-star" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>Let’s try to optimise this - i.e. let’s vary <span class="math notranslate nohighlight">\(a\)</span> and see its effect on error.  Note that this process won’t be possible in general since we won’t have access to the exact solution so we would need to come up with other approaches to select <span class="math notranslate nohighlight">\(a\)</span>, or more generally the transformation function.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mf">30.</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="n">Pe</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mf">1.</span>

<span class="c1"># let&#39;s use a relatively small number of grid points</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">8</span>
<span class="c1"># mesh stretching values to test</span>
<span class="n">aa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">100.</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
<span class="c1"># define function to generate numerical solution</span>
<span class="n">Xfn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">xi</span><span class="p">:</span> <span class="n">L</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsinh</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sinh</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">xi</span><span class="p">)</span><span class="o">/</span><span class="n">a</span>
<span class="n">errors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">aa</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aa</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">BVP_AD_central_stretch_mesh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">Xfn</span><span class="p">)</span>
    <span class="n">errors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">a</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">C</span> <span class="o">=</span> <span class="n">BVP_AD_central_stretch_mesh</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">CE</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">Xfn</span><span class="p">)</span>
<span class="n">uniform_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">C</span> <span class="o">-</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Uniform mesh (a = 1) gives an error of </span><span class="si">{0:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uniform_error</span><span class="p">))</span>
<span class="n">besti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Minimum error of </span><span class="si">{0:.6f}</span><span class="s1"> when a = </span><span class="si">{1:.6f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">errors</span><span class="p">[</span><span class="n">besti</span><span class="p">],</span> <span class="n">aa</span><span class="p">[</span><span class="n">besti</span><span class="p">]))</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">aa</span><span class="p">,</span><span class="n">errors</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$a$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Error&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Error as a function of mesh stretching parameter $a$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">aa</span><span class="p">[</span><span class="n">besti</span><span class="p">]],</span> <span class="p">[</span><span class="n">errors</span><span class="p">[</span><span class="n">besti</span><span class="p">]],</span> <span class="s1">&#39;r*&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;best result&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">1.0</span><span class="p">],</span> <span class="p">[</span><span class="n">uniform_error</span><span class="p">],</span> <span class="s1">&#39;b*&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;uniform mesh result&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Uniform mesh (a = 1) gives an error of 1.766687
Minimum error of 0.036023 when a = 10.600000
</pre></div>
</div>
<img alt="../_images/05645a5c3d7b6ea680db7e4e4a4aa1017b6ab7602b3959531359e3084cc27e79.png" src="../_images/05645a5c3d7b6ea680db7e4e4a4aa1017b6ab7602b3959531359e3084cc27e79.png" />
</div>
</details>
</div>
<section id="comments">
<h4><a class="toc-backref" href="#id46" role="doc-backlink">Comments</a><a class="headerlink" href="#comments" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Note that if you vary <span class="math notranslate nohighlight">\(N\)</span> above, <span class="math notranslate nohighlight">\(a \approx 10\)</span> is always a good choice.</p></li>
<li><p>The optimal stretching is (hopefully obviously) a function of <span class="math notranslate nohighlight">\(Pe\)</span>, e.g. for <span class="math notranslate nohighlight">\(Pe=10\)</span> a value of <span class="math notranslate nohighlight">\(a=4\)</span> is closer to optimal.</p></li>
</ul>
</section>
</section>
</section>
<section id="the-time-dependent-unsteady-advection-diffusion-problem">
<h2><a class="toc-backref" href="#id47" role="doc-backlink">The time-dependent (unsteady) advection-diffusion problem</a><a class="headerlink" href="#the-time-dependent-unsteady-advection-diffusion-problem" title="Permalink to this heading">#</a></h2>
<p>Let’s return to the time-dependent, or unsteady, form of the <a class="reference external" href="https://en.wikipedia.org/wiki/Convection%E2%80%93diffusion_equation"><em>advection-diffusion</em> (or sometimes <em>convection-diffusion</em>)</a> probklem</p>
<div class="math notranslate nohighlight">
\[\frac{\partial c}{\partial t} + U\frac{\partial c}{\partial x} = \kappa\frac{\partial^2 c}{\partial x^2}, \]</div>
<p>with initial and boundary conditions</p>
<div class="math notranslate nohighlight">
\[c(x,0)=c^0(x),  \;\;\;\;\;\; c(0,t) = 0, \;\;\;\;\;\; c(L,t)=c_E\]</div>
<br>
<p>Recalling again that the Peclet number</p>
<div class="math notranslate nohighlight">
\[ Pe = \frac{UL}{\kappa}, \]</div>
<p>still describes the relative importance of advection to diffusion.</p>
<section id="discretising-in-space">
<h3><a class="toc-backref" href="#id48" role="doc-backlink">Discretising in space</a><a class="headerlink" href="#discretising-in-space" title="Permalink to this heading">#</a></h3>
<p>Recall the <em>method of lines</em> approach which invovled discretising in space first to form a coupled system of ODEs.</p>
<br>
<p>Using central differences in space for both advection and diffusion (remembering that there are potential stability concerns with the use of a central difference for advection!!),
at location <span class="math notranslate nohighlight">\(x_i\)</span> the discretised form of the PDE tells us that</p>
<div class="math notranslate nohighlight">
\[ 
\frac{\partial c_i}{\partial t} = \kappa\frac{c_{i+1} - 2c_i + c_{i-1}}{\Delta x^2} - U\frac{c_{i+1} - c_{i-1}}{2\Delta x}  , \]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[c_i \equiv c_i(t) \approx c(x_i,t). \]</div>
<p>and since we have used central schemes for both advection and diffusion the spatial truncation error is <span class="math notranslate nohighlight">\(\mathcal{O}({\Delta x^2})\)</span>.</p>
<section id="including-dirichlet-boundary-conditions">
<h4><a class="toc-backref" href="#id49" role="doc-backlink">Including Dirichlet boundary conditions</a><a class="headerlink" href="#including-dirichlet-boundary-conditions" title="Permalink to this heading">#</a></h4>
<p>We need to consider appropriate boundary conditions for this problem, and here for simplicity we can initially just use exactly the same discretised boundary conditions as we did when we considered the corresponding BVP:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
x=0: &amp; \;\;\;\; \frac{1}{2}(c_0 + c_1) = 0, \\[5pt]
x=L: &amp; \;\;\;\; \frac{1}{2}(c_N + c_{N+1}) = c_E,
\end{split}\]</div>
<p>for a given value <span class="math notranslate nohighlight">\(c_E\)</span>.</p>
<br>
<p>In order to formulate these as ODEs to add in to our ODE system above, we differentiate:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{1}{2}(c_0 + c_1) &amp;= 0 \;\;\;\;\implies\;\;\;\; \frac{1}{2}\left(\frac{d c_0}{d t} + \frac{d c_1}{d t}\right) = 0, \\[5pt]
\frac{1}{2}(c_N + c_{N+1}) &amp;= c_E \;\;\;\;\implies\;\;\;\; \frac{1}{2}\left(\frac{d c_N}{d t} + \frac{d c_{N+1}}{d t}\right) = \frac{d c_E}{d t}\;\;\; \text{(which we assume to be zero)}.
\end{split}\]</div>
<p>We therefore have two extra ODEs for the two ghost nodes, but note that they’re not at the moment quite in the simple form <span class="math notranslate nohighlight">\(\frac{d{\boldsymbol{c}}}{dt} = \boldsymbol{f}\,(t,\boldsymbol{c}(t))\)</span>, but we will see below how we deal with this.</p>
<p>We need to specify corresponding initial conditions, which we can obtain simply by evaluating the BC at the initial time (which we assume it <span class="math notranslate nohighlight">\(t=0\)</span>) to yield</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{1}{2}(c_0(t=0) + c_1(t=0)) &amp;= 0 \;\;\;\;\implies\;\;\;\; c_0^0 = -c_1^0, \\[5pt]
\frac{1}{2}(c_N(t=0) + c_{N+1}(t=0)) &amp;= c_E \;\;\;\;\implies\;\;\;\;  c_{N+1}^0 =  2c_E - c_N^0.
\end{split}\]</div>
</section>
<section id="the-semi-discretised-system">
<h4><a class="toc-backref" href="#id50" role="doc-backlink">The (semi-) discretised system</a><a class="headerlink" href="#the-semi-discretised-system" title="Permalink to this heading">#</a></h4>
<p>Our <em><strong>semi-discretised system</strong></em> thus takes the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}
  \begin{cases}
\frac{1}{2}(c_0 + c_1) &amp;= 0 \\[5pt]
\frac{\partial c_1}{\partial t}  &amp; = \kappa\frac{c_{2} - 2c_1 + c_{0}}{\Delta x^2} -  U\frac{c_{2} - c_{0}}{2\Delta x} \\[5pt]
\vdots \\[5pt]
\frac{\partial c_N}{\partial t}  &amp; = \kappa\frac{c_{N+1} - 2c_N + c_{N-1}}{\Delta x^2} -  U\frac{c_{N+1} - c_{N-1}}{2\Delta x} \\[5pt]
\frac{1}{2}(c_N + c_{N+1}) &amp;= c_E,
  \end{cases}
\end{split}\]</div>
<p>[It’s really just a matter of style if we use <span class="math notranslate nohighlight">\({\partial c_i}/{\partial t}\)</span> or <span class="math notranslate nohighlight">\({d c_i}/{d t}\)</span> here since recall that <span class="math notranslate nohighlight">\(c_i \equiv c_i(t)\)</span> - i.e. we only now have time as a proper independent variable.]</p>
<p>At the moment this system comprises <span class="math notranslate nohighlight">\(N\)</span> coupled ODEs, coupled to two algebraic conditions representing the two boundary conditions.</p>
<p>A general ODE solver won’t necessarily be able to deal with the algebraic conditions, as they are likely set-up to solve systems given in the form</p>
<div class="math notranslate nohighlight">
\[\frac{d{\boldsymbol{c}}}{dt} = \boldsymbol{f}\,(t,\boldsymbol{c}(t)),\;\;\;\;\;\; \boldsymbol{c}\,(0)=\boldsymbol{c}^0.\]</div>
<br>
<p>[Note that <em><strong>differential-algebraic equation (DAE) solvers</strong></em> do exist (e.g. <em>DASSL</em>: <a class="reference external" href="https://www.osti.gov/biblio/5882821-description-dassl-differential-algebraic-system-solver">https://www.osti.gov/biblio/5882821-description-dassl-differential-algebraic-system-solver</a>), we just won’t consider them here].</p>
<br>
<p>However, we can convert this into a system of <span class="math notranslate nohighlight">\(N+2\)</span> coupled ODEs fairly easily.</p>
<p>To achiece this, let’s first differentiate the semi-discrete boundary conditions in time:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{1}{2}(c_0 + c_1) &amp;= 0 \;\;\;\;\implies\;\;\;\; \frac{1}{2}\left(\frac{d c_0}{d t} + \frac{d c_1}{d t}\right) = 0, \\[5pt]
\frac{1}{2}(c_N + c_{N+1}) &amp;= c_E \;\;\;\;\implies\;\;\;\; \frac{1}{2}\left(\frac{d c_N}{d t} + \frac{d c_{N+1}}{d t}\right) = \frac{d c_E}{d t}.
\end{split}\]</div>
<p>For simplicity here we will assume that our boundary condition <span class="math notranslate nohighlight">\(c_E\)</span> is constant in time and so the RHS of the second equation is also zero, this could easily be generalised.</p>
<p>We therefore have two extra ODEs for the two ghost nodes.</p>
<p>They’re not at the moment quite in the simple form <span class="math notranslate nohighlight">\(\frac{d{\boldsymbol{c}}}{dt} = \boldsymbol{f}\,(t,\boldsymbol{c}(t))\)</span>, but we will see below how we deal with this.</p>
<p>Being ODEs we do of course need corresponding initial conditions. We know that we want the BCs to hold at all time levels, and so we can just evaluate the BC at the initial time (which we assume it <span class="math notranslate nohighlight">\(t=0\)</span>) to yield</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{1}{2}(c_0(t=0) + c_1(t=0)) &amp;= 0 \;\;\;\;\implies\;\;\;\; c_0^0 = -c_1^0, \\[5pt]
\frac{1}{2}(c_N(t=0) + c_{N+1}(t=0)) &amp;= c_E \;\;\;\;\implies\;\;\;\;  c_{N+1}^0 =  2c_E - c_N^0.
\end{split}\]</div>
</section>
</section>
<section id="the-semi-disrete-matrix-system">
<h3><a class="toc-backref" href="#id51" role="doc-backlink">The semi-disrete matrix system</a><a class="headerlink" href="#the-semi-disrete-matrix-system" title="Permalink to this heading">#</a></h3>
<p>Now that we’ve dealt with the BCs, the semi-discrete ODE system can be written as</p>
<div class="math notranslate nohighlight">
\[M \, \frac{d\boldsymbol{c}}{dt} = B \, \boldsymbol{c},\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\boldsymbol{c} &amp; := \begin{pmatrix}
c_0\\
c_1\\
\vdots\\
c_N\\
c_{N+1}
\end{pmatrix},
\;\;\;\;\;\;\;\;\;\;\;\;
M := \begin{pmatrix}
    \frac{1}{2} &amp; \frac{1}{2} &amp; 0 &amp; \cdots &amp; \cdots  &amp; 0 \\
    0 &amp; 1 &amp; 0 &amp; \ldots &amp;   &amp; 0 \\    
    \vdots &amp;  &amp;  &amp; \ddots &amp;   &amp; 0 \\  
       &amp;  &amp;  &amp; 0  &amp;  1 &amp; 0 \\  
    0 &amp; \cdots &amp;  &amp; 0 &amp; \frac{1}{2}  &amp; \frac{1}{2}
\end{pmatrix},
\\[10pt]
B &amp; := \begin{pmatrix}
    0 &amp; 0 &amp; 0 &amp; \ldots &amp; \dots  &amp; 0 \\
    \left\{r_{\text{diff}} + r_{\text{adv}}\right\} &amp; \left\{-2r_{\text{diff}}\right\} &amp; \left\{r_{\text{diff}} - r_{\text{adv}}\right\} &amp; 0 &amp; &amp; \vdots \\
    0 &amp; \ddots &amp; \ddots &amp; \ddots &amp;  &amp; \vdots \\
    \vdots &amp;  &amp;  &amp;  &amp;  &amp; 0 \\
      &amp;  &amp; 0 &amp;\left\{r_{\text{diff}}+r_{\text{adv}}\right\} &amp; \left\{-2r_{\text{diff}}\right\} &amp; \left\{r_{\text{diff}} - r_{\text{adv}}\right\}\\    
    0 &amp; \ldots &amp; \ldots &amp; 0 &amp; 0  &amp; 0
\end{pmatrix},
\end{split}\]</div>
<p>and we have used the shorthand notation</p>
<div class="math notranslate nohighlight">
\[r_{\text{adv}} := \frac{U}{2\Delta x}, \;\;\;\;\;\;\;\; r_{\text{diff}} := \frac{\kappa}{\Delta x^2}.\]</div>
<p>The matrix <span class="math notranslate nohighlight">\(M\)</span> is present here because of the form of our BCs.</p>
<p>This isn’t quite in the form we need for a general ODE solver, but this is easily rectified by simply multiplying through by the inverse of <span class="math notranslate nohighlight">\(M\)</span>:</p>
<div class="math notranslate nohighlight">
\[\frac{d\boldsymbol{c}}{dt} = M^{-1} \, B \, \boldsymbol{c},\]</div>
<p>which is in the form</p>
<div class="math notranslate nohighlight">
\[\frac{d\boldsymbol{c}}{dt} = A \, \boldsymbol{c},\]</div>
<p>where <span class="math notranslate nohighlight">\(A := M^{-1} \, B\)</span>.</p>
<p>Let’s form these spatial discretisation matrices for a small problem to check what they look like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># physical parameters</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Pe</span>

<span class="c1"># define spatial mesh</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># find the RHS discretisation matrices</span>

<span class="c1"># define first the parameters we defined above</span>
<span class="n">r_diff</span> <span class="o">=</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
<span class="n">r_adv</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">U</span> <span class="o">/</span> <span class="n">dx</span>

<span class="c1"># and use them to create the B matrix - recall zeros on the first and last rows</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span> <span class="o">+</span> <span class="n">r_adv</span>
    <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r_diff</span>
    <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span> <span class="o">-</span> <span class="n">r_adv</span>

<span class="c1"># create M matrix - start from the identity</span>
<span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># and fix the first and last rows</span>
<span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>   
    
<span class="c1"># find A matrix</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">@</span> <span class="n">B</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B = &#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">M = &#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">A = &#39;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>B = 
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">36</span>
<span class="g g-Whitespace">     </span><span class="mi">33</span> <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">@</span> <span class="n">B</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;B = &#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">36</span> <span class="n">pprint</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">37</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">M = &#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span> <span class="n">pprint</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;pprint&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Let’s turn the assembly of the RHS discretisation matrix (<span class="math notranslate nohighlight">\(A\)</span>) into a function for use later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">assemble_adv_diff_disc_matrix_central</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to form the spatial discretisation matrix for </span>
<span class="sd">    advection-diffusion using central differences, given physical </span>
<span class="sd">    parameters U and kappa and assuming a uniform mesh of N interior </span>
<span class="sd">    nodes on the interval [0,L] with the ghost node approach.</span>
<span class="sd">    </span>
<span class="sd">    Returns the discretisation matrix A as well as the mesh x.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># define spatial mesh</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># define first the parameters we defined above</span>
    <span class="n">r_diff</span> <span class="o">=</span> <span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">r_adv</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">U</span> <span class="o">/</span> <span class="n">dx</span>

    <span class="c1"># and use them to create the B matrix - recall zeros on the first and last rows</span>
    <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span> <span class="o">+</span> <span class="n">r_adv</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">r_diff</span>
        <span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">r_diff</span> <span class="o">-</span> <span class="n">r_adv</span>

    <span class="c1"># create M matrix - start from the identity</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># and fix the first and last rows</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
    <span class="n">M</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>   

    <span class="c1"># find A matrix</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">M</span><span class="p">)</span> <span class="o">@</span> <span class="n">B</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">x</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="discretising-in-time">
<h3><a class="toc-backref" href="#id52" role="doc-backlink">Discretising in time</a><a class="headerlink" href="#discretising-in-time" title="Permalink to this heading">#</a></h3>
<p>We have a few options now. One is to just hand over this system to a “black box” ODE solver, the other is for us to take charge of the time-stepping task ourselves.</p>
<p>Firstly we prescribe a time step size <span class="math notranslate nohighlight">\(\Delta t\)</span> which allows us to now define the “space-time mesh”</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/space_time_stencil.svg"><img alt="../_images/space_time_stencil.svg" src="../_images/space_time_stencil.svg" width="70%" /></a>
</figure>
<p>where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
x_i &amp; := \left( i - \frac{1}{2}\right) \, \Delta x,   \;\;\;\;\textrm{for}\;\;\;\;  i=0,\ldots,N+1\\[5pt]
t^n &amp; := n\,\Delta t \;\;\;\;\textrm{for}\;\;\;\;  n=0,1,\ldots
\end{split}\]</div>
<section id="forward-euler">
<h4><a class="toc-backref" href="#id53" role="doc-backlink">Forward Euler</a><a class="headerlink" href="#forward-euler" title="Permalink to this heading">#</a></h4>
<p>Let’s implement the simplest method we know - forward Euler.</p>
<p>And let’s start from an initial condition given by the solution to the diffusion only problem (i.e. the linear solution joining the two BC values).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># physical parameters</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Pe</span>

<span class="c1"># define number of points in spatial mesh (N+2 including ghose nodes)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>

<span class="c1"># use the function we just wrote to form the spatial mesh and the discretisation matrix </span>
<span class="n">A</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">assemble_adv_diff_disc_matrix_central</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># define a time step size</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>

<span class="c1"># and compute and print some key non-dimensional parameters - we&#39;ll explain these later</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pe_c: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

<span class="c1"># define the end time and hence some storage for all solution levels</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># assume a constant dt and so can define all the t&#39;s in advance</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="c1"># and we can also set up a matrix to store the discrete solution in space-time</span>
<span class="c1"># with our a priori knowledge of the size required.</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>

<span class="c1"># define an initial condition - this one just linearly varies between the BC values, </span>
<span class="c1"># i.e. 0 and 1 - this linear solution is also the steady state solution to the diffusion </span>
<span class="c1"># only problem of course.</span>
<span class="c1"># Let&#39;s place this discrete solution in the first column of the C matrix which stores all solution levels</span>
<span class="n">C</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">CE</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span>

<span class="c1"># now let&#39;s do the time-stepping via a for loop</span>
<span class="c1"># we will need the identity matrix so define it once outside the loop</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">@</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">n</span><span class="p">]</span>
    

<span class="c1"># construct the exact solution to the **steady state** problem</span>
<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">Cex</span> <span class="o">=</span> <span class="n">CE</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span> <span class="o">*</span> <span class="n">xf</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">Pe</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adv-Diff time-dependent PDE solve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="c1"># plot the exact solution to the steady state version of problem</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">Cex</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;exact steady state solution&#39;</span><span class="p">)</span>

<span class="c1"># let&#39;s plot every 100th time level</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="c1"># to exclude ghost points just restrict the x limit of the plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an animation</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="c1"># First set up the figure, the axis, and the plot element we want to animate</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$C$&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Advection-Diffusion - convergence to the steady state solution&#39;</span><span class="p">)</span>
<span class="c1"># if we don&#39;t close the figure here we get a rogue frame under the movie</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">Cex</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact ss solution&#39;</span><span class="p">)</span>
<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;transient numerical solution&#39;</span><span class="p">)</span>
<span class="n">time_text</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;time = </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="n">number_frames</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">number_frames</span><span class="p">))</span>
<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span>
                               <span class="n">interval</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_jshtml</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<section id="id3">
<h5><a class="toc-backref" href="#id54" role="doc-backlink">Observations</a><a class="headerlink" href="#id3" title="Permalink to this heading">#</a></h5>
<ul class="simple">
<li><p>We chose here to use the initial condition from the diffusion-only steady state problem, i.e. a linear function which passes through the two boundary values, in part since its simple and since it has a physical basis.</p></li>
<li><p>The black line is the exact solution of the steady-state advection-diffusion problem we saw from the BVP section.</p></li>
<li><p>We can see from above that this time-dependent PDE is an example of a case where the unsteady problem converges in time to the steady solution, i.e. the steady solution represents the long-term behaviour of the transient unsteady problem.</p></li>
<li><p>We note also that this looks to be a stable solver …</p></li>
</ul>
<br>
<ul class="simple">
<li><p><strong>or at least we have selected numerical parameters that ensure that we remain stable - since we have used a central difference for advection and a forward Euler scheme in time (both of which we saw in previously were prone to going unstable unless we’re careful over the choice of <span class="math notranslate nohighlight">\(\Delta x\)</span> and <span class="math notranslate nohighlight">\(\Delta t\)</span>), this is indeed the case here.</strong></p></li>
</ul>
<br>
<ul class="simple">
<li><p><strong>We will lose stability if we make either <span class="math notranslate nohighlight">\(\Delta x\)</span> or <span class="math notranslate nohighlight">\(\Delta t\)</span> too large (relative to the underlying physics of the problem) - you can experiment with these numerical parameters to confirm this, or equivalently play with the physical parameters such as <span class="math notranslate nohighlight">\(U\)</span> or <span class="math notranslate nohighlight">\(Pe\)</span> to make the problem more challenging - remember that whether or not <span class="math notranslate nohighlight">\(\Delta x\)</span> or <span class="math notranslate nohighlight">\(\Delta t\)</span> are sufficiently fine is a relative consideration which is dependent on the spatial and temporal scales of the problem, which here are governed by <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(Pe\)</span> (or <span class="math notranslate nohighlight">\(\kappa\)</span>)!</strong></p></li>
</ul>
<br>
<ul class="simple">
<li><p>This is the cell Peclet number stability criteria for the steady state version of this problem from earlier - try implementing an solver that uses upwind for advection (see homework question).</p></li>
</ul>
</section>
</section>
</section>
<section id="example-advection-diffusion-of-a-gaussian">
<h3><a class="toc-backref" href="#id55" role="doc-backlink">Example - advection-diffusion of a Gaussian</a><a class="headerlink" href="#example-advection-diffusion-of-a-gaussian" title="Permalink to this heading">#</a></h3>
<p>The previous problem was dominated by the boundary conditions.</p>
<p>Let’s now consider a problem where a “blob” is advecting and diffusing in the interior of the domain, i.e. let’s consider dynamics away from the boundaries.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># physical parameters</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Pe</span>
<span class="c1"># set the RHS boundary value to zero as well as the left</span>
<span class="n">CE</span> <span class="o">=</span> <span class="mi">0</span>


<span class="c1"># define number of points in spatial mesh (N+2 including ghose nodes)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># use the function we just wrote to form the spatial mesh and the discretisation matrix </span>
<span class="n">A</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">assemble_adv_diff_disc_matrix_central</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># define a time step size</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0002</span>

<span class="c1"># and compute and print some key non-dimensional parameters</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pe_c: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

<span class="c1"># define the end time and hence some storage for all solution levels</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># assume a constant dt and so can define all the t&#39;s in advance</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="c1"># and we can also set up a matrix to store the discrete solution in space-time</span>
<span class="c1"># with our a priori knowledge of the size required.</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>

<span class="c1"># define an initial condition - a &quot;blob&quot; in the shape of a Gaussian</span>
<span class="c1"># and place it in the first column of the C matrix which stores all solution levels</span>
<span class="n">C</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># now let&#39;s do the time-stepping via a for loop</span>
<span class="c1"># we will need the identity matrix so define it once outside the loop</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">@</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">n</span><span class="p">]</span>
    

<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adv-Diff time-dependent PDE solve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># let&#39;s plot every 500th time level</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span><span class="mi">500</span><span class="p">):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>


<span class="c1"># to exclude ghost points just restrict the x limit of the plot</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h4><a class="toc-backref" href="#id56" role="doc-backlink">Observations</a><a class="headerlink" href="#id4" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>So the Gaussian is clearly advecting (translating to the right) and diffusing (getting shorter and fatter)!</p></li>
<li><p>Something that looks a little strange (it is still physically meaningful) happens when it hits the boundary due to the constraint of the Dirichlet BCs.</p></li>
<li><p>Next let’s see how to implement <em>periodic BCs</em>.</p></li>
</ul>
</section>
</section>
<section id="periodic-boundaries">
<h3><a class="toc-backref" href="#id57" role="doc-backlink">Periodic boundaries</a><a class="headerlink" href="#periodic-boundaries" title="Permalink to this heading">#</a></h3>
<p>Periodic boundaries, or boundary conditions, are useful since they effectively mean we can run a simulation indefinitely without an externally imposed boundary condition (e.g. of Dirichlet or Neumann type) impacting on the result. Essentially what goes out one end automatically comes in the other!</p>
<p>So here for this advection diffusion example instead of using our Dirichlet boundary conditions in our disretisation matrix, now we want to effectively loop our domain.</p>
<p>We can thus do away with the ghost nodes which we used to allow us to formulate a finite difference expression at the boundary, and where needed instead of using these ghost nodes, use the appropriate nodal values from the other end of the domain.</p>
<p>Topologically you can think of the mesh as being a circle.</p>
<p>Since we don’t have/need the ghost nodes anymore, we locate our <span class="math notranslate nohighlight">\(N\)</span> interior nodes such that the first and last correspond to the end point of our domain, i.e. we replace</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>with</p>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
<p>What this means for our discrete system is that our old <span class="math notranslate nohighlight">\(B\)</span> matrix of dimension (<span class="math notranslate nohighlight">\(N+2 \, \times \, N+2\)</span>, where <span class="math notranslate nohighlight">\(N\)</span> was the number of internal nodes)</p>
<div class="math notranslate nohighlight">
\[\begin{split}
B  := \begin{pmatrix}
    0 &amp; 0 &amp; 0 &amp; \ldots &amp; \dots  &amp; 0 \\
    \left\{r_{\text{diff}} + r_{\text{adv}}\right\} &amp; \left\{-r_{\text{diff}}\right\} &amp; \left\{r_{\text{diff}} - r_{\text{adv}}\right\} &amp; 0 &amp; &amp; \vdots \\
    0 &amp; \ddots &amp; \ddots &amp; \ddots &amp;  &amp; \vdots \\
    \vdots &amp;  &amp;  &amp;  &amp;  &amp; 0 \\
      &amp;  &amp; 0 &amp;\left\{r_{\text{diff}}+r_{\text{adv}}\right\} &amp; \left\{-r_{\text{diff}}\right\} &amp; \left\{r_{\text{diff}} - r_{\text{adv}}\right\}\\    
    0 &amp; \ldots &amp; \ldots &amp; 0 &amp; 0  &amp; 0
\end{pmatrix},
\end{split}\]</div>
<p>where we hadn’t yet included the boundary discretisation (which recall led to entries in the first and last column corresponding to the ghost nodes), can be generalised to the <span class="math notranslate nohighlight">\(N\times N\)</span> matrix</p>
<div class="math notranslate nohighlight">
\[\begin{split}
B  := \begin{pmatrix}
    \left\{-r_{\text{diff}}\right\} &amp; \left\{r_{\text{diff}} - r_{\text{adv}}\right\} &amp; 0 &amp; \ldots &amp; \dots  &amp; \left\{r_{\text{diff}} + r_{\text{adv}}\right\} \\
    \left\{r_{\text{diff}} + r_{\text{adv}}\right\} &amp; \left\{-r_{\text{diff}}\right\} &amp; \left\{r_{\text{diff}} - r_{\text{adv}}\right\} &amp; 0 &amp; &amp; \vdots \\
    0 &amp; \ddots &amp; \ddots &amp; \ddots &amp;  &amp; \vdots \\
    \vdots &amp;  &amp;  &amp;  &amp;  &amp; 0 \\
      &amp;  &amp; 0 &amp;\left\{r_{\text{diff}}+r_{\text{adv}}\right\} &amp; \left\{-r_{\text{diff}}\right\} &amp; \left\{r_{\text{diff}} - r_{\text{adv}}\right\}\\    
    \left\{r_{\text{diff}} - r_{\text{adv}}\right\} &amp; \ldots &amp; \ldots &amp; 0 &amp;\left\{r_{\text{diff}}+r_{\text{adv}}\right\} &amp; \left\{-r_{\text{diff}}\right\}
\end{pmatrix}.
\end{split}\]</div>
<p>As we’ll be using discretisations of advection and diffusion in periodic domains multiple times below let’s implement functions for these matrices individually.  Also note that in these examples we don’t multiply through by the <span class="math notranslate nohighlight">\(r_{\text{adv}}\)</span> and <span class="math notranslate nohighlight">\(r_{\text{diff}}\)</span> factors inside the functions and so need to remember to do so outside.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adv_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Funtion to generate the NxN discretisation matrix for advection</span>
<span class="sd">    using second-order central differences.</span>
<span class="sd">    </span>
<span class="sd">    NB. this version does not multiply through by the factor  (U / dx).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Dx</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Add in the wrapped values due to periodicity</span>
    <span class="n">Dx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
    <span class="n">Dx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">Dx</span>

<span class="k">def</span> <span class="nf">diff_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Funtion to generate the NxN discretisation matrix for diffusion</span>
<span class="sd">    using second-order central differences.</span>
<span class="sd">    </span>
<span class="sd">    NB. this version does not multiply through by the factor  (kappa / dx**2).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Dxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Add in the wrapped values due to periodicity</span>
    <span class="n">Dxx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">Dxx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="k">return</span> <span class="n">Dxx</span>
</pre></div>
</div>
</div>
</div>
<p>The interior rows of these matrices clearly take the form</p>
<div class="math notranslate nohighlight">
\[\begin{split}D_x = \begin{pmatrix}
     &amp;  &amp;  &amp;  &amp;    \\
     \ddots &amp; \ddots &amp; \ddots &amp;  &amp;    \\    
     &amp; -1/2 &amp; 0 &amp; 1/2 &amp;     \\  
     &amp;  &amp; \ddots &amp; \ddots  &amp;  \ddots  \\  
     &amp;  &amp;  &amp;  &amp; 
\end{pmatrix}\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}D_{xx} = \begin{pmatrix}
     &amp;  &amp;  &amp;  &amp;    \\
     \ddots &amp; \ddots &amp; \ddots &amp;  &amp;    \\    
     &amp; 1 &amp; -2 &amp; 1 &amp;     \\  
     &amp;  &amp; \ddots &amp; \ddots  &amp;  \ddots  \\  
     &amp;  &amp;  &amp;  &amp; 
\end{pmatrix}\end{split}\]</div>
<p>Let’s test these changes on the Gaussian problem and check that as the “blob” moves out of the right-hand boundary it comes back in at the left.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># physical parameters</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Pe</span>

<span class="c1"># define spatial mesh</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># create discretisation matrix</span>
<span class="n">Dx</span> <span class="o">=</span> <span class="n">adv_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">Dxx</span> <span class="o">=</span> <span class="n">diff_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dxx</span>

<span class="c1"># define a time step size</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.0002</span>

<span class="c1"># this is a slightly larger dt value mentioned in the comments after the movie</span>
<span class="c1">#dt = 0.000201</span>

<span class="c1"># and compute and print some key non-dimensional parameters</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pe_c: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL:  </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r:    </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

<span class="c1"># define the end time and hence some storage for all solution levels</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mi">1</span>
<span class="c1"># assume a constant dt and so can define all the t&#39;s in advance</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="c1"># and we can also set up a matrix to store the discrete solution in space-time</span>
<span class="c1"># with our a priori knowledge of the size required.</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
<span class="c1"># define an initial condition - a &quot;blob&quot; in the shape of a Gaussian</span>
<span class="c1"># and place it in the first column of the C matrix which stores all solution levels</span>
<span class="n">C</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># now let&#39;s do the time-stepping via a for loop</span>
<span class="c1"># we will need the identity matrix so define it once outside the loop</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[:,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">@</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">n</span><span class="p">]</span>
    
<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adv-Diff time-dependent PDE solve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="mi">5</span><span class="p">)):</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">i</span><span class="p">],</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an animation</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="c1"># First set up the figure, the axis, and the plot element we want to animate</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$C$&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Advection-diffusion of a Gaussian in a periodic domain&#39;</span><span class="p">)</span>
<span class="c1"># if we don&#39;t close the figure here we get a rogue frame under the movie</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">time_text</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;time = </span><span class="si">%.3f</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="n">number_frames</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">number_frames</span><span class="p">))</span>
<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span>
                               <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_jshtml</span><span class="p">())</span>
</pre></div>
</div>
</div>
</div>
<section id="id5">
<h4><a class="toc-backref" href="#id58" role="doc-backlink">Comments</a><a class="headerlink" href="#id5" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>If you increase the time step size (even by just a tiny amount) in the case above you will see our simulation goes unstable as the <span class="math notranslate nohighlight">\(r\)</span> parameter goes above 0.5.</p></li>
<li><p>Try a value of <span class="math notranslate nohighlight">\(\Delta t  = 0.00201\)</span>. Even though the still image is completely polluted by the later noise in the solution. Take a look at the corresponding movie to get an idea how the instability develops.</p></li>
<li><p>Note that in this implementation we are storing the <span class="math notranslate nohighlight">\(C\)</span> values at all time levels. This is useful for later plotting and for making movies, but might be too memory intensive. As this is a two time level scheme we only need to temporarily store the previous time level’s solution. We could do this with something like</p></li>
</ul>
<div class="highlight-Python notranslate"><div class="highlight"><pre><span></span><span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># define an initial condition</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">C_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">@</span> <span class="n">C_prev</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Setting <span class="math notranslate nohighlight">\(U=0\)</span> (or just not including the <code class="docutils literal notranslate"><span class="pre">Dx</span></code> matrix and corresponding function call) and you will see a solver for pure diffusion; similarly you can get an advection only solver by setting <span class="math notranslate nohighlight">\(\kappa=0\)</span>, although we know that this is likely to be unstable due to the infinite (cell) Peclet number and use of a central discretisation for advection.</p></li>
</ul>
</section>
</section>
</section>
<section id="id6">
<h2><a class="toc-backref" href="#id59" role="doc-backlink">Stability</a><a class="headerlink" href="#id6" title="Permalink to this heading">#</a></h2>
<p>So we hit a stability problem in the last example (when we made <span class="math notranslate nohighlight">\(\Delta t\)</span> just a little larger).</p>
<p>Given that we output three diagnostic quantities with each simulation above it may not be a surprise  that there are actually three “flavours” of stability we need to consider. There are three since there’s quite a lot going on in this problem, compared to what we’ve seen in the IVP and the BVP lectures which effectively considered parts of the current problem in isolation.</p>
<p>Recall from previous lectures that stability is a concept that essentially means that the inevitable discretisation errors that occur over a single time step or are localised to a single part of the spatial domain (e.g. in boundary layers we saw in the BVP lecture), do not “accumulate” or grow such that the quality and convergence of the overall numerical solve is compromised.</p>
<p>We’ll now explain the three stability issues we need to be aware of in this context, and how to manage them.</p>
<section id="cell-peclet-number">
<h3><a class="toc-backref" href="#id60" role="doc-backlink">Cell Peclet number</a><a class="headerlink" href="#cell-peclet-number" title="Permalink to this heading">#</a></h3>
<p>We know from our work on BVPs that an issue with mesh sizes comes when we are dealing with a central difference for advection, and the solution varies substantially over a small distance, e.g. in a boundary layer, or simply a concentration type field with sharp changes in solution value.</p>
<p>Previously we quantified this in terms of the cell Peclet number where for stability of the central scheme we found that instabilities can occur if we break the following bound on this non-dimensional number:</p>
<div class="math notranslate nohighlight">
\[Pe_c =  \frac{U\Delta x}{\kappa} &lt; 2.\]</div>
<p>[Recall that an upwind discretisation essentially added enough numerical dissipation that the numerical solution was never allowed to get too steep between discrete solution locations].</p>
<p>In the current unsteady (time-dependent) advection-diffusion case this stability criterion is still present and valid for the same reasons as for the steady case we discussed previously.  [Although note that with a very stable time-stepping method it is possible that we can push this limit a little bit before wiggles cause us problems].</p>
<p>If your solution goes unstable (catastrophically so in that it “blows up”, or just that it exhibits annoying/damaging wiggles) and through a study of key parameters such as the cell Peclet number you suspect that this phenomena is the problem, then you have three potential solutions:</p>
<br>
<ol class="arabic simple">
<li><p>Use a <strong>finer mesh</strong> (but this may be too costly)</p></li>
</ol>
<br>
<ol class="arabic simple" start="2">
<li><p>Use a <strong>different discretisation</strong> (e.g. upwind) - but this may be too inaccurate, and so may need to be performed in tandem with option 1, and with a study of potential errors [NB. given the interplay between the discretisations of advection, diffusion and the time-derivative term, it is possible that changing the latter two could also help with stability, but likely in a similar manner to upwind through the effective addition of spurious additional numerical diffusion]</p></li>
</ol>
<br>
<ol class="arabic simple" start="3">
<li><p><strong>Change the problem!</strong> E.g. here you could specify a larger <span class="math notranslate nohighlight">\(\kappa\)</span>.  Now of course <span class="math notranslate nohighlight">\(\kappa\)</span> is a physical quantity that is specified in the real world, changing physical parameters should therefore be done with caution and knowledge, and is really a topic for a course on “numerical <em>modelling</em>” rather that a course on “numerical methods” (cf. also the difference between model verification and model validation).</p></li>
</ol>
<br>
<p>Now in practice you may well perform a combination of all three of these “solutions”.  Some initially simply to understand the problem, and then you may iterate towards a practical solution which balances stability with your accuracy requirements and computational cost.</p>
</section>
<section id="the-courant-number-and-the-cfl-condition">
<h3><a class="toc-backref" href="#id61" role="doc-backlink">The Courant number and the CFL condition</a><a class="headerlink" href="#the-courant-number-and-the-cfl-condition" title="Permalink to this heading">#</a></h3>
<p>Recall that the stability criterion for the forward Euler method took the form</p>
<div class="math notranslate nohighlight">
\[\left|\;1-\lambda\Delta t\;\right|&lt;1, \]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda\)</span> was any one of the eigenvalues of the <span class="math notranslate nohighlight">\(A\)</span> matrix in our linear ODE system (and with similar expressions for other time-stepping methods based on their “amplification factors”).</p>
<p>We will, through consideration of the eigenvalues of our discretised system, see below that for our problem in the presence of advection this leads to what is termed the <a class="reference external" href="https://en.wikipedia.org/wiki/Courant%E2%80%93Friedrichs%E2%80%93Lewy_condition"><strong>CFL condition</strong></a> (after Courant, Friedrichs and Lewy):</p>
<div class="math notranslate nohighlight">
\[\frac{U\Delta t}{\Delta x} &lt; 1, \]</div>
<p>where the term on the LHS is generally termed the <strong>Courant number</strong> (sometimes the notation <span class="math notranslate nohighlight">\(C\)</span> is used - <span class="math notranslate nohighlight">\(C:=U\Delta t/L\)</span>).</p>
<p>We can also establish this stability criterion graphically/intuitively as we will do next.</p>
<p>But first note that if you suspect that this is the cause of an stability issues you again have several solutions:</p>
<br>
<ol class="arabic simple">
<li><p>Use a <strong>smaller time step</strong> (but as above, this may be too expensive).</p></li>
</ol>
<br>
<ol class="arabic simple" start="2">
<li><p><strong>Change the time stepping method</strong>, either for a different method with a more suitable stability region (cf. the stability region plots from the IVP lectures, and with suitability here being based on the locations of the eigenvalues in the complex plane and the corresponding size of the schemes’ stability region in the real and the imaginary directions), e.g. an A-stable implicit method - but this will possibly come at the expense of additional computational costs, and in the case of an implicit method (as for upwinding) while you may get a stable solution it won’t necessarily be accurate!</p></li>
</ol>
<br>
<ol class="arabic simple" start="3">
<li><p><strong>Change the physics</strong> of the problem - this is more difficult to achieve here than the suggestion above to change the value of diffusivity which we can sometimes get away with to a certain extent - we can’t really justify changing the speed of advection. Although note that in compressible fluids people often artificially slow down the speed of sound purely for time stepping stability reasons!</p></li>
</ol>
<br>
<ol class="arabic simple" start="4">
<li><p>Change <span class="math notranslate nohighlight">\(\Delta x\)</span>, e.g. <strong>make the mesh coarser</strong>.  We can do this, but only after giving due consideration to cell Peclet number related stability limits and of course required spatial accuracy!</p></li>
</ol>
<br>
<ol class="arabic simple" start="5">
<li><p>Note also that addressing a cell Peclet number instability as suggested above with a finer mesh, while fixing that issue could then lead to a CFL related instability!  <strong>All these issues/solutions are coupled</strong> and we need to understand this to effectively set up and optimise a simulation set-up.  In general if you halve <span class="math notranslate nohighlight">\(\Delta x\)</span>, say to either fix an instability or investigate convergence/accuracy, you may be well advised to also halve the time step size so as to maintain a constant Courant number (see below for a slightly different piece of advise when diffusion dominates - when halving <span class="math notranslate nohighlight">\(\Delta x\)</span> it may be advisable to divide the time step size by a factor of four).</p></li>
</ol>
</section>
<section id="the-cfl-condition-a-physical-interpretation">
<h3><a class="toc-backref" href="#id62" role="doc-backlink">The CFL condition - a physical interpretation</a><a class="headerlink" href="#the-cfl-condition-a-physical-interpretation" title="Permalink to this heading">#</a></h3>
<p>Further below we will derive the CFL condition through consideration of the eigenvalues of our discretisation matrix,</p>
<p>but first it’s useful to think about why it makes perfect sense from a more physical/geometrical perspective.</p>
<br>
<p>Consider the following schematic showing our discretisation stencil</p>
<figure class="align-default">
<a class="reference internal image-reference" href="../_images/CFL_schematic.svg"><img alt="../_images/CFL_schematic.svg" src="../_images/CFL_schematic.svg" width="75%" /></a>
</figure>
<br>
<p>A <strong>domain of dependence</strong> for an equation is defined as those points at earlier times which have an influence on the solution at a single point at a later time.</p>
<p>For this schematic, in grey we identify the numerical <em>domain of dependence</em>. This is clear from the stencil we are using - only the points <span class="math notranslate nohighlight">\(i-1\)</span>, <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(i+1\)</span> at the earlier time impact on the value at point <span class="math notranslate nohighlight">\(i\)</span> at the new time level. So in this case the domain of dependence is a triangle extending backwards from the point in question to cover the three nodes at the earlier time.</p>
<p>We can also define the <em>domain of dependence</em> for the continuous problem based on the speed of information propagation, e.g. the speed with which advection (or any other physical process whereby information in transmitted, e.g. through waves) propagate.</p>
<p>The CFL condition essentially states that a numerical method can be convergent only if its <strong>numerical domain of dependence contains the true domain of dependence of the PDE</strong>. If this is not the case then the numerical method will essentially be missing information in each of its time step updates.</p>
<p>From the schematic we can see that the maximum speed which information can propagate in this discrete scheme is given by the slopes of the grey triangle: <span class="math notranslate nohighlight">\(\Delta x/\Delta t\)</span> [note this has the units we might expect!] - with this stencil and method information can propagate a maximum of spatial cell size per time step.</p>
<p>Now in the case of advection with speed <span class="math notranslate nohighlight">\(U\)</span>, information propagates at the speed <span class="math notranslate nohighlight">\(U\)</span>. Hence here for the CFL condition to hold we need that</p>
<div class="math notranslate nohighlight">
\[ \frac{\Delta x}{\Delta t} &gt; U,\]</div>
<p>which is more commonly written as</p>
<div class="math notranslate nohighlight">
\[C:=\frac{U \Delta t}{\Delta x} &lt; 1. \]</div>
<p>More generally, all explicit time-stepping methods will be subject to a CFL condition of the form</p>
<div class="math notranslate nohighlight">
\[C &lt; C_{\text{max}}. \]</div>
</section>
<section id="the-r-number-parameter-for-diffusion">
<h3><a class="toc-backref" href="#id63" role="doc-backlink">The r-number/parameter for diffusion</a><a class="headerlink" href="#the-r-number-parameter-for-diffusion" title="Permalink to this heading">#</a></h3>
<p><em>Information</em> also propagates through diffusion (there are different “models” for diffusion, Fickian diffusion is the common one: <a class="reference external" href="https://en.wikipedia.org/wiki/Fick%27s_laws_of_diffusion">https://en.wikipedia.org/wiki/Fick’s_laws_of_diffusion</a>).</p>
<p>A <em>characteristic</em> time scale for this diffusive process can be given by</p>
<div class="math notranslate nohighlight">
\[ \tau_d : = \frac{\Delta x^2}{\kappa}. \]</div>
<p>From this we can define the so-called r-number or r-parameter</p>
<div class="math notranslate nohighlight">
\[ r: =  \frac{\kappa \Delta t}{\Delta x^2},\]</div>
<p>[check units] and, similar to the CFL condition, we need to ensure that information can propagate sufficiently quickly on our mesh, and thus by the same logic as above we arrive at a stability bound of the form</p>
<div class="math notranslate nohighlight">
\[ r &lt; r_{\text{max}},\]</div>
<p>[we will see below that <span class="math notranslate nohighlight">\(r_{\text{max}} = 1/2\)</span> for the discretisation options we have so far considered (i.e. FTCS in the language introduced next)].</p>
<br>
<p>Some comments on this:</p>
<ol class="arabic simple">
<li><p>Depending on whether advection or diffusion dominate the physics of our problem, this may or may not be a harsher constraint on the allowable time step sizes. Note that <span class="math notranslate nohighlight">\(r\)</span> and the Courant number <span class="math notranslate nohighlight">\(C\)</span> are related via the cell Peclet number:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[ \frac{C}{r} = \frac{ \frac{U \Delta t}{\Delta x} }{ \frac{\kappa \Delta t}{\Delta x^2} } 
= \frac{U \Delta x}{\kappa} = Pe_c.\]</div>
<ol class="arabic simple" start="2">
<li><p>Note a big difference now though is that <span class="math notranslate nohighlight">\(r\)</span> contains the mesh size squared. So the advice above for CFL where when halving the mesh size you may be advised to also halve the time step, when diffusion is dominant you may actually need to divide by a factor of 4!</p></li>
</ol>
</section>
</section>
<section id="other-time-stepping-options">
<h2><a class="toc-backref" href="#id64" role="doc-backlink">Other time stepping options</a><a class="headerlink" href="#other-time-stepping-options" title="Permalink to this heading">#</a></h2>
<p>Since we have followed a method of lines semi-discretisation approach we can decouple the choice of spatial discretisation from time-stepping. The approach we used above has the short-hand title FTCS, meaning forward in time and centred in space, but we have other options available to us, including:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\frac{\boldsymbol{c}^{n+1} - \boldsymbol{c}^{n}}{\Delta t} &amp;= A\boldsymbol{c}^{n}\;\; &amp;&amp; \text{FTCS: forward in time (FE, or RK1/AB1), central in space}\\ 
\frac{\boldsymbol{c}^{n+1} - \boldsymbol{c}^{n}}{\Delta t} &amp;= A\boldsymbol{c}^{n+1}\;\; &amp;&amp;  \text{BTCS: backward in time (BE, or AM0), central in space}\\
\frac{\boldsymbol{c}^{n+1} - \boldsymbol{c}^{n}}{\Delta t} &amp;= \frac{1}{2}A\left(\boldsymbol{c}^{n+1} + \boldsymbol{c}^{n}\right)\;\; &amp;&amp;  \text{Crank-Nicolson (AM2)}\\
\frac{\boldsymbol{c}^{n+1} - \boldsymbol{c}^{n}}{\Delta t} &amp;= A\left(\theta\boldsymbol{c}^{n+1} + (1-\theta)\boldsymbol{c}^{n}\right)\;\; &amp;&amp;  \text{Theta method}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(\theta\)</span> can be chosen in <span class="math notranslate nohighlight">\([0,1]\)</span> and of course includes the first three schemes with the choices <span class="math notranslate nohighlight">\(0\)</span>, <span class="math notranslate nohighlight">\(1\)</span> and <span class="math notranslate nohighlight">\(1/2\)</span>.</p>
<p>Of course through the use of either multi-step or multi-stage methods (as seen in earlier lectures) a huge number of time-stepping options are open to us.</p>
</section>
<section id="fourier-analysis-of-the-continuous-system-star-star">
<h2><a class="toc-backref" href="#id65" role="doc-backlink">Fourier analysis of the continuous system [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#fourier-analysis-of-the-continuous-system-star-star" title="Permalink to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>We will now spend some time analysing the performance of numerical solvers, we do this by considering what the solver does to certain simple types of solution (i.e. Fourier modes).</p>
<p>But before we consider what the numerical solver does, we need to understand what the PDE does for this type of solution.</p>
<p>[This is the analogue of considering whether or not the exact solution to the model problem <span class="math notranslate nohighlight">\(y'=\lambda\,y\)</span> tends to zero of infinity when we considered the stability of ODE solvers.  To be able to make progress analytically, there we simplified the problem but argued that it told us valuable information about more general problems. Here we take the approach of simplifying the form of the solution to our PDE problem, again arguing that it tells us very valuable things about solutions more generally.]</p>
<p>A Fourier analysis (or later what is often called a <em>von Neumann stability analysis</em> in the context of the discrete system) considers the behaviour of a <em>Fourier mode</em> solution to the PDE. To keep this analytical exercise simple we ignore boundaries - this would be the case for example if we considered a problem with periodic boundary conditions.</p>
<p>We start from a <em>Fourier mode</em> (for background see <a class="reference external" href="https://en.wikipedia.org/wiki/Fourier_series">https://en.wikipedia.org/wiki/Fourier_series</a>) of the form</p>
<div class="math notranslate nohighlight">
\[c(x,t) := \hat{c}(t)\,\exp(i\,k_m\,x),\]</div>
<p>with <a class="reference external" href="https://en.wikipedia.org/wiki/Wavenumber"><em>wavenumber</em></a></p>
<div class="math notranslate nohighlight">
\[k_m := \frac{2\pi m}{L},\]</div>
<p>(i.e. a mode with a wavelength of <span class="math notranslate nohighlight">\(\,\lambda = L/m\)</span>), where we will consider <span class="math notranslate nohighlight">\(\,m\in[1,2,\ldots]\,\)</span> so that have solutions which are both well and not well resolved on the mesh.</p>
<p>If you want you can just imagine a sine wave with this wavelength - the larger the value of <span class="math notranslate nohighlight">\(m\)</span> the higher the frequency/smaller the wavelength of the wave.</p>
<p>Substituting this form of solution into our continuous advection-diffusion PDE</p>
<div class="math notranslate nohighlight">
\[\frac{\partial c}{\partial t} + U\frac{\partial c}{\partial x} = \kappa\frac{\partial^2 c}{\partial x^2},\]</div>
<p>results in</p>
<div class="math notranslate nohighlight">
\[\left( \frac{d\hat{c}}{dt} + i\,k_m\,U\,\hat{c} + \kappa\, k_m^2\,\hat{c} \right)\,\exp(i\,k_m\,x) = 0.\]</div>
<p>This needs to be satisfied for all <span class="math notranslate nohighlight">\(x\)</span>, and the only way that can happen is if the term in parentheses is zero, i.e. provided that</p>
<div class="math notranslate nohighlight">
\[\frac{d\hat{c}}{dt} + i\,k_m\,U\,\hat{c} + \kappa\, k_m^2\,\hat{c} = 0 \;\; \iff \;\;
\frac{d\hat{c}}{dt} = \lambda_m\,\hat{c},\]</div>
<p>where the <em>‘eigenvalue’</em> <span class="math notranslate nohighlight">\(\lambda_m\)</span> is defined as</p>
<div class="math notranslate nohighlight">
\[\lambda_m := -i\,k_m\,U - \kappa\,k_m^2.\]</div>
<p>The solution to this ODE is of course</p>
<div class="math notranslate nohighlight">
\[\hat{c}(t) = \hat{c}(0)\,\exp(\lambda_m t),\]</div>
<p>and hence the behaviour of the full Fourier mode solution to the PDE in space and time is described by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
c(x,t) &amp;= \hat{c}(t)\,\exp(i\,k_m\,x)\\[5pt]
       &amp; = \hat{c}(0)\,\exp(\lambda_m t)\,\exp(i\,k_m\,x)\\[5pt]
       &amp; = \hat{c}(0)\,\exp( - \kappa\,k_m^2\,t)\,\exp(i\,(k_m\,x\,-\,\omega_m\,t)),
\end{split}\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[\omega_m = k_m\,U,\]</div>
<p>can be termed the <a class="reference external" href="https://en.wikipedia.org/wiki/Angular_frequency"><em>angular frequency</em></a>.</p>
<p class="rubric">Comments</p>
<ul class="simple">
<li><p>The first exponential (i.e. <span class="math notranslate nohighlight">\( \exp( - \kappa\,k_m^2\,t) \)</span>) is a damping term (it gets smaller as <span class="math notranslate nohighlight">\(t\)</span> gets bigger), since physically we can assume <span class="math notranslate nohighlight">\(\kappa\ge 0\)</span>, we can assume <span class="math notranslate nohighlight">\(t&gt;0\)</span>, and <span class="math notranslate nohighlight">\(k_m^2&gt;0\)</span>. This means that we expect the solution components to decay with time.</p></li>
<li><p>Note also that the larger the wavenumber <span class="math notranslate nohighlight">\(k_m\)</span> is (i.e. the smaller the Fourier mode’s wavelength), the more rapidly the decay occurs - <strong>shorter wavelengths are damped more strongly</strong>.</p></li>
<li><p>The second exponential term (<span class="math notranslate nohighlight">\( \exp(i\,(k_m\,x\,-\,\omega_m\,t) = \exp(i\,(k_m\,(x\,-\,U\,t))\)</span>)  tells us that all wave modes travel at the same speed (note that wave speed is also often termed <em>celerity</em>) - i.e. the speed of travel is independent of the wave number (this is sometimes termed <strong>non-dispersive</strong> behaviour).</p></li>
<li><p>We use a waterfall plot next to demonstrate the advection and diffusion - you can change the wavenumber to see how it affects the rate of dissipation (but not the speed of propagation).</p></li>
</ul>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Pe</span>    <span class="o">=</span> <span class="mi">100</span>
<span class="n">U</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">L</span>     <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Pe</span>

<span class="n">m</span>  <span class="o">=</span> <span class="mi">2</span>
<span class="n">km</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">m</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">L</span>

<span class="k">def</span> <span class="nf">C_Fourier_exact</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span> <span class="o">-</span><span class="n">kappa</span> <span class="o">*</span> <span class="n">km</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span> <span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span> <span class="n">km</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">U</span> <span class="o">*</span> <span class="n">t</span><span class="p">))</span>

<span class="c1"># from https://stackoverflow.com/questions/11209646/waterfall-plot-python</span>
<span class="k">def</span> <span class="nf">waterfall_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Make a waterfall plot</span>
<span class="sd">    Input:</span>
<span class="sd">        fig,ax : matplotlib figure and axes to populate</span>
<span class="sd">        Z : n,m numpy array. Must be a 2d array even if only one line should be plotted</span>
<span class="sd">        X,Y : n,m array</span>
<span class="sd">        kwargs : kwargs are directly passed to the LineCollection object</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Set normalization to the same values for all plots</span>
    <span class="n">norm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">Z</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">Z</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="c1"># Check sizes to loop always over the smallest dimension</span>
    <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">&gt;</span><span class="n">m</span><span class="p">:</span>
        <span class="n">X</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="p">;</span> <span class="n">Y</span><span class="o">=</span><span class="n">Y</span><span class="o">.</span><span class="n">T</span><span class="p">;</span> <span class="n">Z</span><span class="o">=</span><span class="n">Z</span><span class="o">.</span><span class="n">T</span>
        <span class="n">m</span><span class="p">,</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span><span class="n">m</span>

    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
        <span class="c1"># reshape the X,Z into pairs </span>
        <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">X</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span> <span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">,:]])</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">segments</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">points</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
        <span class="c1"># The values used by the colormap are the input to the array parameter</span>
        <span class="n">lc</span> <span class="o">=</span> <span class="n">LineCollection</span><span class="p">(</span><span class="n">segments</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;plasma&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="p">(</span><span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">Z</span><span class="p">[</span><span class="n">j</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">add_collection3d</span><span class="p">(</span><span class="n">lc</span><span class="p">,</span><span class="n">zs</span><span class="o">=</span><span class="p">(</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span><span class="o">+</span><span class="n">Y</span><span class="p">[</span><span class="n">j</span><span class="p">,:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span> <span class="c1"># add line to axes</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span> <span class="c1"># add colorbar, as the normalization is the same for all</span>
    <span class="c1"># it doesent matter which of the lc objects we use</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">auto_scale_xyz</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">Z</span><span class="p">)</span> <span class="c1"># set axis limits</span>

<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">LineCollection</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">C_Fourier_exact</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">)</span>
<span class="c1"># Generate waterfall plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">waterfall_plot</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">C</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="n">C_Fourier_exact</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">),</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;c(x,t)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> 
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span> 
<span class="c1">#fig.tight_layout()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">view_init</span><span class="p">(</span><span class="n">elev</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">azim</span><span class="o">=-</span><span class="mi">110</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="observations-exercises">
<h3><a class="toc-backref" href="#id66" role="doc-backlink">Observations / exercises</a><a class="headerlink" href="#observations-exercises" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>We see here the behaviour expected - the wave propagates (to the right as <span class="math notranslate nohighlight">\(U&gt;0\)</span>) and it diffuses.</p></li>
<li><p>Try with <span class="math notranslate nohighlight">\(m=1\)</span> (i.e. a longer wavelength wave) - you should see it propagates at the same rate, but that it diffuses slower.</p></li>
<li><p>With <span class="math notranslate nohighlight">\(m=3\)</span> and higher you should see a shorted wavelength that again propagates at the same speed, but that decays much more rapidly.</p></li>
</ul>
</section>
<section id="analysis">
<h3><a class="toc-backref" href="#id67" role="doc-backlink">Analysis</a><a class="headerlink" href="#analysis" title="Permalink to this heading">#</a></h3>
<p>The “eigenvalue” of the Fourier mode was given by</p>
<div class="math notranslate nohighlight">
\[\lambda_m = -i\,k_m\,U - \kappa\,k_m^2,\]</div>
<ul class="simple">
<li><p>the imaginary part comes from advection.   No advection (equivalently <span class="math notranslate nohighlight">\(U=0\)</span>) means that the eigenvalue is purely real (and note negative)</p></li>
<li><p>the real part comes from diffusion.  No diffusion (equivalently <span class="math notranslate nohighlight">\(\kappa =0\)</span>) means that the eigenvalue is purely imaginary, indicating oscillatory behaviour with no decay</p></li>
<li><p>You can see this through the specification of either  <span class="math notranslate nohighlight">\(U=0\)</span> or <span class="math notranslate nohighlight">\(\kappa =0\)</span> in the waterfall plot above.</p></li>
</ul>
</section>
</section>
<section id="eigenvalue-stability-analysis-of-the-semi-discrete-system">
<h2><a class="toc-backref" href="#id68" role="doc-backlink">Eigenvalue (stability) analysis of the semi-discrete system</a><a class="headerlink" href="#eigenvalue-stability-analysis-of-the-semi-discrete-system" title="Permalink to this heading">#</a></h2>
<p>Now we know something about the true behaviour of (representative) exact solutions to the PDE, let’s consider now how things change for the semi-discrete (i.e. discretised in space but still continuous in time) advection-diffusion problem using central schemes for both advection and diffusion:</p>
<div class="math notranslate nohighlight">
\[\frac{d\boldsymbol{c}}{dt} = A \, \boldsymbol{c},\]</div>
<p>we are ignoring BCs in this analysis and so we don’t have the <span class="math notranslate nohighlight">\(M\)</span> matrix on the LHS which was introduced in the process of dealing with Dirichlet BCs. (We can ignore BCs by assuming that our domain is periodic).</p>
<p>As we introduced in our implementation of periodic boundaries above, we can write the discretisation matrix <span class="math notranslate nohighlight">\(A\)</span> here as</p>
<div class="math notranslate nohighlight">
\[ A = -\frac{U}{\Delta x} D_x + \frac{\kappa}{\Delta x^2}D_{xx},\]</div>
<p>where the so-called difference or discretisation matrices</p>
<div class="math notranslate nohighlight">
\[\begin{split}D_x = \begin{pmatrix}
     &amp;  &amp;  &amp;  &amp;    \\
     \ddots &amp; \ddots &amp; \ddots &amp;  &amp;    \\    
     &amp; -1/2 &amp; 0 &amp; 1/2 &amp;     \\  
     &amp;  &amp; \ddots &amp; \ddots  &amp;  \ddots  \\  
     &amp;  &amp;  &amp;  &amp; 
\end{pmatrix},\end{split}\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[\begin{split}D_{xx} = \begin{pmatrix}
     &amp;  &amp;  &amp;  &amp;    \\
     \ddots &amp; \ddots &amp; \ddots &amp;  &amp;    \\    
     &amp; 1 &amp; -2 &amp; 1 &amp;     \\  
     &amp;  &amp; \ddots &amp; \ddots  &amp;  \ddots  \\  
     &amp;  &amp;  &amp;  &amp; 
\end{pmatrix}.\end{split}\]</div>
<br>
<p>Recall from our analysis of ODEs of this form (i.e. <span class="math notranslate nohighlight">\(\boldsymbol{y}'=A\boldsymbol{y}\)</span>) in an earlier lecture, that the stability of time-stepping methods is determined by the eigenvalues of <span class="math notranslate nohighlight">\(A\)</span> multiplied by <span class="math notranslate nohighlight">\(\Delta t\)</span>.</p>
<p>Let’s first compute the eigenvalues of the discretisation matrix <span class="math notranslate nohighlight">\(\,A\,\)</span> in the advection only and in the diffusion only cases, and for the time-being ignoring the factors <span class="math notranslate nohighlight">\(-U/\Delta x\)</span> and <span class="math notranslate nohighlight">\( \kappa/\Delta x^2 \)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>

<span class="n">Dx</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add in the wrapped values due to periodicity</span>
<span class="n">Dx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">Dx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">Dxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add in the wrapped values due to periodicity</span>
<span class="n">Dxx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Dxx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># compute the eigenvales of the Dx (advection) matrix alone</span>
<span class="n">Dx_eigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">Dx</span><span class="p">)</span>

<span class="c1"># compute the eigenvales of the Dxx (diffusion) matrix alone</span>
<span class="n">Dxx_eigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span><span class="n">Dxx</span><span class="p">)</span>

<span class="c1">#plot the eigenvalues in complex plane</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$Re(\lambda)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$Im(\lambda)$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eigenvalues of discretisation matrices (red = advection; blue = diffusion)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="c1"># add in the eigenvalues</span>
<span class="k">for</span> <span class="n">eig</span> <span class="ow">in</span> <span class="n">Dx_eigs</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eig</span><span class="p">),</span> <span class="s1">&#39;ro&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">eig</span> <span class="ow">in</span> <span class="n">Dxx_eigs</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eig</span><span class="p">),</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="id7">
<h3><a class="toc-backref" href="#id69" role="doc-backlink">Observations</a><a class="headerlink" href="#id7" title="Permalink to this heading">#</a></h3>
<ul class="simple">
<li><p>The advection discretisation matrix’s eigenvalues are all purely imaginary, and their magnitude is bounded above by 1 (i.e if you change the value of <span class="math notranslate nohighlight">\(N\)</span> you get a different number of eigenvalues of course, but they have the same range/bounds).</p></li>
<li><p>The diffusion discretisation matrix’s eigenvalues are purely real, and they lie between -4 and 0.</p></li>
<li><p><strong>Note that importantly in these calculations and plots we have not included the factors <span class="math notranslate nohighlight">\(U/{\Delta x}\)</span> and  <span class="math notranslate nohighlight">\(\kappa/{\Delta x^2}\)</span> - these will act to  scale the eigenvalues, and note that physically larger <span class="math notranslate nohighlight">\(U\)</span> and <span class="math notranslate nohighlight">\(\kappa\)</span> will make the magnitudes of the corresponding eigenvalues larger, but also refining the mesh with a smaller <span class="math notranslate nohighlight">\(\Delta x\)</span> will also act to make the eigenvalue magnitudes larger.</strong></p></li>
<li><p>[Combining the last two bullets - the furthest left eigenvalue for diffusion (blue dot) will have a value of <span class="math notranslate nohighlight">\(-4\kappa/{\Delta x^2}\)</span>, with the remainder spread between this and the origin - we’ll use this information in the next cell]</p></li>
<li><p>We know that for stability we need the eigenvalues of <span class="math notranslate nohighlight">\(A\)</span> multiplied by the time step size, <span class="math notranslate nohighlight">\(\Delta t\)</span>, to lie within the stability region for the particular time-stepping scheme we are employing.</p></li>
<li><p>We can use this information to derive stability bounds.</p></li>
<li><p>Below we’ll combine the advection AND diffusion discretisation matrices with the appropriate factors (i.e. form the full discretisation matrix <span class="math notranslate nohighlight">\(A\)</span>) and plot the corresponding eigenvalues - we’ll see that when combining two matrices it’s not quite a simple as simply summing the eigenvalues corresponding to advection and those corresponding diffusion.</p></li>
<li><p>But first let’s consider what the individual eigenvalues tell us about stability for advection and diffusion processes individually.</p></li>
</ul>
</section>
<section id="stability-criterion-for-diffusion-star">
<h3><a class="toc-backref" href="#id70" role="doc-backlink">Stability criterion for diffusion [<span class="math notranslate nohighlight">\(\star\)</span>]</a><a class="headerlink" href="#stability-criterion-for-diffusion-star" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>Consider first diffusion and recall the diffusion stability (or “r”) number defined as</p>
<div class="math notranslate nohighlight">
\[ r := \frac{\kappa\Delta t}{\Delta x^2}.\]</div>
<p>Physically, it can be understood to be the ratio of the time-increment <span class="math notranslate nohighlight">\(\Delta t\)</span> and the diffusive time-scale <span class="math notranslate nohighlight">\(\tau_d:=\Delta x^2/\kappa\)</span> (the time it takes to diffuse over a distance <span class="math notranslate nohighlight">\(\Delta x\)</span>).</p>
<p>If diffusive processes are simulated using time-integration schemes with a finite stability region, then stability will requires that</p>
<div class="math notranslate nohighlight">
\[r &lt; r_{\text{max}}, \]</div>
<p>where <span class="math notranslate nohighlight">\(r_{\text{max}}\)</span> depends on the specific discretisation employed.</p>
<p>So this is an analogous idea to CFL, just a different physical process by which information is transmitted.</p>
<p>Recall from above that <span class="math notranslate nohighlight">\(r\)</span> and the Courant number are linked by the cell-Peclet number</p>
<div class="math notranslate nohighlight">
\[ r = \frac{\kappa}{U\Delta x}\frac{U\Delta t}{\Delta x} = \frac{\text{C}}{Pe_c}. \]</div>
<p>Recall from earlier lectures that for forward Euler our absolute stability region restricted to the real axis is</p>
<div class="math notranslate nohighlight">
\[-2&lt;Re(\lambda)\,\Delta t &lt;0, \]</div>
<p>[we will also plot it below as a reminder].</p>
<p>Given that eigenvalues for diffusion are real and bounded above and below by zero and <span class="math notranslate nohighlight">\(-4{\kappa}/{\Delta x^2}\)</span>, substituting this knowledge into what we know of the stability region leads to the stability requirement</p>
<div class="math notranslate nohighlight">
\[-2&lt;Re(\lambda)\,\Delta t &lt;0 \;\;\iff\;\;-2 &lt; -4\frac{\kappa}{\Delta x^2} \Delta t &lt; 0 \;\;\iff\;\; 0&lt;r&lt;\frac{1}{2},\]</div>
<p>So for forward Euler <span class="math notranslate nohighlight">\(r_\text{max}=1/2\)</span>, which was the value we stated above where we saw the simulation of a Gaussian blob go unstable for a time step of <span class="math notranslate nohighlight">\(\Delta t  = 0.00201\)</span>.</p>
</div>
</section>
<section id="stability-criterion-for-advection-star">
<h3><a class="toc-backref" href="#id71" role="doc-backlink">Stability criterion for advection [<span class="math notranslate nohighlight">\(\star\)</span>]</a><a class="headerlink" href="#stability-criterion-for-advection-star" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Optional Content</p>
<p>By a very similar argument,</p>
<p>the stability number for advection is the Courant (or CFL) number defined as</p>
<div class="math notranslate nohighlight">
\[ \text{C} := \frac{U\Delta t}{\Delta x}.\]</div>
<p>Physically, it can be understood to be the ratio of the time-increment <span class="math notranslate nohighlight">\(\Delta t\)</span> and the advective time-scale <span class="math notranslate nohighlight">\(\tau_a:=\Delta x/U\)</span> (the time it takes to advect over a distance <span class="math notranslate nohighlight">\(\Delta x\)</span>).</p>
<p>If advective processes are simulated by time-integration schemes with a finite stability region then stability requires that</p>
<div class="math notranslate nohighlight">
\[\text{C} &lt; \text{C}_{\text{max}}, \]</div>
<p>where <span class="math notranslate nohighlight">\(\text{C}_{\text{max}}\)</span> depends on the specific discretisation employed.</p>
<p>For forward Euler we have the stability requirement in the imaginary direction that</p>
<div class="math notranslate nohighlight">
\[-1&lt;Im(\lambda)\,\Delta t &lt;1, \]</div>
<p>[in the plots that follow you’ll see that as soon as we have some diffusion the eigenvalues won’t actually be located on the imaginary axis]</p>
<p>and given that the eigenvalues of the advection discretisation matrix are purely imaginary and of magnitude bounded by one, this leads to the stability criterion</p>
<div class="math notranslate nohighlight">
\[ \frac{U\Delta t}{\Delta x} &lt; 1. \]</div>
<p>So for forward Euler <span class="math notranslate nohighlight">\(\text{C}_\text{max}=1\)</span>, which agrees with the schematic/physical based argument using domains of dependence we made above.</p>
</div>
</section>
</section>
<section id="stability-summary">
<h2><a class="toc-backref" href="#id72" role="doc-backlink">Stability summary</a><a class="headerlink" href="#stability-summary" title="Permalink to this heading">#</a></h2>
<p>So we have three stability conditions for the FTCS scheme:</p>
<br>
<ol class="arabic simple">
<li><p>Cell Peclet number condition:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[ PE_c:= \frac{U\Delta x}{\kappa} &lt; 2. \]</div>
<br>
<ol class="arabic simple" start="2">
<li><p>CFL condition:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[ \text{C} := \frac{U\Delta t}{\Delta x}&lt;1.\]</div>
<br>
<ol class="arabic simple" start="3">
<li><p>r-parameter condition:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[ r := \frac{\kappa\Delta t}{\Delta x^2} &lt; \frac{1}{2}.\]</div>
<br>
<p>We will now perform a study to fix these ideas and also see how these three conditions play off against one another (e.g. reducing <span class="math notranslate nohighlight">\(\Delta x\)</span> to the satisfy one condition can have implications for the others etc).</p>
</section>
<section id="stability-study-for-advection-diffusion">
<h2><a class="toc-backref" href="#id73" role="doc-backlink">Stability study for advection-diffusion</a><a class="headerlink" href="#stability-study-for-advection-diffusion" title="Permalink to this heading">#</a></h2>
<p>As we said above we really need to consider the eigenvalues of the full discretisation matrix <span class="math notranslate nohighlight">\(A\)</span> when we’re considering systems that contain both advection and diffusion, let’s compute and plot these now.</p>
<p>In the following plots we plot the eigenvalues multiplied by the time step size in the complex plane as blue dots.</p>
<p>Since so far we have considered the forward Euler time-stepping method, let’s also overlay the absolute stability region for FE as we computed in earlier lectures.</p>
<p>Our aim is really to understand whether the theory and analysis that has been conducted based on simplified problems or solutions carries over to more complicated scenarios.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s actually plot the eigenvalues of A assuming the presence of both advection and diffusion</span>

<span class="c1"># physical parameters</span>
<span class="n">Pe</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Pe</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">40</span>

<span class="n">Dx</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add in the wrapped values due to periodicity</span>
<span class="n">Dx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span>
<span class="n">Dx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="n">Dxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Add in the wrapped values due to periodicity</span>
<span class="n">Dxx</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Dxx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">A_eigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dxx</span> <span class="p">)</span>

<span class="c1">#plot the eigenvalues in the complex plane</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eigenvalues vs stability region&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1">#ax1.set_xlim(-5, 1)</span>
<span class="c1">#ax1.set_ylim(-2, 2)</span>
<span class="c1"># add in the eigenvalues</span>
<span class="k">for</span> <span class="n">eig</span> <span class="ow">in</span> <span class="n">A_eigs</span><span class="p">:</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
    
<span class="c1"># and the FE stability region</span>
<span class="c1"># we&#39;re again going to plot the stability region for forward Euler</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>
<span class="c1"># forward Euler amplification factor</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span>
<span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
<span class="c1"># forward Euler</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tab:grey&#39;</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Looking closely at this plot, do we expect this combination of physical and numerical parameters to result in a stable calculation?</p>
<p>Since we’re going to investigate the various issues at play here with various experiments, let’s write a function to solve the unsteady advection-diffusion problem (assuming a Gaussian initial condition), and then plot both the solution at a time level where the Guassian has advected a given distance, as well as the eigenvalues of the discretisation matrix overlain by the stability region for forward Euler.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Solve the advection-diffusion problem on a periodic domain</span>
<span class="sd">    with a hard coded Gaussian-shaped initial condition.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    C - the solution at the final time level.</span>
<span class="sd">    x - the spatial mesh.</span>
<span class="sd">    A - the discretisation matrix.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># define spatial mesh</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
       
    <span class="c1"># create discrerisation matrix</span>
    <span class="n">Dx</span> <span class="o">=</span> <span class="n">adv_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Dxx</span> <span class="o">=</span> <span class="n">diff_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dxx</span>

    <span class="c1">#  compute and print some key non-dimensional parameters</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pe_c: </span><span class="si">{0:.5f}</span><span class="s1">.  Stable: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="p">,</span> <span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="o">&lt;</span><span class="mi">2</span><span class="p">))</span>    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL:  </span><span class="si">{0:.5f}</span><span class="s1">.  Stable: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">,</span> <span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="o">&lt;</span><span class="mf">1.</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r:    </span><span class="si">{0:.5f}</span><span class="s1">.  Stable: </span><span class="si">{1}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.5</span><span class="p">))</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
    <span class="c1"># define an initial condition</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">C_prev</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">@</span> <span class="n">C_prev</span>
    <span class="k">return</span> <span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span>

<span class="k">def</span> <span class="nf">plot_eigs_stability</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to plot the forward Euler stability region and</span>
<span class="sd">    overlay it with dt multiplied by the eigenvalues of the matrix</span>
<span class="sd">    A in the complex plane.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A_eigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span> <span class="n">A</span> <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eigenvalues vs stability region&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="c1"># add in the eigenvalues</span>
    <span class="k">for</span> <span class="n">eig</span> <span class="ow">in</span> <span class="n">A_eigs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>
    <span class="c1"># and the FE stability region</span>
    <span class="c1"># we&#39;re again going to plot the stability region for forward Euler</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>
    <span class="c1"># forward Euler amplification factor</span>
    <span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span>
    <span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
    <span class="c1"># forward Euler</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;tab:grey&#39;</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">add_fig_axes_etc</span><span class="p">(</span><span class="n">ax</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adv-Diff time-dependent PDE solve&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>First let’s take a look at things where the physical and numerical parameters are such that we expect a stable calculation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># start with something we expect to be stable</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">100.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plot_eigs_stability</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># For our Gaussian blob test case we will get an indication of problems</span>
<span class="c1"># should the solution go negative anywhere - so print out C&#39;s minimum value.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Looks good.</p>
<p>We’ve printed out our key non-dimensional/stability parameters as well, they’re within the constraints we established earlier, equivalently all eigenvalues are within the absolute stability region and consequently the numerical solution appears stable (at least no wiggles or under/over shoots are visible).</p>
<p>Looking at the location of the eigenvalues (and the value of the Courant number) it would seem that we should be able to double the velocity <span class="math notranslate nohighlight">\(U\)</span> and still have a stable calculation - let’s confirm this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># From first image we see we can increase U</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">100.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plot_eigs_stability</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># For our Gaussian blob test case we will get an indication of problems</span>
<span class="c1"># should the solution go negative anywhere - so print out C&#39;s minimum value.</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Yes - it’s done what we expected, i.e. remained stable.</p>
<p>The numerical solution has decayed a lot less - this is due to the fact that since we have doubled <span class="math notranslate nohighlight">\(U\)</span> we have integrated for half the time for the Gaussian to have reached the same location; or said another way, the Peclet number for this problem is double what it was before - so advection is more dominant in comparison to diffusion.</p>
<p>We could of course have tweaked various physical and/or numerical parameters to explore their combined links with stability.</p>
<p>We can see from the locations of the eigenvalues that we can’t push things too much further before we’d expect to see instability, i.e. from the eigenvalues either extending too far to the left (making diffusion too high - e.g. try setting <span class="math notranslate nohighlight">\(\kappa = 1/50\)</span>), or too large in the imaginary direction (resulting from increasing <span class="math notranslate nohighlight">\(U\)</span>, e.g. try setting <span class="math notranslate nohighlight">\(U = 3\)</span>).</p>
<p>But notice also that we are right on the limit of the cell Peclet number stability bound here (if you were to zoom into the origin you would see the locations of the eigenvalues just skirting the inside of the stability region).</p>
<p>Let’s try setting <span class="math notranslate nohighlight">\(\kappa\)</span> smaller to see what happens if we push things, let’s halve it and so double the cell Peclet number (this makes the problem obvious although setting the cell Peclet number just a touch above 2 leads to small undershoots).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># but note what happens if we the decrease diffusion?</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">200.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plot_eigs_stability</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Now it’s not really a time-stepping instability we’re seeing (although these things are all coupled), rather we don’t have enough diffusivity to represent the steepness of the Gaussian at this mesh resolution - our cell Peclet number is too large - the eigenvalues are too close to the imaginary axis.</p>
<p>Since this is a result of too large a cell Peclet number (which is not dependent on the time step) we don’t expect a smaller time step to help us.</p>
<p>Thinking in terms of eigenvalues, reducing the time step will move the blue eigenvalues closer to the origin, but note that this will never actually pull them all inside the stability region - let’s check this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># can we save things with a smaller dt?</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">200.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.003</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plot_eigs_stability</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>So the details of our result are different, but we are still unstable (as expected). No matter how small we choose the time step we will still get instability - wiggles which lead to under and/or overshoots.</p>
<p>Of course we can attempt to fix the cell Peclet number issue with a smaller <span class="math notranslate nohighlight">\(\Delta x\)</span>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># So what about a smaller dx?</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">200.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">201</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.003</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plot_eigs_stability</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Ahhh - but now this has messed up both the CFL and the “r” criterion.</p>
<p>Of course a smaller <span class="math notranslate nohighlight">\(\Delta t\)</span> will save us again in this situation - try this yourself.</p>
<p>The moral of this little exercise is that the selection of diffusiviy <span class="math notranslate nohighlight">\(\kappa\)</span>, <span class="math notranslate nohighlight">\(U\)</span>, <span class="math notranslate nohighlight">\(\Delta t\)</span> and <span class="math notranslate nohighlight">\(\Delta x\)</span> are all coupled and there are multiple ways things can go unstable!</p>
<p>Let’s return to the original set of parameters, but now push up the value of diffusivity to break things in a different way!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># now see what happens when we push up diffusion (and hence r)</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">74.</span> <span class="c1"># recall that originally we had 1/100</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plot_eigs_stability</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<p>Now we go unstable due to the “r” stability criterion for diffusion.</p>
<p>Of course we could fix things here with a smaller <span class="math notranslate nohighlight">\(\Delta t\)</span>, but now let’s recall that from the earlier lectures on ODEs some time-steppers had a larger stability region - implicit is one option of course but would be a bit of extra coding work, and would require the solution of a linear system here in the case of a linear PDE.</p>
<p>Recall that RK4 in particular had a larger stability region. Let’s change nothing other than try using RK4:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; The RHS for our semi-discrete system is A*u</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">@</span> <span class="n">u</span>

<span class="k">def</span> <span class="nf">RK4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">t_max</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">A</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; This is the RK4 function from an earlier lecture,</span>
<span class="sd">    just updated to take in A, and use this A in the calls</span>
<span class="sd">    to the function f(.) in the stage calculations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u0</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t0</span><span class="p">)</span>
    <span class="n">u_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">u0</span><span class="p">]</span>
    <span class="n">t_all</span> <span class="o">=</span> <span class="p">[</span><span class="n">t0</span><span class="p">]</span>                 
    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_max</span><span class="p">:</span>
        <span class="n">k1</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="n">k2</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">u</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k1</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="n">k3</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">u</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">k2</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="n">k4</span> <span class="o">=</span> <span class="n">dt</span><span class="o">*</span><span class="n">f</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">,</span> <span class="n">u</span> <span class="o">+</span> <span class="n">k3</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">6.</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">k1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">k3</span> <span class="o">+</span> <span class="n">k4</span><span class="p">)</span>
        <span class="n">u_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="n">dt</span>
        <span class="n">t_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u_all</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_all</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">discretise_adv_diff_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Function to form the discretisation matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># define spatial mesh</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span> 
    <span class="c1"># create discrerisation matrix</span>
    <span class="n">Dx</span> <span class="o">=</span> <span class="n">adv_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Dxx</span> <span class="o">=</span> <span class="n">diff_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dxx</span>
    <span class="k">return</span> <span class="n">A</span>

<span class="c1"># the same parameters that failed with FE above</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">74.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">discretise_adv_diff_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>
<span class="n">Call</span><span class="p">,</span> <span class="n">tall</span> <span class="o">=</span> <span class="n">RK4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pe_c: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL:  </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r:    </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Call</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])))</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># RK4 stability region</span>
<span class="c1"># set up a mesh in x,y</span>
<span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">)</span>
<span class="c1"># define a complex parameter which is our lambda * dt quantity</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>
<span class="c1"># compute the &quot;amplification factor&quot; for RK4</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mi">24</span>
<span class="c1"># and its magnitude - we want this to be less than one for stability</span>
<span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
<span class="c1"># set up our figs for plotting</span>
<span class="c1"># plot the RK2 stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="c1"># overlay A&#39;s eigenvalues (multiplied by dt)</span>
<span class="n">A_eigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span> <span class="n">A</span> <span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eigenvalues vs stability region&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># add in the eigenvalues</span>
<span class="k">for</span> <span class="n">eig</span> <span class="ow">in</span> <span class="n">A_eigs</span><span class="p">:</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Call</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<p>So yes a change of (explicit) time-stepper has saved us.</p>
<p>We see from the eigenvalue and stability region plot that we can actually now push things quite a lot - let’s test this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">74.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">discretise_adv_diff_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>
<span class="n">Call</span><span class="p">,</span> <span class="n">tall</span> <span class="o">=</span> <span class="n">RK4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pe_c: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL:  </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r:    </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Call</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])))</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># RK4 stability region</span>
<span class="c1"># set up a mesh in x,y</span>
<span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">)</span>
<span class="c1"># define a complex parameter which is our lambda * dt quantity</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>
<span class="c1"># compute the &quot;amplification factor&quot; for RK4</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mi">24</span>
<span class="c1"># and its magnitude - we want this to be less than one for stability</span>
<span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
<span class="c1"># set up our figs for plotting</span>
<span class="c1"># plot the RK2 stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="c1"># overlay A&#39;s eigenvalues (multiplied by dt)</span>
<span class="n">A_eigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span> <span class="n">A</span> <span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eigenvalues vs stability region&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># add in the eigenvalues</span>
<span class="k">for</span> <span class="n">eig</span> <span class="ow">in</span> <span class="n">A_eigs</span><span class="p">:</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Call</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<p>Note that we’re now breaking the (FTCS) stability bounds we derived for forward Euler for BOTH advection and diffusion (the CFL and “r” conditions).</p>
<p>Since RK4 has a stability region close to the imaginary axis let’s return to a set of parameters we saw to be unstable above due to too large a cell Peclet number and the eigenvalues near the origin not quite being in the circular stability region for FE.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is a reminder of what FE did </span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">200.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>

<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">A</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plot_eigs_stability</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">A</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">C</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># parameters froma bove which were stable from a CFL and &quot;r&quot; perspective,</span>
<span class="c1"># but exhinitied isntability due to too large a cell Peclet number</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">200.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">L</span><span class="o">/</span><span class="n">U</span> <span class="c1"># so we always advect the same DISTANCE</span>


<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">discretise_adv_diff_central</span><span class="p">(</span><span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>
<span class="n">Call</span><span class="p">,</span> <span class="n">tall</span> <span class="o">=</span> <span class="n">RK4</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">A</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pe_c: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dx</span><span class="o">/</span><span class="n">kappa</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL:  </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r:    </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">kappa</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Check for undershoots: </span><span class="si">{0:.5e}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Call</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])))</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># RK4 stability region</span>
<span class="c1"># set up a mesh in x,y</span>
<span class="n">x_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">3.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_</span><span class="p">,</span> <span class="n">y_</span><span class="p">)</span>
<span class="c1"># define a complex parameter which is our lambda * dt quantity</span>
<span class="n">lamdt</span> <span class="o">=</span> <span class="n">xx</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">yy</span>
<span class="c1"># compute the &quot;amplification factor&quot; for RK4</span>
<span class="n">amp</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">lamdt</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="mi">6</span> <span class="o">+</span> <span class="n">lamdt</span><span class="o">**</span><span class="mi">4</span><span class="o">/</span><span class="mi">24</span>
<span class="c1"># and its magnitude - we want this to be less than one for stability</span>
<span class="n">ampmag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">amp</span><span class="p">)</span>
<span class="c1"># set up our figs for plotting</span>
<span class="c1"># plot the RK2 stability region</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">ampmag</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">colors</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;grey&#39;</span><span class="p">))</span>
<span class="c1"># overlay A&#39;s eigenvalues (multiplied by dt)</span>
<span class="n">A_eigs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigvals</span><span class="p">(</span> <span class="n">A</span> <span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Re(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$Im(\lambda)\Delta t$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Eigenvalues vs stability region&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="c1"># add in the eigenvalues</span>
<span class="k">for</span> <span class="n">eig</span> <span class="ow">in</span> <span class="n">A_eigs</span><span class="p">:</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">eig</span><span class="p">)</span><span class="o">*</span><span class="n">dt</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Call</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:],</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
<span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
</div>
<p>Notice that it hasn’t completely got rid of the undershoot, but the magnitude is now far smaller. This may be acceptable for your calculation.</p>
<p>Also note that in this particular case due to the Gaussian spreading (and hence becoming better resolved on the mesh), and the action of diffusion, if you integrate for longer the undershoot actually completely disappears - so we clearly are benefiting from being inside the stability region of this time-stepper.</p>
<p>This combination of parameters therefore is stable (this is not the case for forward Euler as you would see if you integrated for longer in the cell above!).</p>
</section>
<section id="von-neumann-fourier-stability-analysis-star-star">
<h2><a class="toc-backref" href="#id74" role="doc-backlink">Von Neumann / Fourier stability analysis [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#von-neumann-fourier-stability-analysis-star-star" title="Permalink to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>A von Neumann stability analysis is similar to the Fourier analysis we performed for the full continuous system - we will derive discrete analogues of the eigenvalue for a Fourier mode, and by comparing it to the exact eigenvalue we derived above:</p>
<div class="math notranslate nohighlight">
\[ \lambda_m = -i\,k_m\,U - \kappa\,k_m^2,\]</div>
<p>we will be able to make qualitative statements about the behaviour of the numerical solution in terms of its stability as well as its levels of dispersive and diffusive errors.</p>
<p class="rubric">Reminder - the  behaviour of the exact solution [<span class="math notranslate nohighlight">\(\star\star\)</span>]</p>
<p>Recall from above that for the continuous problem when we considered a solution of the form</p>
<div class="math notranslate nohighlight">
\[c(x,t) := \hat{c}(t)\,\exp(i\,k_m\,x),\;\;\;\;\; k_m := \frac{2\pi m}{L}\]</div>
<p>then we arrived at</p>
<div class="math notranslate nohighlight">
\[
c(x,t)  = \hat{c}(0)\,\exp( - \kappa\,k_m^2\,t)\,\exp(i\,(k_m\,x\,-\,\omega_m\,t)),\;\;\; \omega_m = k_m\,U.
\]</div>
<p>This analysis allowed us to make the following observations:</p>
<ul class="simple">
<li><p>The first exponential (i.e. <span class="math notranslate nohighlight">\( \exp( - \kappa\,k_m^2\,t) \)</span>) is a damping term (it gets smaller as <span class="math notranslate nohighlight">\(t\)</span> gets bigger), since physically we can assume <span class="math notranslate nohighlight">\(\kappa\ge 0\)</span>, we can assume <span class="math notranslate nohighlight">\(t&gt;0\)</span>, and <span class="math notranslate nohighlight">\(k_m^2&gt;0\)</span>. This means that we expect the solution components to decay with time.</p></li>
<li><p>Note also that the larger the wavenumber <span class="math notranslate nohighlight">\(k_m\)</span> is (i.e. the smaller the Fourier mode’s wavelength), the more rapidly the decay occurs - <strong>shorter wavelengths are damped more strongly</strong>.</p></li>
<li><p>The second exponential term (<span class="math notranslate nohighlight">\( \exp(i\,(k_m\,x\,-\,\omega_m\,t) = \exp(i\,(k_m\,(x\,-\,U\,t))\)</span>)  tells us that all wave modes travel at the same speed (note that wave speed is also often termed <em>celerity</em>) - i.e. the speed of travel is independent of the wave number (this is sometimes termed non-dispersive behaviour).</p></li>
<li><p>Finally recall the waterfall plot we used above to demonstrate advection and diffusion - the impact that changing the wavenumber had on rates of  dissipation/diffusion, but NOT the speed of propagation.</p></li>
</ul>
</div>
</section>
<section id="aside-the-wave-number-on-a-discrete-mesh">
<h2><a class="toc-backref" href="#id75" role="doc-backlink">Aside - the wave number on a discrete mesh</a><a class="headerlink" href="#aside-the-wave-number-on-a-discrete-mesh" title="Permalink to this heading">#</a></h2>
<p>For the continuous problem we could essentially consider <span class="math notranslate nohighlight">\(m\)</span> infinitely high and hence wave like solutions with arbitrarily small wavelengths. We can’t do this in the discrete case as we shall now see.</p>
<p>Recall that the wavenumber is given by</p>
<div class="math notranslate nohighlight">
\[k_m = \frac{2\pi m}{L}.\]</div>
<p>Consider the dimensionless quantity <span class="math notranslate nohighlight">\(k_m\,\Delta x\)</span>.  This quantity can be seen to be proportional to the number of grid points per wavelength (<span class="math notranslate nohighlight">\(\lambda = L/m\)</span>):</p>
<div class="math notranslate nohighlight">
\[k_m\,\Delta x = \frac{2\pi}{\lambda}\Delta x = \frac{2\pi m}{L}\frac{L}{N} = 2\pi \frac{m}{N}, \]</div>
<p>where <span class="math notranslate nohighlight">\(N\)</span> is the number of grid points in the domain <span class="math notranslate nohighlight">\([0,L]\)</span>.</p>
<p>The largest wave in the periodic domain is the <span class="math notranslate nohighlight">\(m=1\)</span> mode with a wavelength of <span class="math notranslate nohighlight">\(\lambda = L\)</span> and <span class="math notranslate nohighlight">\(N\)</span> grid points per wavelength.</p>
<p>The <span class="math notranslate nohighlight">\(m=2\)</span> mode has <span class="math notranslate nohighlight">\(N/2\)</span> grid points per wavelength,</p>
<p>and so on …</p>
<p>Let’s fix <span class="math notranslate nohighlight">\(N\)</span> and see what happens as we increase <span class="math notranslate nohighlight">\(m\)</span> and hence change the number of grid points per wavelength.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define spatial domain and mesh</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">h_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">)):</span>
    <span class="n">lam</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">m</span>
    <span class="n">km</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">lam</span>
    <span class="n">kmdx</span> <span class="o">=</span> <span class="n">km</span> <span class="o">*</span> <span class="n">dx</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">km</span> <span class="o">*</span> <span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">km</span><span class="o">*</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;ro&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$c$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Representing a Fourier mode.  $m=$</span><span class="si">{0:1d}</span><span class="s1">.  $k_m\Delta x = $</span><span class="si">{1:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">kmdx</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>You can perhaps already see that there’s an issue with the <span class="math notranslate nohighlight">\(m=4\)</span> wave above, which we can clarify/confirm from the following plot.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define spatial domain and mesh</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">m</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">lam</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">m</span>
<span class="n">km</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">lam</span>
<span class="n">kmdx</span> <span class="o">=</span> <span class="n">km</span> <span class="o">*</span> <span class="n">dx</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">xf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">km</span> <span class="o">*</span> <span class="n">xf</span><span class="p">),</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$k_m=2m\pi/L$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">xf</span><span class="p">),</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$k_m=2(N-m)\pi/L$&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">km</span><span class="o">*</span><span class="n">x</span><span class="p">),</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sample points&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Aliasing example&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$c$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.04</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<p>The problem is that if we only have the red sample points (as we will in a discrete numerical solver) then we cannot distinguish whether these sample points are from a wave with wavenumber <span class="math notranslate nohighlight">\(k_m = 2m\pi/L\)</span> (i.e. wavelength <span class="math notranslate nohighlight">\(\lambda = L/m\)</span>) or with a wavenumber <span class="math notranslate nohighlight">\(k_m = 2(N-m)\pi/L\)</span> (i.e. the longer  wavelength <span class="math notranslate nohighlight">\(\lambda = L/(N-m)\)</span>).</p>
<p>The issue of small wavelength signals not being resolvable on the grid and thus incorrectly represented or interpreted as a lower frequency signal is called <a class="reference external" href="https://en.wikipedia.org/wiki/Aliasing"><em>aliasing</em></a>.</p>
<section id="the-nyquist-limit-star-star">
<h3><a class="toc-backref" href="#id76" role="doc-backlink">The Nyquist limit [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#the-nyquist-limit-star-star" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>The smallest wave that can be resolved on the grid has two points per wave, i.e. a wavelength of <span class="math notranslate nohighlight">\(2\Delta x\)</span>.</p>
<p>This is sometimes termed the Nyquist limit, for which</p>
<div class="math notranslate nohighlight">
\[ k_m \Delta x = \pi.\]</div>
<p>When these modes occur in the simulation it is usually a sign that the problem requires more resolution</p>
<p>[or some other discretisation based fix/fudge is needed to preclude this from occurring – e.g. stabilisation/filtering].</p>
<p>These modes could occur due to a number of mechanisms - they are contained within our initial condition (e.g. our Gaussian initially being too steep), they form during a simulation, e.g. the formation of a boundary layer where the cell Peclet number is too high to preclude too steep a solution, or through the injection of energy into the system through a source term.</p>
</div>
</section>
</section>
<section id="stability-analysis-advection-with-central-differences-star-star">
<h2><a class="toc-backref" href="#id77" role="doc-backlink">Stability analysis - advection with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#stability-analysis-advection-with-central-differences-star-star" title="Permalink to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>Let’s consider the effect of spatial discretisation of advection using a second-order central difference:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial c_i}{\partial t} + U\frac{c_{i+1} - c_{i-1}}{2\Delta x}  = 0. \]</div>
<p>Proceeding as we did in the continuous case, consider a model solution which takes the form</p>
<div class="math notranslate nohighlight">
\[c_i(t) \equiv c(x_i,t) := \hat{c}(t)\,\exp(i\,k_m\,x_i),\]</div>
<p>and hence we have (dropping the <span class="math notranslate nohighlight">\(t\)</span> dependence notation):</p>
<div class="math notranslate nohighlight">
\[\begin{split}
c_{i+1} &amp; = \hat{c}\,\exp(i\,k_m\,x_{i+1}) = \hat{c}\,\exp(i\,k_m\,(x_{i} + \Delta x)) = \hat{c}\,\exp(i\,k_m\,\Delta x) \,\exp(i\,k_m\,x_{i}),\\[5pt]
c_{i-1} &amp; = \hat{c}\,\exp(i\,k_m\,x_{i-1}) = \hat{c}\,\exp(i\,k_m\,(x_{i} - \Delta x)) = \hat{c}\,\exp(-i\,k_m\,\Delta x) \,\exp(i\,k_m\,x_{i}).
\end{split}\]</div>
<p>Substitution into our difference formula results in</p>
<div class="math notranslate nohighlight">
\[\left( \frac{d \hat{c}}{d t} + U\frac{\exp(i\,k_m\,\Delta x) - \exp(-i\,k_m\,\Delta x)}{2\Delta x} \hat{c} \right) \exp(i\,k_m\,x_{i}) = 0.\]</div>
<p>For this expression to equal zero for all <span class="math notranslate nohighlight">\(m\)</span>’s we need the term in brackets to equal zero, i.e.</p>
<div class="math notranslate nohighlight">
\[ \frac{d \hat{c}}{d t} = \lambda_m\hat{c}
\;\;\;\;\;\; \text{where} \;\;\;\;\;\; 
\lambda_m = U\frac{\exp(i\,k_m\,\Delta x) - \exp(-i\,k_m\,\Delta x)}{2\Delta x}  = - i U \frac{\sin(\,k_m\,\Delta x)}{\Delta x}. \]</div>
<p>Just as in the continuous case, the solution to this ODE is clearly</p>
<div class="math notranslate nohighlight">
\[ \hat{c}(t) = \hat{c}(0) \exp(\lambda_m\,t), \]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[ \lambda_m = -i\,k_m\,U_{\text{num}},
\;\;\;\;\;\; \text{where} \;\;\;\;\;\; 
U_{\text{num}} := U \frac{\sin(\,k_m\,\Delta x)}{k_m\Delta x}.
\]</div>
<p>Recall the corresponding eigenvalue for the true solution in the case of advection only was</p>
<div class="math notranslate nohighlight">
\[ \lambda_m = -i\,k_m\,U ,\]</div>
<p>(obtained by setting <span class="math notranslate nohighlight">\(\,\kappa=0\,\)</span> in <span class="math notranslate nohighlight">\(\, \lambda_m = -i\,k_m\,U - \kappa\,k_m^2\)</span>.)</p>
<p>The ratio between the numerical propagation speed and the true one is given by</p>
<div class="math notranslate nohighlight">
\[\frac{U_{\text{num}}}{U} = \frac{\sin(\,k_m\,\Delta x)}{k_m\Delta x}.\]</div>
<p>Let’s plot this to see the impact of this difference between the continuous and discrete solution.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">kmdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kmdx</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kmdx</span><span class="p">)</span><span class="o">/</span><span class="n">kmdx</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Advection - central - dispersion error&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k_m\,\Delta x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$U_{{num}}/U$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="s1">&#39;r:&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="id8">
<h3><a class="toc-backref" href="#id78" role="doc-backlink">Comments</a><a class="headerlink" href="#id8" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>So, the effect of the (central) spatial discretisation is to modify the propagation velocity of the Fourier mode.</p>
<p>This is termed a <em>lagging phase error</em>, or a <a class="reference external" href="https://en.wikipedia.org/wiki/Numerical_dispersion"><em>dispersion error</em></a> where
shorter (less well-resolved) waves propagate too slowly.</p>
<p>The vertical dashed line indicates the Nyquist limit - this demonstrates that the shortest resolvable waves on the mesh actually do not propagate, and if we attempt to represent even shorter waves they actually propagate in the wrong direction!</p>
<p>Only very well resolved modes (the left of the plot with a <span class="math notranslate nohighlight">\(y\)</span> axis value of close to 1) propagate at close to the correct speed.</p>
<p>A way to see this is to attempt to advect an initial condition with a relatively steep jump (imagine a top hat function) - the sharp jump can be thought of as being a summation over Fourier modes of different frequencies - the sharper the jump the higher the frequencies in this summation.</p>
<p>Now for the continuous problem all these modes propagate at the same speed (non-dispersive behaviour), and so the solution even with a sharp jump moves together without changing shape and without any misalignment of the individual modes leading to “wiggles”.</p>
<p>However, due to dispersion errors in the spatially discretised system these modes move at wrong and different speeds, and the single sharp jump in the solution will thus break up - leading to errors in the numerical representation of the jump and its propagation, as well as oscillations/wiggles propagating away from the jump, and based on the comment above the highest frequency modes could actually propagate in the opposite direction to the advection direction.</p>
<p>Note that oscillations in a numerical solution close to high solution gradients are sometimes called <em>Gibbs oscillations</em>.</p>
<p>Let’s see an example of this in the following cell where we attempt to advect with central differences an initial condition with a sharp jump.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># physical parameters</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">U</span> <span class="o">=</span> <span class="mf">1.</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">0.</span>

<span class="c1"># define number of points in spatial mesh (N+2 including ghose nodes)</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># for the discretisation matrix and the mesh</span>
<span class="n">A</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">assemble_adv_diff_disc_matrix_central</span><span class="p">(</span><span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="c1"># define a time step size</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.002</span>

<span class="c1"># and compute and print some key non-dimensional parameters</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;CFL: </span><span class="si">{0:.5f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">U</span><span class="o">*</span><span class="n">dt</span><span class="o">/</span><span class="n">dx</span><span class="p">))</span>

<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
<span class="c1"># define an initial condition </span>
<span class="n">C</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="mf">100.</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">)))</span>

<span class="c1"># now let&#39;s do the time-stepping via a for loop</span>
<span class="c1"># we will need the identity matrix so define it once outside the loop</span>
<span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">C</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">@</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">n</span><span class="p">]</span>
    
<span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x/L$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$C/C_E$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Advection of a sharp front&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;k.-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Initial condition&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;b.-&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;End state&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="id9">
<h3><a class="toc-backref" href="#id79" role="doc-backlink">Observations</a><a class="headerlink" href="#id9" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>Note that our initial jump started at <span class="math notranslate nohighlight">\(x=0.4\)</span>, and our length if integration should have centred the jump at the plotted time level at <span class="math notranslate nohighlight">\(x=0.6\)</span>.</p>
<p>So from the image above it is clear that some of our “error” has propagated to the right, just too slowly, while some error (the highest frequency components) has actually propagated to the left.</p>
<p>This behaviour is consistent with the observations we made above based on the von Neumann analysis.</p>
<p>A movie may help clarify what’s going on here.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an animation</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>

<span class="c1"># First set up the figure, the axis, and the plot element we want to animate</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$C$&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Advection of a sharp front&#39;</span><span class="p">)</span>
<span class="c1"># if we don&#39;t close the figure here we get a rogue frame under the movie</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;numerical&#39;</span><span class="p">)</span>
<span class="n">time_text</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span> <span class="n">i</span><span class="p">])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;time = </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="o">*</span><span class="n">dt</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="n">number_frames</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">number_frames</span><span class="p">))</span>
<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span>
                               <span class="n">interval</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_jshtml</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="stability-analysis-diffusion-with-central-differences-star-star">
<h2><a class="toc-backref" href="#id80" role="doc-backlink">Stability analysis - diffusion with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#stability-analysis-diffusion-with-central-differences-star-star" title="Permalink to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>Now let’s consider the effect of spatial discretisation of diffusion using a second-order central difference:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial c_i}{\partial t} = \kappa \frac{c_{i+1} -2c_i +  c_{i-1}}{\Delta x^2}. \]</div>
<p>A repeat of the substitution above leads to the numerical solution</p>
<div class="math notranslate nohighlight">
\[ \hat{c}(t) = \hat{c}(0) \exp(\lambda_m\,t), \]</div>
<p>with the eigenvalue</p>
<div class="math notranslate nohighlight">
\[ \lambda_m =- \kappa_{\text{num}}\,k_m^2,\]</div>
<p>where recall that the diffusive component of the eigenvalue corresponding to the true continuous problem we have</p>
<div class="math notranslate nohighlight">
\[ \lambda_m =- \kappa \,k_m^2.\]</div>
<p>The numerical diffusivity appearing in the discrete eigenvalue is defined as</p>
<div class="math notranslate nohighlight">
\[ \kappa_{\text{num}} := \kappa \frac{\sin^2\left(\frac{k_m\,\Delta x}{2}\right)}{\left(\frac{k_m\,\Delta x}{2}\right)^2}.\]</div>
<p>As before we can plot the ratio of the numerical to the true diffusivity:</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">kmdx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-9</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kmdx</span><span class="p">,</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">kmdx</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">kmdx</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Diffusion - central - dissipation error&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$k_m\,\Delta x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\kappa_{{num}}/\kappa$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">],</span> <span class="s1">&#39;r:&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="id10">
<h3><a class="toc-backref" href="#id81" role="doc-backlink">Comments</a><a class="headerlink" href="#id10" title="Permalink to this heading">#</a></h3>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>The effect of the spatial discretisation here is to modify the damping rate of the Fourier mode.</p>
<p>This is a <em>dissipation error</em> where shorter (less well-resolved) waves are not damped as rapidly as they should be.</p>
<p>This is a major problem for small (e.g. grid-) scale noise or “wiggles” in a simulation.</p>
<p>Based on these results for advection and diffusion, if these wiggles are generated they sit there (as we saw above that dispersion errors mean that they move slowly, or not at all) and do not get damped down (due to dissipation errors).</p>
<p>In addition, whatever mechanism it was that lead to their generation in the first place is entirely likely to keep “feeding” them so they will grow and ultimately send the simulation unstable (it will “blow-up” in that you will likely rapidly hit overflow).</p>
<p>We can see this growth of grid scale noise in one of the examples we saw earlier - let’s look in detail at their growth.</p>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these are the same parameters we considered in an example above</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">U</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">kappa</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">74.</span> <span class="c1"># recall that originally we had 1/100</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.004</span>
<span class="n">tend</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">U</span><span class="o">/</span><span class="n">L</span>

<span class="k">def</span> <span class="nf">solve_adv_diff_Gaussian2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Solve the advection-diffusion problem on a periodic domain</span>
<span class="sd">    with a hard coded Gaussian-shaped initial condition.</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    C - the solution at all time levels.</span>
<span class="sd">    x - the spatial mesh.</span>
<span class="sd">    t - the time levels.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># define spatial mesh</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">L</span> <span class="o">/</span> <span class="n">N</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
       
    <span class="c1"># create discrerisation matrix</span>
    <span class="n">Dx</span> <span class="o">=</span> <span class="n">adv_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">Dxx</span> <span class="o">=</span> <span class="n">diff_central_periodic</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dx</span> <span class="o">+</span> <span class="p">(</span><span class="n">kappa</span> <span class="o">/</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">Dxx</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

    <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
    <span class="c1"># define an initial condition</span>
    <span class="n">C</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="mf">0.2</span><span class="p">)</span><span class="o">/</span><span class="mf">0.05</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">C</span><span class="p">[:,</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">I</span> <span class="o">+</span> <span class="n">A</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">@</span> <span class="n">C</span><span class="p">[:,</span><span class="n">n</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span>

<span class="c1"># set up figure</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">w_pad</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">h_pad</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">C</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="n">solve_adv_diff_Gaussian2</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">tend</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">kappa</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)):</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span><span class="n">n</span><span class="p">],</span> <span class="s1">&#39;.-&#39;</span><span class="p">)</span>
    <span class="n">add_fig_axes_etc</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Adv-Diff time-dependent PDE solve. $t=$</span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">n</span><span class="p">]),</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create an animation</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">animation</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
   
<span class="c1"># First set up the figure, the axis, and the plot element we want to animate</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">),</span> <span class="n">ylim</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">),</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;$C$&#39;</span><span class="p">,</span>
                      <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Zoom in of wiggle growth&#39;</span><span class="p">)</span>
<span class="c1"># if we don&#39;t close the figure here we get a rogue frame under the movie</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([],</span> <span class="p">[],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">time_text</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.78</span><span class="p">,</span> <span class="mf">0.92</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax1</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">init</span><span class="p">():</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">([],</span> <span class="p">[])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="k">def</span> <span class="nf">animate</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="n">line</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">C</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
    <span class="n">time_text</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="s1">&#39;time = </span><span class="si">{0:.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">line</span><span class="p">,</span> <span class="n">time_text</span>


<span class="n">number_frames</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">frames</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">/</span><span class="n">number_frames</span><span class="p">))</span>
<span class="n">anim</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">animate</span><span class="p">,</span> <span class="n">frames</span><span class="p">,</span>
                               <span class="n">interval</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">blit</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">init_func</span><span class="o">=</span><span class="n">init</span><span class="p">)</span>

<span class="n">HTML</span><span class="p">(</span><span class="n">anim</span><span class="o">.</span><span class="n">to_jshtml</span><span class="p">())</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="stability-analysis-advection-with-upwind-differences-star-star">
<h2><a class="toc-backref" href="#id82" role="doc-backlink">Stability analysis - advection with upwind differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><a class="headerlink" href="#stability-analysis-advection-with-upwind-differences-star-star" title="Permalink to this heading">#</a></h2>
<div class="dropdown admonition">
<p class="admonition-title">Advanced Content</p>
<p>Now let’s consider the effect of spatial discretisation of advection using a first-order upwind difference:</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial c_i}{\partial t} + U \frac{c_{i} - c_{i-1}}{\Delta x}. \]</div>
<p>A repeat of the substitutions above leads to the numerical solution</p>
<div class="math notranslate nohighlight">
\[ \hat{c}(t) = \hat{c}(0) \exp(\lambda_m\,t), \]</div>
<p>with eigenvalue</p>
<div class="math notranslate nohighlight">
\[ \lambda_m = -i\,k_m\,U_{\text{num}} - \kappa_{\text{num}}\,k_m^2.\]</div>
<p>So note now the difference to the central difference for advection, upwinding not only introduces a numerical propagation speed different to the true solution, it now also introduces some diffusion even though we are considering here the discretisation of a problem that has no real physical diffusion!</p>
<p>The values for the numerical propagation speed and the numerical diffusion are given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
U_{\text{num}} &amp;= U\frac{\sin(\,k_m\,\Delta x)}{k_m\Delta x},\\[5pt]
\kappa_{\text{num}} &amp;= \frac{U\Delta x}{2}\frac{\sin^2\left(\frac{k_m\,\Delta x}{2}\right)}{\left(\frac{k_m\,\Delta x}{2}\right)^2}.
\end{split}\]</div>
<p>This has the same dispersion error characteristics as the central scheme applied to advection; but adds numerical diffusion with maximum amplitude <span class="math notranslate nohighlight">\(U\Delta x/2\)</span>.</p>
</div>
</section>
<section id="summary">
<h2><a class="toc-backref" href="#id83" role="doc-backlink">Summary</a><a class="headerlink" href="#summary" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>We have reviewed finite difference approximations of derivatives.</p></li>
<li><p>We have used these to solve advection-diffusion type problems.</p></li>
<li><p>We have seen that the choice of whether we use central or upwind differences for advection is important for stability in the case of high <span class="math notranslate nohighlight">\(Pe\)</span> number problems.</p></li>
<li><p>Upwinding is robust but comes at the cost of reduced (order of) accuracy as well as the addition of spurious numerical dissipation.</p></li>
<li><p>An example has been given for how variable resolution can be used as an alternative method to increase stability.</p></li>
<li><p>Further stability conditions were derived and in total there are three key stability issues that need to be considered for unsteady advection-diffusion.</p></li>
<li><p>Advection-diffusion has many similarities with fluid dynamics - ALL of the concepts introduced today are also critical to the massive field of <em><strong>computational fluid dynamics (CFD)</strong></em> in its broadest terms - the issues and the potential solutions discussed are all highly relevant to CFD.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter11"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="intro.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">11. PDE Solvers: Finite Difference Methods 2</p>
      </div>
    </a>
    <a class="right-next"
       href="Homework.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Homework <a class="tocSkip"></p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of Contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#learning-objectives">Learning objectives:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-differences-review">Finite differences - review</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-forward-difference">The forward difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-backward-difference">The backward difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-central-difference">The central difference</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#taylor-series-to-estimate-accuracy">Taylor series to estimate accuracy</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-difference">Forward difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#backward-difference">Backward difference</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#central-difference">Central difference</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#finite-difference-approximation-of-second-and-higher-order-derivatives">Finite difference approximation of second (and higher order) derivatives</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-method-of-undetermined-coefficients-star">The method of undetermined coefficients [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#advection-diffusion-a-very-important-model-problem">Advection-diffusion: a very important model problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-non-dimensionalisation">Problem non-dimensionalisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-steady-state-advection-diffusion-problem-a-bvp">The steady-state advection-diffusion problem (a BVP)</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#defining-a-grid-or-mesh">Defining a grid (or mesh)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discretising-using-a-three-point-stencil-and-central-differences-for-advection-and-diffusion">Discretising using a three-point stencil and central differences for advection and diffusion</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-dirichlet-boundary-conditions">Dealing with Dirichlet boundary conditions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discrete-fluxes-star">Discrete fluxes [<span class="math notranslate nohighlight">\(\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#stability">Stability</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#upwind-for-advection">Upwind for advection</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#observations">Observations</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-the-upwind-scheme-star">Analysis of the upwind scheme [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#practicalities">Practicalities!</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#monotonicity">Monotonicity</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-uniform-and-adaptive-meshes-star-star">Non-uniform (and adaptive) meshes [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#coordinate-transformations-star-star">Coordinate transformations [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#an-example-an-ocean-domain-star-star">An example - an ocean domain [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#d-theory-star-star">1D theory  [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#choice-of-stretching-function-star-star">Choice of stretching function [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation-star-star">Implementation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#optimisation-star-star">Optimisation [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#comments">Comments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-time-dependent-unsteady-advection-diffusion-problem">The time-dependent (unsteady) advection-diffusion problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretising-in-space">Discretising in space</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#including-dirichlet-boundary-conditions">Including Dirichlet boundary conditions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#the-semi-discretised-system">The (semi-) discretised system</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-semi-disrete-matrix-system">The semi-disrete matrix system</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#discretising-in-time">Discretising in time</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#forward-euler">Forward Euler</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Observations</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#example-advection-diffusion-of-a-gaussian">Example - advection-diffusion of a Gaussian</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Observations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#periodic-boundaries">Periodic boundaries</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Comments</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Stability</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cell-peclet-number">Cell Peclet number</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-courant-number-and-the-cfl-condition">The Courant number and the CFL condition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-cfl-condition-a-physical-interpretation">The CFL condition - a physical interpretation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-r-number-parameter-for-diffusion">The r-number/parameter for diffusion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#other-time-stepping-options">Other time stepping options</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fourier-analysis-of-the-continuous-system-star-star">Fourier analysis of the continuous system [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#observations-exercises">Observations / exercises</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis">Analysis</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#eigenvalue-stability-analysis-of-the-semi-discrete-system">Eigenvalue (stability) analysis of the semi-discrete system</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">Observations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-criterion-for-diffusion-star">Stability criterion for diffusion [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-criterion-for-advection-star">Stability criterion for advection [<span class="math notranslate nohighlight">\(\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-summary">Stability summary</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-study-for-advection-diffusion">Stability study for advection-diffusion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#von-neumann-fourier-stability-analysis-star-star">Von Neumann / Fourier stability analysis [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#aside-the-wave-number-on-a-discrete-mesh">Aside - the wave number on a discrete mesh</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-nyquist-limit-star-star">The Nyquist limit [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-advection-with-central-differences-star-star">Stability analysis - advection with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">Comments</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Observations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-diffusion-with-central-differences-star-star">Stability analysis - diffusion with central differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">Comments</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stability-analysis-advection-with-upwind-differences-star-star">Stability analysis - advection with upwind differences [<span class="math notranslate nohighlight">\(\star\star\)</span>]</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Imperial College London
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>