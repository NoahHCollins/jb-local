

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>&lt;no title&gt; &#8212; Modelling and Numerical Methods</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter7/Solvers/Solver_pressure_driven_uneven_Vectorised';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="8. Turbulence and Non-Newtonian Flows" href="../../Chapter8/intro.html" />
    <link rel="prev" title="&lt;no title&gt;" href="Solver_pressure_driven_Vectorised.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Modelling and Numerical Methods
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 1 - Analytical Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Chapter1/intro.html">1. Intro to Vector/Tensor Calculus</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter1/Lecture%201.1%20-%20Intro%20to%20Vectors.html">1.1 Continuum Mechanics and Vector Calculus</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter1/Lecture%201.2%20-%20Vector%20Transformations.html">1.2 Vector Transformations  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter1/Lecture%201.3%20-%20Intro%20to%20Tensors.html">1.3 Intro to Tensors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter1/exercises.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter1/solutions.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Chapter2/intro.html">2. Stress Tensor</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter2/Lecture%202%20-%20Stress%20and%20Tensors.html">2.1 Stress and Tensors  <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter2/exercises2.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter2/solutions2.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Chapter3/intro.html">3. Kinematics and Strain</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter3/Lecture%203%20-%20Kinematics.html">3.1 Kinematics   <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter3/exercises3.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter3/solutions3.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Chapter4/intro.html">4. Conservation Equations</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter4/Lecture%204.1%20-%20Conservation%20Equations.html">4.1 Conservation Equations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter4/Lecture%204.2%20-%20Rheology.html">4.2 Rheology</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter4/exercises4.html">Exercises</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter4/solutions4.html">Solutions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Chapter5/intro.html">5. Dimensional Analysis</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter5/Lecture%205%20-%20Dimensions%20and%20Dimensional%20Analysis.html">5.1 Dimensions and Dimensional Analysis</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 2 - Numerical Solutions</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../intro.html">7. Navier-Stokes</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../Lecture%207.1%20-%20Navier-Stokes.html">7.1 Solving Navier-Stokes Numerically</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SolversIntro.html">Solvers</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Chapter8/intro.html">8. Turbulence and Non-Newtonian Flows</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter8/Lecture%208.1%20-%20Turbulent%20and%20Non-Newtonian%20Flows.html">8.1 Turbulent and Non-Newtonian Flows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter8/Worksheet.html">Worksheet</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter8/Solutions.html">Solutions</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part 3 - Numerical Techniques</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Chapter9/intro.html">9. Interpolation Quadrature 2</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter9/Lecture%209.1%20-%20interpolation%20quadrature.html">9.1 Interpolation &amp; Quadrature 2 <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter9/Homework.html">Homework <a class="tocSkip"></a></a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Chapter9/Solutions.html">Solutions <a class="tocSkip"></a></a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FChapter7/Solvers/Solver_pressure_driven_uneven_Vectorised.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Chapter7/Solvers/Solver_pressure_driven_uneven_Vectorised.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <p>Pressure Driven Uneven Solver</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">precision</span> 3
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">scipy.linalg</span> <span class="k">as</span> <span class="nn">sl</span>
<span class="kn">import</span> <span class="nn">scipy.sparse</span> <span class="k">as</span> <span class="nn">sp</span>
<span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span> <span class="k">as</span> <span class="nn">spla</span>
<span class="c1"># the following allows us to plot triangles indicating convergence order</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">cm</span>
<span class="c1"># and we will create some animations!</span>
<span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">HTML</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pressure_poisson_jacobi</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">RHS</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1.e-5</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Solve the pressure Poisson equation (PPE)</span>
<span class="sd">    using Jacobi iteration assuming mesh spacing of</span>
<span class="sd">    dx and dy (we assume at the moment that dx=dy)</span>
<span class="sd">    and the RHS function given by RHS.</span>
<span class="sd">    </span>
<span class="sd">    Assumes imposition of a Neumann BC on all boundaries.</span>
<span class="sd">    </span>
<span class="sd">    Return the pressure field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># iterate</span>
    <span class="n">tol</span> <span class="o">=</span> <span class="mf">10.</span><span class="o">*</span><span class="n">rtol</span>
    <span class="n">it</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">p_old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    
    <span class="n">imax</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">jmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">//</span><span class="n">imax</span>
    
    <span class="k">while</span> <span class="n">tol</span> <span class="o">&gt;</span> <span class="n">rtol</span><span class="p">:</span>
        <span class="n">it</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">#this version is valid for dx!=dy</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">+</span><span class="mf">2.0</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p_old</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">p_old</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                                <span class="p">(</span><span class="n">p_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">+</span> <span class="n">p_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                <span class="o">-</span> <span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">RHS</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        
        <span class="c1"># apply zero gradient Neumann boundary conditions at the no slip walls</span>
        <span class="n">p</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="p">(</span><span class="n">jmax</span><span class="o">-</span><span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="p">(</span><span class="n">jmax</span><span class="o">-</span><span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">)]</span>

        <span class="c1"># relative change in pressure</span>
        <span class="n">tol</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p_old</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">1.0e-10</span><span class="p">,</span><span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
        
        <span class="c1">#swap arrays without copying the data</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">p_old</span>
        <span class="n">p_old</span> <span class="o">=</span> <span class="n">p</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">temp</span>
        
    <span class="k">if</span> <span class="n">logs</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;pressure solve iterations = </span><span class="si">{:4d}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">it</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calculate_ppm_RHS_upwind</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">RHS</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the RHS of the </span>
<span class="sd">    Poisson equation resulting from the projection method.</span>
<span class="sd">    Use upwind differences for the first derivatives of u and v.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span><span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">])</span> <span class="o">+</span> 
              <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">RHS</span>

<span class="k">def</span> <span class="nf">calculate_ppm_RHS_central</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">RHS</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the RHS of the </span>
<span class="sd">    Poisson equation resulting from the projection method.</span>
<span class="sd">    Use central differences for the first derivatives of u and v.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RHS</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="n">dt</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">u</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span> 
                   <span class="o">+</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span> <span class="p">))</span>
    <span class="k">return</span> <span class="n">RHS</span>

<span class="k">def</span> <span class="nf">project_velocity</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">p</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Update the velocity to be divergence free using the pressure.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">rho</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">2</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dx</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">rho</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">:]</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">dy</span><span class="p">)</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>

<span class="k">def</span> <span class="nf">calculate_intermediate_velocity</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">u_old</span><span class="p">,</span> <span class="n">v_old</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the intermediate velocities.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># intermediate u</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span>
                      <span class="c1"># ADVECTION:  uu_x + vu_x</span>
                        <span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span>
                      <span class="c1"># see comments in the upwind based solver for advection above</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u_old</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">])</span> <span class="o">+</span>
                             <span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">])</span> <span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
                       <span class="c1"># DIFFUSION</span>
                         <span class="n">dt</span><span class="o">*</span><span class="n">nu</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u_old</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                 <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="p">)</span>
    <span class="c1"># intermediate v</span>
    <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">*</span> <span class="p">(</span>
                      <span class="c1"># ADVECTION:  uv_x + vv_x</span>
                        <span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span>
                      <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">u_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v_old</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">dx</span><span class="p">])</span> <span class="o">+</span>
                             <span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">],</span>
                      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">,</span>
                       <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">:],</span> <span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">dy</span><span class="p">])</span> <span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
                       <span class="c1"># DIFFUSION</span>
                        <span class="n">dt</span><span class="o">*</span><span class="n">nu</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v_old</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dx</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
                                 <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">v_old</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:],</span> <span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">dy</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="p">)</span>
    
    <span class="c1">#apply the velocity boundary condition to the intermediate velocity data</span>
    <span class="c1">#apply the velocity boundary condition</span>
    <span class="n">imax</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">jmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">//</span><span class="n">imax</span>
    <span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">:]</span>
    <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,:]</span>
    
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">solve_NS</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">courant</span><span class="p">,</span> <span class="n">dt_min</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">rtol</span> <span class="o">=</span> <span class="mf">1.e-5</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">outint</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Solve the incompressible Navier-Stokes equations</span>
<span class="sd">    using a lot of the numerical choices and approaches we&#39;ve seen</span>
<span class="sd">    earlier in this lecture.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">u_old</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">v_old</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">p_RHS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    
    <span class="n">time_it</span> <span class="o">=</span> <span class="mi">0</span> 
    
    <span class="k">while</span> <span class="n">t</span> <span class="o">&lt;</span> <span class="n">t_end</span><span class="p">:</span>
        <span class="n">time_it</span><span class="o">+=</span><span class="mi">1</span>
        <span class="c1">#set dt based on courant number</span>
        <span class="n">vel_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">vel_max</span><span class="o">&gt;</span><span class="mf">0.0</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">courant</span><span class="o">*</span><span class="nb">min</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">)</span><span class="o">/</span><span class="n">vel_max</span><span class="p">,</span><span class="n">dt_min</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">dt_min</span>
            
        <span class="n">t</span> <span class="o">+=</span> <span class="n">dt</span>
        <span class="k">if</span> <span class="n">logs</span> <span class="ow">and</span> <span class="n">time_it</span><span class="o">%</span><span class="k">outint</span> == 0: 
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Time = </span><span class="si">{:.8f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
            
        <span class="c1"># calculate intermediate velocities</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">calculate_intermediate_velocity</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">u_old</span><span class="p">,</span> <span class="n">v_old</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="c1"># PPM</span>
        <span class="c1"># calculate RHS for the pressure Poisson problem</span>
        <span class="n">p_RHS</span> <span class="o">=</span> <span class="n">calculate_ppm_RHS_central</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p_RHS</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="c1"># compute pressure - note that we use the previous p as an initial guess to the solution</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">pressure_poisson_jacobi</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">p_RHS</span><span class="p">,</span> <span class="mf">1.e-5</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="p">(</span><span class="n">logs</span> <span class="ow">and</span> <span class="n">time_it</span><span class="o">%</span><span class="k">outint</span> == 0))
        <span class="c1"># project velocity</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">project_velocity</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">logs</span> <span class="ow">and</span> <span class="n">time_it</span><span class="o">%</span><span class="k">outint</span> == 0:
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;norm(u) = </span><span class="si">{0:.8f}</span><span class="s1">, norm(v) = </span><span class="si">{1:.8f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">u</span><span class="p">),</span><span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v</span><span class="p">)))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Courant number: </span><span class="si">{0:.8f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span><span class="n">dy</span><span class="p">)))</span>
                
        <span class="c1">#swap pointers without copying data</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">u_old</span>
        <span class="n">u_old</span> <span class="o">=</span> <span class="n">u</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">temp</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">v_old</span>
        <span class="n">v_old</span> <span class="o">=</span> <span class="n">v</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">temp</span>
    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># physical parameters</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">10.</span>

<span class="c1"># define spatial mesh</span>
<span class="c1"># Size of rectangular domain</span>
<span class="n">Lx</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">Ly</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">P_max</span> <span class="o">=</span> <span class="mf">0.5</span>

<span class="c1"># Number of grid points in each direction, including boundary nodes</span>
<span class="n">Nx</span> <span class="o">=</span> <span class="mi">201</span>
<span class="n">Ny</span> <span class="o">=</span> <span class="mi">51</span>

<span class="c1"># hence the mesh spacing</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">/</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">Ly</span><span class="o">/</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># read the docs to see the ordering that mgrid gives us</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nx</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Ny</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">X</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">dy</span><span class="o">*</span><span class="n">Y</span>
<span class="c1"># the following is an alternative to the three lines above</span>
<span class="c1">#X, Y = np.mgrid[0: Lx + 1e-10: dx, 0: Ly + 1e-10: dy]</span>
<span class="c1"># but without the need to add a &quot;small&quot; increement to ensure</span>
<span class="c1"># the Lx and Ly end points are included</span>

<span class="c1"># initialise independent variables</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Apply Dirichlet BCs to u and v - the code below doesn&#39;t touch </span>
<span class="c1"># these so we can do this once outside the time loop</span>
<span class="n">u</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">u</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">imax</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">jmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">//</span><span class="n">imax</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="n">P_max</span>
<span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1">#set a Courant number and use dynamic time step</span>
<span class="n">courant</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">dt_min</span> <span class="o">=</span> <span class="mf">1.e-3</span>

<span class="n">t_end</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">solve_NS</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">courant</span><span class="p">,</span> <span class="n">dt_min</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1.e-6</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">outint</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time taken by calculation = &#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 0.92504142
pressure solve iterations =    9
norm(u) = 5.75588435, norm(v) = 0.82023177
Courant number: 0.00500413
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 1.56396603
pressure solve iterations =    4
norm(u) = 7.17385750, norm(v) = 1.01437241
Courant number: 0.00500118
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 2.12247992
pressure solve iterations =    2
norm(u) = 7.75132786, norm(v) = 1.09305978
Courant number: 0.00500050
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 2.65200717
pressure solve iterations =    2
norm(u) = 8.02592629, norm(v) = 1.13039598
Courant number: 0.00500024
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 3.16846933
pressure solve iterations =    1
norm(u) = 8.16407065, norm(v) = 1.14915841
Courant number: 0.00500012
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 3.67852842
pressure solve iterations =    1
norm(u) = 8.23535741, norm(v) = 1.15883487
Courant number: 0.00500006
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 4.18532702
pressure solve iterations =    1
norm(u) = 8.27260476, norm(v) = 1.16388939
Courant number: 0.00500003
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 4.69043372
pressure solve iterations =    1
norm(u) = 8.29219033, norm(v) = 1.16654680
Courant number: 0.00500002
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 5.19465397
pressure solve iterations =    1
norm(u) = 8.30252271, norm(v) = 1.16794865
Courant number: 0.00500001
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 5.69840745
pressure solve iterations =    1
norm(u) = 8.30798273, norm(v) = 1.16868950
Courant number: 0.00500000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 6.20191444
pressure solve iterations =    1
norm(u) = 8.31087038, norm(v) = 1.16908165
Courant number: 0.00500000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 6.70529101
pressure solve iterations =    1
norm(u) = 8.31239776, norm(v) = 1.16928979
Courant number: 0.00500000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 7.20859847
pressure solve iterations =    1
norm(u) = 8.31320551, norm(v) = 1.16940038
Courant number: 0.00500000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 7.71186913
pressure solve iterations =    1
norm(u) = 8.31363288, norm(v) = 1.16945651
Courant number: 0.00500000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 8.21511995
pressure solve iterations =    1
norm(u) = 8.31385676, norm(v) = 1.16948876
Courant number: 0.00500000
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 8.71836070
pressure solve iterations =    1
norm(u) = 8.31397423, norm(v) = 1.16950934
Courant number: 0.00500000
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">57</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="kn">import</span> <span class="nn">time</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="ne">---&gt; </span><span class="mi">57</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">solve_NS</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">courant</span><span class="p">,</span> <span class="n">dt_min</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1.e-6</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">outint</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span> <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time taken by calculation = &#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>

<span class="nn">Cell In[4], line 33,</span> in <span class="ni">solve_NS</span><span class="nt">(u, v, p, rho, nu, courant, dt_min, t_end, dx, dy, rtol, logs, outint)</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="n">p_RHS</span> <span class="o">=</span> <span class="n">calculate_ppm_RHS_central</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p_RHS</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">32</span> <span class="c1"># compute pressure - note that we use the previous p as an initial guess to the solution</span>
<span class="ne">---&gt; </span><span class="mi">33</span> <span class="n">p</span> <span class="o">=</span> <span class="n">pressure_poisson_jacobi</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">p_RHS</span><span class="p">,</span> <span class="mf">1.e-5</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="p">(</span><span class="n">logs</span> <span class="ow">and</span> <span class="n">time_it</span><span class="o">%</span><span class="k">outint</span> == 0))
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="c1"># project velocity</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">project_velocity</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="nn">Cell In[2], line 32,</span> in <span class="ni">pressure_poisson_jacobi</span><span class="nt">(p, dx, dy, RHS, rtol, logs)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="p">(</span><span class="n">jmax</span><span class="o">-</span><span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">)]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="p">(</span><span class="n">jmax</span><span class="o">-</span><span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">)]</span>
<span class="g g-Whitespace">     </span><span class="mi">31</span> <span class="c1"># relative change in pressure</span>
<span class="ne">---&gt; </span><span class="mi">32</span> <span class="n">tol</span> <span class="o">=</span> <span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="n">p_old</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mf">1.0e-10</span><span class="p">,</span><span class="n">sl</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">p</span><span class="p">))</span>
<span class="g g-Whitespace">     </span><span class="mi">34</span> <span class="c1">#swap arrays without copying the data</span>
<span class="g g-Whitespace">     </span><span class="mi">35</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">p_old</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/scipy/linalg/_misc.py:178,</span> in <span class="ni">norm</span><span class="nt">(a, ord, axis, keepdims, check_finite)</span>
<span class="g g-Whitespace">    </span><span class="mi">175</span>             <span class="k">return</span> <span class="n">lange</span><span class="p">(</span><span class="o">*</span><span class="n">lange_args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">177</span> <span class="c1"># fall back to numpy in every other case</span>
<span class="ne">--&gt; </span><span class="mi">178</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">ord</span><span class="o">=</span><span class="nb">ord</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.9.17/x64/lib/python3.9/site-packages/numpy/linalg/linalg.py:2552,</span> in <span class="ni">norm</span><span class="nt">(x, ord, axis, keepdims)</span>
<span class="g g-Whitespace">   </span><span class="mi">2550</span>     <span class="n">sqnorm</span> <span class="o">=</span> <span class="n">x_real</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_real</span><span class="p">)</span> <span class="o">+</span> <span class="n">x_imag</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x_imag</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2551</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2552</span>     <span class="n">sqnorm</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2553</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">sqnorm</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2554</span> <span class="k">if</span> <span class="n">keepdims</span><span class="p">:</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<span class="c1"># don&#39;t plot at every gird point - every 5th</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">],</span><span class="n">Y</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">],</span><span class="n">u</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">],</span><span class="n">v</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pressure driven problem - pressure and velocity vectors&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pressure driven problem - speed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Pressure driven problem - speed&#39;)
</pre></div>
</div>
<img alt="../../_images/3a00f15bf4562588157d2e0f58c865bfd140ffdeae3d3b60b1497a21e3e8cc4a.png" src="../../_images/3a00f15bf4562588157d2e0f58c865bfd140ffdeae3d3b60b1497a21e3e8cc4a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flow_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span><span class="o">*</span><span class="n">Ly</span>
<span class="n">flow_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span><span class="o">*</span><span class="n">Ly</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flow in &#39;</span><span class="p">,</span><span class="n">flow_in</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flow out &#39;</span><span class="p">,</span><span class="n">flow_out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>flow in  3.6400883324252575
flow out  3.6920762379752325
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># physical parameters</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">10.</span>

<span class="c1"># define spatial mesh</span>
<span class="c1"># Size of rectangular domain</span>
<span class="n">Lx</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="n">Ly</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="n">P_max</span> <span class="o">=</span> <span class="mf">5.0</span>

<span class="c1"># Number of grid points in each direction, including boundary nodes</span>
<span class="n">Nx</span> <span class="o">=</span> <span class="mi">201</span>
<span class="n">Ny</span> <span class="o">=</span> <span class="mi">51</span>

<span class="c1"># hence the mesh spacing</span>
<span class="n">dx</span> <span class="o">=</span> <span class="n">Lx</span><span class="o">/</span><span class="p">(</span><span class="n">Nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dy</span> <span class="o">=</span> <span class="n">Ly</span><span class="o">/</span><span class="p">(</span><span class="n">Ny</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># read the docs to see the ordering that mgrid gives us</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">Nx</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="n">Ny</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">dx</span><span class="o">*</span><span class="n">X</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">dy</span><span class="o">*</span><span class="n">Y</span>
<span class="c1"># the following is an alternative to the three lines above</span>
<span class="c1">#X, Y = np.mgrid[0: Lx + 1e-10: dx, 0: Ly + 1e-10: dy]</span>
<span class="c1"># but without the need to add a &quot;small&quot; increement to ensure</span>
<span class="c1"># the Lx and Ly end points are included</span>

<span class="c1"># initialise independent variables</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Apply Dirichlet BCs to u and v - the code below doesn&#39;t touch </span>
<span class="c1"># these so we can do this once outside the time loop</span>
<span class="n">u</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">u</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">v</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">imax</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="n">jmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">//</span><span class="n">imax</span>
<span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">jmax</span><span class="o">//</span><span class="mi">2</span><span class="p">):]</span> <span class="o">=</span> <span class="n">P_max</span>
<span class="n">p</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1">#set a Courant number and use dynamic time step</span>
<span class="n">courant</span> <span class="o">=</span> <span class="mf">0.005</span>
<span class="n">dt_min</span> <span class="o">=</span> <span class="mf">1.e-3</span>

<span class="n">t_end</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="kn">import</span> <span class="nn">time</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="n">solve_NS</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">courant</span><span class="p">,</span> <span class="n">dt_min</span><span class="p">,</span> <span class="n">t_end</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">rtol</span><span class="o">=</span><span class="mf">1.e-6</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">outint</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time taken by calculation = &#39;</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Time = 0.29128222
pressure solve iterations =    4
norm(u) = 26.40120295, norm(v) = 3.82856151
Courant number: 0.00500452

Time = 0.42434206
pressure solve iterations =    2
norm(u) = 35.59942847, norm(v) = 5.05105750
Courant number: 0.00500213

Time = 0.53042189
pressure solve iterations =    3
norm(u) = 42.01154659, norm(v) = 5.87103940
Courant number: 0.00500135

Time = 0.62274982
pressure solve iterations =    2
norm(u) = 47.02031125, norm(v) = 6.49357974
Courant number: 0.00500097

Time = 0.70638201
pressure solve iterations =    1
norm(u) = 51.15035533, norm(v) = 6.99497900
Courant number: 0.00500075

Time = 0.78389566
pressure solve iterations =    2
norm(u) = 54.66746928, norm(v) = 7.41343505
Courant number: 0.00500061

Time = 0.85681524
pressure solve iterations =    1
norm(u) = 57.72801356, norm(v) = 7.77118401
Courant number: 0.00500050

Time = 0.92613075
pressure solve iterations =    1
norm(u) = 60.43299488, norm(v) = 8.08241933
Courant number: 0.00500043

Time = 0.99252778
pressure solve iterations =    1
norm(u) = 62.85199799, norm(v) = 8.35690594
Courant number: 0.00500037

Time = 1.05650399
pressure solve iterations =    2
norm(u) = 65.03529862, norm(v) = 8.60158838
Courant number: 0.00500032

Time = 1.11843438
pressure solve iterations =    2
norm(u) = 67.02059863, norm(v) = 8.82146877
Courant number: 0.00500029

Time = 1.17860935
pressure solve iterations =    1
norm(u) = 68.83695508, norm(v) = 9.02050263
Courant number: 0.00500026

Time = 1.23725804
pressure solve iterations =    1
norm(u) = 70.50726990, norm(v) = 9.20181647
Courant number: 0.00500023

Time = 1.29456085
pressure solve iterations =    1
norm(u) = 72.04986099, norm(v) = 9.36784337
Courant number: 0.00500021

Time = 1.35067099
pressure solve iterations =    2
norm(u) = 73.47988751, norm(v) = 9.52052599
Courant number: 0.00500019

Time = 1.40571684
pressure solve iterations =    2
norm(u) = 74.80994744, norm(v) = 9.66149149
Courant number: 0.00500018

Time = 1.45980673
pressure solve iterations =    1
norm(u) = 76.05061952, norm(v) = 9.79211782
Courant number: 0.00500016

Time = 1.51303302
pressure solve iterations =    2
norm(u) = 77.21088618, norm(v) = 9.91354762
Courant number: 0.00500015

Time = 1.56547517
pressure solve iterations =    1
norm(u) = 78.29844717, norm(v) = 10.02673266
Courant number: 0.00500014

Time = 1.61720209
pressure solve iterations =    2
norm(u) = 79.31995547, norm(v) = 10.13249019
Courant number: 0.00500013

Time = 1.66827399
pressure solve iterations =    1
norm(u) = 80.28120097, norm(v) = 10.23153903
Courant number: 0.00500012

Time = 1.71874387
pressure solve iterations =    2
norm(u) = 81.18725773, norm(v) = 10.32450186
Courant number: 0.00500011

Time = 1.76865862
pressure solve iterations =    1
norm(u) = 82.04260048, norm(v) = 10.41191316
Courant number: 0.00500010

Time = 1.81805994
pressure solve iterations =    2
norm(u) = 82.85119651, norm(v) = 10.49423886
Courant number: 0.00500010

Time = 1.86698512
pressure solve iterations =    2
norm(u) = 83.61657969, norm(v) = 10.57189761
Courant number: 0.00500009

Time = 1.91546766
pressure solve iterations =    2
norm(u) = 84.34191271, norm(v) = 10.64526224
Courant number: 0.00500009

Time = 1.96353776
pressure solve iterations =    2
norm(u) = 85.03003841, norm(v) = 10.71466250
Courant number: 0.00500008

Time = 2.01122277
pressure solve iterations =    2
norm(u) = 85.68352222, norm(v) = 10.78038983
Courant number: 0.00500008

Time = 2.05854752
pressure solve iterations =    1
norm(u) = 86.30468701, norm(v) = 10.84270733
Courant number: 0.00500007

Time = 2.10553465
pressure solve iterations =    2
norm(u) = 86.89564292, norm(v) = 10.90185531
Courant number: 0.00500007

Time = 2.15220487
pressure solve iterations =    2
norm(u) = 87.45831299, norm(v) = 10.95805062
Courant number: 0.00500006

Time = 2.19857713
pressure solve iterations =    1
norm(u) = 87.99445485, norm(v) = 11.01148794
Courant number: 0.00500006

Time = 2.24466887
pressure solve iterations =    2
norm(u) = 88.50567835, norm(v) = 11.06234467
Courant number: 0.00500006

Time = 2.29049616
pressure solve iterations =    2
norm(u) = 88.99346337, norm(v) = 11.11078364
Courant number: 0.00500005

Time = 2.33607384
pressure solve iterations =    1
norm(u) = 89.45917273, norm(v) = 11.15695414
Courant number: 0.00500005

Time = 2.38141564
pressure solve iterations =    1
norm(u) = 89.90406422, norm(v) = 11.20099295
Courant number: 0.00500005

Time = 2.42653428
pressure solve iterations =    1
norm(u) = 90.32930113, norm(v) = 11.24302500
Courant number: 0.00500005

Time = 2.47144161
pressure solve iterations =    1
norm(u) = 90.73596149, norm(v) = 11.28316563
Courant number: 0.00500004

Time = 2.51614863
pressure solve iterations =    2
norm(u) = 91.12504598, norm(v) = 11.32152191
Courant number: 0.00500004

Time = 2.56066561
pressure solve iterations =    2
norm(u) = 91.49748520, norm(v) = 11.35819300
Courant number: 0.00500004

Time = 2.60500213
pressure solve iterations =    1
norm(u) = 91.85414598, norm(v) = 11.39327061
Courant number: 0.00500004

Time = 2.64916715
pressure solve iterations =    2
norm(u) = 92.19583708, norm(v) = 11.42683968
Courant number: 0.00500004

Time = 2.69316908
pressure solve iterations =    1
norm(u) = 92.52331420, norm(v) = 11.45897946
Courant number: 0.00500004

Time = 2.73701579
pressure solve iterations =    2
norm(u) = 92.83728437, norm(v) = 11.48976398
Courant number: 0.00500003

Time = 2.78071467
pressure solve iterations =    2
norm(u) = 93.13841005, norm(v) = 11.51926219
Courant number: 0.00500003

Time = 2.82427266
pressure solve iterations =    2
norm(u) = 93.42731268, norm(v) = 11.54753874
Courant number: 0.00500003

Time = 2.86769632
pressure solve iterations =    1
norm(u) = 93.70457601, norm(v) = 11.57465369
Courant number: 0.00500003

Time = 2.91099179
pressure solve iterations =    2
norm(u) = 93.97074890, norm(v) = 11.60066379
Courant number: 0.00500003

Time = 2.95416491
pressure solve iterations =    2
norm(u) = 94.22634802, norm(v) = 11.62562224
Courant number: 0.00500003

Time = 2.99722115
pressure solve iterations =    1
norm(u) = 94.47186026, norm(v) = 11.64957898
Courant number: 0.00500003

Time = 3.04016571
pressure solve iterations =    2
norm(u) = 94.70774483, norm(v) = 11.67258096
Courant number: 0.00500002

Time = 3.08300349
pressure solve iterations =    2
norm(u) = 94.93443532, norm(v) = 11.69467234
Courant number: 0.00500002

Time = 3.12573913
pressure solve iterations =    2
norm(u) = 95.15234147, norm(v) = 11.71589485
Courant number: 0.00500002

Time = 3.16837704
pressure solve iterations =    1
norm(u) = 95.36185085, norm(v) = 11.73628787
Courant number: 0.00500002

Time = 3.21092138
pressure solve iterations =    2
norm(u) = 95.56333036, norm(v) = 11.75588840
Courant number: 0.00500002

Time = 3.25337613
pressure solve iterations =    2
norm(u) = 95.75712758, norm(v) = 11.77473162
Courant number: 0.00500002

Time = 3.29574503
pressure solve iterations =    1
norm(u) = 95.94357207, norm(v) = 11.79285078
Courant number: 0.00500002

Time = 3.33803167
pressure solve iterations =    1
norm(u) = 96.12297648, norm(v) = 11.81027743
Courant number: 0.00500002

Time = 3.38023944
pressure solve iterations =    1
norm(u) = 96.29563769, norm(v) = 11.82704139
Courant number: 0.00500002

Time = 3.42237157
pressure solve iterations =    2
norm(u) = 96.46183774, norm(v) = 11.84317099
Courant number: 0.00500002

Time = 3.46443115
pressure solve iterations =    2
norm(u) = 96.62184479, norm(v) = 11.85869309
Courant number: 0.00500002

Time = 3.50642109
pressure solve iterations =    1
norm(u) = 96.77591391, norm(v) = 11.87363319
Courant number: 0.00500002

Time = 3.54834421
pressure solve iterations =    2
norm(u) = 96.92428788, norm(v) = 11.88801559
Courant number: 0.00500002

Time = 3.59020316
pressure solve iterations =    2
norm(u) = 97.06719794, norm(v) = 11.90186326
Courant number: 0.00500001

Time = 3.63200049
pressure solve iterations =    1
norm(u) = 97.20486443, norm(v) = 11.91519819
Courant number: 0.00500001

Time = 3.67373862
pressure solve iterations =    2
norm(u) = 97.33749742, norm(v) = 11.92804124
Courant number: 0.00500001

Time = 3.71541987
pressure solve iterations =    2
norm(u) = 97.46529731, norm(v) = 11.94041230
Courant number: 0.00500001

Time = 3.75704645
pressure solve iterations =    1
norm(u) = 97.58845531, norm(v) = 11.95233037
Courant number: 0.00500001

Time = 3.79862049
pressure solve iterations =    2
norm(u) = 97.70715402, norm(v) = 11.96381350
Courant number: 0.00500001

Time = 3.84014400
pressure solve iterations =    2
norm(u) = 97.82156782, norm(v) = 11.97487896
Courant number: 0.00500001

Time = 3.88161893
pressure solve iterations =    2
norm(u) = 97.93186337, norm(v) = 11.98554319
Courant number: 0.00500001

Time = 3.92304712
pressure solve iterations =    2
norm(u) = 98.03820000, norm(v) = 11.99582194
Courant number: 0.00500001

Time = 3.96443035
pressure solve iterations =    1
norm(u) = 98.14073009, norm(v) = 12.00573025
Courant number: 0.00500001

Time = 4.00577032
pressure solve iterations =    1
norm(u) = 98.23959943, norm(v) = 12.01528246
Courant number: 0.00500001

Time = 4.04706866
pressure solve iterations =    2
norm(u) = 98.33494755, norm(v) = 12.02449234
Courant number: 0.00500001

Time = 4.08832693
pressure solve iterations =    1
norm(u) = 98.42690806, norm(v) = 12.03337304
Courant number: 0.00500001

Time = 4.12954661
pressure solve iterations =    1
norm(u) = 98.51560892, norm(v) = 12.04193711
Courant number: 0.00500001

Time = 4.17072915
pressure solve iterations =    2
norm(u) = 98.60117271, norm(v) = 12.05019659
Courant number: 0.00500001

Time = 4.21187592
pressure solve iterations =    1
norm(u) = 98.68371693, norm(v) = 12.05816301
Courant number: 0.00500001

Time = 4.25298824
pressure solve iterations =    1
norm(u) = 98.76335422, norm(v) = 12.06584741
Courant number: 0.00500001

Time = 4.29406738
pressure solve iterations =    2
norm(u) = 98.84019258, norm(v) = 12.07326038
Courant number: 0.00500001

Time = 4.33511454
pressure solve iterations =    1
norm(u) = 98.91433565, norm(v) = 12.08041206
Courant number: 0.00500001

Time = 4.37613091
pressure solve iterations =    2
norm(u) = 98.98588282, norm(v) = 12.08731217
Courant number: 0.00500001

Time = 4.41711760
pressure solve iterations =    2
norm(u) = 99.05492950, norm(v) = 12.09397004
Courant number: 0.00500001

Time = 4.45807568
pressure solve iterations =    1
norm(u) = 99.12156730, norm(v) = 12.10039462
Courant number: 0.00500001

Time = 4.49900619
pressure solve iterations =    1
norm(u) = 99.18588416, norm(v) = 12.10659450
Courant number: 0.00500001

Time = 4.53991012
pressure solve iterations =    2
norm(u) = 99.24796454, norm(v) = 12.11257791
Courant number: 0.00500001

Time = 4.58078844
pressure solve iterations =    2
norm(u) = 99.30788960, norm(v) = 12.11835277
Courant number: 0.00500001

Time = 4.62164206
pressure solve iterations =    2
norm(u) = 99.36573730, norm(v) = 12.12392669
Courant number: 0.00500001

Time = 4.66247186
pressure solve iterations =    2
norm(u) = 99.42158259, norm(v) = 12.12930696
Courant number: 0.00500001

Time = 4.70327869
pressure solve iterations =    1
norm(u) = 99.47549751, norm(v) = 12.13450060
Courant number: 0.00500001

Time = 4.74406338
pressure solve iterations =    1
norm(u) = 99.52755130, norm(v) = 12.13951435
Courant number: 0.00500001

Time = 4.78482670
pressure solve iterations =    1
norm(u) = 99.57781057, norm(v) = 12.14435468
Courant number: 0.00500001

Time = 4.82556942
pressure solve iterations =    1
norm(u) = 99.62633938, norm(v) = 12.14902781
Courant number: 0.00500000

Time = 4.86629226
pressure solve iterations =    2
norm(u) = 99.67319935, norm(v) = 12.15353974
Courant number: 0.00500000

Time = 4.90699593
pressure solve iterations =    2
norm(u) = 99.71844978, norm(v) = 12.15789624
Courant number: 0.00500000

Time = 4.94768110
pressure solve iterations =    2
norm(u) = 99.76214771, norm(v) = 12.16210285
Courant number: 0.00500000

Time = 4.98834841
pressure solve iterations =    2
norm(u) = 99.80434807, norm(v) = 12.16616489
Courant number: 0.00500000

Time = 5.02899851
pressure solve iterations =    1
norm(u) = 99.84510371, norm(v) = 12.17008751
Courant number: 0.00500000

Time = 5.06963198
pressure solve iterations =    1
norm(u) = 99.88446553, norm(v) = 12.17387563
Courant number: 0.00500000

Time = 5.11024941
pressure solve iterations =    2
norm(u) = 99.92248252, norm(v) = 12.17753400
Courant number: 0.00500000

Time = 5.15085136
pressure solve iterations =    2
norm(u) = 99.95920187, norm(v) = 12.18106722
Courant number: 0.00500000

Time = 5.19143838
pressure solve iterations =    1
norm(u) = 99.99466904, norm(v) = 12.18447967
Courant number: 0.00500000

Time = 5.23201097
pressure solve iterations =    1
norm(u) = 100.02892781, norm(v) = 12.18777559
Courant number: 0.00500000

Time = 5.27256964
pressure solve iterations =    2
norm(u) = 100.06202035, norm(v) = 12.19095908
Courant number: 0.00500000

Time = 5.31311487
pressure solve iterations =    1
norm(u) = 100.09398731, norm(v) = 12.19403407
Courant number: 0.00500000

Time = 5.35364714
pressure solve iterations =    1
norm(u) = 100.12486783, norm(v) = 12.19700434
Courant number: 0.00500000

Time = 5.39416687
pressure solve iterations =    2
norm(u) = 100.15469966, norm(v) = 12.19987354
Courant number: 0.00500000

Time = 5.43467452
pressure solve iterations =    1
norm(u) = 100.18351918, norm(v) = 12.20264520
Courant number: 0.00500000

Time = 5.47517049
pressure solve iterations =    2
norm(u) = 100.21136144, norm(v) = 12.20532271
Courant number: 0.00500000

Time = 5.51565519
pressure solve iterations =    1
norm(u) = 100.23826023, norm(v) = 12.20790934
Courant number: 0.00500000

Time = 5.55612901
pressure solve iterations =    1
norm(u) = 100.26424816, norm(v) = 12.21040822
Courant number: 0.00500000

Time = 5.59659231
pressure solve iterations =    2
norm(u) = 100.28935662, norm(v) = 12.21282240
Courant number: 0.00500000

Time = 5.63704547
pressure solve iterations =    1
norm(u) = 100.31361593, norm(v) = 12.21515480
Courant number: 0.00500000

Time = 5.67748882
pressure solve iterations =    2
norm(u) = 100.33705530, norm(v) = 12.21740826
Courant number: 0.00500000

Time = 5.71792271
pressure solve iterations =    1
norm(u) = 100.35970291, norm(v) = 12.21958548
Courant number: 0.00500000

Time = 5.75834745
pressure solve iterations =    1
norm(u) = 100.38158594, norm(v) = 12.22168910
Courant number: 0.00500000

Time = 5.79876337
pressure solve iterations =    2
norm(u) = 100.40273061, norm(v) = 12.22372164
Courant number: 0.00500000

Time = 5.83917075
pressure solve iterations =    1
norm(u) = 100.42316221, norm(v) = 12.22568555
Courant number: 0.00500000

Time = 5.87956990
pressure solve iterations =    1
norm(u) = 100.44290514, norm(v) = 12.22758317
Courant number: 0.00500000

Time = 5.91996109
pressure solve iterations =    1
norm(u) = 100.46198294, norm(v) = 12.22941679
Courant number: 0.00500000

Time = 5.96034460
pressure solve iterations =    2
norm(u) = 100.48041834, norm(v) = 12.23118859
Courant number: 0.00500000

Time = 6.00072068
pressure solve iterations =    2
norm(u) = 100.49823324, norm(v) = 12.23290069
Courant number: 0.00500000

Time = 6.04108959
pressure solve iterations =    2
norm(u) = 100.51544880, norm(v) = 12.23455512
Courant number: 0.00500000

Time = 6.08145157
pressure solve iterations =    2
norm(u) = 100.53208543, norm(v) = 12.23615386
Courant number: 0.00500000

Time = 6.12180686
pressure solve iterations =    1
norm(u) = 100.54816284, norm(v) = 12.23769881
Courant number: 0.00500000

Time = 6.16215568
pressure solve iterations =    1
norm(u) = 100.56370004, norm(v) = 12.23919179
Courant number: 0.00500000

Time = 6.20249826
pressure solve iterations =    1
norm(u) = 100.57871539, norm(v) = 12.24063458
Courant number: 0.00500000

Time = 6.24283480
pressure solve iterations =    2
norm(u) = 100.59322661, norm(v) = 12.24202888
Courant number: 0.00500000

Time = 6.28316550
pressure solve iterations =    2
norm(u) = 100.60725079, norm(v) = 12.24337634
Courant number: 0.00500000

Time = 6.32349058
pressure solve iterations =    1
norm(u) = 100.62080445, norm(v) = 12.24467855
Courant number: 0.00500000

Time = 6.36381021
pressure solve iterations =    2
norm(u) = 100.63390354, norm(v) = 12.24593705
Courant number: 0.00500000

Time = 6.40412458
pressure solve iterations =    1
norm(u) = 100.64656343, norm(v) = 12.24715333
Courant number: 0.00500000

Time = 6.44443388
pressure solve iterations =    1
norm(u) = 100.65879900, norm(v) = 12.24832880
Courant number: 0.00500000

Time = 6.48473826
pressure solve iterations =    1
norm(u) = 100.67062459, norm(v) = 12.24946486
Courant number: 0.00500000

Time = 6.52503789
pressure solve iterations =    2
norm(u) = 100.68205405, norm(v) = 12.25056283
Courant number: 0.00500000

Time = 6.56533294
pressure solve iterations =    1
norm(u) = 100.69310076, norm(v) = 12.25162401
Courant number: 0.00500000

Time = 6.60562357
pressure solve iterations =    2
norm(u) = 100.70377765, norm(v) = 12.25264964
Courant number: 0.00500000

Time = 6.64590991
pressure solve iterations =    1
norm(u) = 100.71409719, norm(v) = 12.25364092
Courant number: 0.00500000

Time = 6.68619211
pressure solve iterations =    1
norm(u) = 100.72407143, norm(v) = 12.25459900
Courant number: 0.00500000

Time = 6.72647031
pressure solve iterations =    2
norm(u) = 100.73371201, norm(v) = 12.25552502
Courant number: 0.00500000

Time = 6.76674466
pressure solve iterations =    1
norm(u) = 100.74303017, norm(v) = 12.25642005
Courant number: 0.00500000

Time = 6.80701527
pressure solve iterations =    1
norm(u) = 100.75203676, norm(v) = 12.25728513
Courant number: 0.00500000

Time = 6.84728227
pressure solve iterations =    1
norm(u) = 100.76074227, norm(v) = 12.25812128
Courant number: 0.00500000

Time = 6.88754578
pressure solve iterations =    2
norm(u) = 100.76915682, norm(v) = 12.25892947
Courant number: 0.00500000

Time = 6.92780593
pressure solve iterations =    2
norm(u) = 100.77729021, norm(v) = 12.25971064
Courant number: 0.00500000

Time = 6.96806282
pressure solve iterations =    2
norm(u) = 100.78515188, norm(v) = 12.26046570
Courant number: 0.00500000

Time = 7.00831656
pressure solve iterations =    1
norm(u) = 100.79275096, norm(v) = 12.26119553
Courant number: 0.00500000

Time = 7.04856726
pressure solve iterations =    1
norm(u) = 100.80009627, norm(v) = 12.26190097
Courant number: 0.00500000

Time = 7.08881502
pressure solve iterations =    1
norm(u) = 100.80719634, norm(v) = 12.26258285
Courant number: 0.00500000

Time = 7.12905994
pressure solve iterations =    1
norm(u) = 100.81405938, norm(v) = 12.26324195
Courant number: 0.00500000

Time = 7.16930212
pressure solve iterations =    1
norm(u) = 100.82069335, norm(v) = 12.26387905
Courant number: 0.00500000

Time = 7.20954164
pressure solve iterations =    1
norm(u) = 100.82710594, norm(v) = 12.26449488
Courant number: 0.00500000

Time = 7.24977859
pressure solve iterations =    1
norm(u) = 100.83330457, norm(v) = 12.26509015
Courant number: 0.00500000

Time = 7.29001307
pressure solve iterations =    1
norm(u) = 100.83929641, norm(v) = 12.26566556
Courant number: 0.00500000

Time = 7.33024515
pressure solve iterations =    1
norm(u) = 100.84508838, norm(v) = 12.26622176
Courant number: 0.00500000

Time = 7.37047491
pressure solve iterations =    2
norm(u) = 100.85068719, norm(v) = 12.26675941
Courant number: 0.00500000

Time = 7.41070244
pressure solve iterations =    2
norm(u) = 100.85609929, norm(v) = 12.26727912
Courant number: 0.00500000

Time = 7.45092780
pressure solve iterations =    2
norm(u) = 100.86133095, norm(v) = 12.26778150
Courant number: 0.00500000

Time = 7.49115107
pressure solve iterations =    1
norm(u) = 100.86638820, norm(v) = 12.26826713
Courant number: 0.00500000

Time = 7.53137232
pressure solve iterations =    1
norm(u) = 100.87127687, norm(v) = 12.26873656
Courant number: 0.00500000

Time = 7.57159162
pressure solve iterations =    2
norm(u) = 100.87600261, norm(v) = 12.26919035
Courant number: 0.00500000

Time = 7.61180903
pressure solve iterations =    2
norm(u) = 100.88057086, norm(v) = 12.26962900
Courant number: 0.00500000

Time = 7.65202461
pressure solve iterations =    1
norm(u) = 100.88498689, norm(v) = 12.27005304
Courant number: 0.00500000

Time = 7.69223843
pressure solve iterations =    1
norm(u) = 100.88925579, norm(v) = 12.27046294
Courant number: 0.00500000

Time = 7.73245054
pressure solve iterations =    1
norm(u) = 100.89338248, norm(v) = 12.27085919
Courant number: 0.00500000

Time = 7.77266100
pressure solve iterations =    2
norm(u) = 100.89737170, norm(v) = 12.27124223
Courant number: 0.00500000

Time = 7.81286988
pressure solve iterations =    2
norm(u) = 100.90122805, norm(v) = 12.27161251
Courant number: 0.00500000

Time = 7.85307721
pressure solve iterations =    1
norm(u) = 100.90495597, norm(v) = 12.27197046
Courant number: 0.00500000

Time = 7.89328305
pressure solve iterations =    1
norm(u) = 100.90855975, norm(v) = 12.27231648
Courant number: 0.00500000

Time = 7.93348745
pressure solve iterations =    2
norm(u) = 100.91204353, norm(v) = 12.27265098
Courant number: 0.00500000

Time = 7.97369046
pressure solve iterations =    2
norm(u) = 100.91541132, norm(v) = 12.27297434
Courant number: 0.00500000

Time = 8.01389213
pressure solve iterations =    1
norm(u) = 100.91866698, norm(v) = 12.27328693
Courant number: 0.00500000

Time = 8.05409250
pressure solve iterations =    2
norm(u) = 100.92181427, norm(v) = 12.27358911
Courant number: 0.00500000

Time = 8.09429161
pressure solve iterations =    1
norm(u) = 100.92485679, norm(v) = 12.27388123
Courant number: 0.00500000

Time = 8.13448950
pressure solve iterations =    1
norm(u) = 100.92779804, norm(v) = 12.27416363
Courant number: 0.00500000

Time = 8.17468622
pressure solve iterations =    2
norm(u) = 100.93064140, norm(v) = 12.27443663
Courant number: 0.00500000

Time = 8.21488181
pressure solve iterations =    1
norm(u) = 100.93339014, norm(v) = 12.27470054
Courant number: 0.00500000

Time = 8.25507630
pressure solve iterations =    2
norm(u) = 100.93604741, norm(v) = 12.27495567
Courant number: 0.00500000

Time = 8.29526973
pressure solve iterations =    1
norm(u) = 100.93861625, norm(v) = 12.27520230
Courant number: 0.00500000

Time = 8.33546213
pressure solve iterations =    2
norm(u) = 100.94109963, norm(v) = 12.27544073
Courant number: 0.00500000

Time = 8.37565355
pressure solve iterations =    1
norm(u) = 100.94350037, norm(v) = 12.27567122
Courant number: 0.00500000

Time = 8.41584400
pressure solve iterations =    2
norm(u) = 100.94582125, norm(v) = 12.27589405
Courant number: 0.00500000

Time = 8.45603353
pressure solve iterations =    1
norm(u) = 100.94806492, norm(v) = 12.27610946
Courant number: 0.00500000

Time = 8.49622216
pressure solve iterations =    2
norm(u) = 100.95023395, norm(v) = 12.27631770
Courant number: 0.00500000

Time = 8.53640993
pressure solve iterations =    1
norm(u) = 100.95233084, norm(v) = 12.27651902
Courant number: 0.00500000

Time = 8.57659686
pressure solve iterations =    2
norm(u) = 100.95435798, norm(v) = 12.27671364
Courant number: 0.00500000

Time = 8.61678298
pressure solve iterations =    1
norm(u) = 100.95631769, norm(v) = 12.27690179
Courant number: 0.00500000

Time = 8.65696832
pressure solve iterations =    2
norm(u) = 100.95821223, norm(v) = 12.27708367
Courant number: 0.00500000

Time = 8.69715291
pressure solve iterations =    1
norm(u) = 100.96004377, norm(v) = 12.27725951
Courant number: 0.00500000

Time = 8.73733676
pressure solve iterations =    2
norm(u) = 100.96181439, norm(v) = 12.27742950
Courant number: 0.00500000

Time = 8.77751991
pressure solve iterations =    1
norm(u) = 100.96352614, norm(v) = 12.27759384
Courant number: 0.00500000

Time = 8.81770237
pressure solve iterations =    1
norm(u) = 100.96518096, norm(v) = 12.27775271
Courant number: 0.00500000

Time = 8.85788418
pressure solve iterations =    2
norm(u) = 100.96678076, norm(v) = 12.27790630
Courant number: 0.00500000

Time = 8.89806535
pressure solve iterations =    1
norm(u) = 100.96832737, norm(v) = 12.27805478
Courant number: 0.00500000

Time = 8.93824589
pressure solve iterations =    2
norm(u) = 100.96982256, norm(v) = 12.27819832
Courant number: 0.00500000

Time = 8.97842585
pressure solve iterations =    1
norm(u) = 100.97126804, norm(v) = 12.27833709
Courant number: 0.00500000

Time = 9.01860522
pressure solve iterations =    1
norm(u) = 100.97266546, norm(v) = 12.27847125
Courant number: 0.00500000

Time = 9.05878404
pressure solve iterations =    2
norm(u) = 100.97401642, norm(v) = 12.27860094
Courant number: 0.00500000

Time = 9.09896232
pressure solve iterations =    1
norm(u) = 100.97532247, norm(v) = 12.27872633
Courant number: 0.00500000

Time = 9.13914008
pressure solve iterations =    1
norm(u) = 100.97658511, norm(v) = 12.27884754
Courant number: 0.00500000

Time = 9.17931734
pressure solve iterations =    2
norm(u) = 100.97780577, norm(v) = 12.27896473
Courant number: 0.00500000

Time = 9.21949411
pressure solve iterations =    1
norm(u) = 100.97898586, norm(v) = 12.27907802
Courant number: 0.00500000

Time = 9.25967041
pressure solve iterations =    1
norm(u) = 100.98012673, norm(v) = 12.27918755
Courant number: 0.00500000

Time = 9.29984625
pressure solve iterations =    2
norm(u) = 100.98122967, norm(v) = 12.27929343
Courant number: 0.00500000

Time = 9.34002165
pressure solve iterations =    2
norm(u) = 100.98229595, norm(v) = 12.27939579
Courant number: 0.00500000

Time = 9.38019663
pressure solve iterations =    1
norm(u) = 100.98332680, norm(v) = 12.27949476
Courant number: 0.00500000

Time = 9.42037120
pressure solve iterations =    2
norm(u) = 100.98432338, norm(v) = 12.27959043
Courant number: 0.00500000

Time = 9.46054537
pressure solve iterations =    2
norm(u) = 100.98528684, norm(v) = 12.27968292
Courant number: 0.00500000

Time = 9.50071916
pressure solve iterations =    1
norm(u) = 100.98621828, norm(v) = 12.27977234
Courant number: 0.00500000

Time = 9.54089257
pressure solve iterations =    1
norm(u) = 100.98711877, norm(v) = 12.27985879
Courant number: 0.00500000

Time = 9.58106563
pressure solve iterations =    2
norm(u) = 100.98798933, norm(v) = 12.27994236
Courant number: 0.00500000

Time = 9.62123834
pressure solve iterations =    2
norm(u) = 100.98883096, norm(v) = 12.28002316
Courant number: 0.00500000

Time = 9.66141071
pressure solve iterations =    2
norm(u) = 100.98964463, norm(v) = 12.28010127
Courant number: 0.00500000

Time = 9.70158276
pressure solve iterations =    1
norm(u) = 100.99043125, norm(v) = 12.28017678
Courant number: 0.00500000

Time = 9.74175449
pressure solve iterations =    1
norm(u) = 100.99119174, norm(v) = 12.28024979
Courant number: 0.00500000

Time = 9.78192592
pressure solve iterations =    2
norm(u) = 100.99192695, norm(v) = 12.28032037
Courant number: 0.00500000

Time = 9.82209706
pressure solve iterations =    2
norm(u) = 100.99263774, norm(v) = 12.28038860
Courant number: 0.00500000

Time = 9.86226792
pressure solve iterations =    2
norm(u) = 100.99332490, norm(v) = 12.28045457
Courant number: 0.00500000

Time = 9.90243850
pressure solve iterations =    1
norm(u) = 100.99398924, norm(v) = 12.28051835
Courant number: 0.00500000

Time = 9.94260881
pressure solve iterations =    1
norm(u) = 100.99463150, norm(v) = 12.28058000
Courant number: 0.00500000

Time = 9.98277887
pressure solve iterations =    1
norm(u) = 100.99525242, norm(v) = 12.28063961
Courant number: 0.00500000
Time taken by calculation =  306.7849705219269
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set up figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">p</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<span class="c1"># don&#39;t plot at every gird point - every 5th</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">X</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">],</span><span class="n">Y</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">],</span><span class="n">u</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">],</span><span class="n">v</span><span class="p">[::</span><span class="mi">20</span><span class="p">,::</span><span class="mi">5</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pressure driven problem - pressure and velocity vectors&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u</span><span class="o">*</span><span class="n">u</span><span class="o">+</span><span class="n">v</span><span class="o">*</span><span class="n">v</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">coolwarm</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cont</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$x$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$y$&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Pressure driven problem - speed&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Pressure driven problem - speed&#39;)
</pre></div>
</div>
<img alt="../../_images/02c7dcbab27f4139ce41cb83bc2fdcddb83a6e052cef11b29222c0247011221c.png" src="../../_images/02c7dcbab27f4139ce41cb83bc2fdcddb83a6e052cef11b29222c0247011221c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flow_in</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span><span class="o">*</span><span class="n">Ly</span>
<span class="n">flow_out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span><span class="o">*</span><span class="n">Ly</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flow in &#39;</span><span class="p">,</span><span class="n">flow_in</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;flow out &#39;</span><span class="p">,</span><span class="n">flow_out</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>flow in  44.11691653247884
flow out  44.30906374017106
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Chapter7/Solvers"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Solver_pressure_driven_Vectorised.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">&lt;no title&gt;</p>
      </div>
    </a>
    <a class="right-next"
       href="../../Chapter8/intro.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">8. Turbulence and Non-Newtonian Flows</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Imperial College London
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
       Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>